import{a as r,j as e}from"./vendor-react-query-BZoSzIJu.js";import{A as F,U as L,S as E,a as B,z as V,b as D,B as q}from"./HomePage-D2yojtKn.js";import{f as _,z as H,A as G,y as z,B as O,D as I,F as W,G as Q,i as Y}from"./vendor-web3-DyILjG9k.js";import{y as K,j as X,Y as $,F as Z}from"./FormInput-HyhUTaM5.js";import{y as J}from"./close-button-wcmtdzOM.js";import"./bn-lqe85siY.js";import"./inherits_browser-ObB8GLRm.js";import"./hash-BGiI6FLj.js";const U=[{inputs:[{components:[{internalType:"address",name:"permit2",type:"address"},{internalType:"address",name:"weth9",type:"address"},{internalType:"address",name:"seaportV1_5",type:"address"},{internalType:"address",name:"seaportV1_4",type:"address"},{internalType:"address",name:"openseaConduit",type:"address"},{internalType:"address",name:"nftxZap",type:"address"},{internalType:"address",name:"x2y2",type:"address"},{internalType:"address",name:"foundation",type:"address"},{internalType:"address",name:"sudoswap",type:"address"},{internalType:"address",name:"elementMarket",type:"address"},{internalType:"address",name:"nft20Zap",type:"address"},{internalType:"address",name:"cryptopunks",type:"address"},{internalType:"address",name:"looksRareV2",type:"address"},{internalType:"address",name:"routerRewardsDistributor",type:"address"},{internalType:"address",name:"looksRareRewardsDistributor",type:"address"},{internalType:"address",name:"looksRareToken",type:"address"},{internalType:"address",name:"v2Factory",type:"address"},{internalType:"address",name:"v3Factory",type:"address"},{internalType:"bytes32",name:"pairInitCodeHash",type:"bytes32"},{internalType:"bytes32",name:"poolInitCodeHash",type:"bytes32"}],internalType:"struct RouterParameters",name:"params",type:"tuple"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"BalanceTooLow",type:"error"},{inputs:[],name:"BuyPunkFailed",type:"error"},{inputs:[],name:"ContractLocked",type:"error"},{inputs:[],name:"ETHNotAccepted",type:"error"},{inputs:[{internalType:"uint256",name:"commandIndex",type:"uint256"},{internalType:"bytes",name:"message",type:"bytes"}],name:"ExecutionFailed",type:"error"},{inputs:[],name:"FromAddressIsNotOwner",type:"error"},{inputs:[],name:"InsufficientETH",type:"error"},{inputs:[],name:"InsufficientToken",type:"error"},{inputs:[],name:"InvalidBips",type:"error"},{inputs:[{internalType:"uint256",name:"commandType",type:"uint256"}],name:"InvalidCommandType",type:"error"},{inputs:[],name:"InvalidOwnerERC1155",type:"error"},{inputs:[],name:"InvalidOwnerERC721",type:"error"},{inputs:[],name:"InvalidPath",type:"error"},{inputs:[],name:"InvalidReserves",type:"error"},{inputs:[],name:"InvalidSpender",type:"error"},{inputs:[],name:"LengthMismatch",type:"error"},{inputs:[],name:"SliceOutOfBounds",type:"error"},{inputs:[],name:"TransactionDeadlinePassed",type:"error"},{inputs:[],name:"UnableToClaim",type:"error"},{inputs:[],name:"UnsafeCast",type:"error"},{inputs:[],name:"V2InvalidPath",type:"error"},{inputs:[],name:"V2TooLittleReceived",type:"error"},{inputs:[],name:"V2TooMuchRequested",type:"error"},{inputs:[],name:"V3InvalidAmountOut",type:"error"},{inputs:[],name:"V3InvalidCaller",type:"error"},{inputs:[],name:"V3InvalidSwap",type:"error"},{inputs:[],name:"V3TooLittleReceived",type:"error"},{inputs:[],name:"V3TooMuchRequested",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"RewardsSent",type:"event"},{inputs:[{internalType:"bytes",name:"looksRareClaim",type:"bytes"}],name:"collectRewards",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"commands",type:"bytes"},{internalType:"bytes[]",name:"inputs",type:"bytes[]"}],name:"execute",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"commands",type:"bytes"},{internalType:"bytes[]",name:"inputs",type:"bytes[]"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"execute",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256[]",name:"",type:"uint256[]"},{internalType:"uint256[]",name:"",type:"uint256[]"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC1155BatchReceived",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC1155Received",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC721Received",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"int256",name:"amount0Delta",type:"int256"},{internalType:"int256",name:"amount1Delta",type:"int256"},{internalType:"bytes",name:"data",type:"bytes"}],name:"uniswapV3SwapCallback",outputs:[],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}];function ee(d){const[M,l]=r.useState({loading:!1,error:null,txHash:null,quote:null}),{address:p}=_(),o=H(),{data:u}=G(),[s,y]=r.useState(null),A=r.useCallback(async({tokenIn:c,tokenOut:x,amount:m,slippagePercentage:n})=>{if(!(!p||!o)){l(a=>({...a,loading:!0}));try{const a=z(m,6),i=O(["uint8"],[32]),t=O(["uint8","uint8","uint8"],[F.SWAP_EXACT_IN_SINGLE,F.SETTLE_ALL,F.TAKE_ALL]),b={currency0:L[d],currency1:c,fee:3e3,tickSpacing:60,hooks:"0x0000000000000000000000000000000000000000"},T=I({abi:[{name:"exactInputSingle",type:"function",inputs:[{name:"params",type:"tuple",components:[{name:"poolKey",type:"tuple",components:[{name:"currency0",type:"address"},{name:"currency1",type:"address"},{name:"fee",type:"uint24"},{name:"tickSpacing",type:"int24"},{name:"hooks",type:"address"}]},{name:"zeroForOne",type:"bool"},{name:"amountIn",type:"uint256"},{name:"amountOutMinimum",type:"uint256"},{name:"sqrtPriceLimitX96",type:"uint160"},{name:"hookData",type:"bytes"}]}]}],functionName:"exactInputSingle",args:[{poolKey:b,zeroForOne:!0,amountIn:a,amountOutMinimum:BigInt(0),sqrtPriceLimitX96:BigInt(0),hookData:"0x0000000000000000000000000000000000000000000000000000000000000000"}]}),j=I({abi:[{name:"settleAll",type:"function",inputs:[{name:"currency",type:"address"},{name:"amount",type:"uint256"}]}],functionName:"settleAll",args:[b.currency0,a]}),N=I({abi:[{name:"takeAll",type:"function",inputs:[{name:"currency",type:"address"},{name:"amountMinimum",type:"uint256"}]}],functionName:"takeAll",args:[b.currency1,BigInt(0)]}),C=[I({abi:[{name:"execute",type:"function",inputs:[{name:"actions",type:"bytes"},{name:"params",type:"bytes[]"}]}],functionName:"execute",args:[t,[T,j,N]]})],k=BigInt(Math.floor(Date.now()/1e3)+1800);y({commands:i,inputs:C,deadline:k});const P=(parseFloat(m)*.003).toFixed(6),S="< 1%";await o.simulateContract({address:E[d],abi:U,functionName:"execute",args:[i,C,k],account:p});const f=BigInt(0);l(w=>({...w,loading:!1,quote:{outputAmount:W(f,18),fee:P,priceImpact:S}}))}catch(a){console.error("Error getting quote:",a),l(i=>({...i,quote:null}))}}},[p,d,o]),h=r.useCallback(async(c,x)=>{if(!p||!u||!o)return!1;try{if(await o.readContract({address:c,abi:B,functionName:"allowance",args:[p,E[d]]})<BigInt(x)){const{request:n}=await o.simulateContract({address:c,abi:B,functionName:"approve",args:[E[d],BigInt(x)],account:p});await u.writeContract(n)}return!0}catch(m){return console.error("Error in token approval:",m),!1}},[p,d,o,u]),v=r.useCallback(async({tokenIn:c,tokenOut:x,amount:m,slippagePercentage:n})=>{if(!p||!o||!u||!s){l(a=>({...a,error:new Error("Missing required parameters or wallet not connected")}));return}l(a=>({...a,loading:!0,error:null}));try{if(!await h(c,m))throw new Error("Token approval failed");if(!s)throw new Error("Swap configuration not found");const{commands:i,inputs:t,deadline:b}=s,g=await u.writeContract({address:E[d],abi:U,functionName:"execute",args:[i,t,b]});return l(T=>({...T,loading:!1,error:null,txHash:g})),g}catch(a){const i=a;throw console.error("Error executing swap:",i),l(t=>({...t,loading:!1,error:i})),i}},[p,d,o,u,h,s]);return{state:M,getQuote:A,swap:v}}const pe=({isOpen:d,onClose:M,tokenAddress:l,tokenName:p="AmmoToken",tokenSymbol:o="AMMO",onSuccess:u,onError:s})=>{var S;const{chain:y,address:A,isConnected:h}=_(),{openConnectModal:v}=Q(),c=(y==null?void 0:y.id)||1,{data:x}=Y({address:A,token:L[c]}),m=r.useMemo(()=>x?parseFloat(x.formatted).toFixed(2):"0.00",[x]),{state:n,getQuote:a,swap:i}=ee(c),[t,b]=r.useState(""),g=5,T=10,j=L[c]||"",N=t&&parseFloat(t)>0?(parseFloat(t)*T/100).toFixed(2):"0.00",R=t&&parseFloat(t)>0?(parseFloat(t)+parseFloat(N)).toFixed(2):"0.00";r.useEffect(()=>{(async()=>{if(!(!t||parseFloat(t)<=0))try{await a({tokenIn:j,tokenOut:l,amount:t,slippagePercentage:g})}catch(w){console.error("Error getting quote:",w),s&&w instanceof Error&&s(w)}})()},[t,a,l,j,s]),r.useEffect(()=>{n.txHash&&u&&u(n.txHash)},[n.txHash,u]),r.useEffect(()=>{n.error&&s&&s(n.error)},[n.error,s]);const C=async()=>{if(!t||parseFloat(t)<=0){alert("Please enter a valid USDC amount");return}try{await i({tokenIn:j,tokenOut:l,amount:R,slippagePercentage:g})}catch(f){console.error("Error executing swap:",f),s&&f instanceof Error&&s(f)}},k=()=>{h?C():v==null||v()};return e.jsx(V,{show:d,as:r.Fragment,children:e.jsxs(K,{as:"div",className:"relative z-50",onClose:M,children:[e.jsx(D,{as:r.Fragment,children:e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm transition duration-300 data-[closed]:opacity-0","aria-hidden":"true"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-3 md:p-4",children:e.jsx(D,{as:r.Fragment,children:e.jsxs(X,{className:"w-full max-w-sm md:max-w-md transform overflow-hidden rounded-none bg-background border border-border p-4 md:p-6 transition-all duration-300 ease-out data-[closed]:opacity-0 data-[closed]:scale-95",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs($,{as:"h3",className:"text-lg font-mono font-bold text-accentGreen",children:["Purchase ",o]}),e.jsx(J,{className:"text-muted hover:text-foreground focus:outline-none","aria-label":"Close",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex flex-col w-full space-y-3",children:[e.jsx("p",{className:"text-xs text-muted w-full",children:p}),e.jsxs("div",{className:"w-full space-y-3",children:[e.jsx("div",{className:"bg-muted/10 p-2 rounded-none border border-border",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-muted",children:"Your USDC Balance:"}),e.jsxs("span",{className:"text-xs font-mono font-medium text-foreground",children:["$",m]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{label:"Purchase Amount (USDC)",id:"amount-input",type:"number",value:t,onChange:f=>b(f.target.value),placeholder:"0.00",min:"0",step:"0.01",className:"pr-12 text-xs font-mono"}),e.jsx("span",{className:"absolute right-3 bottom-2 text-xs text-muted",children:"USDC"})]}),e.jsxs("div",{className:"border border-border rounded-none overflow-hidden",children:[e.jsx("div",{className:"bg-muted/10 px-3 py-1.5 border-b border-border",children:e.jsx("h3",{className:"font-medium text-xs font-mono text-foreground",children:"Order Summary"})}),e.jsxs("div",{className:"p-2.5 space-y-1.5 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted",children:"Subtotal"}),e.jsxs("span",{className:"font-mono font-medium text-foreground",children:[t||"0.00"," USDC"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-muted",children:["Shipping (",T,"%)"]}),e.jsxs("span",{className:"font-mono font-medium text-foreground",children:[N," USDC"]})]}),e.jsx("div",{className:"border-t border-border my-1 pt-1"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium font-mono text-foreground",children:"Total"}),e.jsxs("span",{className:"font-bold font-mono text-foreground",children:[R," USDC"]})]}),n.quote&&e.jsxs("div",{className:"flex justify-between pt-1 border-t border-border",children:[e.jsx("span",{className:"text-muted",children:"You receive (est.)"}),e.jsxs("span",{className:"font-mono font-medium text-accentGreen",children:[n.quote.outputAmount," ",o]})]})]})]}),e.jsxs("div",{className:"bg-muted/10 p-2 rounded-none text-xs border border-border",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted font-medium mb-0.5",children:[e.jsx("svg",{className:"w-4 h-4 text-muted flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),e.jsx("span",{className:"font-mono",children:"Shipping Info"})]}),e.jsxs("p",{className:"text-muted pl-5",children:["Est. delivery:"," ",e.jsx("span",{className:"font-medium text-foreground font-mono",children:"2-4 weeks"})]})]}),e.jsx(q,{variant:"primary",fullWidth:!0,onClick:k,disabled:h&&(n.loading||!t||!n.quote||parseFloat(t)<=0),children:h?n.loading?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("svg",{className:"animate-spin h-4 w-4 mr-2 text-accentGreen",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M12 2 L12 5 M12 19 L12 22 M5 12 L2 12 M22 12 L19 12 M19.07 4.93 L16.95 7.05 M7.05 16.95 L4.93 19.07 M19.07 19.07 L16.95 16.95 M7.05 7.05 L4.93 4.93",strokeWidth:"2",strokeLinecap:"round"})}),e.jsx("span",{className:"font-mono",children:"Processing..."})]}):"Complete Purchase":"Connect Wallet"}),n.error&&e.jsx("div",{className:"bg-destructive/10 text-destructive p-2 rounded-none text-xs border border-destructive",children:n.error.message}),n.txHash&&e.jsxs("div",{className:"bg-accentGreen/10 text-accentGreen p-2 rounded-none text-xs border border-accentGreen",children:[e.jsx("p",{className:"font-medium font-mono",children:"Order Confirmed!"}),e.jsx("a",{href:`https://${(S=y==null?void 0:y.name)!=null&&S.toLowerCase().includes("base")?"basescan.org":"sepolia.etherscan.io"}/tx/${n.txHash}`,target:"_blank",rel:"noopener noreferrer",className:"text-foreground underline font-mono",children:"View Transaction"})]}),e.jsx("p",{className:"text-xs text-muted text-center mt-2",children:"By completing this purchase, you agree to our Terms of Service and acknowledge that physical redemption is subject to verification and applicable regulations."})]})]})]})})})]})})};export{pe as PurchaseDialog};
