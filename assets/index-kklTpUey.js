import{r as Ne}from"./index-CCQ-jUte.js";import{j as qe}from"./vendor-web3-Dhm48kts.js";import"./vendor-react-query-BcVPugoj.js";const De=()=>"9.1.0",Ue=e=>e.toString(16).padStart(2,"0"),Ve=e=>{const t=new Uint8Array(e/2);return window.crypto.getRandomValues(t),Array.from(t,Ue).join("")},Fe=()=>typeof window<"u"?Ve(10):new Date().getTime().toString(36);class M{}M.makeRequest=(e,t)=>({id:Fe(),method:e,params:t,env:{sdkVersion:De()}});M.makeResponse=(e,t,n)=>({id:e,success:!0,version:n,data:t});M.makeErrorResponse=(e,t,n)=>({id:e,success:!1,error:t,version:n});var d;(function(e){e.sendTransactions="sendTransactions",e.rpcCall="rpcCall",e.getChainInfo="getChainInfo",e.getSafeInfo="getSafeInfo",e.getTxBySafeTxHash="getTxBySafeTxHash",e.getSafeBalances="getSafeBalances",e.signMessage="signMessage",e.signTypedMessage="signTypedMessage",e.getEnvironmentInfo="getEnvironmentInfo",e.getOffChainSignature="getOffChainSignature",e.requestAddressBook="requestAddressBook",e.wallet_getPermissions="wallet_getPermissions",e.wallet_requestPermissions="wallet_requestPermissions"})(d||(d={}));var L;(function(e){e.requestAddressBook="requestAddressBook"})(L||(L={}));class We{constructor(t=null,n=!1){this.allowedOrigins=null,this.callbacks=new Map,this.debugMode=!1,this.isServer=typeof window>"u",this.isValidMessage=({origin:s,data:r,source:i})=>{const o=!r,a=!this.isServer&&i===window.parent,c=typeof r.version<"u"&&parseInt(r.version.split(".")[0]),l=typeof c=="number"&&c>=1;let f=!0;return Array.isArray(this.allowedOrigins)&&(f=this.allowedOrigins.find(h=>h.test(s))!==void 0),!o&&a&&l&&f},this.logIncomingMessage=s=>{console.info(`Safe Apps SDK v1: A message was received from origin ${s.origin}. `,s.data)},this.onParentMessage=s=>{this.isValidMessage(s)&&(this.debugMode&&this.logIncomingMessage(s),this.handleIncomingMessage(s.data))},this.handleIncomingMessage=s=>{const{id:r}=s,i=this.callbacks.get(r);i&&(i(s),this.callbacks.delete(r))},this.send=(s,r)=>{const i=M.makeRequest(s,r);if(this.isServer)throw new Error("Window doesn't exist");return window.parent.postMessage(i,"*"),new Promise((o,a)=>{this.callbacks.set(i.id,c=>{if(!c.success){a(new Error(c.error));return}o(c)})})},this.allowedOrigins=t,this.debugMode=n,this.isServer||window.addEventListener("message",this.onParentMessage)}}const ae=e=>typeof e=="object"&&e!=null&&"domain"in e&&"types"in e&&"message"in e;Ne();class Ge{constructor(t){this.communicator=t}async getBySafeTxHash(t){if(!t)throw new Error("Invalid safeTxHash");return(await this.communicator.send(d.getTxBySafeTxHash,{safeTxHash:t})).data}async signMessage(t){const n={message:t};return(await this.communicator.send(d.signMessage,n)).data}async signTypedMessage(t){if(!ae(t))throw new Error("Invalid typed data");return(await this.communicator.send(d.signTypedMessage,{typedData:t})).data}async send({txs:t,params:n}){if(!t||!t.length)throw new Error("No transactions were passed");const s={txs:t,params:n};return(await this.communicator.send(d.sendTransactions,s)).data}}const p={eth_call:"eth_call",eth_gasPrice:"eth_gasPrice",eth_getLogs:"eth_getLogs",eth_getBalance:"eth_getBalance",eth_getCode:"eth_getCode",eth_getBlockByHash:"eth_getBlockByHash",eth_getBlockByNumber:"eth_getBlockByNumber",eth_getStorageAt:"eth_getStorageAt",eth_getTransactionByHash:"eth_getTransactionByHash",eth_getTransactionReceipt:"eth_getTransactionReceipt",eth_getTransactionCount:"eth_getTransactionCount",eth_estimateGas:"eth_estimateGas",safe_setSettings:"safe_setSettings"},m={defaultBlockParam:(e="latest")=>e,returnFullTxObjectParam:(e=!1)=>e,blockNumberToHex:e=>Number.isInteger(e)?`0x${e.toString(16)}`:e};class Xe{constructor(t){this.communicator=t,this.call=this.buildRequest({call:p.eth_call,formatters:[null,m.defaultBlockParam]}),this.getBalance=this.buildRequest({call:p.eth_getBalance,formatters:[null,m.defaultBlockParam]}),this.getCode=this.buildRequest({call:p.eth_getCode,formatters:[null,m.defaultBlockParam]}),this.getStorageAt=this.buildRequest({call:p.eth_getStorageAt,formatters:[null,m.blockNumberToHex,m.defaultBlockParam]}),this.getPastLogs=this.buildRequest({call:p.eth_getLogs}),this.getBlockByHash=this.buildRequest({call:p.eth_getBlockByHash,formatters:[null,m.returnFullTxObjectParam]}),this.getBlockByNumber=this.buildRequest({call:p.eth_getBlockByNumber,formatters:[m.blockNumberToHex,m.returnFullTxObjectParam]}),this.getTransactionByHash=this.buildRequest({call:p.eth_getTransactionByHash}),this.getTransactionReceipt=this.buildRequest({call:p.eth_getTransactionReceipt}),this.getTransactionCount=this.buildRequest({call:p.eth_getTransactionCount,formatters:[null,m.defaultBlockParam]}),this.getGasPrice=this.buildRequest({call:p.eth_gasPrice}),this.getEstimateGas=n=>this.buildRequest({call:p.eth_estimateGas})([n]),this.setSafeSettings=this.buildRequest({call:p.safe_setSettings})}buildRequest(t){const{call:n,formatters:s}=t;return async r=>{s&&Array.isArray(r)&&s.forEach((a,c)=>{a&&(r[c]=a(r[c]))});const i={call:n,params:r||[]};return(await this.communicator.send(d.rpcCall,i)).data}}}function R(e,{includeName:t=!1}={}){if(e.type!=="function"&&e.type!=="event"&&e.type!=="error")throw new st(e.type);return`${e.name}(${ce(e.inputs,{includeName:t})})`}function ce(e,{includeName:t=!1}={}){return e?e.map(n=>Ke(n,{includeName:t})).join(t?", ":","):""}function Ke(e,{includeName:t}){return e.type.startsWith("tuple")?`(${ce(e.components,{includeName:t})})${e.type.slice(5)}`:e.type+(t&&e.name?` ${e.name}`:"")}function k(e,{strict:t=!0}={}){return!e||typeof e!="string"?!1:t?/^0x[0-9a-fA-F]*$/.test(e):e.startsWith("0x")}function g(e){return k(e,{strict:!1})?Math.ceil((e.length-2)/2):e.length}const ue="2.28.0";let $={getDocsUrl:({docsBaseUrl:e,docsPath:t="",docsSlug:n})=>t?`${e??"https://viem.sh"}${t}${n?`#${n}`:""}`:void 0,version:`viem@${ue}`};class u extends Error{constructor(t,n={}){var a;const s=(()=>{var c;return n.cause instanceof u?n.cause.details:(c=n.cause)!=null&&c.message?n.cause.message:n.details})(),r=n.cause instanceof u&&n.cause.docsPath||n.docsPath,i=(a=$.getDocsUrl)==null?void 0:a.call($,{...n,docsPath:r}),o=[t||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...i?[`Docs: ${i}`]:[],...s?[`Details: ${s}`]:[],...$.version?[`Version: ${$.version}`]:[]].join(`
`);super(o,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=s,this.docsPath=r,this.metaMessages=n.metaMessages,this.name=n.name??this.name,this.shortMessage=t,this.version=ue}walk(t){return fe(this,t)}}function fe(e,t){return t!=null&&t(e)?e:e&&typeof e=="object"&&"cause"in e&&e.cause!==void 0?fe(e.cause,t):t?null:e}class Je extends u{constructor({expectedLength:t,givenLength:n,type:s}){super([`ABI encoding array length mismatch for type ${s}.`,`Expected length: ${t}`,`Given length: ${n}`].join(`
`),{name:"AbiEncodingArrayLengthMismatchError"})}}class Qe extends u{constructor({expectedSize:t,value:n}){super(`Size of bytes "${n}" (bytes${g(n)}) does not match expected size (bytes${t}).`,{name:"AbiEncodingBytesSizeMismatchError"})}}class Ye extends u{constructor({expectedLength:t,givenLength:n}){super(["ABI encoding params/values length mismatch.",`Expected length (params): ${t}`,`Given length (values): ${n}`].join(`
`),{name:"AbiEncodingLengthMismatchError"})}}class K extends u{constructor(t,{docsPath:n}={}){super([`Function ${t?`"${t}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the function exists on it."].join(`
`),{docsPath:n,name:"AbiFunctionNotFoundError"})}}class Ze extends u{constructor(t,n){super("Found ambiguous types in overloaded ABI items.",{metaMessages:[`\`${t.type}\` in \`${R(t.abiItem)}\`, and`,`\`${n.type}\` in \`${R(n.abiItem)}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."],name:"AbiItemAmbiguityError"})}}class et extends u{constructor({expectedSize:t,givenSize:n}){super(`Expected bytes${t}, got bytes${n}.`,{name:"BytesSizeMismatchError"})}}class tt extends u{constructor(t,{docsPath:n}){super([`Type "${t}" is not a valid encoding type.`,"Please provide a valid ABI type."].join(`
`),{docsPath:n,name:"InvalidAbiEncodingType"})}}class nt extends u{constructor(t){super([`Value "${t}" is not a valid array.`].join(`
`),{name:"InvalidArrayError"})}}class st extends u{constructor(t){super([`"${t}" is not a valid definition type.`,'Valid types: "function", "event", "error"'].join(`
`),{name:"InvalidDefinitionTypeError"})}}class le extends u{constructor({offset:t,position:n,size:s}){super(`Slice ${n==="start"?"starting":"ending"} at offset "${t}" is out-of-bounds (size: ${s}).`,{name:"SliceOffsetOutOfBoundsError"})}}class de extends u{constructor({size:t,targetSize:n,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} size (${t}) exceeds padding size (${n}).`,{name:"SizeExceedsPaddingSizeError"})}}function I(e,{dir:t,size:n=32}={}){return typeof e=="string"?w(e,{dir:t,size:n}):rt(e,{dir:t,size:n})}function w(e,{dir:t,size:n=32}={}){if(n===null)return e;const s=e.replace("0x","");if(s.length>n*2)throw new de({size:Math.ceil(s.length/2),targetSize:n,type:"hex"});return`0x${s[t==="right"?"padEnd":"padStart"](n*2,"0")}`}function rt(e,{dir:t,size:n=32}={}){if(n===null)return e;if(e.length>n)throw new de({size:e.length,targetSize:n,type:"bytes"});const s=new Uint8Array(n);for(let r=0;r<n;r++){const i=t==="right";s[i?r:n-r-1]=e[i?r:e.length-r-1]}return s}class he extends u{constructor({max:t,min:n,signed:s,size:r,value:i}){super(`Number "${i}" is not in safe ${r?`${r*8}-bit ${s?"signed":"unsigned"} `:""}integer range ${t?`(${n} to ${t})`:`(above ${n})`}`,{name:"IntegerOutOfRangeError"})}}class it extends u{constructor({givenSize:t,maxSize:n}){super(`Size cannot exceed ${n} bytes. Given size: ${t} bytes.`,{name:"SizeOverflowError"})}}function _(e,{size:t}){if(g(e)>t)throw new it({givenSize:g(e),maxSize:t})}const ot=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function q(e,t={}){return typeof e=="number"||typeof e=="bigint"?S(e,t):typeof e=="string"?v(e,t):typeof e=="boolean"?pe(e,t):D(e,t)}function pe(e,t={}){const n=`0x${Number(e)}`;return typeof t.size=="number"?(_(n,{size:t.size}),I(n,{size:t.size})):n}function D(e,t={}){let n="";for(let r=0;r<e.length;r++)n+=ot[e[r]];const s=`0x${n}`;return typeof t.size=="number"?(_(s,{size:t.size}),I(s,{dir:"right",size:t.size})):s}function S(e,t={}){const{signed:n,size:s}=t,r=BigInt(e);let i;s?n?i=(1n<<BigInt(s)*8n-1n)-1n:i=2n**(BigInt(s)*8n)-1n:typeof e=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof i=="bigint"&&n?-i-1n:0;if(i&&r>i||r<o){const c=typeof e=="bigint"?"n":"";throw new he({max:i?`${i}${c}`:void 0,min:`${o}${c}`,signed:n,size:s,value:`${e}${c}`})}const a=`0x${(n&&r<0?(1n<<BigInt(s*8))+BigInt(r):r).toString(16)}`;return s?I(a,{size:s}):a}const at=new TextEncoder;function v(e,t={}){const n=at.encode(e);return D(n,t)}const ct=new TextEncoder;function ge(e,t={}){return typeof e=="number"||typeof e=="bigint"?ft(e,t):typeof e=="boolean"?ut(e,t):k(e)?ye(e,t):me(e,t)}function ut(e,t={}){const n=new Uint8Array(1);return n[0]=Number(e),typeof t.size=="number"?(_(n,{size:t.size}),I(n,{size:t.size})):n}const b={zero:48,nine:57,A:65,F:70,a:97,f:102};function J(e){if(e>=b.zero&&e<=b.nine)return e-b.zero;if(e>=b.A&&e<=b.F)return e-(b.A-10);if(e>=b.a&&e<=b.f)return e-(b.a-10)}function ye(e,t={}){let n=e;t.size&&(_(n,{size:t.size}),n=I(n,{dir:"right",size:t.size}));let s=n.slice(2);s.length%2&&(s=`0${s}`);const r=s.length/2,i=new Uint8Array(r);for(let o=0,a=0;o<r;o++){const c=J(s.charCodeAt(a++)),l=J(s.charCodeAt(a++));if(c===void 0||l===void 0)throw new u(`Invalid byte sequence ("${s[a-2]}${s[a-1]}" in "${s}").`);i[o]=c*16+l}return i}function ft(e,t){const n=S(e,t);return ye(n)}function me(e,t={}){const n=ct.encode(e);return typeof t.size=="number"?(_(n,{size:t.size}),I(n,{dir:"right",size:t.size})):n}function Q(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function lt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function U(e,...t){if(!lt(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Y(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function dt(e,t){U(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const O=BigInt(2**32-1),Z=BigInt(32);function ht(e,t=!1){return t?{h:Number(e&O),l:Number(e>>Z&O)}:{h:Number(e>>Z&O)|0,l:Number(e&O)|0}}function pt(e,t=!1){let n=new Uint32Array(e.length),s=new Uint32Array(e.length);for(let r=0;r<e.length;r++){const{h:i,l:o}=ht(e[r],t);[n[r],s[r]]=[i,o]}return[n,s]}const gt=(e,t,n)=>e<<n|t>>>32-n,yt=(e,t,n)=>t<<n|e>>>32-n,mt=(e,t,n)=>t<<n-32|e>>>64-n,bt=(e,t,n)=>e<<n-32|t>>>64-n;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function wt(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}const ee=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function xt(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function te(e){for(let t=0;t<e.length;t++)e[t]=xt(e[t])}typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;function St(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function be(e){return typeof e=="string"&&(e=St(e)),U(e),e}class At{clone(){return this._cloneInto()}}function It(e){const t=s=>e().update(be(s)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}const we=[],xe=[],Se=[],Et=BigInt(0),B=BigInt(1),$t=BigInt(2),Bt=BigInt(7),Tt=BigInt(256),Pt=BigInt(113);for(let e=0,t=B,n=1,s=0;e<24;e++){[n,s]=[s,(2*n+3*s)%5],we.push(2*(5*s+n)),xe.push((e+1)*(e+2)/2%64);let r=Et;for(let i=0;i<7;i++)t=(t<<B^(t>>Bt)*Pt)%Tt,t&$t&&(r^=B<<(B<<BigInt(i))-B);Se.push(r)}const[kt,_t]=pt(Se,!0),ne=(e,t,n)=>n>32?mt(e,t,n):gt(e,t,n),se=(e,t,n)=>n>32?bt(e,t,n):yt(e,t,n);function zt(e,t=24){const n=new Uint32Array(10);for(let s=24-t;s<24;s++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=n[c],f=n[c+1],h=ne(l,f,1)^n[a],z=se(l,f,1)^n[a+1];for(let A=0;A<50;A+=10)e[o+A]^=h,e[o+A+1]^=z}let r=e[2],i=e[3];for(let o=0;o<24;o++){const a=xe[o],c=ne(r,i,a),l=se(r,i,a),f=we[o];r=e[f],i=e[f+1],e[f]=c,e[f+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=e[o+a];for(let a=0;a<10;a++)e[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}e[0]^=kt[s],e[1]^=_t[s]}n.fill(0)}class V extends At{constructor(t,n,s,r=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=n,this.outputLen=s,this.enableXOF=r,this.rounds=i,Q(s),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=wt(this.state)}keccak(){ee||te(this.state32),zt(this.state32,this.rounds),ee||te(this.state32),this.posOut=0,this.pos=0}update(t){Y(this);const{blockLen:n,state:s}=this;t=be(t);const r=t.length;for(let i=0;i<r;){const o=Math.min(n-this.pos,r-i);for(let a=0;a<o;a++)s[this.pos++]^=t[i++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:s,blockLen:r}=this;t[s]^=n,(n&128)!==0&&s===r-1&&this.keccak(),t[r-1]^=128,this.keccak()}writeInto(t){Y(this,!1),U(t),this.finish();const n=this.state,{blockLen:s}=this;for(let r=0,i=t.length;r<i;){this.posOut>=s&&this.keccak();const o=Math.min(s-this.posOut,i-r);t.set(n.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Q(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(dt(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){const{blockLen:n,suffix:s,outputLen:r,rounds:i,enableXOF:o}=this;return t||(t=new V(n,s,r,o,i)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=i,t.suffix=s,t.outputLen=r,t.enableXOF=o,t.destroyed=this.destroyed,t}}const Ot=(e,t,n)=>It(()=>new V(t,e,n)),vt=Ot(1,136,256/8);function y(e,t){const n=t||"hex",s=vt(k(e,{strict:!1})?ge(e):e);return n==="bytes"?s:q(s)}const Mt=e=>y(ge(e));function Ht(e){return Mt(e)}function Ct(e){let t=!0,n="",s=0,r="",i=!1;for(let o=0;o<e.length;o++){const a=e[o];if(["(",")",","].includes(a)&&(t=!0),a==="("&&s++,a===")"&&s--,!!t){if(s===0){if(a===" "&&["event","function",""].includes(r))r="";else if(r+=a,a===")"){i=!0;break}continue}if(a===" "){e[o-1]!==","&&n!==","&&n!==",("&&(n="",t=!1);continue}r+=a,n+=a}}if(!i)throw new u("Unable to normalize signature.");return r}const Lt=e=>{const t=typeof e=="string"?e:qe(e);return Ct(t)};function Ae(e){return Ht(Lt(e))}const Rt=Ae;class Ie extends u{constructor({address:t}){super(`Address "${t}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}}class Ee extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){const n=super.get(t);return super.has(t)&&n!==void 0&&(this.delete(t),super.set(t,n)),n}set(t,n){if(super.set(t,n),this.maxSize&&this.size>this.maxSize){const s=this.keys().next().value;s&&this.delete(s)}return this}}const H=new Ee(8192);function jt(e,t){if(H.has(`${e}.${t}`))return H.get(`${e}.${t}`);const n=e.substring(2).toLowerCase(),s=y(me(n),"bytes"),r=n.split("");for(let o=0;o<40;o+=2)s[o>>1]>>4>=8&&r[o]&&(r[o]=r[o].toUpperCase()),(s[o>>1]&15)>=8&&r[o+1]&&(r[o+1]=r[o+1].toUpperCase());const i=`0x${r.join("")}`;return H.set(`${e}.${t}`,i),i}const Nt=/^0x[a-fA-F0-9]{40}$/,C=new Ee(8192);function T(e,t){const{strict:n=!0}=t??{},s=`${e}.${n}`;if(C.has(s))return C.get(s);const r=Nt.test(e)?e.toLowerCase()===e?!0:n?jt(e)===e:!0:!1;return C.set(s,r),r}function x(e){return typeof e[0]=="string"?$e(e):qt(e)}function qt(e){let t=0;for(const r of e)t+=r.length;const n=new Uint8Array(t);let s=0;for(const r of e)n.set(r,s),s+=r.length;return n}function $e(e){return`0x${e.reduce((t,n)=>t+n.replace("0x",""),"")}`}function Be(e,t,n,{strict:s}={}){return k(e,{strict:!1})?Ut(e,t,n,{strict:s}):Dt(e,t,n,{strict:s})}function Te(e,t){if(typeof t=="number"&&t>0&&t>g(e)-1)throw new le({offset:t,position:"start",size:g(e)})}function Pe(e,t,n){if(typeof t=="number"&&typeof n=="number"&&g(e)!==n-t)throw new le({offset:n,position:"end",size:g(e)})}function Dt(e,t,n,{strict:s}={}){Te(e,t);const r=e.slice(t,n);return s&&Pe(r,t,n),r}function Ut(e,t,n,{strict:s}={}){Te(e,t);const r=`0x${e.replace("0x","").slice((t??0)*2,(n??e.length)*2)}`;return s&&Pe(r,t,n),r}const Vt=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,ke=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function F(e,t){if(e.length!==t.length)throw new Ye({expectedLength:e.length,givenLength:t.length});const n=Ft({params:e,values:t}),s=G(n);return s.length===0?"0x":s}function Ft({params:e,values:t}){const n=[];for(let s=0;s<e.length;s++)n.push(W({param:e[s],value:t[s]}));return n}function W({param:e,value:t}){const n=Zt(e.type);if(n){const[s,r]=n;return Gt(t,{length:s,param:{...e,type:r}})}if(e.type==="tuple")return Yt(t,{param:e});if(e.type==="address")return Wt(t);if(e.type==="bool")return Kt(t);if(e.type.startsWith("uint")||e.type.startsWith("int")){const s=e.type.startsWith("int"),[,,r="256"]=ke.exec(e.type)??[];return Jt(t,{signed:s,size:Number(r)})}if(e.type.startsWith("bytes"))return Xt(t,{param:e});if(e.type==="string")return Qt(t);throw new tt(e.type,{docsPath:"/docs/contract/encodeAbiParameters"})}function G(e){let t=0;for(let i=0;i<e.length;i++){const{dynamic:o,encoded:a}=e[i];o?t+=32:t+=g(a)}const n=[],s=[];let r=0;for(let i=0;i<e.length;i++){const{dynamic:o,encoded:a}=e[i];o?(n.push(S(t+r,{size:32})),s.push(a),r+=g(a)):n.push(a)}return x([...n,...s])}function Wt(e){if(!T(e))throw new Ie({address:e});return{dynamic:!1,encoded:w(e.toLowerCase())}}function Gt(e,{length:t,param:n}){const s=t===null;if(!Array.isArray(e))throw new nt(e);if(!s&&e.length!==t)throw new Je({expectedLength:t,givenLength:e.length,type:`${n.type}[${t}]`});let r=!1;const i=[];for(let o=0;o<e.length;o++){const a=W({param:n,value:e[o]});a.dynamic&&(r=!0),i.push(a)}if(s||r){const o=G(i);if(s){const a=S(i.length,{size:32});return{dynamic:!0,encoded:i.length>0?x([a,o]):a}}if(r)return{dynamic:!0,encoded:o}}return{dynamic:!1,encoded:x(i.map(({encoded:o})=>o))}}function Xt(e,{param:t}){const[,n]=t.type.split("bytes"),s=g(e);if(!n){let r=e;return s%32!==0&&(r=w(r,{dir:"right",size:Math.ceil((e.length-2)/2/32)*32})),{dynamic:!0,encoded:x([w(S(s,{size:32})),r])}}if(s!==Number.parseInt(n))throw new Qe({expectedSize:Number.parseInt(n),value:e});return{dynamic:!1,encoded:w(e,{dir:"right"})}}function Kt(e){if(typeof e!="boolean")throw new u(`Invalid boolean value: "${e}" (type: ${typeof e}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:w(pe(e))}}function Jt(e,{signed:t,size:n=256}){if(typeof n=="number"){const s=2n**(BigInt(n)-(t?1n:0n))-1n,r=t?-s-1n:0n;if(e>s||e<r)throw new he({max:s.toString(),min:r.toString(),signed:t,size:n/8,value:e.toString()})}return{dynamic:!1,encoded:S(e,{size:32,signed:t})}}function Qt(e){const t=v(e),n=Math.ceil(g(t)/32),s=[];for(let r=0;r<n;r++)s.push(w(Be(t,r*32,(r+1)*32),{dir:"right"}));return{dynamic:!0,encoded:x([w(S(g(t),{size:32})),...s])}}function Yt(e,{param:t}){let n=!1;const s=[];for(let r=0;r<t.components.length;r++){const i=t.components[r],o=Array.isArray(e)?r:i.name,a=W({param:i,value:e[o]});s.push(a),a.dynamic&&(n=!0)}return{dynamic:n,encoded:n?G(s):x(s.map(({encoded:r})=>r))}}function Zt(e){const t=e.match(/^(.*)\[(\d+)?\]$/);return t?[t[2]?Number(t[2]):null,t[1]]:void 0}const _e=e=>Be(Ae(e),0,4);function en(e){const{abi:t,args:n=[],name:s}=e,r=k(s,{strict:!1}),i=t.filter(a=>r?a.type==="function"?_e(a)===s:a.type==="event"?Rt(a)===s:!1:"name"in a&&a.name===s);if(i.length===0)return;if(i.length===1)return i[0];let o;for(const a of i){if(!("inputs"in a))continue;if(!n||n.length===0){if(!a.inputs||a.inputs.length===0)return a;continue}if(!a.inputs||a.inputs.length===0||a.inputs.length!==n.length)continue;if(n.every((l,f)=>{const h="inputs"in a&&a.inputs[f];return h?j(l,h):!1})){if(o&&"inputs"in o&&o.inputs){const l=ze(a.inputs,o.inputs,n);if(l)throw new Ze({abiItem:a,type:l[0]},{abiItem:o,type:l[1]})}o=a}}return o||i[0]}function j(e,t){const n=typeof e,s=t.type;switch(s){case"address":return T(e,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return s==="tuple"&&"components"in t?Object.values(t.components).every((r,i)=>j(Object.values(e)[i],r)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(s)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(s)?n==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(s)?Array.isArray(e)&&e.every(r=>j(r,{...t,type:s.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function ze(e,t,n){for(const s in e){const r=e[s],i=t[s];if(r.type==="tuple"&&i.type==="tuple"&&"components"in r&&"components"in i)return ze(r.components,i.components,n[s]);const o=[r.type,i.type];if(o.includes("address")&&o.includes("bytes20")?!0:o.includes("address")&&o.includes("string")?T(n[s],{strict:!1}):o.includes("address")&&o.includes("bytes")?T(n[s],{strict:!1}):!1)return o}}const re="/docs/contract/encodeFunctionData";function tn(e){const{abi:t,args:n,functionName:s}=e;let r=t[0];if(s){const i=en({abi:t,args:n,name:s});if(!i)throw new K(s,{docsPath:re});r=i}if(r.type!=="function")throw new K(void 0,{docsPath:re});return{abi:[r],functionName:_e(R(r))}}function ie(e){const{args:t}=e,{abi:n,functionName:s}=(()=>{var a;return e.abi.length===1&&((a=e.functionName)!=null&&a.startsWith("0x"))?e:tn(e)})(),r=n[0],i=s,o="inputs"in r&&r.inputs?F(r.inputs,t??[]):void 0;return $e([i,o??"0x"])}const nn=(e,t,n)=>JSON.stringify(e,(s,r)=>typeof r=="bigint"?r.toString():r,n);class sn extends u{constructor({domain:t}){super(`Invalid domain "${nn(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}}class rn extends u{constructor({primaryType:t,types:n}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(n))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}}class on extends u{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}}function an(e){const{domain:t={},message:n,primaryType:s}=e,r={EIP712Domain:dn({domain:t}),...e.types};ln({domain:t,message:n,primaryType:s,types:r});const i=["0x1901"];return t&&i.push(cn({domain:t,types:r})),s!=="EIP712Domain"&&i.push(Oe({data:n,primaryType:s,types:r})),y(x(i))}function cn({domain:e,types:t}){return Oe({data:e,primaryType:"EIP712Domain",types:t})}function Oe({data:e,primaryType:t,types:n}){const s=ve({data:e,primaryType:t,types:n});return y(s)}function ve({data:e,primaryType:t,types:n}){const s=[{type:"bytes32"}],r=[un({primaryType:t,types:n})];for(const i of n[t]){const[o,a]=He({types:n,name:i.name,type:i.type,value:e[i.name]});s.push(o),r.push(a)}return F(s,r)}function un({primaryType:e,types:t}){const n=q(fn({primaryType:e,types:t}));return y(n)}function fn({primaryType:e,types:t}){let n="";const s=Me({primaryType:e,types:t});s.delete(e);const r=[e,...Array.from(s).sort()];for(const i of r)n+=`${i}(${t[i].map(({name:o,type:a})=>`${a} ${o}`).join(",")})`;return n}function Me({primaryType:e,types:t},n=new Set){const s=e.match(/^\w*/u),r=s==null?void 0:s[0];if(n.has(r)||t[r]===void 0)return n;n.add(r);for(const i of t[r])Me({primaryType:i.type,types:t},n);return n}function He({types:e,name:t,type:n,value:s}){if(e[n]!==void 0)return[{type:"bytes32"},y(ve({data:s,primaryType:n,types:e}))];if(n==="bytes")return s=`0x${(s.length%2?"0":"")+s.slice(2)}`,[{type:"bytes32"},y(s)];if(n==="string")return[{type:"bytes32"},y(q(s))];if(n.lastIndexOf("]")===n.length-1){const r=n.slice(0,n.lastIndexOf("[")),i=s.map(o=>He({name:t,type:r,types:e,value:o}));return[{type:"bytes32"},y(F(i.map(([o])=>o),i.map(([,o])=>o)))]}return[{type:n},s]}function ln(e){const{domain:t,message:n,primaryType:s,types:r}=e,i=(o,a)=>{for(const c of o){const{name:l,type:f}=c,h=a[l],z=f.match(ke);if(z&&(typeof h=="number"||typeof h=="bigint")){const[Re,E,je]=z;S(h,{signed:E==="int",size:Number.parseInt(je)/8})}if(f==="address"&&typeof h=="string"&&!T(h))throw new Ie({address:h});const A=f.match(Vt);if(A){const[Re,E]=A;if(E&&g(h)!==Number.parseInt(E))throw new et({expectedSize:Number.parseInt(E),givenSize:g(h)})}const X=r[f];X&&(hn(f),i(X,h))}};if(r.EIP712Domain&&t){if(typeof t!="object")throw new sn({domain:t});i(r.EIP712Domain,t)}if(s!=="EIP712Domain")if(r[s])i(r[s],n);else throw new rn({primaryType:s,types:r})}function dn({domain:e}){return[typeof(e==null?void 0:e.name)=="string"&&{name:"name",type:"string"},(e==null?void 0:e.version)&&{name:"version",type:"string"},(typeof(e==null?void 0:e.chainId)=="number"||typeof(e==null?void 0:e.chainId)=="bigint")&&{name:"chainId",type:"uint256"},(e==null?void 0:e.verifyingContract)&&{name:"verifyingContract",type:"address"},(e==null?void 0:e.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}function hn(e){if(e==="address"||e==="bool"||e==="string"||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new on({type:e})}const pn=`Ethereum Signed Message:
`;function gn(e){const t=typeof e=="string"?v(e):typeof e.raw=="string"?e.raw:D(e.raw),n=v(`${pn}${g(t)}`);return x([n,t])}function yn(e,t){return y(gn(e),t)}const mn="0x1626ba7e",bn="0x20c13b0b",N=4001;class P extends Error{constructor(t,n,s){super(t),this.code=n,this.data=s,Object.setPrototypeOf(this,P.prototype)}}class Ce{constructor(t){this.communicator=t}async getPermissions(){return(await this.communicator.send(d.wallet_getPermissions,void 0)).data}async requestPermissions(t){if(!this.isPermissionRequestValid(t))throw new P("Permissions request is invalid",N);try{return(await this.communicator.send(d.wallet_requestPermissions,t)).data}catch{throw new P("Permissions rejected",N)}}isPermissionRequestValid(t){return t.every(n=>typeof n=="object"?Object.keys(n).every(s=>!!Object.values(L).includes(s)):!1)}}const oe=(e,t)=>t.some(n=>n.parentCapability===e),wn=()=>(e,t,n)=>{const s=n.value;return n.value=async function(){const r=new Ce(this.communicator);let i=await r.getPermissions();if(oe(t,i)||(i=await r.requestPermissions([{[t]:{}}])),!oe(t,i))throw new P("Permissions rejected",N);return s.apply(this)},n};var xn=function(e,t,n,s){var r=arguments.length,i=r<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,n):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r<3?o(i):r>3?o(t,n,i):o(t,n))||i);return r>3&&i&&Object.defineProperty(t,n,i),i};class Le{constructor(t){this.communicator=t}async getChainInfo(){return(await this.communicator.send(d.getChainInfo,void 0)).data}async getInfo(){return(await this.communicator.send(d.getSafeInfo,void 0)).data}async experimental_getBalances({currency:t="usd"}={}){return(await this.communicator.send(d.getSafeBalances,{currency:t})).data}async check1271Signature(t,n="0x"){const s=await this.getInfo(),r=ie({abi:[{constant:!1,inputs:[{name:"_dataHash",type:"bytes32"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[t,n]}),i={call:p.eth_call,params:[{to:s.safeAddress,data:r},"latest"]};try{return(await this.communicator.send(d.rpcCall,i)).data.slice(0,10).toLowerCase()===mn}catch{return!1}}async check1271SignatureBytes(t,n="0x"){const s=await this.getInfo(),r=ie({abi:[{constant:!1,inputs:[{name:"_data",type:"bytes"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[t,n]}),i={call:p.eth_call,params:[{to:s.safeAddress,data:r},"latest"]};try{return(await this.communicator.send(d.rpcCall,i)).data.slice(0,10).toLowerCase()===bn}catch{return!1}}calculateMessageHash(t){return yn(t)}calculateTypedMessageHash(t){const n=typeof t.domain.chainId=="object"?t.domain.chainId.toNumber():Number(t.domain.chainId);let s=t.primaryType;if(!s){const r=Object.values(t.types),i=Object.keys(t.types).filter(o=>r.every(a=>a.every(({type:c})=>c.replace("[","").replace("]","")!==o)));if(i.length===0||i.length>1)throw new Error("Please specify primaryType");s=i[0]}return an({message:t.message,domain:{...t.domain,chainId:n,verifyingContract:t.domain.verifyingContract,salt:t.domain.salt},types:t.types,primaryType:s})}async getOffChainSignature(t){return(await this.communicator.send(d.getOffChainSignature,t)).data}async isMessageSigned(t,n="0x"){let s;if(typeof t=="string"&&(s=async()=>{const r=this.calculateMessageHash(t);return await this.isMessageHashSigned(r,n)}),ae(t)&&(s=async()=>{const r=this.calculateTypedMessageHash(t);return await this.isMessageHashSigned(r,n)}),s)return await s();throw new Error("Invalid message type")}async isMessageHashSigned(t,n="0x"){const s=[this.check1271Signature.bind(this),this.check1271SignatureBytes.bind(this)];for(const r of s)if(await r(t,n))return!0;return!1}async getEnvironmentInfo(){return(await this.communicator.send(d.getEnvironmentInfo,void 0)).data}async requestAddressBook(){return(await this.communicator.send(d.requestAddressBook,void 0)).data}}xn([wn()],Le.prototype,"requestAddressBook",null);class En{constructor(t={}){const{allowedDomains:n=null,debug:s=!1}=t;this.communicator=new We(n,s),this.eth=new Xe(this.communicator),this.txs=new Ge(this.communicator),this.safe=new Le(this.communicator),this.wallet=new Ce(this.communicator)}}export{M as MessageFormatter,d as Methods,p as RPC_CALLS,L as RestrictedMethods,En as default,De as getSDKVersion,ae as isObjectEIP712TypedData};
