const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-5AXpmujZ.js","assets/index-qCb0pVFX.css","assets/index-DzABqRQN.js"])))=>i.map(i=>d[i]);
import{f as Hn,m as sd,k as t0,_ as nd,n as ad,o as od,p as rc,q as ic,t as Pt}from"./index-5AXpmujZ.js";import{r as r0}from"./events-DQ172AOg.js";var qt=r0();const sc=Hn(qt);var zc=function(r,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return r.concat(n||Array.prototype.slice.call(e))},i0=function(){function r(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return r}(),s0=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),n0=function(){function r(e,t,i,s){this.name=e,this.version=t,this.os=i,this.bot=s,this.type="bot-device"}return r}(),a0=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),o0=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),c0=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,u0=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,kc=3,h0=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",c0]],Hc=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function f0(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new o0:typeof navigator<"u"?l0(navigator.userAgent):g0()}function d0(r){return r!==""&&h0.reduce(function(e,t){var i=t[0],s=t[1];if(e)return e;var n=s.exec(r);return!!n&&[i,n]},!1)}function l0(r){var e=d0(r);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new a0;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<kc&&(s=zc(zc([],s,!0),b0(kc-s.length),!0)):s=[];var n=s.join("."),a=p0(r),o=u0.exec(r);return o&&o[1]?new n0(t,n,a,o[1]):new i0(t,n,a)}function p0(r){for(var e=0,t=Hc.length;e<t;e++){var i=Hc[e],s=i[0],n=i[1],a=n.exec(r);if(a)return s}return null}function g0(){var r=typeof process<"u"&&process.version;return r?new s0(process.version.slice(1)):null}function b0(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var da={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var bo=function(r,e){return bo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},bo(r,e)};function y0(r,e){bo(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var yo=function(){return yo=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},yo.apply(this,arguments)};function v0(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function m0(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var o=r.length-1;o>=0;o--)(a=r[o])&&(n=(s<3?a(n):s>3?a(e,t,n):a(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function w0(r,e){return function(t,i){e(t,i,r)}}function _0(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function E0(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{c(i.next(h))}catch(l){a(l)}}function u(h){try{c(i.throw(h))}catch(l){a(l)}}function c(h){h.done?n(h.value):s(h.value).then(o,u)}c((i=i.apply(r,e||[])).next())})}function $0(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(c){return function(h){return u([c,h])}}function u(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=c[0]&2?s.return:c[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,c[1])).done)return n;switch(s=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(h){c=[6,h],s=0}finally{i=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function I0(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function S0(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function vo(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function cd(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],a;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}return n}function x0(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(cd(arguments[e]));return r}function D0(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],a=0,o=n.length;a<o;a++,s++)i[s]=n[a];return i}function Ts(r){return this instanceof Ts?(this.v=r,this):new Ts(r)}function P0(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(g){i[g]&&(s[g]=function(m){return new Promise(function(y,_){n.push([g,m,y,_])>1||o(g,m)})})}function o(g,m){try{u(i[g](m))}catch(y){l(n[0][3],y)}}function u(g){g.value instanceof Ts?Promise.resolve(g.value.v).then(c,h):l(n[0][2],g)}function c(g){o("next",g)}function h(g){o("throw",g)}function l(g,m){g(m),n.shift(),n.length&&o(n[0][0],n[0][1])}}function A0(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(a){return(t=!t)?{value:Ts(r[s](a)),done:s==="return"}:n?n(a):a}:n}}function O0(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof vo=="function"?vo(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(a){return new Promise(function(o,u){a=r[n](a),s(o,u,a.done,a.value)})}}function s(n,a,o,u){Promise.resolve(u).then(function(c){n({value:c,done:o})},a)}}function M0(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function C0(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function R0(r){return r&&r.__esModule?r:{default:r}}function T0(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function N0(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const F0=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return yo},__asyncDelegator:A0,__asyncGenerator:P0,__asyncValues:O0,__await:Ts,__awaiter:E0,__classPrivateFieldGet:T0,__classPrivateFieldSet:N0,__createBinding:I0,__decorate:m0,__exportStar:S0,__extends:y0,__generator:$0,__importDefault:R0,__importStar:C0,__makeTemplateObject:M0,__metadata:_0,__param:w0,__read:cd,__rest:v0,__spread:x0,__spreadArrays:D0,__values:vo},Symbol.toStringTag,{value:"Module"})),Kn=sd(F0);var la={},gs={},Kc;function q0(){if(Kc)return gs;Kc=1,Object.defineProperty(gs,"__esModule",{value:!0}),gs.delay=void 0;function r(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return gs.delay=r,gs}var Gr={},pa={},Jr={},Vc;function B0(){return Vc||(Vc=1,Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.ONE_THOUSAND=Jr.ONE_HUNDRED=void 0,Jr.ONE_HUNDRED=100,Jr.ONE_THOUSAND=1e3),Jr}var ga={},Wc;function j0(){return Wc||(Wc=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365}(ga)),ga}var Gc;function ud(){return Gc||(Gc=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Kn;e.__exportStar(B0(),r),e.__exportStar(j0(),r)}(pa)),pa}var Jc;function L0(){if(Jc)return Gr;Jc=1,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.fromMiliseconds=Gr.toMiliseconds=void 0;const r=ud();function e(i){return i*r.ONE_THOUSAND}Gr.toMiliseconds=e;function t(i){return Math.floor(i/r.ONE_THOUSAND)}return Gr.fromMiliseconds=t,Gr}var Yc;function U0(){return Yc||(Yc=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Kn;e.__exportStar(q0(),r),e.__exportStar(L0(),r)}(la)),la}var bi={},Xc;function z0(){if(Xc)return bi;Xc=1,Object.defineProperty(bi,"__esModule",{value:!0}),bi.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const i=this.get(t);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-i.started;this.timestamps.set(t,{started:i.started,elapsed:s})}get(t){const i=this.timestamps.get(t);if(typeof i>"u")throw new Error(`No timestamp found for label: ${t}`);return i}elapsed(t){const i=this.get(t);return i.elapsed||Date.now()-i.started}}return bi.Watch=r,bi.default=r,bi}var ba={},bs={},Zc;function k0(){if(Zc)return bs;Zc=1,Object.defineProperty(bs,"__esModule",{value:!0}),bs.IWatch=void 0;class r{}return bs.IWatch=r,bs}var Qc;function H0(){return Qc||(Qc=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),Kn.__exportStar(k0(),r)}(ba)),ba}var eu;function K0(){return eu||(eu=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Kn;e.__exportStar(U0(),r),e.__exportStar(z0(),r),e.__exportStar(H0(),r),e.__exportStar(ud(),r)}(da)),da}var V=K0(),ge={},tu;function hd(){if(tu)return ge;tu=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.getLocalStorage=ge.getLocalStorageOrThrow=ge.getCrypto=ge.getCryptoOrThrow=ge.getLocation=ge.getLocationOrThrow=ge.getNavigator=ge.getNavigatorOrThrow=ge.getDocument=ge.getDocumentOrThrow=ge.getFromWindowOrThrow=ge.getFromWindow=void 0;function r(g){let m;return typeof window<"u"&&typeof window[g]<"u"&&(m=window[g]),m}ge.getFromWindow=r;function e(g){const m=r(g);if(!m)throw new Error(`${g} is not defined in Window`);return m}ge.getFromWindowOrThrow=e;function t(){return e("document")}ge.getDocumentOrThrow=t;function i(){return r("document")}ge.getDocument=i;function s(){return e("navigator")}ge.getNavigatorOrThrow=s;function n(){return r("navigator")}ge.getNavigator=n;function a(){return e("location")}ge.getLocationOrThrow=a;function o(){return r("location")}ge.getLocation=o;function u(){return e("crypto")}ge.getCryptoOrThrow=u;function c(){return r("crypto")}ge.getCrypto=c;function h(){return e("localStorage")}ge.getLocalStorageOrThrow=h;function l(){return r("localStorage")}return ge.getLocalStorage=l,ge}var ii=hd(),ys={},ru;function V0(){if(ru)return ys;ru=1,Object.defineProperty(ys,"__esModule",{value:!0}),ys.getWindowMetadata=void 0;const r=hd();function e(){let t,i;try{t=r.getDocumentOrThrow(),i=r.getLocationOrThrow()}catch{return null}function s(){const m=t.getElementsByTagName("link"),y=[];for(let _=0;_<m.length;_++){const O=m[_],x=O.getAttribute("rel");if(x&&x.toLowerCase().indexOf("icon")>-1){const D=O.getAttribute("href");if(D)if(D.toLowerCase().indexOf("https:")===-1&&D.toLowerCase().indexOf("http:")===-1&&D.indexOf("//")!==0){let M=i.protocol+"//"+i.host;if(D.indexOf("/")===0)M+=D;else{const R=i.pathname.split("/");R.pop();const N=R.join("/");M+=N+"/"+D}y.push(M)}else if(D.indexOf("//")===0){const M=i.protocol+D;y.push(M)}else y.push(D)}}return y}function n(...m){const y=t.getElementsByTagName("meta");for(let _=0;_<y.length;_++){const O=y[_],x=["itemprop","property","name"].map(D=>O.getAttribute(D)).filter(D=>D?m.includes(D):!1);if(x.length&&x){const D=O.getAttribute("content");if(D)return D}}return""}function a(){let m=n("name","og:site_name","og:title","twitter:title");return m||(m=t.title),m}function o(){return n("description","og:description","twitter:description","keywords")}const u=a(),c=o(),h=i.origin,l=s();return{description:c,url:h,icons:l,name:u}}return ys.getWindowMetadata=e,ys}var W0=V0();function Ns(r,{strict:e=!0}={}){return!r||typeof r!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function iu(r){return Ns(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const fd="2.23.2";let vs={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:t})=>e?`${r??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:`viem@${fd}`};class si extends Error{constructor(e,t={}){var o;const i=(()=>{var u;return t.cause instanceof si?t.cause.details:(u=t.cause)!=null&&u.message?t.cause.message:t.details})(),s=t.cause instanceof si&&t.cause.docsPath||t.docsPath,n=(o=vs.getDocsUrl)==null?void 0:o.call(vs,{...t,docsPath:s}),a=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...i?[`Details: ${i}`]:[],...vs.version?[`Version: ${vs.version}`]:[]].join(`
`);super(a,t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=s,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=fd}walk(e){return dd(this,e)}}function dd(r,e){return e!=null&&e(r)?r:r&&typeof r=="object"&&"cause"in r&&r.cause!==void 0?dd(r.cause,e):e?null:r}class ld extends si{constructor({size:e,targetSize:t,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function Ki(r,{dir:e,size:t=32}={}){return typeof r=="string"?G0(r,{dir:e,size:t}):J0(r,{dir:e,size:t})}function G0(r,{dir:e,size:t=32}={}){if(t===null)return r;const i=r.replace("0x","");if(i.length>t*2)throw new ld({size:Math.ceil(i.length/2),targetSize:t,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](t*2,"0")}`}function J0(r,{dir:e,size:t=32}={}){if(t===null)return r;if(r.length>t)throw new ld({size:r.length,targetSize:t,type:"bytes"});const i=new Uint8Array(t);for(let s=0;s<t;s++){const n=e==="right";i[n?s:t-s-1]=r[n?s:r.length-s-1]}return i}class Y0 extends si{constructor({max:e,min:t,signed:i,size:s,value:n}){super(`Number "${n}" is not in safe ${s?`${s*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class X0 extends si{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Vi(r,{size:e}){if(iu(r)>e)throw new X0({givenSize:iu(r),maxSize:e})}function mo(r,e={}){const{signed:t}=e;e.size&&Vi(r,{size:e.size});const i=BigInt(r);if(!t)return i;const s=(r.length-2)/2,n=(1n<<BigInt(s)*8n-1n)-1n;return i<=n?i:i-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function Z0(r,e={}){return Number(mo(r,e))}const Q0=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function wo(r,e={}){return typeof r=="number"||typeof r=="bigint"?gd(r,e):typeof r=="string"?rg(r,e):typeof r=="boolean"?eg(r,e):pd(r,e)}function eg(r,e={}){const t=`0x${Number(r)}`;return typeof e.size=="number"?(Vi(t,{size:e.size}),Ki(t,{size:e.size})):t}function pd(r,e={}){let t="";for(let s=0;s<r.length;s++)t+=Q0[r[s]];const i=`0x${t}`;return typeof e.size=="number"?(Vi(i,{size:e.size}),Ki(i,{dir:"right",size:e.size})):i}function gd(r,e={}){const{signed:t,size:i}=e,s=BigInt(r);let n;i?t?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof r=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const a=typeof n=="bigint"&&t?-n-1n:0;if(n&&s>n||s<a){const u=typeof r=="bigint"?"n":"";throw new Y0({max:n?`${n}${u}`:void 0,min:`${a}${u}`,signed:t,size:i,value:`${r}${u}`})}const o=`0x${(t&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?Ki(o,{size:i}):o}const tg=new TextEncoder;function rg(r,e={}){const t=tg.encode(r);return pd(t,e)}const ig=new TextEncoder;function sg(r,e={}){return typeof r=="number"||typeof r=="bigint"?ag(r,e):typeof r=="boolean"?ng(r,e):Ns(r)?bd(r,e):yd(r,e)}function ng(r,e={}){const t=new Uint8Array(1);return t[0]=Number(r),typeof e.size=="number"?(Vi(t,{size:e.size}),Ki(t,{size:e.size})):t}const br={zero:48,nine:57,A:65,F:70,a:97,f:102};function su(r){if(r>=br.zero&&r<=br.nine)return r-br.zero;if(r>=br.A&&r<=br.F)return r-(br.A-10);if(r>=br.a&&r<=br.f)return r-(br.a-10)}function bd(r,e={}){let t=r;e.size&&(Vi(t,{size:e.size}),t=Ki(t,{dir:"right",size:e.size}));let i=t.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,n=new Uint8Array(s);for(let a=0,o=0;a<s;a++){const u=su(i.charCodeAt(o++)),c=su(i.charCodeAt(o++));if(u===void 0||c===void 0)throw new si(`Invalid byte sequence ("${i[o-2]}${i[o-1]}" in "${i}").`);n[a]=u*16+c}return n}function ag(r,e){const t=gd(r,e);return bd(t)}function yd(r,e={}){const t=ig.encode(r);return typeof e.size=="number"?(Vi(t,{size:e.size}),Ki(t,{dir:"right",size:e.size})):t}function vd(r,e){const t=e||"hex",i=t0(Ns(r,{strict:!1})?sg(r):r);return t==="bytes"?i:wo(i)}class og extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const ya=new og(8192);function cg(r,e){if(ya.has(`${r}.${e}`))return ya.get(`${r}.${e}`);const t=r.substring(2).toLowerCase(),i=vd(yd(t),"bytes"),s=t.split("");for(let a=0;a<40;a+=2)i[a>>1]>>4>=8&&s[a]&&(s[a]=s[a].toUpperCase()),(i[a>>1]&15)>=8&&s[a+1]&&(s[a+1]=s[a+1].toUpperCase());const n=`0x${s.join("")}`;return ya.set(`${r}.${e}`,n),n}function ug(r){const e=vd(`0x${r.substring(4)}`).substring(26);return cg(`0x${e}`)}async function hg({hash:r,signature:e}){const t=Ns(r)?r:wo(r),{secp256k1:i}=await nd(async()=>{const{secp256k1:a}=await import("./index-5AXpmujZ.js").then(o=>o.x);return{secp256k1:a}},__vite__mapDeps([0,1]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:c,s:h,v:l,yParity:g}=e,m=Number(g??l),y=nu(m);return new i.Signature(mo(c),mo(h)).addRecoveryBit(y)}const a=Ns(e)?e:wo(e),o=Z0(`0x${a.slice(130)}`),u=nu(o);return i.Signature.fromCompact(a.substring(2,130)).addRecoveryBit(u)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function nu(r){if(r===0||r===1)return r;if(r===27)return 0;if(r===28)return 1;throw new Error("Invalid yParityOrV value")}async function fg({hash:r,signature:e}){return ug(await hg({hash:r,signature:e}))}const dg=r=>JSON.stringify(r,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),lg=r=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=r.replace(e,'$1"$2n"$3');return JSON.parse(t,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function ni(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return lg(r)}catch{return r}}function Sr(r){return typeof r=="string"?r:dg(r)||""}function pg(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function md(r,...e){if(!pg(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function au(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function gg(r,e){md(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const yi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const va=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);function bg(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function wd(r){return typeof r=="string"&&(r=bg(r)),md(r),r}let yg=class{clone(){return this._cloneInto()}};function vg(r){const e=i=>r().update(wd(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function _d(r=32){if(yi&&typeof yi.getRandomValues=="function")return yi.getRandomValues(new Uint8Array(r));if(yi&&typeof yi.randomBytes=="function")return yi.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function mg(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),a=Number(t>>s&n),o=Number(t&n),u=i?4:0,c=i?0:4;r.setUint32(e+u,a,i),r.setUint32(e+c,o,i)}let wg=class extends yg{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=va(this.buffer)}update(e){au(this);const{view:t,buffer:i,blockLen:s}=this;e=wd(e);const n=e.length;for(let a=0;a<n;){const o=Math.min(s-this.pos,n-a);if(o===s){const u=va(e);for(;s<=n-a;a+=s)this.process(u,a);continue}i.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){au(this),gg(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(i,0),a=0);for(let l=a;l<s;l++)t[l]=0;mg(i,s-8,BigInt(this.length*8),n),this.process(i,0);const o=va(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=u/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)o.setUint32(4*l,h[l],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:a,pos:o}=this;return e.length=s,e.pos=o,e.finished=n,e.destroyed=a,s%t&&e.buffer.set(i),e}};const hn=BigInt(2**32-1),_o=BigInt(32);function Ed(r,e=!1){return e?{h:Number(r&hn),l:Number(r>>_o&hn)}:{h:Number(r>>_o&hn)|0,l:Number(r&hn)|0}}function _g(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:n,l:a}=Ed(r[s],e);[t[s],i[s]]=[n,a]}return[t,i]}const Eg=(r,e)=>BigInt(r>>>0)<<_o|BigInt(e>>>0),$g=(r,e,t)=>r>>>t,Ig=(r,e,t)=>r<<32-t|e>>>t,Sg=(r,e,t)=>r>>>t|e<<32-t,xg=(r,e,t)=>r<<32-t|e>>>t,Dg=(r,e,t)=>r<<64-t|e>>>t-32,Pg=(r,e,t)=>r>>>t-32|e<<64-t,Ag=(r,e)=>e,Og=(r,e)=>r,Mg=(r,e,t)=>r<<t|e>>>32-t,Cg=(r,e,t)=>e<<t|r>>>32-t,Rg=(r,e,t)=>e<<t-32|r>>>64-t,Tg=(r,e,t)=>r<<t-32|e>>>64-t;function Ng(r,e,t,i){const s=(e>>>0)+(i>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const Fg=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),qg=(r,e,t,i)=>e+t+i+(r/2**32|0)|0,Bg=(r,e,t,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0),jg=(r,e,t,i,s)=>e+t+i+s+(r/2**32|0)|0,Lg=(r,e,t,i,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(s>>>0),Ug=(r,e,t,i,s,n)=>e+t+i+s+n+(r/2**32|0)|0,te={fromBig:Ed,split:_g,toBig:Eg,shrSH:$g,shrSL:Ig,rotrSH:Sg,rotrSL:xg,rotrBH:Dg,rotrBL:Pg,rotr32H:Ag,rotr32L:Og,rotlSH:Mg,rotlSL:Cg,rotlBH:Rg,rotlBL:Tg,add:Ng,add3L:Fg,add3H:qg,add4L:Bg,add4H:jg,add5H:Ug,add5L:Lg},[zg,kg]=te.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Mr=new Uint32Array(80),Cr=new Uint32Array(80);let Hg=class extends wg{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:i,Bl:s,Ch:n,Cl:a,Dh:o,Dl:u,Eh:c,El:h,Fh:l,Fl:g,Gh:m,Gl:y,Hh:_,Hl:O}=this;return[e,t,i,s,n,a,o,u,c,h,l,g,m,y,_,O]}set(e,t,i,s,n,a,o,u,c,h,l,g,m,y,_,O){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=a|0,this.Dh=o|0,this.Dl=u|0,this.Eh=c|0,this.El=h|0,this.Fh=l|0,this.Fl=g|0,this.Gh=m|0,this.Gl=y|0,this.Hh=_|0,this.Hl=O|0}process(e,t){for(let M=0;M<16;M++,t+=4)Mr[M]=e.getUint32(t),Cr[M]=e.getUint32(t+=4);for(let M=16;M<80;M++){const R=Mr[M-15]|0,N=Cr[M-15]|0,C=te.rotrSH(R,N,1)^te.rotrSH(R,N,8)^te.shrSH(R,N,7),q=te.rotrSL(R,N,1)^te.rotrSL(R,N,8)^te.shrSL(R,N,7),B=Mr[M-2]|0,F=Cr[M-2]|0,H=te.rotrSH(B,F,19)^te.rotrBH(B,F,61)^te.shrSH(B,F,6),S=te.rotrSL(B,F,19)^te.rotrBL(B,F,61)^te.shrSL(B,F,6),f=te.add4L(q,S,Cr[M-7],Cr[M-16]),b=te.add4H(f,C,H,Mr[M-7],Mr[M-16]);Mr[M]=b|0,Cr[M]=f|0}let{Ah:i,Al:s,Bh:n,Bl:a,Ch:o,Cl:u,Dh:c,Dl:h,Eh:l,El:g,Fh:m,Fl:y,Gh:_,Gl:O,Hh:x,Hl:D}=this;for(let M=0;M<80;M++){const R=te.rotrSH(l,g,14)^te.rotrSH(l,g,18)^te.rotrBH(l,g,41),N=te.rotrSL(l,g,14)^te.rotrSL(l,g,18)^te.rotrBL(l,g,41),C=l&m^~l&_,q=g&y^~g&O,B=te.add5L(D,N,q,kg[M],Cr[M]),F=te.add5H(B,x,R,C,zg[M],Mr[M]),H=B|0,S=te.rotrSH(i,s,28)^te.rotrBH(i,s,34)^te.rotrBH(i,s,39),f=te.rotrSL(i,s,28)^te.rotrBL(i,s,34)^te.rotrBL(i,s,39),b=i&n^i&o^n&o,w=s&a^s&u^a&u;x=_|0,D=O|0,_=m|0,O=y|0,m=l|0,y=g|0,{h:l,l:g}=te.add(c|0,h|0,F|0,H|0),c=o|0,h=u|0,o=n|0,u=a|0,n=i|0,a=s|0;const p=te.add3L(H,f,w);i=te.add3H(p,F,S,b),s=p|0}({h:i,l:s}=te.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:a}=te.add(this.Bh|0,this.Bl|0,n|0,a|0),{h:o,l:u}=te.add(this.Ch|0,this.Cl|0,o|0,u|0),{h:c,l:h}=te.add(this.Dh|0,this.Dl|0,c|0,h|0),{h:l,l:g}=te.add(this.Eh|0,this.El|0,l|0,g|0),{h:m,l:y}=te.add(this.Fh|0,this.Fl|0,m|0,y|0),{h:_,l:O}=te.add(this.Gh|0,this.Gl|0,_|0,O|0),{h:x,l:D}=te.add(this.Hh|0,this.Hl|0,x|0,D|0),this.set(i,s,n,a,o,u,c,h,l,g,m,y,_,O,x,D)}roundClean(){Mr.fill(0),Cr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Kg=vg(()=>new Hg);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const nc=BigInt(0),$d=BigInt(1),Vg=BigInt(2);function ac(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function oc(r){if(!ac(r))throw new Error("Uint8Array expected")}function ma(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}const Wg=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function cc(r){oc(r);let e="";for(let t=0;t<r.length;t++)e+=Wg[r[t]];return e}function Id(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?nc:BigInt("0x"+r)}const yr={_0:48,_9:57,A:65,F:70,a:97,f:102};function ou(r){if(r>=yr._0&&r<=yr._9)return r-yr._0;if(r>=yr.A&&r<=yr.F)return r-(yr.A-10);if(r>=yr.a&&r<=yr.f)return r-(yr.a-10)}function Sd(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const a=ou(r.charCodeAt(n)),o=ou(r.charCodeAt(n+1));if(a===void 0||o===void 0){const u=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+u+'" at index '+n)}i[s]=a*16+o}return i}function Gg(r){return Id(cc(r))}function xn(r){return oc(r),Id(cc(Uint8Array.from(r).reverse()))}function xd(r,e){return Sd(r.toString(16).padStart(e*2,"0"))}function Eo(r,e){return xd(r,e).reverse()}function vr(r,e,t){let i;if(typeof e=="string")try{i=Sd(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(ac(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=i.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}function cu(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];oc(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}const wa=r=>typeof r=="bigint"&&nc<=r;function Jg(r,e,t){return wa(r)&&wa(e)&&wa(t)&&e<=r&&r<t}function ms(r,e,t,i){if(!Jg(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function Yg(r){let e;for(e=0;r>nc;r>>=$d,e+=1);return e}const Xg=r=>(Vg<<BigInt(r-1))-$d,Zg={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||ac(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function uc(r,e,t={}){const i=(s,n,a)=>{const o=Zg[n];if(typeof o!="function")throw new Error("invalid validator function");const u=r[s];if(!(a&&u===void 0)&&!o(u,r))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+u)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(t))i(s,n,!0);return r}function uu(r){const e=new WeakMap;return(t,...i)=>{const s=e.get(t);if(s!==void 0)return s;const n=r(t,...i);return e.set(t,n),n}}const ct=BigInt(0),Qe=BigInt(1),Qr=BigInt(2),Qg=BigInt(3),$o=BigInt(4),hu=BigInt(5),fu=BigInt(8);function rt(r,e){const t=r%e;return t>=ct?t:e+t}function eb(r,e,t){if(e<ct)throw new Error("invalid exponent, negatives unsupported");if(t<=ct)throw new Error("invalid modulus");if(t===Qe)return ct;let i=Qe;for(;e>ct;)e&Qe&&(i=i*r%t),r=r*r%t,e>>=Qe;return i}function nr(r,e,t){let i=r;for(;e-- >ct;)i*=i,i%=t;return i}function du(r,e){if(r===ct)throw new Error("invert: expected non-zero number");if(e<=ct)throw new Error("invert: expected positive modulus, got "+e);let t=rt(r,e),i=e,s=ct,n=Qe;for(;t!==ct;){const a=i/t,o=i%t,u=s-n*a;i=t,t=o,s=n,n=u}if(i!==Qe)throw new Error("invert: does not exist");return rt(s,e)}function tb(r){const e=(r-Qe)/Qr;let t,i,s;for(t=r-Qe,i=0;t%Qr===ct;t/=Qr,i++);for(s=Qr;s<r&&eb(s,e,r)!==r-Qe;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const a=(r+Qe)/$o;return function(o,u){const c=o.pow(u,a);if(!o.eql(o.sqr(c),u))throw new Error("Cannot find square root");return c}}const n=(t+Qe)/Qr;return function(a,o){if(a.pow(o,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=i,c=a.pow(a.mul(a.ONE,s),t),h=a.pow(o,n),l=a.pow(o,t);for(;!a.eql(l,a.ONE);){if(a.eql(l,a.ZERO))return a.ZERO;let g=1;for(let y=a.sqr(l);g<u&&!a.eql(y,a.ONE);g++)y=a.sqr(y);const m=a.pow(c,Qe<<BigInt(u-g-1));c=a.sqr(m),h=a.mul(h,m),l=a.mul(l,c),u=g}return h}}function rb(r){if(r%$o===Qg){const e=(r+Qe)/$o;return function(t,i){const s=t.pow(i,e);if(!t.eql(t.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%fu===hu){const e=(r-hu)/fu;return function(t,i){const s=t.mul(i,Qr),n=t.pow(s,e),a=t.mul(i,n),o=t.mul(t.mul(a,Qr),n),u=t.mul(a,t.sub(o,t.ONE));if(!t.eql(t.sqr(u),i))throw new Error("Cannot find square root");return u}}return tb(r)}const ib=(r,e)=>(rt(r,e)&Qe)===Qe,sb=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function nb(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=sb.reduce((i,s)=>(i[s]="function",i),e);return uc(r,t)}function ab(r,e,t){if(t<ct)throw new Error("invalid exponent, negatives unsupported");if(t===ct)return r.ONE;if(t===Qe)return e;let i=r.ONE,s=e;for(;t>ct;)t&Qe&&(i=r.mul(i,s)),s=r.sqr(s),t>>=Qe;return i}function ob(r,e){const t=new Array(e.length),i=e.reduce((n,a,o)=>r.is0(a)?n:(t[o]=n,r.mul(n,a)),r.ONE),s=r.inv(i);return e.reduceRight((n,a,o)=>r.is0(a)?n:(t[o]=r.mul(n,t[o]),r.mul(n,a)),s),t}function Dd(r,e){const t=e!==void 0?e:r.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function Pd(r,e,t=!1,i={}){if(r<=ct)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:n}=Dd(r,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a;const o=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:n,MASK:Xg(s),ZERO:ct,ONE:Qe,create:u=>rt(u,r),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return ct<=u&&u<r},is0:u=>u===ct,isOdd:u=>(u&Qe)===Qe,neg:u=>rt(-u,r),eql:(u,c)=>u===c,sqr:u=>rt(u*u,r),add:(u,c)=>rt(u+c,r),sub:(u,c)=>rt(u-c,r),mul:(u,c)=>rt(u*c,r),pow:(u,c)=>ab(o,u,c),div:(u,c)=>rt(u*du(c,r),r),sqrN:u=>u*u,addN:(u,c)=>u+c,subN:(u,c)=>u-c,mulN:(u,c)=>u*c,inv:u=>du(u,r),sqrt:i.sqrt||(u=>(a||(a=rb(r)),a(o,u))),invertBatch:u=>ob(o,u),cmov:(u,c,h)=>h?c:u,toBytes:u=>t?Eo(u,n):xd(u,n),fromBytes:u=>{if(u.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+u.length);return t?xn(u):Gg(u)}});return Object.freeze(o)}const lu=BigInt(0),fn=BigInt(1);function _a(r,e){const t=e.negate();return r?t:e}function Ad(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Ea(r,e){Ad(r,e);const t=Math.ceil(e/r)+1,i=2**(r-1);return{windows:t,windowSize:i}}function cb(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function ub(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}const $a=new WeakMap,Od=new WeakMap;function Ia(r){return Od.get(r)||1}function hb(r,e){return{constTimeNegate:_a,hasPrecomputes(t){return Ia(t)!==1},unsafeLadder(t,i,s=r.ZERO){let n=t;for(;i>lu;)i&fn&&(s=s.add(n)),n=n.double(),i>>=fn;return s},precomputeWindow(t,i){const{windows:s,windowSize:n}=Ea(i,e),a=[];let o=t,u=o;for(let c=0;c<s;c++){u=o,a.push(u);for(let h=1;h<n;h++)u=u.add(o),a.push(u);o=u.double()}return a},wNAF(t,i,s){const{windows:n,windowSize:a}=Ea(t,e);let o=r.ZERO,u=r.BASE;const c=BigInt(2**t-1),h=2**t,l=BigInt(t);for(let g=0;g<n;g++){const m=g*a;let y=Number(s&c);s>>=l,y>a&&(y-=h,s+=fn);const _=m,O=m+Math.abs(y)-1,x=g%2!==0,D=y<0;y===0?u=u.add(_a(x,i[_])):o=o.add(_a(D,i[O]))}return{p:o,f:u}},wNAFUnsafe(t,i,s,n=r.ZERO){const{windows:a,windowSize:o}=Ea(t,e),u=BigInt(2**t-1),c=2**t,h=BigInt(t);for(let l=0;l<a;l++){const g=l*o;if(s===lu)break;let m=Number(s&u);if(s>>=h,m>o&&(m-=c,s+=fn),m===0)continue;let y=i[g+Math.abs(m)-1];m<0&&(y=y.negate()),n=n.add(y)}return n},getPrecomputes(t,i,s){let n=$a.get(i);return n||(n=this.precomputeWindow(i,t),t!==1&&$a.set(i,s(n))),n},wNAFCached(t,i,s){const n=Ia(t);return this.wNAF(n,this.getPrecomputes(n,t,s),i)},wNAFCachedUnsafe(t,i,s,n){const a=Ia(t);return a===1?this.unsafeLadder(t,i,n):this.wNAFUnsafe(a,this.getPrecomputes(a,t,s),i,n)},setWindowSize(t,i){Ad(i,e),Od.set(t,i),$a.delete(t)}}}function fb(r,e,t,i){if(cb(t,r),ub(i,e),t.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,n=Yg(BigInt(t.length)),a=n>12?n-3:n>4?n-2:n?2:1,o=(1<<a)-1,u=new Array(o+1).fill(s),c=Math.floor((e.BITS-1)/a)*a;let h=s;for(let l=c;l>=0;l-=a){u.fill(s);for(let m=0;m<i.length;m++){const y=i[m],_=Number(y>>BigInt(l)&BigInt(o));u[_]=u[_].add(t[m])}let g=s;for(let m=u.length-1,y=s;m>0;m--)y=y.add(u[m]),g=g.add(y);if(h=h.add(g),l!==0)for(let m=0;m<a;m++)h=h.double()}return h}function db(r){return nb(r.Fp),uc(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Dd(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}const Xt=BigInt(0),$t=BigInt(1),dn=BigInt(2),lb=BigInt(8),pb={zip215:!0};function gb(r){const e=db(r);return uc(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function bb(r){const e=gb(r),{Fp:t,n:i,prehash:s,hash:n,randomBytes:a,nByteLength:o,h:u}=e,c=dn<<BigInt(o*8)-$t,h=t.create,l=Pd(e.n,e.nBitLength),g=e.uvRatio||((p,v)=>{try{return{isValid:!0,value:t.sqrt(p*t.inv(v))}}catch{return{isValid:!1,value:Xt}}}),m=e.adjustScalarBytes||(p=>p),y=e.domain||((p,v,I)=>{if(ma("phflag",I),v.length||I)throw new Error("Contexts/pre-hash are not supported");return p});function _(p,v){ms("coordinate "+p,v,Xt,c)}function O(p){if(!(p instanceof M))throw new Error("ExtendedPoint expected")}const x=uu((p,v)=>{const{ex:I,ey:P,ez:E}=p,d=p.is0();v==null&&(v=d?lb:t.inv(E));const $=h(I*v),j=h(P*v),U=h(E*v);if(d)return{x:Xt,y:$t};if(U!==$t)throw new Error("invZ was invalid");return{x:$,y:j}}),D=uu(p=>{const{a:v,d:I}=e;if(p.is0())throw new Error("bad point: ZERO");const{ex:P,ey:E,ez:d,et:$}=p,j=h(P*P),U=h(E*E),L=h(d*d),z=h(L*L),G=h(j*v),X=h(L*h(G+U)),Q=h(z+h(I*h(j*U)));if(X!==Q)throw new Error("bad point: equation left != right (1)");const Y=h(P*E),ee=h(d*$);if(Y!==ee)throw new Error("bad point: equation left != right (2)");return!0});class M{constructor(v,I,P,E){this.ex=v,this.ey=I,this.ez=P,this.et=E,_("x",v),_("y",I),_("z",P),_("t",E),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(v){if(v instanceof M)throw new Error("extended point not allowed");const{x:I,y:P}=v||{};return _("x",I),_("y",P),new M(I,P,$t,h(I*P))}static normalizeZ(v){const I=t.invertBatch(v.map(P=>P.ez));return v.map((P,E)=>P.toAffine(I[E])).map(M.fromAffine)}static msm(v,I){return fb(M,l,v,I)}_setWindowSize(v){C.setWindowSize(this,v)}assertValidity(){D(this)}equals(v){O(v);const{ex:I,ey:P,ez:E}=this,{ex:d,ey:$,ez:j}=v,U=h(I*j),L=h(d*E),z=h(P*j),G=h($*E);return U===L&&z===G}is0(){return this.equals(M.ZERO)}negate(){return new M(h(-this.ex),this.ey,this.ez,h(-this.et))}double(){const{a:v}=e,{ex:I,ey:P,ez:E}=this,d=h(I*I),$=h(P*P),j=h(dn*h(E*E)),U=h(v*d),L=I+P,z=h(h(L*L)-d-$),G=U+$,X=G-j,Q=U-$,Y=h(z*X),ee=h(G*Q),ut=h(z*Q),ne=h(X*G);return new M(Y,ee,ne,ut)}add(v){O(v);const{a:I,d:P}=e,{ex:E,ey:d,ez:$,et:j}=this,{ex:U,ey:L,ez:z,et:G}=v;if(I===BigInt(-1)){const _e=h((d-E)*(L+U)),Ur=h((d+E)*(L-U)),ye=h(Ur-_e);if(ye===Xt)return this.double();const Ee=h($*dn*G),zr=h(j*dn*z),$e=zr+Ee,Ie=Ur+_e,kr=zr-Ee,pe=h($e*ye),ve=h(Ie*kr),Hr=h($e*kr),se=h(ye*Ie);return new M(pe,ve,se,Hr)}const X=h(E*U),Q=h(d*L),Y=h(j*P*G),ee=h($*z),ut=h((E+d)*(U+L)-X-Q),ne=ee-Y,fe=ee+Y,Bt=h(Q-I*X),be=h(ut*ne),Pe=h(fe*Bt),li=h(ut*Bt),Ae=h(ne*fe);return new M(be,Pe,Ae,li)}subtract(v){return this.add(v.negate())}wNAF(v){return C.wNAFCached(this,v,M.normalizeZ)}multiply(v){const I=v;ms("scalar",I,$t,i);const{p:P,f:E}=this.wNAF(I);return M.normalizeZ([P,E])[0]}multiplyUnsafe(v,I=M.ZERO){const P=v;return ms("scalar",P,Xt,i),P===Xt?N:this.is0()||P===$t?this:C.wNAFCachedUnsafe(this,P,M.normalizeZ,I)}isSmallOrder(){return this.multiplyUnsafe(u).is0()}isTorsionFree(){return C.unsafeLadder(this,i).is0()}toAffine(v){return x(this,v)}clearCofactor(){const{h:v}=e;return v===$t?this:this.multiplyUnsafe(v)}static fromHex(v,I=!1){const{d:P,a:E}=e,d=t.BYTES;v=vr("pointHex",v,d),ma("zip215",I);const $=v.slice(),j=v[d-1];$[d-1]=j&-129;const U=xn($),L=I?c:t.ORDER;ms("pointHex.y",U,Xt,L);const z=h(U*U),G=h(z-$t),X=h(P*z-E);let{isValid:Q,value:Y}=g(G,X);if(!Q)throw new Error("Point.fromHex: invalid y coordinate");const ee=(Y&$t)===$t,ut=(j&128)!==0;if(!I&&Y===Xt&&ut)throw new Error("Point.fromHex: x=0 and x_0=1");return ut!==ee&&(Y=h(-Y)),M.fromAffine({x:Y,y:U})}static fromPrivateKey(v){return F(v).point}toRawBytes(){const{x:v,y:I}=this.toAffine(),P=Eo(I,t.BYTES);return P[P.length-1]|=v&$t?128:0,P}toHex(){return cc(this.toRawBytes())}}M.BASE=new M(e.Gx,e.Gy,$t,h(e.Gx*e.Gy)),M.ZERO=new M(Xt,$t,$t,Xt);const{BASE:R,ZERO:N}=M,C=hb(M,o*8);function q(p){return rt(p,i)}function B(p){return q(xn(p))}function F(p){const v=t.BYTES;p=vr("private key",p,v);const I=vr("hashed private key",n(p),2*v),P=m(I.slice(0,v)),E=I.slice(v,2*v),d=B(P),$=R.multiply(d),j=$.toRawBytes();return{head:P,prefix:E,scalar:d,point:$,pointBytes:j}}function H(p){return F(p).pointBytes}function S(p=new Uint8Array,...v){const I=cu(...v);return B(n(y(I,vr("context",p),!!s)))}function f(p,v,I={}){p=vr("message",p),s&&(p=s(p));const{prefix:P,scalar:E,pointBytes:d}=F(v),$=S(I.context,P,p),j=R.multiply($).toRawBytes(),U=S(I.context,j,d,p),L=q($+U*E);ms("signature.s",L,Xt,i);const z=cu(j,Eo(L,t.BYTES));return vr("result",z,t.BYTES*2)}const b=pb;function w(p,v,I,P=b){const{context:E,zip215:d}=P,$=t.BYTES;p=vr("signature",p,2*$),v=vr("message",v),I=vr("publicKey",I,$),d!==void 0&&ma("zip215",d),s&&(v=s(v));const j=xn(p.slice($,2*$));let U,L,z;try{U=M.fromHex(I,d),L=M.fromHex(p.slice(0,$),d),z=R.multiplyUnsafe(j)}catch{return!1}if(!d&&U.isSmallOrder())return!1;const G=S(E,L.toRawBytes(),U.toRawBytes(),v);return L.add(U.multiplyUnsafe(G)).subtract(z).clearCofactor().equals(M.ZERO)}return R._setWindowSize(8),{CURVE:e,getPublicKey:H,sign:f,verify:w,ExtendedPoint:M,utils:{getExtendedPublicKey:F,randomPrivateKey:()=>a(t.BYTES),precompute(p=8,v=M.BASE){return v._setWindowSize(p),v.multiply(BigInt(3)),v}}}}BigInt(0),BigInt(1);const hc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),pu=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const yb=BigInt(1),gu=BigInt(2);BigInt(3);const vb=BigInt(5),mb=BigInt(8);function wb(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),n=hc,a=r*r%n*r%n,o=nr(a,gu,n)*a%n,u=nr(o,yb,n)*r%n,c=nr(u,vb,n)*u%n,h=nr(c,e,n)*c%n,l=nr(h,t,n)*h%n,g=nr(l,i,n)*l%n,m=nr(g,s,n)*g%n,y=nr(m,s,n)*g%n,_=nr(y,e,n)*c%n;return{pow_p_5_8:nr(_,gu,n)*r%n,b2:a}}function _b(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function Eb(r,e){const t=hc,i=rt(e*e*e,t),s=rt(i*i*e,t),n=wb(r*s).pow_p_5_8;let a=rt(r*i*n,t);const o=rt(e*a*a,t),u=a,c=rt(a*pu,t),h=o===r,l=o===rt(-r,t),g=o===rt(-r*pu,t);return h&&(a=u),(l||g)&&(a=c),ib(a,t)&&(a=rt(-a,t)),{isValid:h||l,value:a}}const $b=Pd(hc,void 0,!0),Ib={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:$b,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:mb,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Kg,randomBytes:_d,adjustScalarBytes:_b,uvRatio:Eb},Md=bb(Ib),Sb="EdDSA",xb="JWT",Tn=".",Vn="base64url",Cd="utf8",Rd="utf8",Db=":",Pb="did",Ab="key",bu="base58btc",Ob="z",Mb="K36",Cb=32;function fc(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function Td(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?fc(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Nd(r,e){e||(e=r.reduce((s,n)=>s+n.length,0));const t=Td(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return fc(t)}function Rb(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+" is ambiguous");t[a]=s}var o=r.length,u=r.charAt(0),c=Math.log(o)/Math.log(256),h=Math.log(256)/Math.log(o);function l(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var _=0,O=0,x=0,D=y.length;x!==D&&y[x]===0;)x++,_++;for(var M=(D-x)*h+1>>>0,R=new Uint8Array(M);x!==D;){for(var N=y[x],C=0,q=M-1;(N!==0||C<O)&&q!==-1;q--,C++)N+=256*R[q]>>>0,R[q]=N%o>>>0,N=N/o>>>0;if(N!==0)throw new Error("Non-zero carry");O=C,x++}for(var B=M-O;B!==M&&R[B]===0;)B++;for(var F=u.repeat(_);B<M;++B)F+=r.charAt(R[B]);return F}function g(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var _=0;if(y[_]!==" "){for(var O=0,x=0;y[_]===u;)O++,_++;for(var D=(y.length-_)*c+1>>>0,M=new Uint8Array(D);y[_];){var R=t[y.charCodeAt(_)];if(R===255)return;for(var N=0,C=D-1;(R!==0||N<x)&&C!==-1;C--,N++)R+=o*M[C]>>>0,M[C]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");x=N,_++}if(y[_]!==" "){for(var q=D-x;q!==D&&M[q]===0;)q++;for(var B=new Uint8Array(O+(D-q)),F=O;q!==D;)B[F++]=M[q++];return B}}}function m(y){var _=g(y);if(_)return _;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:g,decode:m}}var Tb=Rb,Nb=Tb;const Fd=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Fb=r=>new TextEncoder().encode(r),qb=r=>new TextDecoder().decode(r);let Bb=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},jb=class{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return qd(this,e)}},Lb=class{constructor(e){this.decoders=e}or(e){return qd(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const qd=(r,e)=>new Lb({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Ub=class{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Bb(e,t,i),this.decoder=new jb(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Wn=({name:r,prefix:e,encode:t,decode:i})=>new Ub(r,e,t,i),Us=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Nb(t,e);return Wn({prefix:r,name:e,encode:i,decode:n=>Fd(s(n))})},zb=(r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;const a=new Uint8Array(n*t/8|0);let o=0,u=0,c=0;for(let h=0;h<n;++h){const l=s[r[h]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);u=u<<t|l,o+=t,o>=8&&(o-=8,a[c++]=255&u>>o)}if(o>=t||255&u<<8-o)throw new SyntaxError("Unexpected end of data");return a},kb=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",a=0,o=0;for(let u=0;u<r.length;++u)for(o=o<<8|r[u],a+=8;a>t;)a-=t,n+=e[s&o>>a];if(a&&(n+=e[s&o<<t-a]),i)for(;n.length*t&7;)n+="=";return n},pt=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Wn({prefix:e,name:r,encode(s){return kb(s,i,t)},decode(s){return zb(s,i,t,r)}}),Hb=Wn({prefix:"\0",name:"identity",encode:r=>qb(r),decode:r=>Fb(r)});var Kb=Object.freeze({__proto__:null,identity:Hb});const Vb=pt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Wb=Object.freeze({__proto__:null,base2:Vb});const Gb=pt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Jb=Object.freeze({__proto__:null,base8:Gb});const Yb=Us({prefix:"9",name:"base10",alphabet:"0123456789"});var Xb=Object.freeze({__proto__:null,base10:Yb});const Zb=pt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Qb=pt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var e1=Object.freeze({__proto__:null,base16:Zb,base16upper:Qb});const t1=pt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),r1=pt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),i1=pt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),s1=pt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),n1=pt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),a1=pt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),o1=pt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),c1=pt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),u1=pt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var h1=Object.freeze({__proto__:null,base32:t1,base32upper:r1,base32pad:i1,base32padupper:s1,base32hex:n1,base32hexupper:a1,base32hexpad:o1,base32hexpadupper:c1,base32z:u1});const f1=Us({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),d1=Us({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var l1=Object.freeze({__proto__:null,base36:f1,base36upper:d1});const p1=Us({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),g1=Us({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var b1=Object.freeze({__proto__:null,base58btc:p1,base58flickr:g1});const y1=pt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),v1=pt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),m1=pt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),w1=pt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var _1=Object.freeze({__proto__:null,base64:y1,base64pad:v1,base64url:m1,base64urlpad:w1});const Bd=Array.from(""),E1=Bd.reduce((r,e,t)=>(r[t]=e,r),[]),$1=Bd.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function I1(r){return r.reduce((e,t)=>(e+=E1[t],e),"")}function S1(r){const e=[];for(const t of r){const i=$1[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const x1=Wn({prefix:"",name:"base256emoji",encode:I1,decode:S1});var D1=Object.freeze({__proto__:null,base256emoji:x1}),P1=jd,yu=128,A1=-128,O1=Math.pow(2,31);function jd(r,e,t){e=e||[],t=t||0;for(var i=t;r>=O1;)e[t++]=r&255|yu,r/=128;for(;r&A1;)e[t++]=r&255|yu,r>>>=7;return e[t]=r|0,jd.bytes=t-i+1,e}var M1=Io,C1=128,vu=127;function Io(r,i){var t=0,i=i||0,s=0,n=i,a,o=r.length;do{if(n>=o)throw Io.bytes=0,new RangeError("Could not decode varint");a=r[n++],t+=s<28?(a&vu)<<s:(a&vu)*Math.pow(2,s),s+=7}while(a>=C1);return Io.bytes=n-i,t}var R1=Math.pow(2,7),T1=Math.pow(2,14),N1=Math.pow(2,21),F1=Math.pow(2,28),q1=Math.pow(2,35),B1=Math.pow(2,42),j1=Math.pow(2,49),L1=Math.pow(2,56),U1=Math.pow(2,63),z1=function(r){return r<R1?1:r<T1?2:r<N1?3:r<F1?4:r<q1?5:r<B1?6:r<j1?7:r<L1?8:r<U1?9:10},k1={encode:P1,decode:M1,encodingLength:z1},Ld=k1;const mu=(r,e,t=0)=>(Ld.encode(r,e,t),e),wu=r=>Ld.encodingLength(r),So=(r,e)=>{const t=e.byteLength,i=wu(r),s=i+wu(t),n=new Uint8Array(s+t);return mu(r,n,0),mu(t,n,i),n.set(e,s),new H1(r,t,e,n)};let H1=class{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}};const Ud=({name:r,code:e,encode:t})=>new K1(r,e,t);let K1=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?So(this.code,t):t.then(i=>So(this.code,i))}else throw Error("Unknown type, must be binary type")}};const zd=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),V1=Ud({name:"sha2-256",code:18,encode:zd("SHA-256")}),W1=Ud({name:"sha2-512",code:19,encode:zd("SHA-512")});var G1=Object.freeze({__proto__:null,sha256:V1,sha512:W1});const kd=0,J1="identity",Hd=Fd,Y1=r=>So(kd,Hd(r)),X1={code:kd,name:J1,encode:Hd,digest:Y1};var Z1=Object.freeze({__proto__:null,identity:X1});new TextEncoder,new TextDecoder;const _u={...Kb,...Wb,...Jb,...Xb,...e1,...h1,...l1,...b1,..._1,...D1};({...G1,...Z1});function Kd(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Eu=Kd("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Sa=Kd("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Td(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Vd={utf8:Eu,"utf-8":Eu,hex:_u.base16,latin1:Sa,ascii:Sa,binary:Sa,..._u};function Gn(r,e="utf8"){const t=Vd[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function Wi(r,e="utf8"){const t=Vd[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?fc(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function $u(r){return ni(Gn(Wi(r,Vn),Cd))}function Nn(r){return Gn(Wi(Sr(r),Cd),Vn)}function Wd(r){const e=Wi(Mb,bu),t=Ob+Gn(Nd([e,r]),bu);return[Pb,Ab,t].join(Db)}function Q1(r){return Gn(r,Vn)}function ey(r){return Wi(r,Vn)}function ty(r){return Wi([Nn(r.header),Nn(r.payload)].join(Tn),Rd)}function ry(r){return[Nn(r.header),Nn(r.payload),Q1(r.signature)].join(Tn)}function xo(r){const e=r.split(Tn),t=$u(e[0]),i=$u(e[1]),s=ey(e[2]),n=Wi(e.slice(0,2).join(Tn),Rd);return{header:t,payload:i,signature:s,data:n}}function Iu(r=_d(Cb)){const e=Md.getPublicKey(r);return{secretKey:Nd([r,e]),publicKey:e}}async function iy(r,e,t,i,s=V.fromMiliseconds(Date.now())){const n={alg:Sb,typ:xb},a=Wd(i.publicKey),o=s+t,u={iss:a,sub:r,aud:e,iat:s,exp:o},c=ty({header:n,payload:u}),h=Md.sign(c,i.secretKey.slice(0,32));return ry({header:n,payload:u,signature:h})}function Gd(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function xa(r,e){e||(e=r.reduce((s,n)=>s+n.length,0));const t=Gd(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return t}function sy(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+" is ambiguous");t[a]=s}var o=r.length,u=r.charAt(0),c=Math.log(o)/Math.log(256),h=Math.log(256)/Math.log(o);function l(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var _=0,O=0,x=0,D=y.length;x!==D&&y[x]===0;)x++,_++;for(var M=(D-x)*h+1>>>0,R=new Uint8Array(M);x!==D;){for(var N=y[x],C=0,q=M-1;(N!==0||C<O)&&q!==-1;q--,C++)N+=256*R[q]>>>0,R[q]=N%o>>>0,N=N/o>>>0;if(N!==0)throw new Error("Non-zero carry");O=C,x++}for(var B=M-O;B!==M&&R[B]===0;)B++;for(var F=u.repeat(_);B<M;++B)F+=r.charAt(R[B]);return F}function g(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var _=0;if(y[_]!==" "){for(var O=0,x=0;y[_]===u;)O++,_++;for(var D=(y.length-_)*c+1>>>0,M=new Uint8Array(D);y[_];){var R=t[y.charCodeAt(_)];if(R===255)return;for(var N=0,C=D-1;(R!==0||N<x)&&C!==-1;C--,N++)R+=o*M[C]>>>0,M[C]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");x=N,_++}if(y[_]!==" "){for(var q=D-x;q!==D&&M[q]===0;)q++;for(var B=new Uint8Array(O+(D-q)),F=O;q!==D;)B[F++]=M[q++];return B}}}function m(y){var _=g(y);if(_)return _;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:g,decode:m}}var ny=sy,ay=ny;const oy=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},cy=r=>new TextEncoder().encode(r),uy=r=>new TextDecoder().decode(r);class hy{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class fy{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Jd(this,e)}}class dy{constructor(e){this.decoders=e}or(e){return Jd(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Jd=(r,e)=>new dy({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class ly{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new hy(e,t,i),this.decoder=new fy(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Jn=({name:r,prefix:e,encode:t,decode:i})=>new ly(r,e,t,i),zs=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=ay(t,e);return Jn({prefix:r,name:e,encode:i,decode:n=>oy(s(n))})},py=(r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;const a=new Uint8Array(n*t/8|0);let o=0,u=0,c=0;for(let h=0;h<n;++h){const l=s[r[h]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);u=u<<t|l,o+=t,o>=8&&(o-=8,a[c++]=255&u>>o)}if(o>=t||255&u<<8-o)throw new SyntaxError("Unexpected end of data");return a},gy=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",a=0,o=0;for(let u=0;u<r.length;++u)for(o=o<<8|r[u],a+=8;a>t;)a-=t,n+=e[s&o>>a];if(a&&(n+=e[s&o<<t-a]),i)for(;n.length*t&7;)n+="=";return n},gt=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Jn({prefix:e,name:r,encode(s){return gy(s,i,t)},decode(s){return py(s,i,t,r)}}),by=Jn({prefix:"\0",name:"identity",encode:r=>uy(r),decode:r=>cy(r)}),yy=Object.freeze(Object.defineProperty({__proto__:null,identity:by},Symbol.toStringTag,{value:"Module"})),vy=gt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),my=Object.freeze(Object.defineProperty({__proto__:null,base2:vy},Symbol.toStringTag,{value:"Module"})),wy=gt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),_y=Object.freeze(Object.defineProperty({__proto__:null,base8:wy},Symbol.toStringTag,{value:"Module"})),Ey=zs({prefix:"9",name:"base10",alphabet:"0123456789"}),$y=Object.freeze(Object.defineProperty({__proto__:null,base10:Ey},Symbol.toStringTag,{value:"Module"})),Iy=gt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Sy=gt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),xy=Object.freeze(Object.defineProperty({__proto__:null,base16:Iy,base16upper:Sy},Symbol.toStringTag,{value:"Module"})),Dy=gt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Py=gt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ay=gt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Oy=gt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),My=gt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Cy=gt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ry=gt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ty=gt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ny=gt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Fy=Object.freeze(Object.defineProperty({__proto__:null,base32:Dy,base32hex:My,base32hexpad:Ry,base32hexpadupper:Ty,base32hexupper:Cy,base32pad:Ay,base32padupper:Oy,base32upper:Py,base32z:Ny},Symbol.toStringTag,{value:"Module"})),qy=zs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),By=zs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),jy=Object.freeze(Object.defineProperty({__proto__:null,base36:qy,base36upper:By},Symbol.toStringTag,{value:"Module"})),Ly=zs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Uy=zs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),zy=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Ly,base58flickr:Uy},Symbol.toStringTag,{value:"Module"})),ky=gt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Hy=gt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ky=gt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Vy=gt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Wy=Object.freeze(Object.defineProperty({__proto__:null,base64:ky,base64pad:Hy,base64url:Ky,base64urlpad:Vy},Symbol.toStringTag,{value:"Module"})),Yd=Array.from(""),Gy=Yd.reduce((r,e,t)=>(r[t]=e,r),[]),Jy=Yd.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Yy(r){return r.reduce((e,t)=>(e+=Gy[t],e),"")}function Xy(r){const e=[];for(const t of r){const i=Jy[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Zy=Jn({prefix:"",name:"base256emoji",encode:Yy,decode:Xy}),Qy=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Zy},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Su={...yy,...my,..._y,...$y,...xy,...Fy,...jy,...zy,...Wy,...Qy};function Xd(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const xu=Xd("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Da=Xd("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Gd(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Zd={utf8:xu,"utf-8":xu,hex:Su.base16,latin1:Da,ascii:Da,binary:Da,...Su};function Kt(r,e="utf8"){const t=Zd[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}function _t(r,e="utf8"){const t=Zd[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var Pa={};const ev="6.6.1",tv={version:ev};var Aa={},Dn={exports:{}},rv=Dn.exports,Du;function xr(){return Du||(Du=1,function(r){(function(e,t){function i(S,f){if(!S)throw new Error(f||"Assertion failed")}function s(S,f){S.super_=f;var b=function(){};b.prototype=f.prototype,S.prototype=new b,S.prototype.constructor=S}function n(S,f,b){if(n.isBN(S))return S;this.negative=0,this.words=null,this.length=0,this.red=null,S!==null&&((f==="le"||f==="be")&&(b=f,f=10),this._init(S||0,f||10,b||"be"))}typeof e=="object"?e.exports=n:t.BN=n,n.BN=n,n.wordSize=26;var a;try{typeof window<"u"&&typeof window.Buffer<"u"?a=window.Buffer:a=ad.Buffer}catch{}n.isBN=function(f){return f instanceof n?!0:f!==null&&typeof f=="object"&&f.constructor.wordSize===n.wordSize&&Array.isArray(f.words)},n.max=function(f,b){return f.cmp(b)>0?f:b},n.min=function(f,b){return f.cmp(b)<0?f:b},n.prototype._init=function(f,b,w){if(typeof f=="number")return this._initNumber(f,b,w);if(typeof f=="object")return this._initArray(f,b,w);b==="hex"&&(b=16),i(b===(b|0)&&b>=2&&b<=36),f=f.toString().replace(/\s+/g,"");var p=0;f[0]==="-"&&(p++,this.negative=1),p<f.length&&(b===16?this._parseHex(f,p,w):(this._parseBase(f,b,p),w==="le"&&this._initArray(this.toArray(),b,w)))},n.prototype._initNumber=function(f,b,w){f<0&&(this.negative=1,f=-f),f<67108864?(this.words=[f&67108863],this.length=1):f<4503599627370496?(this.words=[f&67108863,f/67108864&67108863],this.length=2):(i(f<9007199254740992),this.words=[f&67108863,f/67108864&67108863,1],this.length=3),w==="le"&&this._initArray(this.toArray(),b,w)},n.prototype._initArray=function(f,b,w){if(i(typeof f.length=="number"),f.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(f.length/3),this.words=new Array(this.length);for(var p=0;p<this.length;p++)this.words[p]=0;var v,I,P=0;if(w==="be")for(p=f.length-1,v=0;p>=0;p-=3)I=f[p]|f[p-1]<<8|f[p-2]<<16,this.words[v]|=I<<P&67108863,this.words[v+1]=I>>>26-P&67108863,P+=24,P>=26&&(P-=26,v++);else if(w==="le")for(p=0,v=0;p<f.length;p+=3)I=f[p]|f[p+1]<<8|f[p+2]<<16,this.words[v]|=I<<P&67108863,this.words[v+1]=I>>>26-P&67108863,P+=24,P>=26&&(P-=26,v++);return this.strip()};function o(S,f){var b=S.charCodeAt(f);return b>=65&&b<=70?b-55:b>=97&&b<=102?b-87:b-48&15}function u(S,f,b){var w=o(S,b);return b-1>=f&&(w|=o(S,b-1)<<4),w}n.prototype._parseHex=function(f,b,w){this.length=Math.ceil((f.length-b)/6),this.words=new Array(this.length);for(var p=0;p<this.length;p++)this.words[p]=0;var v=0,I=0,P;if(w==="be")for(p=f.length-1;p>=b;p-=2)P=u(f,b,p)<<v,this.words[I]|=P&67108863,v>=18?(v-=18,I+=1,this.words[I]|=P>>>26):v+=8;else{var E=f.length-b;for(p=E%2===0?b+1:b;p<f.length;p+=2)P=u(f,b,p)<<v,this.words[I]|=P&67108863,v>=18?(v-=18,I+=1,this.words[I]|=P>>>26):v+=8}this.strip()};function c(S,f,b,w){for(var p=0,v=Math.min(S.length,b),I=f;I<v;I++){var P=S.charCodeAt(I)-48;p*=w,P>=49?p+=P-49+10:P>=17?p+=P-17+10:p+=P}return p}n.prototype._parseBase=function(f,b,w){this.words=[0],this.length=1;for(var p=0,v=1;v<=67108863;v*=b)p++;p--,v=v/b|0;for(var I=f.length-w,P=I%p,E=Math.min(I,I-P)+w,d=0,$=w;$<E;$+=p)d=c(f,$,$+p,b),this.imuln(v),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d);if(P!==0){var j=1;for(d=c(f,$,f.length,b),$=0;$<P;$++)j*=b;this.imuln(j),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d)}this.strip()},n.prototype.copy=function(f){f.words=new Array(this.length);for(var b=0;b<this.length;b++)f.words[b]=this.words[b];f.length=this.length,f.negative=this.negative,f.red=this.red},n.prototype.clone=function(){var f=new n(null);return this.copy(f),f},n.prototype._expand=function(f){for(;this.length<f;)this.words[this.length++]=0;return this},n.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},n.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},n.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var h=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],g=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];n.prototype.toString=function(f,b){f=f||10,b=b|0||1;var w;if(f===16||f==="hex"){w="";for(var p=0,v=0,I=0;I<this.length;I++){var P=this.words[I],E=((P<<p|v)&16777215).toString(16);v=P>>>24-p&16777215,p+=2,p>=26&&(p-=26,I--),v!==0||I!==this.length-1?w=h[6-E.length]+E+w:w=E+w}for(v!==0&&(w=v.toString(16)+w);w.length%b!==0;)w="0"+w;return this.negative!==0&&(w="-"+w),w}if(f===(f|0)&&f>=2&&f<=36){var d=l[f],$=g[f];w="";var j=this.clone();for(j.negative=0;!j.isZero();){var U=j.modn($).toString(f);j=j.idivn($),j.isZero()?w=U+w:w=h[d-U.length]+U+w}for(this.isZero()&&(w="0"+w);w.length%b!==0;)w="0"+w;return this.negative!==0&&(w="-"+w),w}i(!1,"Base should be between 2 and 36")},n.prototype.toNumber=function(){var f=this.words[0];return this.length===2?f+=this.words[1]*67108864:this.length===3&&this.words[2]===1?f+=4503599627370496+this.words[1]*67108864:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-f:f},n.prototype.toJSON=function(){return this.toString(16)},n.prototype.toBuffer=function(f,b){return i(typeof a<"u"),this.toArrayLike(a,f,b)},n.prototype.toArray=function(f,b){return this.toArrayLike(Array,f,b)},n.prototype.toArrayLike=function(f,b,w){var p=this.byteLength(),v=w||Math.max(1,p);i(p<=v,"byte array longer than desired length"),i(v>0,"Requested array length <= 0"),this.strip();var I=b==="le",P=new f(v),E,d,$=this.clone();if(I){for(d=0;!$.isZero();d++)E=$.andln(255),$.iushrn(8),P[d]=E;for(;d<v;d++)P[d]=0}else{for(d=0;d<v-p;d++)P[d]=0;for(d=0;!$.isZero();d++)E=$.andln(255),$.iushrn(8),P[v-d-1]=E}return P},Math.clz32?n.prototype._countBits=function(f){return 32-Math.clz32(f)}:n.prototype._countBits=function(f){var b=f,w=0;return b>=4096&&(w+=13,b>>>=13),b>=64&&(w+=7,b>>>=7),b>=8&&(w+=4,b>>>=4),b>=2&&(w+=2,b>>>=2),w+b},n.prototype._zeroBits=function(f){if(f===0)return 26;var b=f,w=0;return(b&8191)===0&&(w+=13,b>>>=13),(b&127)===0&&(w+=7,b>>>=7),(b&15)===0&&(w+=4,b>>>=4),(b&3)===0&&(w+=2,b>>>=2),(b&1)===0&&w++,w},n.prototype.bitLength=function(){var f=this.words[this.length-1],b=this._countBits(f);return(this.length-1)*26+b};function m(S){for(var f=new Array(S.bitLength()),b=0;b<f.length;b++){var w=b/26|0,p=b%26;f[b]=(S.words[w]&1<<p)>>>p}return f}n.prototype.zeroBits=function(){if(this.isZero())return 0;for(var f=0,b=0;b<this.length;b++){var w=this._zeroBits(this.words[b]);if(f+=w,w!==26)break}return f},n.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},n.prototype.toTwos=function(f){return this.negative!==0?this.abs().inotn(f).iaddn(1):this.clone()},n.prototype.fromTwos=function(f){return this.testn(f-1)?this.notn(f).iaddn(1).ineg():this.clone()},n.prototype.isNeg=function(){return this.negative!==0},n.prototype.neg=function(){return this.clone().ineg()},n.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},n.prototype.iuor=function(f){for(;this.length<f.length;)this.words[this.length++]=0;for(var b=0;b<f.length;b++)this.words[b]=this.words[b]|f.words[b];return this.strip()},n.prototype.ior=function(f){return i((this.negative|f.negative)===0),this.iuor(f)},n.prototype.or=function(f){return this.length>f.length?this.clone().ior(f):f.clone().ior(this)},n.prototype.uor=function(f){return this.length>f.length?this.clone().iuor(f):f.clone().iuor(this)},n.prototype.iuand=function(f){var b;this.length>f.length?b=f:b=this;for(var w=0;w<b.length;w++)this.words[w]=this.words[w]&f.words[w];return this.length=b.length,this.strip()},n.prototype.iand=function(f){return i((this.negative|f.negative)===0),this.iuand(f)},n.prototype.and=function(f){return this.length>f.length?this.clone().iand(f):f.clone().iand(this)},n.prototype.uand=function(f){return this.length>f.length?this.clone().iuand(f):f.clone().iuand(this)},n.prototype.iuxor=function(f){var b,w;this.length>f.length?(b=this,w=f):(b=f,w=this);for(var p=0;p<w.length;p++)this.words[p]=b.words[p]^w.words[p];if(this!==b)for(;p<b.length;p++)this.words[p]=b.words[p];return this.length=b.length,this.strip()},n.prototype.ixor=function(f){return i((this.negative|f.negative)===0),this.iuxor(f)},n.prototype.xor=function(f){return this.length>f.length?this.clone().ixor(f):f.clone().ixor(this)},n.prototype.uxor=function(f){return this.length>f.length?this.clone().iuxor(f):f.clone().iuxor(this)},n.prototype.inotn=function(f){i(typeof f=="number"&&f>=0);var b=Math.ceil(f/26)|0,w=f%26;this._expand(b),w>0&&b--;for(var p=0;p<b;p++)this.words[p]=~this.words[p]&67108863;return w>0&&(this.words[p]=~this.words[p]&67108863>>26-w),this.strip()},n.prototype.notn=function(f){return this.clone().inotn(f)},n.prototype.setn=function(f,b){i(typeof f=="number"&&f>=0);var w=f/26|0,p=f%26;return this._expand(w+1),b?this.words[w]=this.words[w]|1<<p:this.words[w]=this.words[w]&~(1<<p),this.strip()},n.prototype.iadd=function(f){var b;if(this.negative!==0&&f.negative===0)return this.negative=0,b=this.isub(f),this.negative^=1,this._normSign();if(this.negative===0&&f.negative!==0)return f.negative=0,b=this.isub(f),f.negative=1,b._normSign();var w,p;this.length>f.length?(w=this,p=f):(w=f,p=this);for(var v=0,I=0;I<p.length;I++)b=(w.words[I]|0)+(p.words[I]|0)+v,this.words[I]=b&67108863,v=b>>>26;for(;v!==0&&I<w.length;I++)b=(w.words[I]|0)+v,this.words[I]=b&67108863,v=b>>>26;if(this.length=w.length,v!==0)this.words[this.length]=v,this.length++;else if(w!==this)for(;I<w.length;I++)this.words[I]=w.words[I];return this},n.prototype.add=function(f){var b;return f.negative!==0&&this.negative===0?(f.negative=0,b=this.sub(f),f.negative^=1,b):f.negative===0&&this.negative!==0?(this.negative=0,b=f.sub(this),this.negative=1,b):this.length>f.length?this.clone().iadd(f):f.clone().iadd(this)},n.prototype.isub=function(f){if(f.negative!==0){f.negative=0;var b=this.iadd(f);return f.negative=1,b._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(f),this.negative=1,this._normSign();var w=this.cmp(f);if(w===0)return this.negative=0,this.length=1,this.words[0]=0,this;var p,v;w>0?(p=this,v=f):(p=f,v=this);for(var I=0,P=0;P<v.length;P++)b=(p.words[P]|0)-(v.words[P]|0)+I,I=b>>26,this.words[P]=b&67108863;for(;I!==0&&P<p.length;P++)b=(p.words[P]|0)+I,I=b>>26,this.words[P]=b&67108863;if(I===0&&P<p.length&&p!==this)for(;P<p.length;P++)this.words[P]=p.words[P];return this.length=Math.max(this.length,P),p!==this&&(this.negative=1),this.strip()},n.prototype.sub=function(f){return this.clone().isub(f)};function y(S,f,b){b.negative=f.negative^S.negative;var w=S.length+f.length|0;b.length=w,w=w-1|0;var p=S.words[0]|0,v=f.words[0]|0,I=p*v,P=I&67108863,E=I/67108864|0;b.words[0]=P;for(var d=1;d<w;d++){for(var $=E>>>26,j=E&67108863,U=Math.min(d,f.length-1),L=Math.max(0,d-S.length+1);L<=U;L++){var z=d-L|0;p=S.words[z]|0,v=f.words[L]|0,I=p*v+j,$+=I/67108864|0,j=I&67108863}b.words[d]=j|0,E=$|0}return E!==0?b.words[d]=E|0:b.length--,b.strip()}var _=function(f,b,w){var p=f.words,v=b.words,I=w.words,P=0,E,d,$,j=p[0]|0,U=j&8191,L=j>>>13,z=p[1]|0,G=z&8191,X=z>>>13,Q=p[2]|0,Y=Q&8191,ee=Q>>>13,ut=p[3]|0,ne=ut&8191,fe=ut>>>13,Bt=p[4]|0,be=Bt&8191,Pe=Bt>>>13,li=p[5]|0,Ae=li&8191,_e=li>>>13,Ur=p[6]|0,ye=Ur&8191,Ee=Ur>>>13,zr=p[7]|0,$e=zr&8191,Ie=zr>>>13,kr=p[8]|0,pe=kr&8191,ve=kr>>>13,Hr=p[9]|0,se=Hr&8191,Te=Hr>>>13,Xi=v[0]|0,ze=Xi&8191,Ne=Xi>>>13,Kr=v[1]|0,Fe=Kr&8191,qe=Kr>>>13,Qs=v[2]|0,de=Qs&8191,Be=Qs>>>13,en=v[3]|0,ke=en&8191,Oe=en>>>13,Dr=v[4]|0,Me=Dr&8191,Ce=Dr>>>13,pi=v[5]|0,me=pi&8191,He=pi>>>13,tn=v[6]|0,Ke=tn&8191,Ve=tn>>>13,rn=v[7]|0,je=rn&8191,Re=rn>>>13,sr=v[8]|0,We=sr&8191,Ge=sr>>>13,sn=v[9]|0,Je=sn&8191,Ye=sn>>>13;w.negative=f.negative^b.negative,w.length=19,E=Math.imul(U,ze),d=Math.imul(U,Ne),d=d+Math.imul(L,ze)|0,$=Math.imul(L,Ne);var Ot=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(Ot>>>26)|0,Ot&=67108863,E=Math.imul(G,ze),d=Math.imul(G,Ne),d=d+Math.imul(X,ze)|0,$=Math.imul(X,Ne),E=E+Math.imul(U,Fe)|0,d=d+Math.imul(U,qe)|0,d=d+Math.imul(L,Fe)|0,$=$+Math.imul(L,qe)|0;var Zi=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(Zi>>>26)|0,Zi&=67108863,E=Math.imul(Y,ze),d=Math.imul(Y,Ne),d=d+Math.imul(ee,ze)|0,$=Math.imul(ee,Ne),E=E+Math.imul(G,Fe)|0,d=d+Math.imul(G,qe)|0,d=d+Math.imul(X,Fe)|0,$=$+Math.imul(X,qe)|0,E=E+Math.imul(U,de)|0,d=d+Math.imul(U,Be)|0,d=d+Math.imul(L,de)|0,$=$+Math.imul(L,Be)|0;var Qi=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(Qi>>>26)|0,Qi&=67108863,E=Math.imul(ne,ze),d=Math.imul(ne,Ne),d=d+Math.imul(fe,ze)|0,$=Math.imul(fe,Ne),E=E+Math.imul(Y,Fe)|0,d=d+Math.imul(Y,qe)|0,d=d+Math.imul(ee,Fe)|0,$=$+Math.imul(ee,qe)|0,E=E+Math.imul(G,de)|0,d=d+Math.imul(G,Be)|0,d=d+Math.imul(X,de)|0,$=$+Math.imul(X,Be)|0,E=E+Math.imul(U,ke)|0,d=d+Math.imul(U,Oe)|0,d=d+Math.imul(L,ke)|0,$=$+Math.imul(L,Oe)|0;var es=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(es>>>26)|0,es&=67108863,E=Math.imul(be,ze),d=Math.imul(be,Ne),d=d+Math.imul(Pe,ze)|0,$=Math.imul(Pe,Ne),E=E+Math.imul(ne,Fe)|0,d=d+Math.imul(ne,qe)|0,d=d+Math.imul(fe,Fe)|0,$=$+Math.imul(fe,qe)|0,E=E+Math.imul(Y,de)|0,d=d+Math.imul(Y,Be)|0,d=d+Math.imul(ee,de)|0,$=$+Math.imul(ee,Be)|0,E=E+Math.imul(G,ke)|0,d=d+Math.imul(G,Oe)|0,d=d+Math.imul(X,ke)|0,$=$+Math.imul(X,Oe)|0,E=E+Math.imul(U,Me)|0,d=d+Math.imul(U,Ce)|0,d=d+Math.imul(L,Me)|0,$=$+Math.imul(L,Ce)|0;var ts=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(ts>>>26)|0,ts&=67108863,E=Math.imul(Ae,ze),d=Math.imul(Ae,Ne),d=d+Math.imul(_e,ze)|0,$=Math.imul(_e,Ne),E=E+Math.imul(be,Fe)|0,d=d+Math.imul(be,qe)|0,d=d+Math.imul(Pe,Fe)|0,$=$+Math.imul(Pe,qe)|0,E=E+Math.imul(ne,de)|0,d=d+Math.imul(ne,Be)|0,d=d+Math.imul(fe,de)|0,$=$+Math.imul(fe,Be)|0,E=E+Math.imul(Y,ke)|0,d=d+Math.imul(Y,Oe)|0,d=d+Math.imul(ee,ke)|0,$=$+Math.imul(ee,Oe)|0,E=E+Math.imul(G,Me)|0,d=d+Math.imul(G,Ce)|0,d=d+Math.imul(X,Me)|0,$=$+Math.imul(X,Ce)|0,E=E+Math.imul(U,me)|0,d=d+Math.imul(U,He)|0,d=d+Math.imul(L,me)|0,$=$+Math.imul(L,He)|0;var rs=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(rs>>>26)|0,rs&=67108863,E=Math.imul(ye,ze),d=Math.imul(ye,Ne),d=d+Math.imul(Ee,ze)|0,$=Math.imul(Ee,Ne),E=E+Math.imul(Ae,Fe)|0,d=d+Math.imul(Ae,qe)|0,d=d+Math.imul(_e,Fe)|0,$=$+Math.imul(_e,qe)|0,E=E+Math.imul(be,de)|0,d=d+Math.imul(be,Be)|0,d=d+Math.imul(Pe,de)|0,$=$+Math.imul(Pe,Be)|0,E=E+Math.imul(ne,ke)|0,d=d+Math.imul(ne,Oe)|0,d=d+Math.imul(fe,ke)|0,$=$+Math.imul(fe,Oe)|0,E=E+Math.imul(Y,Me)|0,d=d+Math.imul(Y,Ce)|0,d=d+Math.imul(ee,Me)|0,$=$+Math.imul(ee,Ce)|0,E=E+Math.imul(G,me)|0,d=d+Math.imul(G,He)|0,d=d+Math.imul(X,me)|0,$=$+Math.imul(X,He)|0,E=E+Math.imul(U,Ke)|0,d=d+Math.imul(U,Ve)|0,d=d+Math.imul(L,Ke)|0,$=$+Math.imul(L,Ve)|0;var Jt=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(Jt>>>26)|0,Jt&=67108863,E=Math.imul($e,ze),d=Math.imul($e,Ne),d=d+Math.imul(Ie,ze)|0,$=Math.imul(Ie,Ne),E=E+Math.imul(ye,Fe)|0,d=d+Math.imul(ye,qe)|0,d=d+Math.imul(Ee,Fe)|0,$=$+Math.imul(Ee,qe)|0,E=E+Math.imul(Ae,de)|0,d=d+Math.imul(Ae,Be)|0,d=d+Math.imul(_e,de)|0,$=$+Math.imul(_e,Be)|0,E=E+Math.imul(be,ke)|0,d=d+Math.imul(be,Oe)|0,d=d+Math.imul(Pe,ke)|0,$=$+Math.imul(Pe,Oe)|0,E=E+Math.imul(ne,Me)|0,d=d+Math.imul(ne,Ce)|0,d=d+Math.imul(fe,Me)|0,$=$+Math.imul(fe,Ce)|0,E=E+Math.imul(Y,me)|0,d=d+Math.imul(Y,He)|0,d=d+Math.imul(ee,me)|0,$=$+Math.imul(ee,He)|0,E=E+Math.imul(G,Ke)|0,d=d+Math.imul(G,Ve)|0,d=d+Math.imul(X,Ke)|0,$=$+Math.imul(X,Ve)|0,E=E+Math.imul(U,je)|0,d=d+Math.imul(U,Re)|0,d=d+Math.imul(L,je)|0,$=$+Math.imul(L,Re)|0;var is=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(is>>>26)|0,is&=67108863,E=Math.imul(pe,ze),d=Math.imul(pe,Ne),d=d+Math.imul(ve,ze)|0,$=Math.imul(ve,Ne),E=E+Math.imul($e,Fe)|0,d=d+Math.imul($e,qe)|0,d=d+Math.imul(Ie,Fe)|0,$=$+Math.imul(Ie,qe)|0,E=E+Math.imul(ye,de)|0,d=d+Math.imul(ye,Be)|0,d=d+Math.imul(Ee,de)|0,$=$+Math.imul(Ee,Be)|0,E=E+Math.imul(Ae,ke)|0,d=d+Math.imul(Ae,Oe)|0,d=d+Math.imul(_e,ke)|0,$=$+Math.imul(_e,Oe)|0,E=E+Math.imul(be,Me)|0,d=d+Math.imul(be,Ce)|0,d=d+Math.imul(Pe,Me)|0,$=$+Math.imul(Pe,Ce)|0,E=E+Math.imul(ne,me)|0,d=d+Math.imul(ne,He)|0,d=d+Math.imul(fe,me)|0,$=$+Math.imul(fe,He)|0,E=E+Math.imul(Y,Ke)|0,d=d+Math.imul(Y,Ve)|0,d=d+Math.imul(ee,Ke)|0,$=$+Math.imul(ee,Ve)|0,E=E+Math.imul(G,je)|0,d=d+Math.imul(G,Re)|0,d=d+Math.imul(X,je)|0,$=$+Math.imul(X,Re)|0,E=E+Math.imul(U,We)|0,d=d+Math.imul(U,Ge)|0,d=d+Math.imul(L,We)|0,$=$+Math.imul(L,Ge)|0;var ss=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(ss>>>26)|0,ss&=67108863,E=Math.imul(se,ze),d=Math.imul(se,Ne),d=d+Math.imul(Te,ze)|0,$=Math.imul(Te,Ne),E=E+Math.imul(pe,Fe)|0,d=d+Math.imul(pe,qe)|0,d=d+Math.imul(ve,Fe)|0,$=$+Math.imul(ve,qe)|0,E=E+Math.imul($e,de)|0,d=d+Math.imul($e,Be)|0,d=d+Math.imul(Ie,de)|0,$=$+Math.imul(Ie,Be)|0,E=E+Math.imul(ye,ke)|0,d=d+Math.imul(ye,Oe)|0,d=d+Math.imul(Ee,ke)|0,$=$+Math.imul(Ee,Oe)|0,E=E+Math.imul(Ae,Me)|0,d=d+Math.imul(Ae,Ce)|0,d=d+Math.imul(_e,Me)|0,$=$+Math.imul(_e,Ce)|0,E=E+Math.imul(be,me)|0,d=d+Math.imul(be,He)|0,d=d+Math.imul(Pe,me)|0,$=$+Math.imul(Pe,He)|0,E=E+Math.imul(ne,Ke)|0,d=d+Math.imul(ne,Ve)|0,d=d+Math.imul(fe,Ke)|0,$=$+Math.imul(fe,Ve)|0,E=E+Math.imul(Y,je)|0,d=d+Math.imul(Y,Re)|0,d=d+Math.imul(ee,je)|0,$=$+Math.imul(ee,Re)|0,E=E+Math.imul(G,We)|0,d=d+Math.imul(G,Ge)|0,d=d+Math.imul(X,We)|0,$=$+Math.imul(X,Ge)|0,E=E+Math.imul(U,Je)|0,d=d+Math.imul(U,Ye)|0,d=d+Math.imul(L,Je)|0,$=$+Math.imul(L,Ye)|0;var ns=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(ns>>>26)|0,ns&=67108863,E=Math.imul(se,Fe),d=Math.imul(se,qe),d=d+Math.imul(Te,Fe)|0,$=Math.imul(Te,qe),E=E+Math.imul(pe,de)|0,d=d+Math.imul(pe,Be)|0,d=d+Math.imul(ve,de)|0,$=$+Math.imul(ve,Be)|0,E=E+Math.imul($e,ke)|0,d=d+Math.imul($e,Oe)|0,d=d+Math.imul(Ie,ke)|0,$=$+Math.imul(Ie,Oe)|0,E=E+Math.imul(ye,Me)|0,d=d+Math.imul(ye,Ce)|0,d=d+Math.imul(Ee,Me)|0,$=$+Math.imul(Ee,Ce)|0,E=E+Math.imul(Ae,me)|0,d=d+Math.imul(Ae,He)|0,d=d+Math.imul(_e,me)|0,$=$+Math.imul(_e,He)|0,E=E+Math.imul(be,Ke)|0,d=d+Math.imul(be,Ve)|0,d=d+Math.imul(Pe,Ke)|0,$=$+Math.imul(Pe,Ve)|0,E=E+Math.imul(ne,je)|0,d=d+Math.imul(ne,Re)|0,d=d+Math.imul(fe,je)|0,$=$+Math.imul(fe,Re)|0,E=E+Math.imul(Y,We)|0,d=d+Math.imul(Y,Ge)|0,d=d+Math.imul(ee,We)|0,$=$+Math.imul(ee,Ge)|0,E=E+Math.imul(G,Je)|0,d=d+Math.imul(G,Ye)|0,d=d+Math.imul(X,Je)|0,$=$+Math.imul(X,Ye)|0;var as=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(as>>>26)|0,as&=67108863,E=Math.imul(se,de),d=Math.imul(se,Be),d=d+Math.imul(Te,de)|0,$=Math.imul(Te,Be),E=E+Math.imul(pe,ke)|0,d=d+Math.imul(pe,Oe)|0,d=d+Math.imul(ve,ke)|0,$=$+Math.imul(ve,Oe)|0,E=E+Math.imul($e,Me)|0,d=d+Math.imul($e,Ce)|0,d=d+Math.imul(Ie,Me)|0,$=$+Math.imul(Ie,Ce)|0,E=E+Math.imul(ye,me)|0,d=d+Math.imul(ye,He)|0,d=d+Math.imul(Ee,me)|0,$=$+Math.imul(Ee,He)|0,E=E+Math.imul(Ae,Ke)|0,d=d+Math.imul(Ae,Ve)|0,d=d+Math.imul(_e,Ke)|0,$=$+Math.imul(_e,Ve)|0,E=E+Math.imul(be,je)|0,d=d+Math.imul(be,Re)|0,d=d+Math.imul(Pe,je)|0,$=$+Math.imul(Pe,Re)|0,E=E+Math.imul(ne,We)|0,d=d+Math.imul(ne,Ge)|0,d=d+Math.imul(fe,We)|0,$=$+Math.imul(fe,Ge)|0,E=E+Math.imul(Y,Je)|0,d=d+Math.imul(Y,Ye)|0,d=d+Math.imul(ee,Je)|0,$=$+Math.imul(ee,Ye)|0;var os=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(os>>>26)|0,os&=67108863,E=Math.imul(se,ke),d=Math.imul(se,Oe),d=d+Math.imul(Te,ke)|0,$=Math.imul(Te,Oe),E=E+Math.imul(pe,Me)|0,d=d+Math.imul(pe,Ce)|0,d=d+Math.imul(ve,Me)|0,$=$+Math.imul(ve,Ce)|0,E=E+Math.imul($e,me)|0,d=d+Math.imul($e,He)|0,d=d+Math.imul(Ie,me)|0,$=$+Math.imul(Ie,He)|0,E=E+Math.imul(ye,Ke)|0,d=d+Math.imul(ye,Ve)|0,d=d+Math.imul(Ee,Ke)|0,$=$+Math.imul(Ee,Ve)|0,E=E+Math.imul(Ae,je)|0,d=d+Math.imul(Ae,Re)|0,d=d+Math.imul(_e,je)|0,$=$+Math.imul(_e,Re)|0,E=E+Math.imul(be,We)|0,d=d+Math.imul(be,Ge)|0,d=d+Math.imul(Pe,We)|0,$=$+Math.imul(Pe,Ge)|0,E=E+Math.imul(ne,Je)|0,d=d+Math.imul(ne,Ye)|0,d=d+Math.imul(fe,Je)|0,$=$+Math.imul(fe,Ye)|0;var Pr=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(Pr>>>26)|0,Pr&=67108863,E=Math.imul(se,Me),d=Math.imul(se,Ce),d=d+Math.imul(Te,Me)|0,$=Math.imul(Te,Ce),E=E+Math.imul(pe,me)|0,d=d+Math.imul(pe,He)|0,d=d+Math.imul(ve,me)|0,$=$+Math.imul(ve,He)|0,E=E+Math.imul($e,Ke)|0,d=d+Math.imul($e,Ve)|0,d=d+Math.imul(Ie,Ke)|0,$=$+Math.imul(Ie,Ve)|0,E=E+Math.imul(ye,je)|0,d=d+Math.imul(ye,Re)|0,d=d+Math.imul(Ee,je)|0,$=$+Math.imul(Ee,Re)|0,E=E+Math.imul(Ae,We)|0,d=d+Math.imul(Ae,Ge)|0,d=d+Math.imul(_e,We)|0,$=$+Math.imul(_e,Ge)|0,E=E+Math.imul(be,Je)|0,d=d+Math.imul(be,Ye)|0,d=d+Math.imul(Pe,Je)|0,$=$+Math.imul(Pe,Ye)|0;var cs=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(cs>>>26)|0,cs&=67108863,E=Math.imul(se,me),d=Math.imul(se,He),d=d+Math.imul(Te,me)|0,$=Math.imul(Te,He),E=E+Math.imul(pe,Ke)|0,d=d+Math.imul(pe,Ve)|0,d=d+Math.imul(ve,Ke)|0,$=$+Math.imul(ve,Ve)|0,E=E+Math.imul($e,je)|0,d=d+Math.imul($e,Re)|0,d=d+Math.imul(Ie,je)|0,$=$+Math.imul(Ie,Re)|0,E=E+Math.imul(ye,We)|0,d=d+Math.imul(ye,Ge)|0,d=d+Math.imul(Ee,We)|0,$=$+Math.imul(Ee,Ge)|0,E=E+Math.imul(Ae,Je)|0,d=d+Math.imul(Ae,Ye)|0,d=d+Math.imul(_e,Je)|0,$=$+Math.imul(_e,Ye)|0;var us=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(us>>>26)|0,us&=67108863,E=Math.imul(se,Ke),d=Math.imul(se,Ve),d=d+Math.imul(Te,Ke)|0,$=Math.imul(Te,Ve),E=E+Math.imul(pe,je)|0,d=d+Math.imul(pe,Re)|0,d=d+Math.imul(ve,je)|0,$=$+Math.imul(ve,Re)|0,E=E+Math.imul($e,We)|0,d=d+Math.imul($e,Ge)|0,d=d+Math.imul(Ie,We)|0,$=$+Math.imul(Ie,Ge)|0,E=E+Math.imul(ye,Je)|0,d=d+Math.imul(ye,Ye)|0,d=d+Math.imul(Ee,Je)|0,$=$+Math.imul(Ee,Ye)|0;var jt=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(jt>>>26)|0,jt&=67108863,E=Math.imul(se,je),d=Math.imul(se,Re),d=d+Math.imul(Te,je)|0,$=Math.imul(Te,Re),E=E+Math.imul(pe,We)|0,d=d+Math.imul(pe,Ge)|0,d=d+Math.imul(ve,We)|0,$=$+Math.imul(ve,Ge)|0,E=E+Math.imul($e,Je)|0,d=d+Math.imul($e,Ye)|0,d=d+Math.imul(Ie,Je)|0,$=$+Math.imul(Ie,Ye)|0;var hs=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(hs>>>26)|0,hs&=67108863,E=Math.imul(se,We),d=Math.imul(se,Ge),d=d+Math.imul(Te,We)|0,$=Math.imul(Te,Ge),E=E+Math.imul(pe,Je)|0,d=d+Math.imul(pe,Ye)|0,d=d+Math.imul(ve,Je)|0,$=$+Math.imul(ve,Ye)|0;var fs=(P+E|0)+((d&8191)<<13)|0;P=($+(d>>>13)|0)+(fs>>>26)|0,fs&=67108863,E=Math.imul(se,Je),d=Math.imul(se,Ye),d=d+Math.imul(Te,Je)|0,$=Math.imul(Te,Ye);var ds=(P+E|0)+((d&8191)<<13)|0;return P=($+(d>>>13)|0)+(ds>>>26)|0,ds&=67108863,I[0]=Ot,I[1]=Zi,I[2]=Qi,I[3]=es,I[4]=ts,I[5]=rs,I[6]=Jt,I[7]=is,I[8]=ss,I[9]=ns,I[10]=as,I[11]=os,I[12]=Pr,I[13]=cs,I[14]=us,I[15]=jt,I[16]=hs,I[17]=fs,I[18]=ds,P!==0&&(I[19]=P,w.length++),w};Math.imul||(_=y);function O(S,f,b){b.negative=f.negative^S.negative,b.length=S.length+f.length;for(var w=0,p=0,v=0;v<b.length-1;v++){var I=p;p=0;for(var P=w&67108863,E=Math.min(v,f.length-1),d=Math.max(0,v-S.length+1);d<=E;d++){var $=v-d,j=S.words[$]|0,U=f.words[d]|0,L=j*U,z=L&67108863;I=I+(L/67108864|0)|0,z=z+P|0,P=z&67108863,I=I+(z>>>26)|0,p+=I>>>26,I&=67108863}b.words[v]=P,w=I,I=p}return w!==0?b.words[v]=w:b.length--,b.strip()}function x(S,f,b){var w=new D;return w.mulp(S,f,b)}n.prototype.mulTo=function(f,b){var w,p=this.length+f.length;return this.length===10&&f.length===10?w=_(this,f,b):p<63?w=y(this,f,b):p<1024?w=O(this,f,b):w=x(this,f,b),w};function D(S,f){this.x=S,this.y=f}D.prototype.makeRBT=function(f){for(var b=new Array(f),w=n.prototype._countBits(f)-1,p=0;p<f;p++)b[p]=this.revBin(p,w,f);return b},D.prototype.revBin=function(f,b,w){if(f===0||f===w-1)return f;for(var p=0,v=0;v<b;v++)p|=(f&1)<<b-v-1,f>>=1;return p},D.prototype.permute=function(f,b,w,p,v,I){for(var P=0;P<I;P++)p[P]=b[f[P]],v[P]=w[f[P]]},D.prototype.transform=function(f,b,w,p,v,I){this.permute(I,f,b,w,p,v);for(var P=1;P<v;P<<=1)for(var E=P<<1,d=Math.cos(2*Math.PI/E),$=Math.sin(2*Math.PI/E),j=0;j<v;j+=E)for(var U=d,L=$,z=0;z<P;z++){var G=w[j+z],X=p[j+z],Q=w[j+z+P],Y=p[j+z+P],ee=U*Q-L*Y;Y=U*Y+L*Q,Q=ee,w[j+z]=G+Q,p[j+z]=X+Y,w[j+z+P]=G-Q,p[j+z+P]=X-Y,z!==E&&(ee=d*U-$*L,L=d*L+$*U,U=ee)}},D.prototype.guessLen13b=function(f,b){var w=Math.max(b,f)|1,p=w&1,v=0;for(w=w/2|0;w;w=w>>>1)v++;return 1<<v+1+p},D.prototype.conjugate=function(f,b,w){if(!(w<=1))for(var p=0;p<w/2;p++){var v=f[p];f[p]=f[w-p-1],f[w-p-1]=v,v=b[p],b[p]=-b[w-p-1],b[w-p-1]=-v}},D.prototype.normalize13b=function(f,b){for(var w=0,p=0;p<b/2;p++){var v=Math.round(f[2*p+1]/b)*8192+Math.round(f[2*p]/b)+w;f[p]=v&67108863,v<67108864?w=0:w=v/67108864|0}return f},D.prototype.convert13b=function(f,b,w,p){for(var v=0,I=0;I<b;I++)v=v+(f[I]|0),w[2*I]=v&8191,v=v>>>13,w[2*I+1]=v&8191,v=v>>>13;for(I=2*b;I<p;++I)w[I]=0;i(v===0),i((v&-8192)===0)},D.prototype.stub=function(f){for(var b=new Array(f),w=0;w<f;w++)b[w]=0;return b},D.prototype.mulp=function(f,b,w){var p=2*this.guessLen13b(f.length,b.length),v=this.makeRBT(p),I=this.stub(p),P=new Array(p),E=new Array(p),d=new Array(p),$=new Array(p),j=new Array(p),U=new Array(p),L=w.words;L.length=p,this.convert13b(f.words,f.length,P,p),this.convert13b(b.words,b.length,$,p),this.transform(P,I,E,d,p,v),this.transform($,I,j,U,p,v);for(var z=0;z<p;z++){var G=E[z]*j[z]-d[z]*U[z];d[z]=E[z]*U[z]+d[z]*j[z],E[z]=G}return this.conjugate(E,d,p),this.transform(E,d,L,I,p,v),this.conjugate(L,I,p),this.normalize13b(L,p),w.negative=f.negative^b.negative,w.length=f.length+b.length,w.strip()},n.prototype.mul=function(f){var b=new n(null);return b.words=new Array(this.length+f.length),this.mulTo(f,b)},n.prototype.mulf=function(f){var b=new n(null);return b.words=new Array(this.length+f.length),x(this,f,b)},n.prototype.imul=function(f){return this.clone().mulTo(f,this)},n.prototype.imuln=function(f){i(typeof f=="number"),i(f<67108864);for(var b=0,w=0;w<this.length;w++){var p=(this.words[w]|0)*f,v=(p&67108863)+(b&67108863);b>>=26,b+=p/67108864|0,b+=v>>>26,this.words[w]=v&67108863}return b!==0&&(this.words[w]=b,this.length++),this},n.prototype.muln=function(f){return this.clone().imuln(f)},n.prototype.sqr=function(){return this.mul(this)},n.prototype.isqr=function(){return this.imul(this.clone())},n.prototype.pow=function(f){var b=m(f);if(b.length===0)return new n(1);for(var w=this,p=0;p<b.length&&b[p]===0;p++,w=w.sqr());if(++p<b.length)for(var v=w.sqr();p<b.length;p++,v=v.sqr())b[p]!==0&&(w=w.mul(v));return w},n.prototype.iushln=function(f){i(typeof f=="number"&&f>=0);var b=f%26,w=(f-b)/26,p=67108863>>>26-b<<26-b,v;if(b!==0){var I=0;for(v=0;v<this.length;v++){var P=this.words[v]&p,E=(this.words[v]|0)-P<<b;this.words[v]=E|I,I=P>>>26-b}I&&(this.words[v]=I,this.length++)}if(w!==0){for(v=this.length-1;v>=0;v--)this.words[v+w]=this.words[v];for(v=0;v<w;v++)this.words[v]=0;this.length+=w}return this.strip()},n.prototype.ishln=function(f){return i(this.negative===0),this.iushln(f)},n.prototype.iushrn=function(f,b,w){i(typeof f=="number"&&f>=0);var p;b?p=(b-b%26)/26:p=0;var v=f%26,I=Math.min((f-v)/26,this.length),P=67108863^67108863>>>v<<v,E=w;if(p-=I,p=Math.max(0,p),E){for(var d=0;d<I;d++)E.words[d]=this.words[d];E.length=I}if(I!==0)if(this.length>I)for(this.length-=I,d=0;d<this.length;d++)this.words[d]=this.words[d+I];else this.words[0]=0,this.length=1;var $=0;for(d=this.length-1;d>=0&&($!==0||d>=p);d--){var j=this.words[d]|0;this.words[d]=$<<26-v|j>>>v,$=j&P}return E&&$!==0&&(E.words[E.length++]=$),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},n.prototype.ishrn=function(f,b,w){return i(this.negative===0),this.iushrn(f,b,w)},n.prototype.shln=function(f){return this.clone().ishln(f)},n.prototype.ushln=function(f){return this.clone().iushln(f)},n.prototype.shrn=function(f){return this.clone().ishrn(f)},n.prototype.ushrn=function(f){return this.clone().iushrn(f)},n.prototype.testn=function(f){i(typeof f=="number"&&f>=0);var b=f%26,w=(f-b)/26,p=1<<b;if(this.length<=w)return!1;var v=this.words[w];return!!(v&p)},n.prototype.imaskn=function(f){i(typeof f=="number"&&f>=0);var b=f%26,w=(f-b)/26;if(i(this.negative===0,"imaskn works only with positive numbers"),this.length<=w)return this;if(b!==0&&w++,this.length=Math.min(w,this.length),b!==0){var p=67108863^67108863>>>b<<b;this.words[this.length-1]&=p}return this.strip()},n.prototype.maskn=function(f){return this.clone().imaskn(f)},n.prototype.iaddn=function(f){return i(typeof f=="number"),i(f<67108864),f<0?this.isubn(-f):this.negative!==0?this.length===1&&(this.words[0]|0)<f?(this.words[0]=f-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(f),this.negative=1,this):this._iaddn(f)},n.prototype._iaddn=function(f){this.words[0]+=f;for(var b=0;b<this.length&&this.words[b]>=67108864;b++)this.words[b]-=67108864,b===this.length-1?this.words[b+1]=1:this.words[b+1]++;return this.length=Math.max(this.length,b+1),this},n.prototype.isubn=function(f){if(i(typeof f=="number"),i(f<67108864),f<0)return this.iaddn(-f);if(this.negative!==0)return this.negative=0,this.iaddn(f),this.negative=1,this;if(this.words[0]-=f,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var b=0;b<this.length&&this.words[b]<0;b++)this.words[b]+=67108864,this.words[b+1]-=1;return this.strip()},n.prototype.addn=function(f){return this.clone().iaddn(f)},n.prototype.subn=function(f){return this.clone().isubn(f)},n.prototype.iabs=function(){return this.negative=0,this},n.prototype.abs=function(){return this.clone().iabs()},n.prototype._ishlnsubmul=function(f,b,w){var p=f.length+w,v;this._expand(p);var I,P=0;for(v=0;v<f.length;v++){I=(this.words[v+w]|0)+P;var E=(f.words[v]|0)*b;I-=E&67108863,P=(I>>26)-(E/67108864|0),this.words[v+w]=I&67108863}for(;v<this.length-w;v++)I=(this.words[v+w]|0)+P,P=I>>26,this.words[v+w]=I&67108863;if(P===0)return this.strip();for(i(P===-1),P=0,v=0;v<this.length;v++)I=-(this.words[v]|0)+P,P=I>>26,this.words[v]=I&67108863;return this.negative=1,this.strip()},n.prototype._wordDiv=function(f,b){var w=this.length-f.length,p=this.clone(),v=f,I=v.words[v.length-1]|0,P=this._countBits(I);w=26-P,w!==0&&(v=v.ushln(w),p.iushln(w),I=v.words[v.length-1]|0);var E=p.length-v.length,d;if(b!=="mod"){d=new n(null),d.length=E+1,d.words=new Array(d.length);for(var $=0;$<d.length;$++)d.words[$]=0}var j=p.clone()._ishlnsubmul(v,1,E);j.negative===0&&(p=j,d&&(d.words[E]=1));for(var U=E-1;U>=0;U--){var L=(p.words[v.length+U]|0)*67108864+(p.words[v.length+U-1]|0);for(L=Math.min(L/I|0,67108863),p._ishlnsubmul(v,L,U);p.negative!==0;)L--,p.negative=0,p._ishlnsubmul(v,1,U),p.isZero()||(p.negative^=1);d&&(d.words[U]=L)}return d&&d.strip(),p.strip(),b!=="div"&&w!==0&&p.iushrn(w),{div:d||null,mod:p}},n.prototype.divmod=function(f,b,w){if(i(!f.isZero()),this.isZero())return{div:new n(0),mod:new n(0)};var p,v,I;return this.negative!==0&&f.negative===0?(I=this.neg().divmod(f,b),b!=="mod"&&(p=I.div.neg()),b!=="div"&&(v=I.mod.neg(),w&&v.negative!==0&&v.iadd(f)),{div:p,mod:v}):this.negative===0&&f.negative!==0?(I=this.divmod(f.neg(),b),b!=="mod"&&(p=I.div.neg()),{div:p,mod:I.mod}):(this.negative&f.negative)!==0?(I=this.neg().divmod(f.neg(),b),b!=="div"&&(v=I.mod.neg(),w&&v.negative!==0&&v.isub(f)),{div:I.div,mod:v}):f.length>this.length||this.cmp(f)<0?{div:new n(0),mod:this}:f.length===1?b==="div"?{div:this.divn(f.words[0]),mod:null}:b==="mod"?{div:null,mod:new n(this.modn(f.words[0]))}:{div:this.divn(f.words[0]),mod:new n(this.modn(f.words[0]))}:this._wordDiv(f,b)},n.prototype.div=function(f){return this.divmod(f,"div",!1).div},n.prototype.mod=function(f){return this.divmod(f,"mod",!1).mod},n.prototype.umod=function(f){return this.divmod(f,"mod",!0).mod},n.prototype.divRound=function(f){var b=this.divmod(f);if(b.mod.isZero())return b.div;var w=b.div.negative!==0?b.mod.isub(f):b.mod,p=f.ushrn(1),v=f.andln(1),I=w.cmp(p);return I<0||v===1&&I===0?b.div:b.div.negative!==0?b.div.isubn(1):b.div.iaddn(1)},n.prototype.modn=function(f){i(f<=67108863);for(var b=(1<<26)%f,w=0,p=this.length-1;p>=0;p--)w=(b*w+(this.words[p]|0))%f;return w},n.prototype.idivn=function(f){i(f<=67108863);for(var b=0,w=this.length-1;w>=0;w--){var p=(this.words[w]|0)+b*67108864;this.words[w]=p/f|0,b=p%f}return this.strip()},n.prototype.divn=function(f){return this.clone().idivn(f)},n.prototype.egcd=function(f){i(f.negative===0),i(!f.isZero());var b=this,w=f.clone();b.negative!==0?b=b.umod(f):b=b.clone();for(var p=new n(1),v=new n(0),I=new n(0),P=new n(1),E=0;b.isEven()&&w.isEven();)b.iushrn(1),w.iushrn(1),++E;for(var d=w.clone(),$=b.clone();!b.isZero();){for(var j=0,U=1;(b.words[0]&U)===0&&j<26;++j,U<<=1);if(j>0)for(b.iushrn(j);j-- >0;)(p.isOdd()||v.isOdd())&&(p.iadd(d),v.isub($)),p.iushrn(1),v.iushrn(1);for(var L=0,z=1;(w.words[0]&z)===0&&L<26;++L,z<<=1);if(L>0)for(w.iushrn(L);L-- >0;)(I.isOdd()||P.isOdd())&&(I.iadd(d),P.isub($)),I.iushrn(1),P.iushrn(1);b.cmp(w)>=0?(b.isub(w),p.isub(I),v.isub(P)):(w.isub(b),I.isub(p),P.isub(v))}return{a:I,b:P,gcd:w.iushln(E)}},n.prototype._invmp=function(f){i(f.negative===0),i(!f.isZero());var b=this,w=f.clone();b.negative!==0?b=b.umod(f):b=b.clone();for(var p=new n(1),v=new n(0),I=w.clone();b.cmpn(1)>0&&w.cmpn(1)>0;){for(var P=0,E=1;(b.words[0]&E)===0&&P<26;++P,E<<=1);if(P>0)for(b.iushrn(P);P-- >0;)p.isOdd()&&p.iadd(I),p.iushrn(1);for(var d=0,$=1;(w.words[0]&$)===0&&d<26;++d,$<<=1);if(d>0)for(w.iushrn(d);d-- >0;)v.isOdd()&&v.iadd(I),v.iushrn(1);b.cmp(w)>=0?(b.isub(w),p.isub(v)):(w.isub(b),v.isub(p))}var j;return b.cmpn(1)===0?j=p:j=v,j.cmpn(0)<0&&j.iadd(f),j},n.prototype.gcd=function(f){if(this.isZero())return f.abs();if(f.isZero())return this.abs();var b=this.clone(),w=f.clone();b.negative=0,w.negative=0;for(var p=0;b.isEven()&&w.isEven();p++)b.iushrn(1),w.iushrn(1);do{for(;b.isEven();)b.iushrn(1);for(;w.isEven();)w.iushrn(1);var v=b.cmp(w);if(v<0){var I=b;b=w,w=I}else if(v===0||w.cmpn(1)===0)break;b.isub(w)}while(!0);return w.iushln(p)},n.prototype.invm=function(f){return this.egcd(f).a.umod(f)},n.prototype.isEven=function(){return(this.words[0]&1)===0},n.prototype.isOdd=function(){return(this.words[0]&1)===1},n.prototype.andln=function(f){return this.words[0]&f},n.prototype.bincn=function(f){i(typeof f=="number");var b=f%26,w=(f-b)/26,p=1<<b;if(this.length<=w)return this._expand(w+1),this.words[w]|=p,this;for(var v=p,I=w;v!==0&&I<this.length;I++){var P=this.words[I]|0;P+=v,v=P>>>26,P&=67108863,this.words[I]=P}return v!==0&&(this.words[I]=v,this.length++),this},n.prototype.isZero=function(){return this.length===1&&this.words[0]===0},n.prototype.cmpn=function(f){var b=f<0;if(this.negative!==0&&!b)return-1;if(this.negative===0&&b)return 1;this.strip();var w;if(this.length>1)w=1;else{b&&(f=-f),i(f<=67108863,"Number is too big");var p=this.words[0]|0;w=p===f?0:p<f?-1:1}return this.negative!==0?-w|0:w},n.prototype.cmp=function(f){if(this.negative!==0&&f.negative===0)return-1;if(this.negative===0&&f.negative!==0)return 1;var b=this.ucmp(f);return this.negative!==0?-b|0:b},n.prototype.ucmp=function(f){if(this.length>f.length)return 1;if(this.length<f.length)return-1;for(var b=0,w=this.length-1;w>=0;w--){var p=this.words[w]|0,v=f.words[w]|0;if(p!==v){p<v?b=-1:p>v&&(b=1);break}}return b},n.prototype.gtn=function(f){return this.cmpn(f)===1},n.prototype.gt=function(f){return this.cmp(f)===1},n.prototype.gten=function(f){return this.cmpn(f)>=0},n.prototype.gte=function(f){return this.cmp(f)>=0},n.prototype.ltn=function(f){return this.cmpn(f)===-1},n.prototype.lt=function(f){return this.cmp(f)===-1},n.prototype.lten=function(f){return this.cmpn(f)<=0},n.prototype.lte=function(f){return this.cmp(f)<=0},n.prototype.eqn=function(f){return this.cmpn(f)===0},n.prototype.eq=function(f){return this.cmp(f)===0},n.red=function(f){return new F(f)},n.prototype.toRed=function(f){return i(!this.red,"Already a number in reduction context"),i(this.negative===0,"red works only with positives"),f.convertTo(this)._forceRed(f)},n.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},n.prototype._forceRed=function(f){return this.red=f,this},n.prototype.forceRed=function(f){return i(!this.red,"Already a number in reduction context"),this._forceRed(f)},n.prototype.redAdd=function(f){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,f)},n.prototype.redIAdd=function(f){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,f)},n.prototype.redSub=function(f){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,f)},n.prototype.redISub=function(f){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,f)},n.prototype.redShl=function(f){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,f)},n.prototype.redMul=function(f){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,f),this.red.mul(this,f)},n.prototype.redIMul=function(f){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,f),this.red.imul(this,f)},n.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},n.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},n.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},n.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},n.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},n.prototype.redPow=function(f){return i(this.red&&!f.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,f)};var M={k256:null,p224:null,p192:null,p25519:null};function R(S,f){this.name=S,this.p=new n(f,16),this.n=this.p.bitLength(),this.k=new n(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}R.prototype._tmp=function(){var f=new n(null);return f.words=new Array(Math.ceil(this.n/13)),f},R.prototype.ireduce=function(f){var b=f,w;do this.split(b,this.tmp),b=this.imulK(b),b=b.iadd(this.tmp),w=b.bitLength();while(w>this.n);var p=w<this.n?-1:b.ucmp(this.p);return p===0?(b.words[0]=0,b.length=1):p>0?b.isub(this.p):b.strip!==void 0?b.strip():b._strip(),b},R.prototype.split=function(f,b){f.iushrn(this.n,0,b)},R.prototype.imulK=function(f){return f.imul(this.k)};function N(){R.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}s(N,R),N.prototype.split=function(f,b){for(var w=4194303,p=Math.min(f.length,9),v=0;v<p;v++)b.words[v]=f.words[v];if(b.length=p,f.length<=9){f.words[0]=0,f.length=1;return}var I=f.words[9];for(b.words[b.length++]=I&w,v=10;v<f.length;v++){var P=f.words[v]|0;f.words[v-10]=(P&w)<<4|I>>>22,I=P}I>>>=22,f.words[v-10]=I,I===0&&f.length>10?f.length-=10:f.length-=9},N.prototype.imulK=function(f){f.words[f.length]=0,f.words[f.length+1]=0,f.length+=2;for(var b=0,w=0;w<f.length;w++){var p=f.words[w]|0;b+=p*977,f.words[w]=b&67108863,b=p*64+(b/67108864|0)}return f.words[f.length-1]===0&&(f.length--,f.words[f.length-1]===0&&f.length--),f};function C(){R.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}s(C,R);function q(){R.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}s(q,R);function B(){R.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}s(B,R),B.prototype.imulK=function(f){for(var b=0,w=0;w<f.length;w++){var p=(f.words[w]|0)*19+b,v=p&67108863;p>>>=26,f.words[w]=v,b=p}return b!==0&&(f.words[f.length++]=b),f},n._prime=function(f){if(M[f])return M[f];var b;if(f==="k256")b=new N;else if(f==="p224")b=new C;else if(f==="p192")b=new q;else if(f==="p25519")b=new B;else throw new Error("Unknown prime "+f);return M[f]=b,b};function F(S){if(typeof S=="string"){var f=n._prime(S);this.m=f.p,this.prime=f}else i(S.gtn(1),"modulus must be greater than 1"),this.m=S,this.prime=null}F.prototype._verify1=function(f){i(f.negative===0,"red works only with positives"),i(f.red,"red works only with red numbers")},F.prototype._verify2=function(f,b){i((f.negative|b.negative)===0,"red works only with positives"),i(f.red&&f.red===b.red,"red works only with red numbers")},F.prototype.imod=function(f){return this.prime?this.prime.ireduce(f)._forceRed(this):f.umod(this.m)._forceRed(this)},F.prototype.neg=function(f){return f.isZero()?f.clone():this.m.sub(f)._forceRed(this)},F.prototype.add=function(f,b){this._verify2(f,b);var w=f.add(b);return w.cmp(this.m)>=0&&w.isub(this.m),w._forceRed(this)},F.prototype.iadd=function(f,b){this._verify2(f,b);var w=f.iadd(b);return w.cmp(this.m)>=0&&w.isub(this.m),w},F.prototype.sub=function(f,b){this._verify2(f,b);var w=f.sub(b);return w.cmpn(0)<0&&w.iadd(this.m),w._forceRed(this)},F.prototype.isub=function(f,b){this._verify2(f,b);var w=f.isub(b);return w.cmpn(0)<0&&w.iadd(this.m),w},F.prototype.shl=function(f,b){return this._verify1(f),this.imod(f.ushln(b))},F.prototype.imul=function(f,b){return this._verify2(f,b),this.imod(f.imul(b))},F.prototype.mul=function(f,b){return this._verify2(f,b),this.imod(f.mul(b))},F.prototype.isqr=function(f){return this.imul(f,f.clone())},F.prototype.sqr=function(f){return this.mul(f,f)},F.prototype.sqrt=function(f){if(f.isZero())return f.clone();var b=this.m.andln(3);if(i(b%2===1),b===3){var w=this.m.add(new n(1)).iushrn(2);return this.pow(f,w)}for(var p=this.m.subn(1),v=0;!p.isZero()&&p.andln(1)===0;)v++,p.iushrn(1);i(!p.isZero());var I=new n(1).toRed(this),P=I.redNeg(),E=this.m.subn(1).iushrn(1),d=this.m.bitLength();for(d=new n(2*d*d).toRed(this);this.pow(d,E).cmp(P)!==0;)d.redIAdd(P);for(var $=this.pow(d,p),j=this.pow(f,p.addn(1).iushrn(1)),U=this.pow(f,p),L=v;U.cmp(I)!==0;){for(var z=U,G=0;z.cmp(I)!==0;G++)z=z.redSqr();i(G<L);var X=this.pow($,new n(1).iushln(L-G-1));j=j.redMul(X),$=X.redSqr(),U=U.redMul($),L=G}return j},F.prototype.invm=function(f){var b=f._invmp(this.m);return b.negative!==0?(b.negative=0,this.imod(b).redNeg()):this.imod(b)},F.prototype.pow=function(f,b){if(b.isZero())return new n(1).toRed(this);if(b.cmpn(1)===0)return f.clone();var w=4,p=new Array(1<<w);p[0]=new n(1).toRed(this),p[1]=f;for(var v=2;v<p.length;v++)p[v]=this.mul(p[v-1],f);var I=p[0],P=0,E=0,d=b.bitLength()%26;for(d===0&&(d=26),v=b.length-1;v>=0;v--){for(var $=b.words[v],j=d-1;j>=0;j--){var U=$>>j&1;if(I!==p[0]&&(I=this.sqr(I)),U===0&&P===0){E=0;continue}P<<=1,P|=U,E++,!(E!==w&&(v!==0||j!==0))&&(I=this.mul(I,p[P]),E=0,P=0)}d=26}return I},F.prototype.convertTo=function(f){var b=f.umod(this.m);return b===f?b.clone():b},F.prototype.convertFrom=function(f){var b=f.clone();return b.red=null,b},n.mont=function(f){return new H(f)};function H(S){F.call(this,S),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new n(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}s(H,F),H.prototype.convertTo=function(f){return this.imod(f.ushln(this.shift))},H.prototype.convertFrom=function(f){var b=this.imod(f.mul(this.rinv));return b.red=null,b},H.prototype.imul=function(f,b){if(f.isZero()||b.isZero())return f.words[0]=0,f.length=1,f;var w=f.imul(b),p=w.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),v=w.isub(p).iushrn(this.shift),I=v;return v.cmp(this.m)>=0?I=v.isub(this.m):v.cmpn(0)<0&&(I=v.iadd(this.m)),I._forceRed(this)},H.prototype.mul=function(f,b){if(f.isZero()||b.isZero())return new n(0)._forceRed(this);var w=f.mul(b),p=w.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),v=w.isub(p).iushrn(this.shift),I=v;return v.cmp(this.m)>=0?I=v.isub(this.m):v.cmpn(0)<0&&(I=v.iadd(this.m)),I._forceRed(this)},H.prototype.invm=function(f){var b=this.imod(f._invmp(this.m).mul(this.r2));return b._forceRed(this)}})(r,rv)}(Dn)),Dn.exports}var Oa={},Pu;function Qd(){return Pu||(Pu=1,function(r){var e=r;function t(n,a){if(Array.isArray(n))return n.slice();if(!n)return[];var o=[];if(typeof n!="string"){for(var u=0;u<n.length;u++)o[u]=n[u]|0;return o}if(a==="hex"){n=n.replace(/[^a-z0-9]+/ig,""),n.length%2!==0&&(n="0"+n);for(var u=0;u<n.length;u+=2)o.push(parseInt(n[u]+n[u+1],16))}else for(var u=0;u<n.length;u++){var c=n.charCodeAt(u),h=c>>8,l=c&255;h?o.push(h,l):o.push(l)}return o}e.toArray=t;function i(n){return n.length===1?"0"+n:n}e.zero2=i;function s(n){for(var a="",o=0;o<n.length;o++)a+=i(n[o].toString(16));return a}e.toHex=s,e.encode=function(a,o){return o==="hex"?s(a):a}}(Oa)),Oa}var Au;function Vt(){return Au||(Au=1,function(r){var e=r,t=xr(),i=od(),s=Qd();e.assert=i,e.toArray=s.toArray,e.zero2=s.zero2,e.toHex=s.toHex,e.encode=s.encode;function n(h,l,g){var m=new Array(Math.max(h.bitLength(),g)+1),y;for(y=0;y<m.length;y+=1)m[y]=0;var _=1<<l+1,O=h.clone();for(y=0;y<m.length;y++){var x,D=O.andln(_-1);O.isOdd()?(D>(_>>1)-1?x=(_>>1)-D:x=D,O.isubn(x)):x=0,m[y]=x,O.iushrn(1)}return m}e.getNAF=n;function a(h,l){var g=[[],[]];h=h.clone(),l=l.clone();for(var m=0,y=0,_;h.cmpn(-m)>0||l.cmpn(-y)>0;){var O=h.andln(3)+m&3,x=l.andln(3)+y&3;O===3&&(O=-1),x===3&&(x=-1);var D;(O&1)===0?D=0:(_=h.andln(7)+m&7,(_===3||_===5)&&x===2?D=-O:D=O),g[0].push(D);var M;(x&1)===0?M=0:(_=l.andln(7)+y&7,(_===3||_===5)&&O===2?M=-x:M=x),g[1].push(M),2*m===D+1&&(m=1-m),2*y===M+1&&(y=1-y),h.iushrn(1),l.iushrn(1)}return g}e.getJSF=a;function o(h,l,g){var m="_"+l;h.prototype[l]=function(){return this[m]!==void 0?this[m]:this[m]=g.call(this)}}e.cachedProperty=o;function u(h){return typeof h=="string"?e.toArray(h,"hex"):h}e.parseBytes=u;function c(h){return new t(h,"hex","le")}e.intFromLE=c}(Aa)),Aa}var ln={exports:{}},Ou;function el(){if(Ou)return ln.exports;Ou=1;var r;ln.exports=function(s){return r||(r=new e(null)),r.generate(s)};function e(i){this.rand=i}if(ln.exports.Rand=e,e.prototype.generate=function(s){return this._rand(s)},e.prototype._rand=function(s){if(this.rand.getBytes)return this.rand.getBytes(s);for(var n=new Uint8Array(s),a=0;a<n.length;a++)n[a]=this.rand.getByte();return n},typeof self=="object")self.crypto&&self.crypto.getRandomValues?e.prototype._rand=function(s){var n=new Uint8Array(s);return self.crypto.getRandomValues(n),n}:self.msCrypto&&self.msCrypto.getRandomValues?e.prototype._rand=function(s){var n=new Uint8Array(s);return self.msCrypto.getRandomValues(n),n}:typeof window=="object"&&(e.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var t=ad;if(typeof t.randomBytes!="function")throw new Error("Not supported");e.prototype._rand=function(s){return t.randomBytes(s)}}catch{}return ln.exports}var Ma={},Ca,Mu;function Yn(){if(Mu)return Ca;Mu=1;var r=xr(),e=Vt(),t=e.getNAF,i=e.getJSF,s=e.assert;function n(o,u){this.type=o,this.p=new r(u.p,16),this.red=u.prime?r.red(u.prime):r.mont(this.p),this.zero=new r(0).toRed(this.red),this.one=new r(1).toRed(this.red),this.two=new r(2).toRed(this.red),this.n=u.n&&new r(u.n,16),this.g=u.g&&this.pointFromJSON(u.g,u.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var c=this.n&&this.p.div(this.n);!c||c.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}Ca=n,n.prototype.point=function(){throw new Error("Not implemented")},n.prototype.validate=function(){throw new Error("Not implemented")},n.prototype._fixedNafMul=function(u,c){s(u.precomputed);var h=u._getDoubles(),l=t(c,1,this._bitLength),g=(1<<h.step+1)-(h.step%2===0?2:1);g/=3;var m=[],y,_;for(y=0;y<l.length;y+=h.step){_=0;for(var O=y+h.step-1;O>=y;O--)_=(_<<1)+l[O];m.push(_)}for(var x=this.jpoint(null,null,null),D=this.jpoint(null,null,null),M=g;M>0;M--){for(y=0;y<m.length;y++)_=m[y],_===M?D=D.mixedAdd(h.points[y]):_===-M&&(D=D.mixedAdd(h.points[y].neg()));x=x.add(D)}return x.toP()},n.prototype._wnafMul=function(u,c){var h=4,l=u._getNAFPoints(h);h=l.wnd;for(var g=l.points,m=t(c,h,this._bitLength),y=this.jpoint(null,null,null),_=m.length-1;_>=0;_--){for(var O=0;_>=0&&m[_]===0;_--)O++;if(_>=0&&O++,y=y.dblp(O),_<0)break;var x=m[_];s(x!==0),u.type==="affine"?x>0?y=y.mixedAdd(g[x-1>>1]):y=y.mixedAdd(g[-x-1>>1].neg()):x>0?y=y.add(g[x-1>>1]):y=y.add(g[-x-1>>1].neg())}return u.type==="affine"?y.toP():y},n.prototype._wnafMulAdd=function(u,c,h,l,g){var m=this._wnafT1,y=this._wnafT2,_=this._wnafT3,O=0,x,D,M;for(x=0;x<l;x++){M=c[x];var R=M._getNAFPoints(u);m[x]=R.wnd,y[x]=R.points}for(x=l-1;x>=1;x-=2){var N=x-1,C=x;if(m[N]!==1||m[C]!==1){_[N]=t(h[N],m[N],this._bitLength),_[C]=t(h[C],m[C],this._bitLength),O=Math.max(_[N].length,O),O=Math.max(_[C].length,O);continue}var q=[c[N],null,null,c[C]];c[N].y.cmp(c[C].y)===0?(q[1]=c[N].add(c[C]),q[2]=c[N].toJ().mixedAdd(c[C].neg())):c[N].y.cmp(c[C].y.redNeg())===0?(q[1]=c[N].toJ().mixedAdd(c[C]),q[2]=c[N].add(c[C].neg())):(q[1]=c[N].toJ().mixedAdd(c[C]),q[2]=c[N].toJ().mixedAdd(c[C].neg()));var B=[-3,-1,-5,-7,0,7,5,1,3],F=i(h[N],h[C]);for(O=Math.max(F[0].length,O),_[N]=new Array(O),_[C]=new Array(O),D=0;D<O;D++){var H=F[0][D]|0,S=F[1][D]|0;_[N][D]=B[(H+1)*3+(S+1)],_[C][D]=0,y[N]=q}}var f=this.jpoint(null,null,null),b=this._wnafT4;for(x=O;x>=0;x--){for(var w=0;x>=0;){var p=!0;for(D=0;D<l;D++)b[D]=_[D][x]|0,b[D]!==0&&(p=!1);if(!p)break;w++,x--}if(x>=0&&w++,f=f.dblp(w),x<0)break;for(D=0;D<l;D++){var v=b[D];v!==0&&(v>0?M=y[D][v-1>>1]:v<0&&(M=y[D][-v-1>>1].neg()),M.type==="affine"?f=f.mixedAdd(M):f=f.add(M))}}for(x=0;x<l;x++)y[x]=null;return g?f:f.toP()};function a(o,u){this.curve=o,this.type=u,this.precomputed=null}return n.BasePoint=a,a.prototype.eq=function(){throw new Error("Not implemented")},a.prototype.validate=function(){return this.curve.validate(this)},n.prototype.decodePoint=function(u,c){u=e.toArray(u,c);var h=this.p.byteLength();if((u[0]===4||u[0]===6||u[0]===7)&&u.length-1===2*h){u[0]===6?s(u[u.length-1]%2===0):u[0]===7&&s(u[u.length-1]%2===1);var l=this.point(u.slice(1,1+h),u.slice(1+h,1+2*h));return l}else if((u[0]===2||u[0]===3)&&u.length-1===h)return this.pointFromX(u.slice(1,1+h),u[0]===3);throw new Error("Unknown point format")},a.prototype.encodeCompressed=function(u){return this.encode(u,!0)},a.prototype._encode=function(u){var c=this.curve.p.byteLength(),h=this.getX().toArray("be",c);return u?[this.getY().isEven()?2:3].concat(h):[4].concat(h,this.getY().toArray("be",c))},a.prototype.encode=function(u,c){return e.encode(this._encode(c),u)},a.prototype.precompute=function(u){if(this.precomputed)return this;var c={doubles:null,naf:null,beta:null};return c.naf=this._getNAFPoints(8),c.doubles=this._getDoubles(4,u),c.beta=this._getBeta(),this.precomputed=c,this},a.prototype._hasDoubles=function(u){if(!this.precomputed)return!1;var c=this.precomputed.doubles;return c?c.points.length>=Math.ceil((u.bitLength()+1)/c.step):!1},a.prototype._getDoubles=function(u,c){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var h=[this],l=this,g=0;g<c;g+=u){for(var m=0;m<u;m++)l=l.dbl();h.push(l)}return{step:u,points:h}},a.prototype._getNAFPoints=function(u){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var c=[this],h=(1<<u)-1,l=h===1?null:this.dbl(),g=1;g<h;g++)c[g]=c[g-1].add(l);return{wnd:u,points:c}},a.prototype._getBeta=function(){return null},a.prototype.dblp=function(u){for(var c=this,h=0;h<u;h++)c=c.dbl();return c},Ca}var Ra,Cu;function iv(){if(Cu)return Ra;Cu=1;var r=Vt(),e=xr(),t=rc(),i=Yn(),s=r.assert;function n(u){i.call(this,"short",u),this.a=new e(u.a,16).toRed(this.red),this.b=new e(u.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(u),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}t(n,i),Ra=n,n.prototype._getEndomorphism=function(c){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var h,l;if(c.beta)h=new e(c.beta,16).toRed(this.red);else{var g=this._getEndoRoots(this.p);h=g[0].cmp(g[1])<0?g[0]:g[1],h=h.toRed(this.red)}if(c.lambda)l=new e(c.lambda,16);else{var m=this._getEndoRoots(this.n);this.g.mul(m[0]).x.cmp(this.g.x.redMul(h))===0?l=m[0]:(l=m[1],s(this.g.mul(l).x.cmp(this.g.x.redMul(h))===0))}var y;return c.basis?y=c.basis.map(function(_){return{a:new e(_.a,16),b:new e(_.b,16)}}):y=this._getEndoBasis(l),{beta:h,lambda:l,basis:y}}},n.prototype._getEndoRoots=function(c){var h=c===this.p?this.red:e.mont(c),l=new e(2).toRed(h).redInvm(),g=l.redNeg(),m=new e(3).toRed(h).redNeg().redSqrt().redMul(l),y=g.redAdd(m).fromRed(),_=g.redSub(m).fromRed();return[y,_]},n.prototype._getEndoBasis=function(c){for(var h=this.n.ushrn(Math.floor(this.n.bitLength()/2)),l=c,g=this.n.clone(),m=new e(1),y=new e(0),_=new e(0),O=new e(1),x,D,M,R,N,C,q,B=0,F,H;l.cmpn(0)!==0;){var S=g.div(l);F=g.sub(S.mul(l)),H=_.sub(S.mul(m));var f=O.sub(S.mul(y));if(!M&&F.cmp(h)<0)x=q.neg(),D=m,M=F.neg(),R=H;else if(M&&++B===2)break;q=F,g=l,l=F,_=m,m=H,O=y,y=f}N=F.neg(),C=H;var b=M.sqr().add(R.sqr()),w=N.sqr().add(C.sqr());return w.cmp(b)>=0&&(N=x,C=D),M.negative&&(M=M.neg(),R=R.neg()),N.negative&&(N=N.neg(),C=C.neg()),[{a:M,b:R},{a:N,b:C}]},n.prototype._endoSplit=function(c){var h=this.endo.basis,l=h[0],g=h[1],m=g.b.mul(c).divRound(this.n),y=l.b.neg().mul(c).divRound(this.n),_=m.mul(l.a),O=y.mul(g.a),x=m.mul(l.b),D=y.mul(g.b),M=c.sub(_).sub(O),R=x.add(D).neg();return{k1:M,k2:R}},n.prototype.pointFromX=function(c,h){c=new e(c,16),c.red||(c=c.toRed(this.red));var l=c.redSqr().redMul(c).redIAdd(c.redMul(this.a)).redIAdd(this.b),g=l.redSqrt();if(g.redSqr().redSub(l).cmp(this.zero)!==0)throw new Error("invalid point");var m=g.fromRed().isOdd();return(h&&!m||!h&&m)&&(g=g.redNeg()),this.point(c,g)},n.prototype.validate=function(c){if(c.inf)return!0;var h=c.x,l=c.y,g=this.a.redMul(h),m=h.redSqr().redMul(h).redIAdd(g).redIAdd(this.b);return l.redSqr().redISub(m).cmpn(0)===0},n.prototype._endoWnafMulAdd=function(c,h,l){for(var g=this._endoWnafT1,m=this._endoWnafT2,y=0;y<c.length;y++){var _=this._endoSplit(h[y]),O=c[y],x=O._getBeta();_.k1.negative&&(_.k1.ineg(),O=O.neg(!0)),_.k2.negative&&(_.k2.ineg(),x=x.neg(!0)),g[y*2]=O,g[y*2+1]=x,m[y*2]=_.k1,m[y*2+1]=_.k2}for(var D=this._wnafMulAdd(1,g,m,y*2,l),M=0;M<y*2;M++)g[M]=null,m[M]=null;return D};function a(u,c,h,l){i.BasePoint.call(this,u,"affine"),c===null&&h===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new e(c,16),this.y=new e(h,16),l&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}t(a,i.BasePoint),n.prototype.point=function(c,h,l){return new a(this,c,h,l)},n.prototype.pointFromJSON=function(c,h){return a.fromJSON(this,c,h)},a.prototype._getBeta=function(){if(this.curve.endo){var c=this.precomputed;if(c&&c.beta)return c.beta;var h=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(c){var l=this.curve,g=function(m){return l.point(m.x.redMul(l.endo.beta),m.y)};c.beta=h,h.precomputed={beta:null,naf:c.naf&&{wnd:c.naf.wnd,points:c.naf.points.map(g)},doubles:c.doubles&&{step:c.doubles.step,points:c.doubles.points.map(g)}}}return h}},a.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},a.fromJSON=function(c,h,l){typeof h=="string"&&(h=JSON.parse(h));var g=c.point(h[0],h[1],l);if(!h[2])return g;function m(_){return c.point(_[0],_[1],l)}var y=h[2];return g.precomputed={beta:null,doubles:y.doubles&&{step:y.doubles.step,points:[g].concat(y.doubles.points.map(m))},naf:y.naf&&{wnd:y.naf.wnd,points:[g].concat(y.naf.points.map(m))}},g},a.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},a.prototype.isInfinity=function(){return this.inf},a.prototype.add=function(c){if(this.inf)return c;if(c.inf)return this;if(this.eq(c))return this.dbl();if(this.neg().eq(c))return this.curve.point(null,null);if(this.x.cmp(c.x)===0)return this.curve.point(null,null);var h=this.y.redSub(c.y);h.cmpn(0)!==0&&(h=h.redMul(this.x.redSub(c.x).redInvm()));var l=h.redSqr().redISub(this.x).redISub(c.x),g=h.redMul(this.x.redSub(l)).redISub(this.y);return this.curve.point(l,g)},a.prototype.dbl=function(){if(this.inf)return this;var c=this.y.redAdd(this.y);if(c.cmpn(0)===0)return this.curve.point(null,null);var h=this.curve.a,l=this.x.redSqr(),g=c.redInvm(),m=l.redAdd(l).redIAdd(l).redIAdd(h).redMul(g),y=m.redSqr().redISub(this.x.redAdd(this.x)),_=m.redMul(this.x.redSub(y)).redISub(this.y);return this.curve.point(y,_)},a.prototype.getX=function(){return this.x.fromRed()},a.prototype.getY=function(){return this.y.fromRed()},a.prototype.mul=function(c){return c=new e(c,16),this.isInfinity()?this:this._hasDoubles(c)?this.curve._fixedNafMul(this,c):this.curve.endo?this.curve._endoWnafMulAdd([this],[c]):this.curve._wnafMul(this,c)},a.prototype.mulAdd=function(c,h,l){var g=[this,h],m=[c,l];return this.curve.endo?this.curve._endoWnafMulAdd(g,m):this.curve._wnafMulAdd(1,g,m,2)},a.prototype.jmulAdd=function(c,h,l){var g=[this,h],m=[c,l];return this.curve.endo?this.curve._endoWnafMulAdd(g,m,!0):this.curve._wnafMulAdd(1,g,m,2,!0)},a.prototype.eq=function(c){return this===c||this.inf===c.inf&&(this.inf||this.x.cmp(c.x)===0&&this.y.cmp(c.y)===0)},a.prototype.neg=function(c){if(this.inf)return this;var h=this.curve.point(this.x,this.y.redNeg());if(c&&this.precomputed){var l=this.precomputed,g=function(m){return m.neg()};h.precomputed={naf:l.naf&&{wnd:l.naf.wnd,points:l.naf.points.map(g)},doubles:l.doubles&&{step:l.doubles.step,points:l.doubles.points.map(g)}}}return h},a.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var c=this.curve.jpoint(this.x,this.y,this.curve.one);return c};function o(u,c,h,l){i.BasePoint.call(this,u,"jacobian"),c===null&&h===null&&l===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new e(0)):(this.x=new e(c,16),this.y=new e(h,16),this.z=new e(l,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}return t(o,i.BasePoint),n.prototype.jpoint=function(c,h,l){return new o(this,c,h,l)},o.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var c=this.z.redInvm(),h=c.redSqr(),l=this.x.redMul(h),g=this.y.redMul(h).redMul(c);return this.curve.point(l,g)},o.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},o.prototype.add=function(c){if(this.isInfinity())return c;if(c.isInfinity())return this;var h=c.z.redSqr(),l=this.z.redSqr(),g=this.x.redMul(h),m=c.x.redMul(l),y=this.y.redMul(h.redMul(c.z)),_=c.y.redMul(l.redMul(this.z)),O=g.redSub(m),x=y.redSub(_);if(O.cmpn(0)===0)return x.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var D=O.redSqr(),M=D.redMul(O),R=g.redMul(D),N=x.redSqr().redIAdd(M).redISub(R).redISub(R),C=x.redMul(R.redISub(N)).redISub(y.redMul(M)),q=this.z.redMul(c.z).redMul(O);return this.curve.jpoint(N,C,q)},o.prototype.mixedAdd=function(c){if(this.isInfinity())return c.toJ();if(c.isInfinity())return this;var h=this.z.redSqr(),l=this.x,g=c.x.redMul(h),m=this.y,y=c.y.redMul(h).redMul(this.z),_=l.redSub(g),O=m.redSub(y);if(_.cmpn(0)===0)return O.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var x=_.redSqr(),D=x.redMul(_),M=l.redMul(x),R=O.redSqr().redIAdd(D).redISub(M).redISub(M),N=O.redMul(M.redISub(R)).redISub(m.redMul(D)),C=this.z.redMul(_);return this.curve.jpoint(R,N,C)},o.prototype.dblp=function(c){if(c===0)return this;if(this.isInfinity())return this;if(!c)return this.dbl();var h;if(this.curve.zeroA||this.curve.threeA){var l=this;for(h=0;h<c;h++)l=l.dbl();return l}var g=this.curve.a,m=this.curve.tinv,y=this.x,_=this.y,O=this.z,x=O.redSqr().redSqr(),D=_.redAdd(_);for(h=0;h<c;h++){var M=y.redSqr(),R=D.redSqr(),N=R.redSqr(),C=M.redAdd(M).redIAdd(M).redIAdd(g.redMul(x)),q=y.redMul(R),B=C.redSqr().redISub(q.redAdd(q)),F=q.redISub(B),H=C.redMul(F);H=H.redIAdd(H).redISub(N);var S=D.redMul(O);h+1<c&&(x=x.redMul(N)),y=B,O=S,D=H}return this.curve.jpoint(y,D.redMul(m),O)},o.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},o.prototype._zeroDbl=function(){var c,h,l;if(this.zOne){var g=this.x.redSqr(),m=this.y.redSqr(),y=m.redSqr(),_=this.x.redAdd(m).redSqr().redISub(g).redISub(y);_=_.redIAdd(_);var O=g.redAdd(g).redIAdd(g),x=O.redSqr().redISub(_).redISub(_),D=y.redIAdd(y);D=D.redIAdd(D),D=D.redIAdd(D),c=x,h=O.redMul(_.redISub(x)).redISub(D),l=this.y.redAdd(this.y)}else{var M=this.x.redSqr(),R=this.y.redSqr(),N=R.redSqr(),C=this.x.redAdd(R).redSqr().redISub(M).redISub(N);C=C.redIAdd(C);var q=M.redAdd(M).redIAdd(M),B=q.redSqr(),F=N.redIAdd(N);F=F.redIAdd(F),F=F.redIAdd(F),c=B.redISub(C).redISub(C),h=q.redMul(C.redISub(c)).redISub(F),l=this.y.redMul(this.z),l=l.redIAdd(l)}return this.curve.jpoint(c,h,l)},o.prototype._threeDbl=function(){var c,h,l;if(this.zOne){var g=this.x.redSqr(),m=this.y.redSqr(),y=m.redSqr(),_=this.x.redAdd(m).redSqr().redISub(g).redISub(y);_=_.redIAdd(_);var O=g.redAdd(g).redIAdd(g).redIAdd(this.curve.a),x=O.redSqr().redISub(_).redISub(_);c=x;var D=y.redIAdd(y);D=D.redIAdd(D),D=D.redIAdd(D),h=O.redMul(_.redISub(x)).redISub(D),l=this.y.redAdd(this.y)}else{var M=this.z.redSqr(),R=this.y.redSqr(),N=this.x.redMul(R),C=this.x.redSub(M).redMul(this.x.redAdd(M));C=C.redAdd(C).redIAdd(C);var q=N.redIAdd(N);q=q.redIAdd(q);var B=q.redAdd(q);c=C.redSqr().redISub(B),l=this.y.redAdd(this.z).redSqr().redISub(R).redISub(M);var F=R.redSqr();F=F.redIAdd(F),F=F.redIAdd(F),F=F.redIAdd(F),h=C.redMul(q.redISub(c)).redISub(F)}return this.curve.jpoint(c,h,l)},o.prototype._dbl=function(){var c=this.curve.a,h=this.x,l=this.y,g=this.z,m=g.redSqr().redSqr(),y=h.redSqr(),_=l.redSqr(),O=y.redAdd(y).redIAdd(y).redIAdd(c.redMul(m)),x=h.redAdd(h);x=x.redIAdd(x);var D=x.redMul(_),M=O.redSqr().redISub(D.redAdd(D)),R=D.redISub(M),N=_.redSqr();N=N.redIAdd(N),N=N.redIAdd(N),N=N.redIAdd(N);var C=O.redMul(R).redISub(N),q=l.redAdd(l).redMul(g);return this.curve.jpoint(M,C,q)},o.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var c=this.x.redSqr(),h=this.y.redSqr(),l=this.z.redSqr(),g=h.redSqr(),m=c.redAdd(c).redIAdd(c),y=m.redSqr(),_=this.x.redAdd(h).redSqr().redISub(c).redISub(g);_=_.redIAdd(_),_=_.redAdd(_).redIAdd(_),_=_.redISub(y);var O=_.redSqr(),x=g.redIAdd(g);x=x.redIAdd(x),x=x.redIAdd(x),x=x.redIAdd(x);var D=m.redIAdd(_).redSqr().redISub(y).redISub(O).redISub(x),M=h.redMul(D);M=M.redIAdd(M),M=M.redIAdd(M);var R=this.x.redMul(O).redISub(M);R=R.redIAdd(R),R=R.redIAdd(R);var N=this.y.redMul(D.redMul(x.redISub(D)).redISub(_.redMul(O)));N=N.redIAdd(N),N=N.redIAdd(N),N=N.redIAdd(N);var C=this.z.redAdd(_).redSqr().redISub(l).redISub(O);return this.curve.jpoint(R,N,C)},o.prototype.mul=function(c,h){return c=new e(c,h),this.curve._wnafMul(this,c)},o.prototype.eq=function(c){if(c.type==="affine")return this.eq(c.toJ());if(this===c)return!0;var h=this.z.redSqr(),l=c.z.redSqr();if(this.x.redMul(l).redISub(c.x.redMul(h)).cmpn(0)!==0)return!1;var g=h.redMul(this.z),m=l.redMul(c.z);return this.y.redMul(m).redISub(c.y.redMul(g)).cmpn(0)===0},o.prototype.eqXToP=function(c){var h=this.z.redSqr(),l=c.toRed(this.curve.red).redMul(h);if(this.x.cmp(l)===0)return!0;for(var g=c.clone(),m=this.curve.redN.redMul(h);;){if(g.iadd(this.curve.n),g.cmp(this.curve.p)>=0)return!1;if(l.redIAdd(m),this.x.cmp(l)===0)return!0}},o.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},o.prototype.isInfinity=function(){return this.z.cmpn(0)===0},Ra}var Ta,Ru;function sv(){if(Ru)return Ta;Ru=1;var r=xr(),e=rc(),t=Yn(),i=Vt();function s(a){t.call(this,"mont",a),this.a=new r(a.a,16).toRed(this.red),this.b=new r(a.b,16).toRed(this.red),this.i4=new r(4).toRed(this.red).redInvm(),this.two=new r(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}e(s,t),Ta=s,s.prototype.validate=function(o){var u=o.normalize().x,c=u.redSqr(),h=c.redMul(u).redAdd(c.redMul(this.a)).redAdd(u),l=h.redSqrt();return l.redSqr().cmp(h)===0};function n(a,o,u){t.BasePoint.call(this,a,"projective"),o===null&&u===null?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new r(o,16),this.z=new r(u,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}return e(n,t.BasePoint),s.prototype.decodePoint=function(o,u){return this.point(i.toArray(o,u),1)},s.prototype.point=function(o,u){return new n(this,o,u)},s.prototype.pointFromJSON=function(o){return n.fromJSON(this,o)},n.prototype.precompute=function(){},n.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},n.fromJSON=function(o,u){return new n(o,u[0],u[1]||o.one)},n.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},n.prototype.isInfinity=function(){return this.z.cmpn(0)===0},n.prototype.dbl=function(){var o=this.x.redAdd(this.z),u=o.redSqr(),c=this.x.redSub(this.z),h=c.redSqr(),l=u.redSub(h),g=u.redMul(h),m=l.redMul(h.redAdd(this.curve.a24.redMul(l)));return this.curve.point(g,m)},n.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},n.prototype.diffAdd=function(o,u){var c=this.x.redAdd(this.z),h=this.x.redSub(this.z),l=o.x.redAdd(o.z),g=o.x.redSub(o.z),m=g.redMul(c),y=l.redMul(h),_=u.z.redMul(m.redAdd(y).redSqr()),O=u.x.redMul(m.redISub(y).redSqr());return this.curve.point(_,O)},n.prototype.mul=function(o){for(var u=o.clone(),c=this,h=this.curve.point(null,null),l=this,g=[];u.cmpn(0)!==0;u.iushrn(1))g.push(u.andln(1));for(var m=g.length-1;m>=0;m--)g[m]===0?(c=c.diffAdd(h,l),h=h.dbl()):(h=c.diffAdd(h,l),c=c.dbl());return h},n.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},n.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},n.prototype.eq=function(o){return this.getX().cmp(o.getX())===0},n.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},n.prototype.getX=function(){return this.normalize(),this.x.fromRed()},Ta}var Na,Tu;function nv(){if(Tu)return Na;Tu=1;var r=Vt(),e=xr(),t=rc(),i=Yn(),s=r.assert;function n(o){this.twisted=(o.a|0)!==1,this.mOneA=this.twisted&&(o.a|0)===-1,this.extended=this.mOneA,i.call(this,"edwards",o),this.a=new e(o.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new e(o.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new e(o.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),s(!this.twisted||this.c.fromRed().cmpn(1)===0),this.oneC=(o.c|0)===1}t(n,i),Na=n,n.prototype._mulA=function(u){return this.mOneA?u.redNeg():this.a.redMul(u)},n.prototype._mulC=function(u){return this.oneC?u:this.c.redMul(u)},n.prototype.jpoint=function(u,c,h,l){return this.point(u,c,h,l)},n.prototype.pointFromX=function(u,c){u=new e(u,16),u.red||(u=u.toRed(this.red));var h=u.redSqr(),l=this.c2.redSub(this.a.redMul(h)),g=this.one.redSub(this.c2.redMul(this.d).redMul(h)),m=l.redMul(g.redInvm()),y=m.redSqrt();if(y.redSqr().redSub(m).cmp(this.zero)!==0)throw new Error("invalid point");var _=y.fromRed().isOdd();return(c&&!_||!c&&_)&&(y=y.redNeg()),this.point(u,y)},n.prototype.pointFromY=function(u,c){u=new e(u,16),u.red||(u=u.toRed(this.red));var h=u.redSqr(),l=h.redSub(this.c2),g=h.redMul(this.d).redMul(this.c2).redSub(this.a),m=l.redMul(g.redInvm());if(m.cmp(this.zero)===0){if(c)throw new Error("invalid point");return this.point(this.zero,u)}var y=m.redSqrt();if(y.redSqr().redSub(m).cmp(this.zero)!==0)throw new Error("invalid point");return y.fromRed().isOdd()!==c&&(y=y.redNeg()),this.point(y,u)},n.prototype.validate=function(u){if(u.isInfinity())return!0;u.normalize();var c=u.x.redSqr(),h=u.y.redSqr(),l=c.redMul(this.a).redAdd(h),g=this.c2.redMul(this.one.redAdd(this.d.redMul(c).redMul(h)));return l.cmp(g)===0};function a(o,u,c,h,l){i.BasePoint.call(this,o,"projective"),u===null&&c===null&&h===null?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new e(u,16),this.y=new e(c,16),this.z=h?new e(h,16):this.curve.one,this.t=l&&new e(l,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}return t(a,i.BasePoint),n.prototype.pointFromJSON=function(u){return a.fromJSON(this,u)},n.prototype.point=function(u,c,h,l){return new a(this,u,c,h,l)},a.fromJSON=function(u,c){return new a(u,c[0],c[1],c[2])},a.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},a.prototype.isInfinity=function(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0)},a.prototype._extDbl=function(){var u=this.x.redSqr(),c=this.y.redSqr(),h=this.z.redSqr();h=h.redIAdd(h);var l=this.curve._mulA(u),g=this.x.redAdd(this.y).redSqr().redISub(u).redISub(c),m=l.redAdd(c),y=m.redSub(h),_=l.redSub(c),O=g.redMul(y),x=m.redMul(_),D=g.redMul(_),M=y.redMul(m);return this.curve.point(O,x,M,D)},a.prototype._projDbl=function(){var u=this.x.redAdd(this.y).redSqr(),c=this.x.redSqr(),h=this.y.redSqr(),l,g,m,y,_,O;if(this.curve.twisted){y=this.curve._mulA(c);var x=y.redAdd(h);this.zOne?(l=u.redSub(c).redSub(h).redMul(x.redSub(this.curve.two)),g=x.redMul(y.redSub(h)),m=x.redSqr().redSub(x).redSub(x)):(_=this.z.redSqr(),O=x.redSub(_).redISub(_),l=u.redSub(c).redISub(h).redMul(O),g=x.redMul(y.redSub(h)),m=x.redMul(O))}else y=c.redAdd(h),_=this.curve._mulC(this.z).redSqr(),O=y.redSub(_).redSub(_),l=this.curve._mulC(u.redISub(y)).redMul(O),g=this.curve._mulC(y).redMul(c.redISub(h)),m=y.redMul(O);return this.curve.point(l,g,m)},a.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},a.prototype._extAdd=function(u){var c=this.y.redSub(this.x).redMul(u.y.redSub(u.x)),h=this.y.redAdd(this.x).redMul(u.y.redAdd(u.x)),l=this.t.redMul(this.curve.dd).redMul(u.t),g=this.z.redMul(u.z.redAdd(u.z)),m=h.redSub(c),y=g.redSub(l),_=g.redAdd(l),O=h.redAdd(c),x=m.redMul(y),D=_.redMul(O),M=m.redMul(O),R=y.redMul(_);return this.curve.point(x,D,R,M)},a.prototype._projAdd=function(u){var c=this.z.redMul(u.z),h=c.redSqr(),l=this.x.redMul(u.x),g=this.y.redMul(u.y),m=this.curve.d.redMul(l).redMul(g),y=h.redSub(m),_=h.redAdd(m),O=this.x.redAdd(this.y).redMul(u.x.redAdd(u.y)).redISub(l).redISub(g),x=c.redMul(y).redMul(O),D,M;return this.curve.twisted?(D=c.redMul(_).redMul(g.redSub(this.curve._mulA(l))),M=y.redMul(_)):(D=c.redMul(_).redMul(g.redSub(l)),M=this.curve._mulC(y).redMul(_)),this.curve.point(x,D,M)},a.prototype.add=function(u){return this.isInfinity()?u:u.isInfinity()?this:this.curve.extended?this._extAdd(u):this._projAdd(u)},a.prototype.mul=function(u){return this._hasDoubles(u)?this.curve._fixedNafMul(this,u):this.curve._wnafMul(this,u)},a.prototype.mulAdd=function(u,c,h){return this.curve._wnafMulAdd(1,[this,c],[u,h],2,!1)},a.prototype.jmulAdd=function(u,c,h){return this.curve._wnafMulAdd(1,[this,c],[u,h],2,!0)},a.prototype.normalize=function(){if(this.zOne)return this;var u=this.z.redInvm();return this.x=this.x.redMul(u),this.y=this.y.redMul(u),this.t&&(this.t=this.t.redMul(u)),this.z=this.curve.one,this.zOne=!0,this},a.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},a.prototype.getX=function(){return this.normalize(),this.x.fromRed()},a.prototype.getY=function(){return this.normalize(),this.y.fromRed()},a.prototype.eq=function(u){return this===u||this.getX().cmp(u.getX())===0&&this.getY().cmp(u.getY())===0},a.prototype.eqXToP=function(u){var c=u.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(c)===0)return!0;for(var h=u.clone(),l=this.curve.redN.redMul(this.z);;){if(h.iadd(this.curve.n),h.cmp(this.curve.p)>=0)return!1;if(c.redIAdd(l),this.x.cmp(c)===0)return!0}},a.prototype.toP=a.prototype.normalize,a.prototype.mixedAdd=a.prototype.add,Na}var Nu;function tl(){return Nu||(Nu=1,function(r){var e=r;e.base=Yn(),e.short=iv(),e.mont=sv(),e.edwards=nv()}(Ma)),Ma}var Fa={},qa,Fu;function av(){return Fu||(Fu=1,qa={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}),qa}var qu;function dc(){return qu||(qu=1,function(r){var e=r,t=ic(),i=tl(),s=Vt(),n=s.assert;function a(c){c.type==="short"?this.curve=new i.short(c):c.type==="edwards"?this.curve=new i.edwards(c):this.curve=new i.mont(c),this.g=this.curve.g,this.n=this.curve.n,this.hash=c.hash,n(this.g.validate(),"Invalid curve"),n(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}e.PresetCurve=a;function o(c,h){Object.defineProperty(e,c,{configurable:!0,enumerable:!0,get:function(){var l=new a(h);return Object.defineProperty(e,c,{configurable:!0,enumerable:!0,value:l}),l}})}o("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:t.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),o("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:t.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),o("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:t.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),o("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:t.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),o("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:t.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),o("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:t.sha256,gRed:!1,g:["9"]}),o("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:t.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var u;try{u=av()}catch{u=void 0}o("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:t.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",u]})}(Fa)),Fa}var Ba,Bu;function ov(){if(Bu)return Ba;Bu=1;var r=ic(),e=Qd(),t=od();function i(s){if(!(this instanceof i))return new i(s);this.hash=s.hash,this.predResist=!!s.predResist,this.outLen=this.hash.outSize,this.minEntropy=s.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var n=e.toArray(s.entropy,s.entropyEnc||"hex"),a=e.toArray(s.nonce,s.nonceEnc||"hex"),o=e.toArray(s.pers,s.persEnc||"hex");t(n.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(n,a,o)}return Ba=i,i.prototype._init=function(n,a,o){var u=n.concat(a).concat(o);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var c=0;c<this.V.length;c++)this.K[c]=0,this.V[c]=1;this._update(u),this._reseed=1,this.reseedInterval=281474976710656},i.prototype._hmac=function(){return new r.hmac(this.hash,this.K)},i.prototype._update=function(n){var a=this._hmac().update(this.V).update([0]);n&&(a=a.update(n)),this.K=a.digest(),this.V=this._hmac().update(this.V).digest(),n&&(this.K=this._hmac().update(this.V).update([1]).update(n).digest(),this.V=this._hmac().update(this.V).digest())},i.prototype.reseed=function(n,a,o,u){typeof a!="string"&&(u=o,o=a,a=null),n=e.toArray(n,a),o=e.toArray(o,u),t(n.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(n.concat(o||[])),this._reseed=1},i.prototype.generate=function(n,a,o,u){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof a!="string"&&(u=o,o=a,a=null),o&&(o=e.toArray(o,u||"hex"),this._update(o));for(var c=[];c.length<n;)this.V=this._hmac().update(this.V).digest(),c=c.concat(this.V);var h=c.slice(0,n);return this._update(o),this._reseed++,e.encode(h,a)},Ba}var ja,ju;function cv(){if(ju)return ja;ju=1;var r=xr(),e=Vt(),t=e.assert;function i(s,n){this.ec=s,this.priv=null,this.pub=null,n.priv&&this._importPrivate(n.priv,n.privEnc),n.pub&&this._importPublic(n.pub,n.pubEnc)}return ja=i,i.fromPublic=function(n,a,o){return a instanceof i?a:new i(n,{pub:a,pubEnc:o})},i.fromPrivate=function(n,a,o){return a instanceof i?a:new i(n,{priv:a,privEnc:o})},i.prototype.validate=function(){var n=this.getPublic();return n.isInfinity()?{result:!1,reason:"Invalid public key"}:n.validate()?n.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},i.prototype.getPublic=function(n,a){return typeof n=="string"&&(a=n,n=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),a?this.pub.encode(a,n):this.pub},i.prototype.getPrivate=function(n){return n==="hex"?this.priv.toString(16,2):this.priv},i.prototype._importPrivate=function(n,a){this.priv=new r(n,a||16),this.priv=this.priv.umod(this.ec.curve.n)},i.prototype._importPublic=function(n,a){if(n.x||n.y){this.ec.curve.type==="mont"?t(n.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&t(n.x&&n.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(n.x,n.y);return}this.pub=this.ec.curve.decodePoint(n,a)},i.prototype.derive=function(n){return n.validate()||t(n.validate(),"public point not validated"),n.mul(this.priv).getX()},i.prototype.sign=function(n,a,o){return this.ec.sign(n,this,a,o)},i.prototype.verify=function(n,a,o){return this.ec.verify(n,a,this,void 0,o)},i.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"},ja}var La,Lu;function uv(){if(Lu)return La;Lu=1;var r=xr(),e=Vt(),t=e.assert;function i(u,c){if(u instanceof i)return u;this._importDER(u,c)||(t(u.r&&u.s,"Signature without r or s"),this.r=new r(u.r,16),this.s=new r(u.s,16),u.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=u.recoveryParam)}La=i;function s(){this.place=0}function n(u,c){var h=u[c.place++];if(!(h&128))return h;var l=h&15;if(l===0||l>4||u[c.place]===0)return!1;for(var g=0,m=0,y=c.place;m<l;m++,y++)g<<=8,g|=u[y],g>>>=0;return g<=127?!1:(c.place=y,g)}function a(u){for(var c=0,h=u.length-1;!u[c]&&!(u[c+1]&128)&&c<h;)c++;return c===0?u:u.slice(c)}i.prototype._importDER=function(c,h){c=e.toArray(c,h);var l=new s;if(c[l.place++]!==48)return!1;var g=n(c,l);if(g===!1||g+l.place!==c.length||c[l.place++]!==2)return!1;var m=n(c,l);if(m===!1||(c[l.place]&128)!==0)return!1;var y=c.slice(l.place,m+l.place);if(l.place+=m,c[l.place++]!==2)return!1;var _=n(c,l);if(_===!1||c.length!==_+l.place||(c[l.place]&128)!==0)return!1;var O=c.slice(l.place,_+l.place);if(y[0]===0)if(y[1]&128)y=y.slice(1);else return!1;if(O[0]===0)if(O[1]&128)O=O.slice(1);else return!1;return this.r=new r(y),this.s=new r(O),this.recoveryParam=null,!0};function o(u,c){if(c<128){u.push(c);return}var h=1+(Math.log(c)/Math.LN2>>>3);for(u.push(h|128);--h;)u.push(c>>>(h<<3)&255);u.push(c)}return i.prototype.toDER=function(c){var h=this.r.toArray(),l=this.s.toArray();for(h[0]&128&&(h=[0].concat(h)),l[0]&128&&(l=[0].concat(l)),h=a(h),l=a(l);!l[0]&&!(l[1]&128);)l=l.slice(1);var g=[2];o(g,h.length),g=g.concat(h),g.push(2),o(g,l.length);var m=g.concat(l),y=[48];return o(y,m.length),y=y.concat(m),e.encode(y,c)},La}var Ua,Uu;function hv(){if(Uu)return Ua;Uu=1;var r=xr(),e=ov(),t=Vt(),i=dc(),s=el(),n=t.assert,a=cv(),o=uv();function u(c){if(!(this instanceof u))return new u(c);typeof c=="string"&&(n(Object.prototype.hasOwnProperty.call(i,c),"Unknown curve "+c),c=i[c]),c instanceof i.PresetCurve&&(c={curve:c}),this.curve=c.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=c.curve.g,this.g.precompute(c.curve.n.bitLength()+1),this.hash=c.hash||c.curve.hash}return Ua=u,u.prototype.keyPair=function(h){return new a(this,h)},u.prototype.keyFromPrivate=function(h,l){return a.fromPrivate(this,h,l)},u.prototype.keyFromPublic=function(h,l){return a.fromPublic(this,h,l)},u.prototype.genKeyPair=function(h){h||(h={});for(var l=new e({hash:this.hash,pers:h.pers,persEnc:h.persEnc||"utf8",entropy:h.entropy||s(this.hash.hmacStrength),entropyEnc:h.entropy&&h.entropyEnc||"utf8",nonce:this.n.toArray()}),g=this.n.byteLength(),m=this.n.sub(new r(2));;){var y=new r(l.generate(g));if(!(y.cmp(m)>0))return y.iaddn(1),this.keyFromPrivate(y)}},u.prototype._truncateToN=function(h,l,g){var m;if(r.isBN(h)||typeof h=="number")h=new r(h,16),m=h.byteLength();else if(typeof h=="object")m=h.length,h=new r(h,16);else{var y=h.toString();m=y.length+1>>>1,h=new r(y,16)}typeof g!="number"&&(g=m*8);var _=g-this.n.bitLength();return _>0&&(h=h.ushrn(_)),!l&&h.cmp(this.n)>=0?h.sub(this.n):h},u.prototype.sign=function(h,l,g,m){if(typeof g=="object"&&(m=g,g=null),m||(m={}),typeof h!="string"&&typeof h!="number"&&!r.isBN(h)){n(typeof h=="object"&&h&&typeof h.length=="number","Expected message to be an array-like, a hex string, or a BN instance"),n(h.length>>>0===h.length);for(var y=0;y<h.length;y++)n((h[y]&255)===h[y])}l=this.keyFromPrivate(l,g),h=this._truncateToN(h,!1,m.msgBitLength),n(!h.isNeg(),"Can not sign a negative message");var _=this.n.byteLength(),O=l.getPrivate().toArray("be",_),x=h.toArray("be",_);n(new r(x).eq(h),"Can not sign message");for(var D=new e({hash:this.hash,entropy:O,nonce:x,pers:m.pers,persEnc:m.persEnc||"utf8"}),M=this.n.sub(new r(1)),R=0;;R++){var N=m.k?m.k(R):new r(D.generate(this.n.byteLength()));if(N=this._truncateToN(N,!0),!(N.cmpn(1)<=0||N.cmp(M)>=0)){var C=this.g.mul(N);if(!C.isInfinity()){var q=C.getX(),B=q.umod(this.n);if(B.cmpn(0)!==0){var F=N.invm(this.n).mul(B.mul(l.getPrivate()).iadd(h));if(F=F.umod(this.n),F.cmpn(0)!==0){var H=(C.getY().isOdd()?1:0)|(q.cmp(B)!==0?2:0);return m.canonical&&F.cmp(this.nh)>0&&(F=this.n.sub(F),H^=1),new o({r:B,s:F,recoveryParam:H})}}}}}},u.prototype.verify=function(h,l,g,m,y){y||(y={}),h=this._truncateToN(h,!1,y.msgBitLength),g=this.keyFromPublic(g,m),l=new o(l,"hex");var _=l.r,O=l.s;if(_.cmpn(1)<0||_.cmp(this.n)>=0||O.cmpn(1)<0||O.cmp(this.n)>=0)return!1;var x=O.invm(this.n),D=x.mul(h).umod(this.n),M=x.mul(_).umod(this.n),R;return this.curve._maxwellTrick?(R=this.g.jmulAdd(D,g.getPublic(),M),R.isInfinity()?!1:R.eqXToP(_)):(R=this.g.mulAdd(D,g.getPublic(),M),R.isInfinity()?!1:R.getX().umod(this.n).cmp(_)===0)},u.prototype.recoverPubKey=function(c,h,l,g){n((3&l)===l,"The recovery param is more than two bits"),h=new o(h,g);var m=this.n,y=new r(c),_=h.r,O=h.s,x=l&1,D=l>>1;if(_.cmp(this.curve.p.umod(this.curve.n))>=0&&D)throw new Error("Unable to find sencond key candinate");D?_=this.curve.pointFromX(_.add(this.curve.n),x):_=this.curve.pointFromX(_,x);var M=h.r.invm(m),R=m.sub(y).mul(M).umod(m),N=O.mul(M).umod(m);return this.g.mulAdd(R,_,N)},u.prototype.getKeyRecoveryParam=function(c,h,l,g){if(h=new o(h,g),h.recoveryParam!==null)return h.recoveryParam;for(var m=0;m<4;m++){var y;try{y=this.recoverPubKey(c,h,m)}catch{continue}if(y.eq(l))return m}throw new Error("Unable to find valid recovery factor")},Ua}var za,zu;function fv(){if(zu)return za;zu=1;var r=Vt(),e=r.assert,t=r.parseBytes,i=r.cachedProperty;function s(n,a){this.eddsa=n,this._secret=t(a.secret),n.isPoint(a.pub)?this._pub=a.pub:this._pubBytes=t(a.pub)}return s.fromPublic=function(a,o){return o instanceof s?o:new s(a,{pub:o})},s.fromSecret=function(a,o){return o instanceof s?o:new s(a,{secret:o})},s.prototype.secret=function(){return this._secret},i(s,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),i(s,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),i(s,"privBytes",function(){var a=this.eddsa,o=this.hash(),u=a.encodingLength-1,c=o.slice(0,a.encodingLength);return c[0]&=248,c[u]&=127,c[u]|=64,c}),i(s,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),i(s,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),i(s,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),s.prototype.sign=function(a){return e(this._secret,"KeyPair can only verify"),this.eddsa.sign(a,this)},s.prototype.verify=function(a,o){return this.eddsa.verify(a,o,this)},s.prototype.getSecret=function(a){return e(this._secret,"KeyPair is public only"),r.encode(this.secret(),a)},s.prototype.getPublic=function(a){return r.encode(this.pubBytes(),a)},za=s,za}var ka,ku;function dv(){if(ku)return ka;ku=1;var r=xr(),e=Vt(),t=e.assert,i=e.cachedProperty,s=e.parseBytes;function n(a,o){this.eddsa=a,typeof o!="object"&&(o=s(o)),Array.isArray(o)&&(t(o.length===a.encodingLength*2,"Signature has invalid size"),o={R:o.slice(0,a.encodingLength),S:o.slice(a.encodingLength)}),t(o.R&&o.S,"Signature without R or S"),a.isPoint(o.R)&&(this._R=o.R),o.S instanceof r&&(this._S=o.S),this._Rencoded=Array.isArray(o.R)?o.R:o.Rencoded,this._Sencoded=Array.isArray(o.S)?o.S:o.Sencoded}return i(n,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),i(n,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),i(n,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),i(n,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),n.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},n.prototype.toHex=function(){return e.encode(this.toBytes(),"hex").toUpperCase()},ka=n,ka}var Ha,Hu;function lv(){if(Hu)return Ha;Hu=1;var r=ic(),e=dc(),t=Vt(),i=t.assert,s=t.parseBytes,n=fv(),a=dv();function o(u){if(i(u==="ed25519","only tested with ed25519 so far"),!(this instanceof o))return new o(u);u=e[u].curve,this.curve=u,this.g=u.g,this.g.precompute(u.n.bitLength()+1),this.pointClass=u.point().constructor,this.encodingLength=Math.ceil(u.n.bitLength()/8),this.hash=r.sha512}return Ha=o,o.prototype.sign=function(c,h){c=s(c);var l=this.keyFromSecret(h),g=this.hashInt(l.messagePrefix(),c),m=this.g.mul(g),y=this.encodePoint(m),_=this.hashInt(y,l.pubBytes(),c).mul(l.priv()),O=g.add(_).umod(this.curve.n);return this.makeSignature({R:m,S:O,Rencoded:y})},o.prototype.verify=function(c,h,l){if(c=s(c),h=this.makeSignature(h),h.S().gte(h.eddsa.curve.n)||h.S().isNeg())return!1;var g=this.keyFromPublic(l),m=this.hashInt(h.Rencoded(),g.pubBytes(),c),y=this.g.mul(h.S()),_=h.R().add(g.pub().mul(m));return _.eq(y)},o.prototype.hashInt=function(){for(var c=this.hash(),h=0;h<arguments.length;h++)c.update(arguments[h]);return t.intFromLE(c.digest()).umod(this.curve.n)},o.prototype.keyFromPublic=function(c){return n.fromPublic(this,c)},o.prototype.keyFromSecret=function(c){return n.fromSecret(this,c)},o.prototype.makeSignature=function(c){return c instanceof a?c:new a(this,c)},o.prototype.encodePoint=function(c){var h=c.getY().toArray("le",this.encodingLength);return h[this.encodingLength-1]|=c.getX().isOdd()?128:0,h},o.prototype.decodePoint=function(c){c=t.parseBytes(c);var h=c.length-1,l=c.slice(0,h).concat(c[h]&-129),g=(c[h]&128)!==0,m=t.intFromLE(l);return this.curve.pointFromY(m,g)},o.prototype.encodeInt=function(c){return c.toArray("le",this.encodingLength)},o.prototype.decodeInt=function(c){return t.intFromLE(c)},o.prototype.isPoint=function(c){return c instanceof this.pointClass},Ha}var Ku;function pv(){return Ku||(Ku=1,function(r){var e=r;e.version=tv.version,e.utils=Vt(),e.rand=el(),e.curve=tl(),e.curves=dc(),e.ec=hv(),e.eddsa=lv()}(Pa)),Pa}var gv=pv();const bv={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var yv={};const vv=":";function Ui(r){const[e,t]=r.split(vv);return{namespace:e,reference:t}}function Vu(r,e=[]){const t=[];return Object.keys(r).forEach(i=>{if(e.length&&!e.includes(i))return;const s=r[i];t.push(...s.accounts)}),t}function rl(r,e){return r.includes(":")?[r]:e.chains||[]}const mv="ReactNative",Nt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},wv="js";function Fn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Lr(){return!ii.getDocument()&&!!ii.getNavigator()&&navigator.product===mv}function _v(){return Lr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function Ev(){return Lr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function ks(){return!Fn()&&!!ii.getNavigator()&&!!ii.getDocument()}function Hs(){return Lr()?Nt.reactNative:Fn()?Nt.node:ks()?Nt.browser:Nt.unknown}function Wu(){var r;try{return Lr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(r=global.Application)==null?void 0:r.applicationId:void 0}catch{return}}function $v(r,e){const t=new URLSearchParams(r);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const s=e[i];s!==void 0&&t.set(i,s)}return t.toString()}function il(){return W0.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Iv(){if(Hs()===Nt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:i}=global.Platform;return[t,i].join("-")}const r=f0();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function Sv(){var r;const e=Hs();return e===Nt.browser?[e,((r=ii.getLocation())==null?void 0:r.host)||"unknown"].join(":"):e}function sl(r,e,t){const i=Iv(),s=Sv();return[[r,e].join("-"),[wv,t].join("-"),i,s].join("/")}function xv({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:a,bundleId:o,packageName:u}){const c=t.split("?"),h=sl(r,e,i),l={auth:s,ua:h,projectId:n,useOnCloseEvent:a,packageName:u||void 0,bundleId:o||void 0},g=$v(c[1]||"",l);return c[0]+"?"+g}function ti(r,e){return r.filter(t=>e.includes(t)).length===r.length}function nl(r){return Object.fromEntries(r.entries())}function al(r){return new Map(Object.entries(r))}function Zr(r=V.FIVE_MINUTES,e){const t=V.toMiliseconds(r||V.FIVE_MINUTES);let i,s,n,a;return{resolve:o=>{n&&i&&(clearTimeout(n),i(o),a=Promise.resolve(o))},reject:o=>{n&&s&&(clearTimeout(n),s(o))},done:()=>new Promise((o,u)=>{if(a)return o(a);n=setTimeout(()=>{const c=new Error(e);a=Promise.reject(c),u(c)},t),i=o,s=u})}}function Fr(r,e,t){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(t)),e);try{const a=await r;i(a)}catch(a){s(a)}clearTimeout(n)})}function ol(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function Dv(r){return ol("topic",r)}function Pv(r){return ol("id",r)}function cl(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function tt(r,e){return V.fromMiliseconds(Date.now()+V.toMiliseconds(r))}function Nr(r){return Date.now()>=V.toMiliseconds(r)}function ue(r,e){return`${r}${e?`:${e}`:""}`}function Pn(r=[],e=[]){return[...new Set([...r,...e])]}async function Av({id:r,topic:e,wcDeepLink:t}){var i;try{if(!t)return;const s=typeof t=="string"?JSON.parse(t):t,n=s==null?void 0:s.href;if(typeof n!="string")return;const a=Ov(n,r,e),o=Hs();if(o===Nt.browser){if(!((i=ii.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Mv(a)}else o===Nt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(a)}catch(s){console.error(s)}}function Ov(r,e,t){const i=`requestId=${e}&sessionTopic=${t}`;r.endsWith("/")&&(r=r.slice(0,-1));let s=`${r}`;if(r.startsWith("https://t.me")){const n=r.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${Nv(i,!0)}`}else s=`${s}/wc?${i}`;return s}function Mv(r){let e="_self";Tv()?e="_top":(Rv()||r.startsWith("https://")||r.startsWith("http://"))&&(e="_blank"),window.open(r,e,"noreferrer noopener")}async function Cv(r,e){let t="";try{if(ks()&&(t=localStorage.getItem(e),t))return t;t=await r.getItem(e)}catch(i){console.error(i)}return t}function Gu(r,e){if(!r.includes(e))return null;const t=r.split(/([&,?,=])/),i=t.indexOf(e);return t[i+2]}function Ju(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}function lc(){return typeof process<"u"&&yv.IS_VITEST==="true"}function Rv(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Tv(){try{return window.self!==window.top}catch{return!1}}function Nv(r,e=!1){const t=Buffer.from(r).toString("base64");return e?t.replace(/[=]/g,""):t}function ul(r){return Buffer.from(r,"base64").toString("utf-8")}function Fv(r){return new Promise(e=>setTimeout(e,r))}function Fs(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function qv(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Xn(r,...e){if(!qv(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function pc(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Fs(r.outputLen),Fs(r.blockLen)}function zi(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function hl(r,e){Xn(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const pn=BigInt(2**32-1),Yu=BigInt(32);function Bv(r,e=!1){return e?{h:Number(r&pn),l:Number(r>>Yu&pn)}:{h:Number(r>>Yu&pn)|0,l:Number(r&pn)|0}}function jv(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:n,l:a}=Bv(r[s],e);[t[s],i[s]]=[n,a]}return[t,i]}const Lv=(r,e,t)=>r<<t|e>>>32-t,Uv=(r,e,t)=>e<<t|r>>>32-t,zv=(r,e,t)=>e<<t-32|r>>>64-t,kv=(r,e,t)=>r<<t-32|e>>>64-t,vi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Hv(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Ka(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function ar(r,e){return r<<32-e|r>>>e}const Xu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Kv(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function Zu(r){for(let e=0;e<r.length;e++)r[e]=Kv(r[e])}function Vv(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function ki(r){return typeof r=="string"&&(r=Vv(r)),Xn(r),r}let gc=class{clone(){return this._cloneInto()}};function fl(r){const e=i=>r().update(ki(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Ks(r=32){if(vi&&typeof vi.getRandomValues=="function")return vi.getRandomValues(new Uint8Array(r));if(vi&&typeof vi.randomBytes=="function")return vi.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}const dl=[],ll=[],pl=[],Wv=BigInt(0),ws=BigInt(1),Gv=BigInt(2),Jv=BigInt(7),Yv=BigInt(256),Xv=BigInt(113);for(let r=0,e=ws,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],dl.push(2*(5*i+t)),ll.push((r+1)*(r+2)/2%64);let s=Wv;for(let n=0;n<7;n++)e=(e<<ws^(e>>Jv)*Xv)%Yv,e&Gv&&(s^=ws<<(ws<<BigInt(n))-ws);pl.push(s)}const[Zv,Qv]=jv(pl,!0),Qu=(r,e,t)=>t>32?zv(r,e,t):Lv(r,e,t),eh=(r,e,t)=>t>32?kv(r,e,t):Uv(r,e,t);function em(r,e=24){const t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let a=0;a<10;a++)t[a]=r[a]^r[a+10]^r[a+20]^r[a+30]^r[a+40];for(let a=0;a<10;a+=2){const o=(a+8)%10,u=(a+2)%10,c=t[u],h=t[u+1],l=Qu(c,h,1)^t[o],g=eh(c,h,1)^t[o+1];for(let m=0;m<50;m+=10)r[a+m]^=l,r[a+m+1]^=g}let s=r[2],n=r[3];for(let a=0;a<24;a++){const o=ll[a],u=Qu(s,n,o),c=eh(s,n,o),h=dl[a];s=r[h],n=r[h+1],r[h]=u,r[h+1]=c}for(let a=0;a<50;a+=10){for(let o=0;o<10;o++)t[o]=r[a+o];for(let o=0;o<10;o++)r[a+o]^=~t[(o+2)%10]&t[(o+4)%10]}r[0]^=Zv[i],r[1]^=Qv[i]}t.fill(0)}let tm=class gl extends gc{constructor(e,t,i,s=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Fs(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Hv(this.state)}keccak(){Xu||Zu(this.state32),em(this.state32,this.rounds),Xu||Zu(this.state32),this.posOut=0,this.pos=0}update(e){zi(this);const{blockLen:t,state:i}=this;e=ki(e);const s=e.length;for(let n=0;n<s;){const a=Math.min(t-this.pos,s-n);for(let o=0;o<a;o++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,(t&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){zi(this,!1),Xn(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const a=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+a),s),this.posOut+=a,s+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Fs(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(hl(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:s,rounds:n,enableXOF:a}=this;return e||(e=new gl(t,i,s,a,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=a,e.destroyed=this.destroyed,e}};const rm=(r,e,t)=>fl(()=>new tm(e,r,t)),im=rm(1,136,256/8),sm="https://rpc.walletconnect.org/v1";function bl(r){const e=`Ethereum Signed Message:
${r.length}`,t=new TextEncoder().encode(e+r);return"0x"+Buffer.from(im(t)).toString("hex")}async function nm(r,e,t,i,s,n){switch(t.t){case"eip191":return await am(r,e,t.s);case"eip1271":return await om(r,e,t.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function am(r,e,t){return(await fg({hash:bl(e),signature:t})).toLowerCase()===r.toLowerCase()}async function om(r,e,t,i,s,n){const a=Ui(i);if(!a.namespace||!a.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const o="0x1626ba7e",u="0000000000000000000000000000000000000000000000000000000000000040",c="0000000000000000000000000000000000000000000000000000000000000041",h=t.substring(2),l=bl(e).substring(2),g=o+l+u+c+h,m=await fetch(`${n||sm}/?chainId=${i}&projectId=${s}`,{method:"POST",body:JSON.stringify({id:cm(),jsonrpc:"2.0",method:"eth_call",params:[{to:r,data:g},"latest"]})}),{result:y}=await m.json();return y?y.slice(0,o.length).toLowerCase()===o.toLowerCase():!1}catch(o){return console.error("isValidEip1271Signature: ",o),!1}}function cm(){return Date.now()+Math.floor(Math.random()*1e3)}var um=Object.defineProperty,hm=Object.defineProperties,fm=Object.getOwnPropertyDescriptors,th=Object.getOwnPropertySymbols,dm=Object.prototype.hasOwnProperty,lm=Object.prototype.propertyIsEnumerable,rh=(r,e,t)=>e in r?um(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pm=(r,e)=>{for(var t in e||(e={}))dm.call(e,t)&&rh(r,t,e[t]);if(th)for(var t of th(e))lm.call(e,t)&&rh(r,t,e[t]);return r},gm=(r,e)=>hm(r,fm(e));const bm="did:pkh:",bc=r=>r==null?void 0:r.split(":"),ym=r=>{const e=r&&bc(r);if(e)return r.includes(bm)?e[3]:e[1]},Do=r=>{const e=r&&bc(r);if(e)return e[2]+":"+e[3]},qn=r=>{const e=r&&bc(r);if(e)return e.pop()};async function ih(r){const{cacao:e,projectId:t}=r,{s:i,p:s}=e,n=yl(s,s.iss),a=qn(s.iss);return await nm(a,n,i,Do(s.iss),t)}const yl=(r,e)=>{const t=`${r.domain} wants you to sign in with your Ethereum account:`,i=qn(e);if(!r.aud&&!r.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=r.statement||void 0;const n=`URI: ${r.aud||r.uri}`,a=`Version: ${r.version}`,o=`Chain ID: ${ym(e)}`,u=`Nonce: ${r.nonce}`,c=`Issued At: ${r.iat}`,h=r.exp?`Expiration Time: ${r.exp}`:void 0,l=r.nbf?`Not Before: ${r.nbf}`:void 0,g=r.requestId?`Request ID: ${r.requestId}`:void 0,m=r.resources?`Resources:${r.resources.map(_=>`
- ${_}`).join("")}`:void 0,y=An(r.resources);if(y){const _=qs(y);s=xm(s,_)}return[t,i,"",s,"",n,a,o,u,c,h,l,g,m].filter(_=>_!=null).join(`
`)};function vm(r){return Buffer.from(JSON.stringify(r)).toString("base64")}function mm(r){return JSON.parse(Buffer.from(r,"base64").toString("utf-8"))}function ai(r){if(!r)throw new Error("No recap provided, value is undefined");if(!r.att)throw new Error("No `att` property found");const e=Object.keys(r.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{const i=r.att[t];if(Array.isArray(i))throw new Error(`Resource must be an object: ${t}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(a=>{if(typeof a!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${a}`)})})})}function wm(r,e,t,i={}){return t==null||t.sort((s,n)=>s.localeCompare(n)),{att:{[r]:_m(e,t,i)}}}function _m(r,e,t={}){e=e==null?void 0:e.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${r}/${s}`]:[t]}));return Object.assign({},...i)}function vl(r){return ai(r),`urn:recap:${vm(r).replace(/=/g,"")}`}function qs(r){const e=mm(r.replace("urn:recap:",""));return ai(e),e}function Em(r,e,t){const i=wm(r,e,t);return vl(i)}function $m(r){return r&&r.includes("urn:recap:")}function Im(r,e){const t=qs(r),i=qs(e),s=Sm(t,i);return vl(s)}function Sm(r,e){ai(r),ai(e);const t=Object.keys(r.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return t.forEach(s=>{var n,a;Object.keys(((n=r.att)==null?void 0:n[s])||{}).concat(Object.keys(((a=e.att)==null?void 0:a[s])||{})).sort((o,u)=>o.localeCompare(u)).forEach(o=>{var u,c;i.att[s]=gm(pm({},i.att[s]),{[o]:((u=r.att[s])==null?void 0:u[o])||((c=e.att[s])==null?void 0:c[o])})})}),i}function xm(r="",e){ai(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(r.includes(t))return r;const i=[];let s=0;Object.keys(e.att).forEach(o=>{const u=Object.keys(e.att[o]).map(l=>({ability:l.split("/")[0],action:l.split("/")[1]}));u.sort((l,g)=>l.action.localeCompare(g.action));const c={};u.forEach(l=>{c[l.ability]||(c[l.ability]=[]),c[l.ability].push(l.action)});const h=Object.keys(c).map(l=>(s++,`(${s}) '${l}': '${c[l].join("', '")}' for '${o}'.`));i.push(h.join(", ").replace(".,","."))});const n=i.join(" "),a=`${t}${n}`;return`${r?r+" ":""}${a}`}function sh(r){var e;const t=qs(r);ai(t);const i=(e=t.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function nh(r){const e=qs(r);ai(e);const t=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s==null?void 0:s[0])!=null&&n.chains&&t.push(s[0].chains)})}),[...new Set(t.flat())]}function An(r){if(!r)return;const e=r==null?void 0:r[r.length-1];return $m(e)?e:void 0}function Va(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function ml(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Tt(r,...e){if(!ml(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function ah(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Dm(r,e){Tt(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function oh(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}const jr=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),Pm=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Am=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Am)throw new Error("Non little-endian hardware is not supported");function Om(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Po(r){if(typeof r=="string")r=Om(r);else if(ml(r))r=Ao(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function Mm(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function Cm(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return t===0}const Rm=(r,e)=>{function t(i,...s){if(Tt(i),r.nonceLength!==void 0){const c=s[0];if(!c)throw new Error("nonce / iv required");r.varSizeNonce?Tt(c):Tt(c,r.nonceLength)}const n=r.tagLength;n&&s[1]!==void 0&&Tt(s[1]);const a=e(i,...s),o=(c,h)=>{if(h!==void 0){if(c!==2)throw new Error("cipher output not supported");Tt(h)}};let u=!1;return{encrypt(c,h){if(u)throw new Error("cannot encrypt() twice with same key + nonce");return u=!0,Tt(c),o(a.encrypt.length,h),a.encrypt(c,h)},decrypt(c,h){if(Tt(c),n&&c.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return o(a.decrypt.length,h),a.decrypt(c,h)}}}return Object.assign(t,r),t};function ch(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!Tm(e))throw new Error("invalid output, must be aligned");return e}function uh(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),a=Number(t>>s&n),o=Number(t&n);r.setUint32(e+4,a,i),r.setUint32(e+0,o,i)}function Tm(r){return r.byteOffset%4===0}function Ao(r){return Uint8Array.from(r)}function Hi(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const wl=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),Nm=wl("expand 16-byte k"),Fm=wl("expand 32-byte k"),qm=jr(Nm),Bm=jr(Fm);function ae(r,e){return r<<e|r>>>32-e}function Oo(r){return r.byteOffset%4===0}const gn=64,jm=16,_l=2**32-1,hh=new Uint32Array;function Lm(r,e,t,i,s,n,a,o){const u=s.length,c=new Uint8Array(gn),h=jr(c),l=Oo(s)&&Oo(n),g=l?jr(s):hh,m=l?jr(n):hh;for(let y=0;y<u;a++){if(r(e,t,i,h,a,o),a>=_l)throw new Error("arx: counter overflow");const _=Math.min(gn,u-y);if(l&&_===gn){const O=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let x=0,D;x<jm;x++)D=O+x,m[D]=g[D]^h[x];y+=gn;continue}for(let O=0,x;O<_;O++)x=y+O,n[x]=s[x]^c[O];y+=_}}function Um(r,e){const{allowShortKeys:t,extendNonceFn:i,counterLength:s,counterRight:n,rounds:a}=Mm({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Va(s),Va(a),oh(n),oh(t),(o,u,c,h,l=0)=>{Tt(o),Tt(u),Tt(c);const g=c.length;if(h===void 0&&(h=new Uint8Array(g)),Tt(h),Va(l),l<0||l>=_l)throw new Error("arx: counter overflow");if(h.length<g)throw new Error(`arx: output (${h.length}) is shorter than data (${g})`);const m=[];let y=o.length,_,O;if(y===32)m.push(_=Ao(o)),O=Bm;else if(y===16&&t)_=new Uint8Array(32),_.set(o),_.set(o,16),O=qm,m.push(_);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);Oo(u)||m.push(u=Ao(u));const x=jr(_);if(i){if(u.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(O,x,jr(u.subarray(0,16)),x),u=u.subarray(16)}const D=16-s;if(D!==u.length)throw new Error(`arx: nonce must be ${D} or 16 bytes`);if(D!==12){const R=new Uint8Array(12);R.set(u,n?0:12-u.length),u=R,m.push(u)}const M=jr(u);return Lm(r,O,x,M,c,h,l,a),Hi(...m),h}}const ft=(r,e)=>r[e++]&255|(r[e++]&255)<<8;let zm=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Po(e),Tt(e,32);const t=ft(e,0),i=ft(e,2),s=ft(e,4),n=ft(e,6),a=ft(e,8),o=ft(e,10),u=ft(e,12),c=ft(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|a<<12)&255,this.r[5]=a>>>1&8190,this.r[6]=(a>>>14|o<<2)&8191,this.r[7]=(o>>>11|u<<5)&8065,this.r[8]=(u>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let h=0;h<8;h++)this.pad[h]=ft(e,16+2*h)}process(e,t,i=!1){const s=i?0:2048,{h:n,r:a}=this,o=a[0],u=a[1],c=a[2],h=a[3],l=a[4],g=a[5],m=a[6],y=a[7],_=a[8],O=a[9],x=ft(e,t+0),D=ft(e,t+2),M=ft(e,t+4),R=ft(e,t+6),N=ft(e,t+8),C=ft(e,t+10),q=ft(e,t+12),B=ft(e,t+14);let F=n[0]+(x&8191),H=n[1]+((x>>>13|D<<3)&8191),S=n[2]+((D>>>10|M<<6)&8191),f=n[3]+((M>>>7|R<<9)&8191),b=n[4]+((R>>>4|N<<12)&8191),w=n[5]+(N>>>1&8191),p=n[6]+((N>>>14|C<<2)&8191),v=n[7]+((C>>>11|q<<5)&8191),I=n[8]+((q>>>8|B<<8)&8191),P=n[9]+(B>>>5|s),E=0,d=E+F*o+H*(5*O)+S*(5*_)+f*(5*y)+b*(5*m);E=d>>>13,d&=8191,d+=w*(5*g)+p*(5*l)+v*(5*h)+I*(5*c)+P*(5*u),E+=d>>>13,d&=8191;let $=E+F*u+H*o+S*(5*O)+f*(5*_)+b*(5*y);E=$>>>13,$&=8191,$+=w*(5*m)+p*(5*g)+v*(5*l)+I*(5*h)+P*(5*c),E+=$>>>13,$&=8191;let j=E+F*c+H*u+S*o+f*(5*O)+b*(5*_);E=j>>>13,j&=8191,j+=w*(5*y)+p*(5*m)+v*(5*g)+I*(5*l)+P*(5*h),E+=j>>>13,j&=8191;let U=E+F*h+H*c+S*u+f*o+b*(5*O);E=U>>>13,U&=8191,U+=w*(5*_)+p*(5*y)+v*(5*m)+I*(5*g)+P*(5*l),E+=U>>>13,U&=8191;let L=E+F*l+H*h+S*c+f*u+b*o;E=L>>>13,L&=8191,L+=w*(5*O)+p*(5*_)+v*(5*y)+I*(5*m)+P*(5*g),E+=L>>>13,L&=8191;let z=E+F*g+H*l+S*h+f*c+b*u;E=z>>>13,z&=8191,z+=w*o+p*(5*O)+v*(5*_)+I*(5*y)+P*(5*m),E+=z>>>13,z&=8191;let G=E+F*m+H*g+S*l+f*h+b*c;E=G>>>13,G&=8191,G+=w*u+p*o+v*(5*O)+I*(5*_)+P*(5*y),E+=G>>>13,G&=8191;let X=E+F*y+H*m+S*g+f*l+b*h;E=X>>>13,X&=8191,X+=w*c+p*u+v*o+I*(5*O)+P*(5*_),E+=X>>>13,X&=8191;let Q=E+F*_+H*y+S*m+f*g+b*l;E=Q>>>13,Q&=8191,Q+=w*h+p*c+v*u+I*o+P*(5*O),E+=Q>>>13,Q&=8191;let Y=E+F*O+H*_+S*y+f*m+b*g;E=Y>>>13,Y&=8191,Y+=w*l+p*h+v*c+I*u+P*o,E+=Y>>>13,Y&=8191,E=(E<<2)+E|0,E=E+d|0,d=E&8191,E=E>>>13,$+=E,n[0]=d,n[1]=$,n[2]=j,n[3]=U,n[4]=L,n[5]=z,n[6]=G,n[7]=X,n[8]=Q,n[9]=Y}finalize(){const{h:e,pad:t}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let o=2;o<10;o++)e[o]+=s,s=e[o]>>>13,e[o]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let o=1;o<10;o++)i[o]=e[o]+s,s=i[o]>>>13,i[o]&=8191;i[9]-=8192;let n=(s^1)-1;for(let o=0;o<10;o++)i[o]&=n;n=~n;for(let o=0;o<10;o++)e[o]=e[o]&n|i[o];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let a=e[0]+t[0];e[0]=a&65535;for(let o=1;o<8;o++)a=(e[o]+t[o]|0)+(a>>>16)|0,e[o]=a&65535;Hi(i)}update(e){ah(this);const{buffer:t,blockLen:i}=this;e=Po(e);const s=e.length;for(let n=0;n<s;){const a=Math.min(i-this.pos,s-n);if(a===i){for(;i<=s-n;n+=i)this.process(e,n);continue}t.set(e.subarray(n,n+a),this.pos),this.pos+=a,n+=a,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Hi(this.h,this.r,this.buffer,this.pad)}digestInto(e){ah(this),Dm(e,this),this.finished=!0;const{buffer:t,h:i}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let a=0;a<8;a++)e[n++]=i[a]>>>0,e[n++]=i[a]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}};function km(r){const e=(i,s)=>r(s).update(Po(i)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}const Hm=km(r=>new zm(r));function Km(r,e,t,i,s,n=20){let a=r[0],o=r[1],u=r[2],c=r[3],h=e[0],l=e[1],g=e[2],m=e[3],y=e[4],_=e[5],O=e[6],x=e[7],D=s,M=t[0],R=t[1],N=t[2],C=a,q=o,B=u,F=c,H=h,S=l,f=g,b=m,w=y,p=_,v=O,I=x,P=D,E=M,d=R,$=N;for(let U=0;U<n;U+=2)C=C+H|0,P=ae(P^C,16),w=w+P|0,H=ae(H^w,12),C=C+H|0,P=ae(P^C,8),w=w+P|0,H=ae(H^w,7),q=q+S|0,E=ae(E^q,16),p=p+E|0,S=ae(S^p,12),q=q+S|0,E=ae(E^q,8),p=p+E|0,S=ae(S^p,7),B=B+f|0,d=ae(d^B,16),v=v+d|0,f=ae(f^v,12),B=B+f|0,d=ae(d^B,8),v=v+d|0,f=ae(f^v,7),F=F+b|0,$=ae($^F,16),I=I+$|0,b=ae(b^I,12),F=F+b|0,$=ae($^F,8),I=I+$|0,b=ae(b^I,7),C=C+S|0,$=ae($^C,16),v=v+$|0,S=ae(S^v,12),C=C+S|0,$=ae($^C,8),v=v+$|0,S=ae(S^v,7),q=q+f|0,P=ae(P^q,16),I=I+P|0,f=ae(f^I,12),q=q+f|0,P=ae(P^q,8),I=I+P|0,f=ae(f^I,7),B=B+b|0,E=ae(E^B,16),w=w+E|0,b=ae(b^w,12),B=B+b|0,E=ae(E^B,8),w=w+E|0,b=ae(b^w,7),F=F+H|0,d=ae(d^F,16),p=p+d|0,H=ae(H^p,12),F=F+H|0,d=ae(d^F,8),p=p+d|0,H=ae(H^p,7);let j=0;i[j++]=a+C|0,i[j++]=o+q|0,i[j++]=u+B|0,i[j++]=c+F|0,i[j++]=h+H|0,i[j++]=l+S|0,i[j++]=g+f|0,i[j++]=m+b|0,i[j++]=y+w|0,i[j++]=_+p|0,i[j++]=O+v|0,i[j++]=x+I|0,i[j++]=D+P|0,i[j++]=M+E|0,i[j++]=R+d|0,i[j++]=N+$|0}const Vm=Um(Km,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Wm=new Uint8Array(16),fh=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(Wm.subarray(t))},Gm=new Uint8Array(32);function dh(r,e,t,i,s){const n=r(e,t,Gm),a=Hm.create(n);s&&fh(a,s),fh(a,i);const o=new Uint8Array(16),u=Pm(o);uh(u,0,BigInt(s?s.length:0),!0),uh(u,8,BigInt(i.length),!0),a.update(o);const c=a.digest();return Hi(n,o),c}const Jm=r=>(e,t,i)=>({encrypt(s,n){const a=s.length;n=ch(a+16,n,!1),n.set(s);const o=n.subarray(0,-16);r(e,t,o,o,1);const u=dh(r,e,t,o,i);return n.set(u,a),Hi(u),n},decrypt(s,n){n=ch(s.length-16,n,!1);const a=s.subarray(0,-16),o=s.subarray(-16),u=dh(r,e,t,a,i);if(!Cm(o,u))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),r(e,t,n,n,1),Hi(u),n}}),El=Rm({blockSize:64,nonceLength:12,tagLength:16},Jm(Vm));let $l=class extends gc{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,pc(e);const i=ki(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let a=0;a<n.length;a++)n[a]^=54;this.iHash.update(n),this.oHash=e.create();for(let a=0;a<n.length;a++)n[a]^=106;this.oHash.update(n),n.fill(0)}update(e){return zi(this),this.iHash.update(e),this}digestInto(e){zi(this),Xn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:s,destroyed:n,blockLen:a,outputLen:o}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=a,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const yc=(r,e,t)=>new $l(r,e).update(t).digest();yc.create=(r,e)=>new $l(r,e);function Ym(r,e,t){return pc(r),t===void 0&&(t=new Uint8Array(r.outputLen)),yc(r,ki(t),ki(e))}const Wa=new Uint8Array([0]),lh=new Uint8Array;function Xm(r,e,t,i=32){if(pc(r),Fs(i),i>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/r.outputLen);t===void 0&&(t=lh);const n=new Uint8Array(s*r.outputLen),a=yc.create(r,e),o=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let c=0;c<s;c++)Wa[0]=c+1,o.update(c===0?lh:u).update(t).update(Wa).digestInto(u),n.set(u,r.outputLen*c),a._cloneInto(o);return a.destroy(),o.destroy(),u.fill(0),Wa.fill(0),n.slice(0,i)}const Zm=(r,e,t,i,s)=>Xm(r,Ym(r,e,t),i,s);function Qm(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),a=Number(t>>s&n),o=Number(t&n),u=i?4:0,c=i?0:4;r.setUint32(e+u,a,i),r.setUint32(e+c,o,i)}function e2(r,e,t){return r&e^~r&t}function t2(r,e,t){return r&e^r&t^e&t}let r2=class extends gc{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ka(this.buffer)}update(e){zi(this);const{view:t,buffer:i,blockLen:s}=this;e=ki(e);const n=e.length;for(let a=0;a<n;){const o=Math.min(s-this.pos,n-a);if(o===s){const u=Ka(e);for(;s<=n-a;a+=s)this.process(u,a);continue}i.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){zi(this),hl(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(i,0),a=0);for(let l=a;l<s;l++)t[l]=0;Qm(i,s-8,BigInt(this.length*8),n),this.process(i,0);const o=Ka(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=u/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)o.setUint32(4*l,h[l],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:a,pos:o}=this;return e.length=s,e.pos=o,e.finished=n,e.destroyed=a,s%t&&e.buffer.set(i),e}};const i2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Rr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Tr=new Uint32Array(64);let s2=class extends r2{constructor(){super(64,32,8,!1),this.A=Rr[0]|0,this.B=Rr[1]|0,this.C=Rr[2]|0,this.D=Rr[3]|0,this.E=Rr[4]|0,this.F=Rr[5]|0,this.G=Rr[6]|0,this.H=Rr[7]|0}get(){const{A:e,B:t,C:i,D:s,E:n,F:a,G:o,H:u}=this;return[e,t,i,s,n,a,o,u]}set(e,t,i,s,n,a,o,u){this.A=e|0,this.B=t|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=a|0,this.G=o|0,this.H=u|0}process(e,t){for(let l=0;l<16;l++,t+=4)Tr[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){const g=Tr[l-15],m=Tr[l-2],y=ar(g,7)^ar(g,18)^g>>>3,_=ar(m,17)^ar(m,19)^m>>>10;Tr[l]=_+Tr[l-7]+y+Tr[l-16]|0}let{A:i,B:s,C:n,D:a,E:o,F:u,G:c,H:h}=this;for(let l=0;l<64;l++){const g=ar(o,6)^ar(o,11)^ar(o,25),m=h+g+e2(o,u,c)+i2[l]+Tr[l]|0,y=(ar(i,2)^ar(i,13)^ar(i,22))+t2(i,s,n)|0;h=c,c=u,u=o,o=a+m|0,a=n,n=s,s=i,i=m+y|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,a=a+this.D|0,o=o+this.E|0,u=u+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(i,s,n,a,o,u,c,h)}roundClean(){Tr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Zn=fl(()=>new s2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Il=BigInt(0);function vc(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Sl(r){if(!vc(r))throw new Error("Uint8Array expected")}const n2=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function a2(r){Sl(r);let e="";for(let t=0;t<r.length;t++)e+=n2[r[t]];return e}function o2(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Il:BigInt("0x"+r)}const mr={_0:48,_9:57,A:65,F:70,a:97,f:102};function ph(r){if(r>=mr._0&&r<=mr._9)return r-mr._0;if(r>=mr.A&&r<=mr.F)return r-(mr.A-10);if(r>=mr.a&&r<=mr.f)return r-(mr.a-10)}function xl(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const a=ph(r.charCodeAt(n)),o=ph(r.charCodeAt(n+1));if(a===void 0||o===void 0){const u=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+u+'" at index '+n)}i[s]=a*16+o}return i}function gh(r){return Sl(r),o2(a2(Uint8Array.from(r).reverse()))}function c2(r,e){return xl(r.toString(16).padStart(e*2,"0"))}function u2(r,e){return c2(r,e).reverse()}function bh(r,e,t){let i;if(typeof e=="string")try{i=xl(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(vc(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=i.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}const Ga=r=>typeof r=="bigint"&&Il<=r;function h2(r,e,t){return Ga(r)&&Ga(e)&&Ga(t)&&e<=r&&r<t}function yh(r,e,t,i){if(!h2(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}const f2={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||vc(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function d2(r,e,t={}){const i=(s,n,a)=>{const o=f2[n];if(typeof o!="function")throw new Error("invalid validator function");const u=r[s];if(!(a&&u===void 0)&&!o(u,r))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+u)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(t))i(s,n,!0);return r}const Li=BigInt(0),bn=BigInt(1);function Dl(r,e){const t=r%e;return t>=Li?t:e+t}function l2(r,e,t){if(e<Li)throw new Error("invalid exponent, negatives unsupported");if(t<=Li)throw new Error("invalid modulus");if(t===bn)return Li;let i=bn;for(;e>Li;)e&bn&&(i=i*r%t),r=r*r%t,e>>=bn;return i}function rr(r,e,t){let i=r;for(;e-- >Li;)i*=i,i%=t;return i}BigInt(0),BigInt(1),BigInt(0),BigInt(1),BigInt(2),BigInt(8);const mi=BigInt(0),Ja=BigInt(1);function p2(r){return d2(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function g2(r){const e=p2(r),{P:t}=e,i=D=>Dl(D,t),s=e.montgomeryBits,n=Math.ceil(s/8),a=e.nByteLength,o=e.adjustScalarBytes||(D=>D),u=e.powPminus2||(D=>l2(D,t-BigInt(2),t));function c(D,M,R){const N=i(D*(M-R));return M=i(M-N),R=i(R+N),[M,R]}const h=(e.a-BigInt(2))/BigInt(4);function l(D,M){yh("u",D,mi,t),yh("scalar",M,mi,t);const R=M,N=D;let C=Ja,q=mi,B=D,F=Ja,H=mi,S;for(let b=BigInt(s-1);b>=mi;b--){const w=R>>b&Ja;H^=w,S=c(H,C,B),C=S[0],B=S[1],S=c(H,q,F),q=S[0],F=S[1],H=w;const p=C+q,v=i(p*p),I=C-q,P=i(I*I),E=v-P,d=B+F,$=B-F,j=i($*p),U=i(d*I),L=j+U,z=j-U;B=i(L*L),F=i(N*i(z*z)),C=i(v*P),q=i(E*(v+i(h*E)))}S=c(H,C,B),C=S[0],B=S[1],S=c(H,q,F),q=S[0],F=S[1];const f=u(q);return i(C*f)}function g(D){return u2(i(D),n)}function m(D){const M=bh("u coordinate",D,n);return a===32&&(M[31]&=127),gh(M)}function y(D){const M=bh("scalar",D),R=M.length;if(R!==n&&R!==a){let N=""+n+" or "+a;throw new Error("invalid scalar, expected "+N+" bytes, got "+R)}return gh(o(M))}function _(D,M){const R=m(M),N=y(D),C=l(R,N);if(C===mi)throw new Error("invalid private or public key received");return g(C)}const O=g(e.Gu);function x(D){return _(D,O)}return{scalarMult:_,scalarMultBase:x,getSharedSecret:(D,M)=>_(D,M),getPublicKey:D=>x(D),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:O}}const Mo=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const b2=BigInt(1),vh=BigInt(2),y2=BigInt(3),v2=BigInt(5);BigInt(8);function m2(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),n=Mo,a=r*r%n*r%n,o=rr(a,vh,n)*a%n,u=rr(o,b2,n)*r%n,c=rr(u,v2,n)*u%n,h=rr(c,e,n)*c%n,l=rr(h,t,n)*h%n,g=rr(l,i,n)*l%n,m=rr(g,s,n)*g%n,y=rr(m,s,n)*g%n,_=rr(y,e,n)*c%n;return{pow_p_5_8:rr(_,vh,n)*r%n,b2:a}}function w2(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}const Co=g2({P:Mo,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=Mo,{pow_p_5_8:t,b2:i}=m2(r);return Dl(rr(t,y2,e)*i,e)},adjustScalarBytes:w2,randomBytes:Ks}),Pl="base10",mt="base16",qr="base64pad",_s="base64url",Vs="utf8",Al=0,Ir=1,Ws=2,_2=0,mh=1,Ms=12,mc=32;function E2(){const r=Co.utils.randomPrivateKey(),e=Co.getPublicKey(r);return{privateKey:_t(r,mt),publicKey:_t(e,mt)}}function Ro(){const r=Ks(mc);return _t(r,mt)}function $2(r,e){const t=Co.getSharedSecret(Kt(r,mt),Kt(e,mt)),i=Zm(Zn,t,void 0,void 0,mc);return _t(i,mt)}function On(r){const e=Zn(Kt(r,mt));return _t(e,mt)}function $r(r){const e=Zn(Kt(r,Vs));return _t(e,mt)}function Ol(r){return Kt(`${r}`,Pl)}function oi(r){return Number(_t(r,Pl))}function I2(r){const e=Ol(typeof r.type<"u"?r.type:Al);if(oi(e)===Ir&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?Kt(r.senderPublicKey,mt):void 0,i=typeof r.iv<"u"?Kt(r.iv,mt):Ks(Ms),s=Kt(r.symKey,mt),n=El(s,i).encrypt(Kt(r.message,Vs));return Ml({type:e,sealed:n,iv:i,senderPublicKey:t,encoding:r.encoding})}function S2(r){const e=Kt(r.symKey,mt),{sealed:t,iv:i}=Bs(r),s=El(e,i).decrypt(t);if(s===null)throw new Error("Failed to decrypt");return _t(s,Vs)}function x2(r,e){const t=Ol(Ws),i=Ks(Ms),s=Kt(r,Vs);return Ml({type:t,sealed:s,iv:i,encoding:e})}function D2(r,e){const{sealed:t}=Bs({encoded:r,encoding:e});return _t(t,Vs)}function Ml(r){const{encoding:e=qr}=r;if(oi(r.type)===Ws)return _t(xa([r.type,r.sealed]),e);if(oi(r.type)===Ir){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return _t(xa([r.type,r.senderPublicKey,r.iv,r.sealed]),e)}return _t(xa([r.type,r.iv,r.sealed]),e)}function Bs(r){const{encoded:e,encoding:t=qr}=r,i=Kt(e,t),s=i.slice(_2,mh),n=mh;if(oi(s)===Ir){const c=n+mc,h=c+Ms,l=i.slice(n,c),g=i.slice(c,h),m=i.slice(h);return{type:s,sealed:m,iv:g,senderPublicKey:l}}if(oi(s)===Ws){const c=i.slice(n),h=Ks(Ms);return{type:s,sealed:c,iv:h}}const a=n+Ms,o=i.slice(n,a),u=i.slice(a);return{type:s,sealed:u,iv:o}}function P2(r,e){const t=Bs({encoded:r,encoding:e==null?void 0:e.encoding});return Cl({type:oi(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?_t(t.senderPublicKey,mt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Cl(r){const e=(r==null?void 0:r.type)||Al;if(e===Ir){if(typeof(r==null?void 0:r.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(r==null?void 0:r.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r==null?void 0:r.senderPublicKey,receiverPublicKey:r==null?void 0:r.receiverPublicKey}}function wh(r){return r.type===Ir&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}function _h(r){return r.type===Ws}function A2(r){return new gv.ec("p256").keyFromPublic({x:Buffer.from(r.x,"base64").toString("hex"),y:Buffer.from(r.y,"base64").toString("hex")},"hex")}function O2(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");const t=e.length%4;return t>0&&(e+="=".repeat(4-t)),e}function M2(r){return Buffer.from(O2(r),"base64")}function C2(r,e){const[t,i,s]=r.split("."),n=M2(s);if(n.length!==64)throw new Error("Invalid signature length");const a=n.slice(0,32).toString("hex"),o=n.slice(32,64).toString("hex"),u=`${t}.${i}`,c=Zn(u),h=A2(e),l=_t(c,mt);if(!h.verify(l,{r:a,s:o}))throw new Error("Invalid signature");return xo(r).payload}const R2="irn";function Bn(r){return(r==null?void 0:r.relay)||{protocol:R2}}function Ps(r){const e=bv[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}function T2(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),a=r[s];t[n]=a}}),t}function Eh(r){if(!r.includes("wc:")){const c=ul(r);c!=null&&c.includes("wc:")&&(r=c)}r=r.includes("wc://")?r.replace("wc://",""):r,r=r.includes("wc:")?r.replace("wc:",""):r;const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,i=r.substring(0,e),s=r.substring(e+1,t).split("@"),n=typeof t<"u"?r.substring(t):"",a=new URLSearchParams(n),o={};a.forEach((c,h)=>{o[h]=c});const u=typeof o.methods=="string"?o.methods.split(","):void 0;return{protocol:i,topic:N2(s[0]),version:parseInt(s[1],10),symKey:o.symKey,relay:T2(o),methods:u,expiryTimestamp:o.expiryTimestamp?parseInt(o.expiryTimestamp,10):void 0}}function N2(r){return r.startsWith("//")?r.substring(2):r}function F2(r,e="-"){const t="relay",i={};return Object.keys(r).forEach(s=>{const n=s,a=t+e+n;r[n]&&(i[a]=r[n])}),i}function $h(r){const e=new URLSearchParams,t=F2(r.relay);Object.keys(t).sort().forEach(s=>{e.set(s,t[s])}),e.set("symKey",r.symKey),r.expiryTimestamp&&e.set("expiryTimestamp",r.expiryTimestamp.toString()),r.methods&&e.set("methods",r.methods.join(","));const i=e.toString();return`${r.protocol}:${r.topic}@${r.version}?${i}`}function yn(r,e,t){return`${r}?wc_ev=${t}&topic=${e}`}function Gi(r){const e=[];return r.forEach(t=>{const[i,s]=t.split(":");e.push(`${i}:${s}`)}),e}function q2(r){const e=[];return Object.values(r).forEach(t=>{e.push(...Gi(t.accounts))}),e}function B2(r,e){const t=[];return Object.values(r).forEach(i=>{Gi(i.accounts).includes(e)&&t.push(...i.methods)}),t}function j2(r,e){const t=[];return Object.values(r).forEach(i=>{Gi(i.accounts).includes(e)&&t.push(...i.events)}),t}function wc(r){return r.includes(":")}function As(r){return wc(r)?r.split(":")[0]:r}function L2(r){const e={};return r==null||r.forEach(t=>{var i;const[s,n]=t.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(t),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function Ih(r,e){e=e.map(i=>i.replace("did:pkh:",""));const t=L2(e);for(const[i,s]of Object.entries(t))s.methods?s.methods=Pn(s.methods,r):s.methods=r,s.events=["chainChanged","accountsChanged"];return t}const U2={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},z2={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function W(r,e){const{message:t,code:i}=z2[r];return{message:e?`${t} ${e}`:t,code:i}}function he(r,e){const{message:t,code:i}=U2[r];return{message:e?`${t} ${e}`:t,code:i}}function lr(r,e){return!!Array.isArray(r)}function js(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function wt(r){return typeof r>"u"}function Ze(r,e){return e&&wt(r)?!0:typeof r=="string"&&!!r.trim().length}function _c(r,e){return e&&wt(r)?!0:typeof r=="number"&&!isNaN(r)}function k2(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),s=Object.keys(t);let n=!0;return ti(s,i)?(i.forEach(a=>{const{accounts:o,methods:u,events:c}=r.namespaces[a],h=Gi(o),l=t[a];(!ti(rl(a,l),h)||!ti(l.methods,u)||!ti(l.events,c))&&(n=!1)}),n):!1}function jn(r){return Ze(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function H2(r){if(Ze(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&jn(t)}}return!1}function K2(r){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(Ze(r,!1)){if(e(r))return!0;const t=ul(r);return e(t)}}catch{}return!1}function V2(r){var e;return(e=r==null?void 0:r.proposer)==null?void 0:e.publicKey}function W2(r){return r==null?void 0:r.topic}function G2(r,e){let t=null;return Ze(r==null?void 0:r.publicKey,!1)||(t=W("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function Sh(r){let e=!0;return lr(r)?r.length&&(e=r.every(t=>Ze(t,!1))):e=!1,e}function J2(r,e,t){let i=null;return lr(e)&&e.length?e.forEach(s=>{i||jn(s)||(i=he("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):jn(r)||(i=he("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function Y2(r,e,t){let i=null;return Object.entries(r).forEach(([s,n])=>{if(i)return;const a=J2(s,rl(s,n),`${e} ${t}`);a&&(i=a)}),i}function X2(r,e){let t=null;return lr(r)?r.forEach(i=>{t||H2(i)||(t=he("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=he("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function Z2(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=X2(i==null?void 0:i.accounts,`${e} namespace`);s&&(t=s)}),t}function Q2(r,e){let t=null;return Sh(r==null?void 0:r.methods)?Sh(r==null?void 0:r.events)||(t=he("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=he("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function Rl(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=Q2(i,`${e}, namespace`);s&&(t=s)}),t}function ew(r,e,t){let i=null;if(r&&js(r)){const s=Rl(r,e);s&&(i=s);const n=Y2(r,e,t);n&&(i=n)}else i=W("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return i}function Ya(r,e){let t=null;if(r&&js(r)){const i=Rl(r,e);i&&(t=i);const s=Z2(r,e);s&&(t=s)}else t=W("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function Tl(r){return Ze(r.protocol,!0)}function tw(r,e){let t=!1;return r?r&&lr(r)&&r.length&&r.forEach(i=>{t=Tl(i)}):t=!0,t}function rw(r){return typeof r=="number"}function Dt(r){return typeof r<"u"&&typeof r!==null}function iw(r){return!(!r||typeof r!="object"||!r.code||!_c(r.code,!1)||!r.message||!Ze(r.message,!1))}function sw(r){return!(wt(r)||!Ze(r.method,!1))}function nw(r){return!(wt(r)||wt(r.result)&&wt(r.error)||!_c(r.id,!1)||!Ze(r.jsonrpc,!1))}function aw(r){return!(wt(r)||!Ze(r.name,!1))}function xh(r,e){return!(!jn(e)||!q2(r).includes(e))}function ow(r,e,t){return Ze(t,!1)?B2(r,e).includes(t):!1}function cw(r,e,t){return Ze(t,!1)?j2(r,e).includes(t):!1}function Dh(r,e,t){let i=null;const s=uw(r),n=hw(e),a=Object.keys(s),o=Object.keys(n),u=Ph(Object.keys(r)),c=Ph(Object.keys(e)),h=u.filter(l=>!c.includes(l));return h.length&&(i=W("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${h.toString()}
      Received: ${Object.keys(e).toString()}`)),ti(a,o)||(i=W("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${a.toString()}
      Approved: ${o.toString()}`)),Object.keys(e).forEach(l=>{if(!l.includes(":")||i)return;const g=Gi(e[l].accounts);g.includes(l)||(i=W("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${l}
        Required: ${l}
        Approved: ${g.toString()}`))}),a.forEach(l=>{i||(ti(s[l].methods,n[l].methods)?ti(s[l].events,n[l].events)||(i=W("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${l}`)):i=W("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${l}`))}),i}function uw(r){const e={};return Object.keys(r).forEach(t=>{var i;t.includes(":")?e[t]=r[t]:(i=r[t].chains)==null||i.forEach(s=>{e[s]={methods:r[t].methods,events:r[t].events}})}),e}function Ph(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function hw(r){const e={};return Object.keys(r).forEach(t=>{if(t.includes(":"))e[t]=r[t];else{const i=Gi(r[t].accounts);i==null||i.forEach(s=>{e[s]={accounts:r[t].accounts.filter(n=>n.includes(`${s}:`)),methods:r[t].methods,events:r[t].events}})}}),e}function fw(r,e){return _c(r,!1)&&r<=e.max&&r>=e.min}function Ah(){const r=Hs();return new Promise(e=>{switch(r){case Nt.browser:e(dw());break;case Nt.reactNative:e(lw());break;case Nt.node:e(pw());break;default:e(!0)}})}function dw(){return ks()&&(navigator==null?void 0:navigator.onLine)}async function lw(){if(Lr()&&typeof global<"u"&&global!=null&&global.NetInfo){const r=await(global==null?void 0:global.NetInfo.fetch());return r==null?void 0:r.isConnected}return!0}function pw(){return!0}function gw(r){switch(Hs()){case Nt.browser:bw(r);break;case Nt.reactNative:yw(r);break}}function bw(r){!Lr()&&ks()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)))}function yw(r){Lr()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>r(e==null?void 0:e.isConnected)))}const Xa={};let Es=class{static get(e){return Xa[e]}static set(e,t){Xa[e]=t}static delete(e){delete Xa[e]}};class ci{}let vw=class extends ci{constructor(e){super()}};const Oh=V.FIVE_SECONDS,Ji={pulse:"heartbeat_pulse"};let mw=class Nl extends vw{constructor(e){super(e),this.events=new qt.EventEmitter,this.interval=Oh,this.interval=(e==null?void 0:e.interval)||Oh}static async init(e){const t=new Nl(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),V.toMiliseconds(this.interval))}pulse(){this.events.emit(Ji.pulse)}};const ww=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,_w=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Ew=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function $w(r,e){if(r==="__proto__"||r==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Iw(r);return}return e}function Iw(r){console.warn(`[destr] Dropping "${r}" key to prevent prototype pollution.`)}function vn(r,e={}){if(typeof r!="string")return r;const t=r.trim();if(r[0]==='"'&&r.endsWith('"')&&!r.includes("\\"))return t.slice(1,-1);if(t.length<=9){const i=t.toLowerCase();if(i==="true")return!0;if(i==="false")return!1;if(i==="undefined")return;if(i==="null")return null;if(i==="nan")return Number.NaN;if(i==="infinity")return Number.POSITIVE_INFINITY;if(i==="-infinity")return Number.NEGATIVE_INFINITY}if(!Ew.test(r)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return r}try{if(ww.test(r)||_w.test(r)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(r,$w)}return JSON.parse(r)}catch(i){if(e.strict)throw i;return r}}function Sw(r){return!r||typeof r.then!="function"?Promise.resolve(r):r}function at(r,...e){try{return Sw(r(...e))}catch(t){return Promise.reject(t)}}function xw(r){const e=typeof r;return r===null||e!=="object"&&e!=="function"}function Dw(r){const e=Object.getPrototypeOf(r);return!e||e.isPrototypeOf(Object)}function Mn(r){if(xw(r))return String(r);if(Dw(r)||Array.isArray(r))return JSON.stringify(r);if(typeof r.toJSON=="function")return Mn(r.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const To="base64:";function Pw(r){return typeof r=="string"?r:To+Mw(r)}function Aw(r){return typeof r!="string"||!r.startsWith(To)?r:Ow(r.slice(To.length))}function Ow(r){return globalThis.Buffer?Buffer.from(r,"base64"):Uint8Array.from(globalThis.atob(r),e=>e.codePointAt(0))}function Mw(r){return globalThis.Buffer?Buffer.from(r).toString("base64"):globalThis.btoa(String.fromCodePoint(...r))}function xt(r){var e;return r&&((e=r.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Cw(...r){return xt(r.join(":"))}function mn(r){return r=xt(r),r?r+":":""}function Rw(r,e){if(e===void 0)return!0;let t=0,i=r.indexOf(":");for(;i>-1;)t++,i=r.indexOf(":",i+1);return t<=e}function Tw(r,e){return e?r.startsWith(e)&&r[r.length-1]!=="$":r[r.length-1]!=="$"}const Nw="memory",Fw=()=>{const r=new Map;return{name:Nw,getInstance:()=>r,hasItem(e){return r.has(e)},getItem(e){return r.get(e)??null},getItemRaw(e){return r.get(e)??null},setItem(e,t){r.set(e,t)},setItemRaw(e,t){r.set(e,t)},removeItem(e){r.delete(e)},getKeys(){return[...r.keys()]},clear(){r.clear()},dispose(){r.clear()}}};function qw(r={}){const e={mounts:{"":r.driver||Fw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=c=>{for(const h of e.mountpoints)if(c.startsWith(h))return{base:h,relativeKey:c.slice(h.length),driver:e.mounts[h]};return{base:"",relativeKey:c,driver:e.mounts[""]}},i=(c,h)=>e.mountpoints.filter(l=>l.startsWith(c)||h&&c.startsWith(l)).map(l=>({relativeBase:c.length>l.length?c.slice(l.length):void 0,mountpoint:l,driver:e.mounts[l]})),s=(c,h)=>{if(e.watching){h=xt(h);for(const l of e.watchListeners)l(c,h)}},n=async()=>{if(!e.watching){e.watching=!0;for(const c in e.mounts)e.unwatch[c]=await Mh(e.mounts[c],s,c)}},a=async()=>{if(e.watching){for(const c in e.unwatch)await e.unwatch[c]();e.unwatch={},e.watching=!1}},o=(c,h,l)=>{const g=new Map,m=y=>{let _=g.get(y.base);return _||(_={driver:y.driver,base:y.base,items:[]},g.set(y.base,_)),_};for(const y of c){const _=typeof y=="string",O=xt(_?y:y.key),x=_?void 0:y.value,D=_||!y.options?h:{...h,...y.options},M=t(O);m(M).items.push({key:O,value:x,relativeKey:M.relativeKey,options:D})}return Promise.all([...g.values()].map(y=>l(y))).then(y=>y.flat())},u={hasItem(c,h={}){c=xt(c);const{relativeKey:l,driver:g}=t(c);return at(g.hasItem,l,h)},getItem(c,h={}){c=xt(c);const{relativeKey:l,driver:g}=t(c);return at(g.getItem,l,h).then(m=>vn(m))},getItems(c,h={}){return o(c,h,l=>l.driver.getItems?at(l.driver.getItems,l.items.map(g=>({key:g.relativeKey,options:g.options})),h).then(g=>g.map(m=>({key:Cw(l.base,m.key),value:vn(m.value)}))):Promise.all(l.items.map(g=>at(l.driver.getItem,g.relativeKey,g.options).then(m=>({key:g.key,value:vn(m)})))))},getItemRaw(c,h={}){c=xt(c);const{relativeKey:l,driver:g}=t(c);return g.getItemRaw?at(g.getItemRaw,l,h):at(g.getItem,l,h).then(m=>Aw(m))},async setItem(c,h,l={}){if(h===void 0)return u.removeItem(c);c=xt(c);const{relativeKey:g,driver:m}=t(c);m.setItem&&(await at(m.setItem,g,Mn(h),l),m.watch||s("update",c))},async setItems(c,h){await o(c,h,async l=>{if(l.driver.setItems)return at(l.driver.setItems,l.items.map(g=>({key:g.relativeKey,value:Mn(g.value),options:g.options})),h);l.driver.setItem&&await Promise.all(l.items.map(g=>at(l.driver.setItem,g.relativeKey,Mn(g.value),g.options)))})},async setItemRaw(c,h,l={}){if(h===void 0)return u.removeItem(c,l);c=xt(c);const{relativeKey:g,driver:m}=t(c);if(m.setItemRaw)await at(m.setItemRaw,g,h,l);else if(m.setItem)await at(m.setItem,g,Pw(h),l);else return;m.watch||s("update",c)},async removeItem(c,h={}){typeof h=="boolean"&&(h={removeMeta:h}),c=xt(c);const{relativeKey:l,driver:g}=t(c);g.removeItem&&(await at(g.removeItem,l,h),(h.removeMeta||h.removeMata)&&await at(g.removeItem,l+"$",h),g.watch||s("remove",c))},async getMeta(c,h={}){typeof h=="boolean"&&(h={nativeOnly:h}),c=xt(c);const{relativeKey:l,driver:g}=t(c),m=Object.create(null);if(g.getMeta&&Object.assign(m,await at(g.getMeta,l,h)),!h.nativeOnly){const y=await at(g.getItem,l+"$",h).then(_=>vn(_));y&&typeof y=="object"&&(typeof y.atime=="string"&&(y.atime=new Date(y.atime)),typeof y.mtime=="string"&&(y.mtime=new Date(y.mtime)),Object.assign(m,y))}return m},setMeta(c,h,l={}){return this.setItem(c+"$",h,l)},removeMeta(c,h={}){return this.removeItem(c+"$",h)},async getKeys(c,h={}){var O;c=mn(c);const l=i(c,!0);let g=[];const m=[];let y=!0;for(const x of l){(O=x.driver.flags)!=null&&O.maxDepth||(y=!1);const D=await at(x.driver.getKeys,x.relativeBase,h);for(const M of D){const R=x.mountpoint+xt(M);g.some(N=>R.startsWith(N))||m.push(R)}g=[x.mountpoint,...g.filter(M=>!M.startsWith(x.mountpoint))]}const _=h.maxDepth!==void 0&&!y;return m.filter(x=>(!_||Rw(x,h.maxDepth))&&Tw(x,c))},async clear(c,h={}){c=mn(c),await Promise.all(i(c,!1).map(async l=>{if(l.driver.clear)return at(l.driver.clear,l.relativeBase,h);if(l.driver.removeItem){const g=await l.driver.getKeys(l.relativeBase||"",h);return Promise.all(g.map(m=>l.driver.removeItem(m,h)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(c=>Ch(c)))},async watch(c){return await n(),e.watchListeners.push(c),async()=>{e.watchListeners=e.watchListeners.filter(h=>h!==c),e.watchListeners.length===0&&await a()}},async unwatch(){e.watchListeners=[],await a()},mount(c,h){if(c=mn(c),c&&e.mounts[c])throw new Error(`already mounted at ${c}`);return c&&(e.mountpoints.push(c),e.mountpoints.sort((l,g)=>g.length-l.length)),e.mounts[c]=h,e.watching&&Promise.resolve(Mh(h,s,c)).then(l=>{e.unwatch[c]=l}).catch(console.error),u},async unmount(c,h=!0){var l,g;c=mn(c),!(!c||!e.mounts[c])&&(e.watching&&c in e.unwatch&&((g=(l=e.unwatch)[c])==null||g.call(l),delete e.unwatch[c]),h&&await Ch(e.mounts[c]),e.mountpoints=e.mountpoints.filter(m=>m!==c),delete e.mounts[c])},getMount(c=""){c=xt(c)+":";const h=t(c);return{driver:h.driver,base:h.base}},getMounts(c="",h={}){return c=xt(c),i(c,h.parents).map(g=>({driver:g.driver,base:g.mountpoint}))},keys:(c,h={})=>u.getKeys(c,h),get:(c,h={})=>u.getItem(c,h),set:(c,h,l={})=>u.setItem(c,h,l),has:(c,h={})=>u.hasItem(c,h),del:(c,h={})=>u.removeItem(c,h),remove:(c,h={})=>u.removeItem(c,h)};return u}function Mh(r,e,t){return r.watch?r.watch((i,s)=>e(i,t+s)):()=>{}}async function Ch(r){typeof r.dispose=="function"&&await at(r.dispose)}function ui(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function Fl(r,e){const t=indexedDB.open(r);t.onupgradeneeded=()=>t.result.createObjectStore(e);const i=ui(t);return(s,n)=>i.then(a=>n(a.transaction(e,s).objectStore(e)))}let Za;function Gs(){return Za||(Za=Fl("keyval-store","keyval")),Za}function Rh(r,e=Gs()){return e("readonly",t=>ui(t.get(r)))}function Bw(r,e,t=Gs()){return t("readwrite",i=>(i.put(e,r),ui(i.transaction)))}function jw(r,e=Gs()){return e("readwrite",t=>(t.delete(r),ui(t.transaction)))}function Lw(r=Gs()){return r("readwrite",e=>(e.clear(),ui(e.transaction)))}function Uw(r,e){return r.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},ui(r.transaction)}function zw(r=Gs()){return r("readonly",e=>{if(e.getAllKeys)return ui(e.getAllKeys());const t=[];return Uw(e,i=>t.push(i.key)).then(()=>t)})}const kw="idb-keyval";var Hw=(r={})=>{const e=r.base&&r.base.length>0?`${r.base}:`:"",t=s=>e+s;let i;return r.dbName&&r.storeName&&(i=Fl(r.dbName,r.storeName)),{name:kw,options:r,async hasItem(s){return!(typeof await Rh(t(s),i)>"u")},async getItem(s){return await Rh(t(s),i)??null},setItem(s,n){return Bw(t(s),n,i)},removeItem(s){return jw(t(s),i)},getKeys(){return zw(i)},clear(){return Lw(i)}}};const Kw="WALLET_CONNECT_V2_INDEXED_DB",Vw="keyvaluestorage";let Ww=class{constructor(){this.indexedDb=qw({driver:Hw({dbName:Kw,storeName:Vw})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,Sr(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Qa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Cn={exports:{}};(function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Qa<"u"&&Qa.localStorage?Cn.exports=Qa.localStorage:typeof window<"u"&&window.localStorage?Cn.exports=window.localStorage:Cn.exports=new e})();function Gw(r){var e;return[r[0],ni((e=r[1])!=null?e:"")]}let Jw=class{constructor(){this.localStorage=Cn.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Gw)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return ni(t)}async setItem(e,t){this.localStorage.setItem(e,Sr(t))}async removeItem(e){this.localStorage.removeItem(e)}};const Yw="wc_storage_version",Th=1,Xw=async(r,e,t)=>{const i=Yw,s=await e.getItem(i);if(s&&s>=Th){t(e);return}const n=await r.getKeys();if(!n.length){t(e);return}const a=[];for(;n.length;){const o=n.shift();if(!o)continue;const u=o.toLowerCase();if(u.includes("wc@")||u.includes("walletconnect")||u.includes("wc_")||u.includes("wallet_connect")){const c=await r.getItem(o);await e.setItem(o,c),a.push(o)}}await e.setItem(i,Th),t(e),Zw(r,a)},Zw=async(r,e)=>{e.length&&e.forEach(async t=>{await r.removeItem(t)})};let Qw=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new Jw;this.storage=e;try{const t=new Ww;Xw(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var eo,Nh;function e3(){if(Nh)return eo;Nh=1;function r(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}eo=e;function e(t,i,s){var n=s&&s.stringify||r,a=1;if(typeof t=="object"&&t!==null){var o=i.length+a;if(o===1)return t;var u=new Array(o);u[0]=n(t);for(var c=1;c<o;c++)u[c]=n(i[c]);return u.join(" ")}if(typeof t!="string")return t;var h=i.length;if(h===0)return t;for(var l="",g=1-a,m=-1,y=t&&t.length||0,_=0;_<y;){if(t.charCodeAt(_)===37&&_+1<y){switch(m=m>-1?m:0,t.charCodeAt(_+1)){case 100:case 102:if(g>=h||i[g]==null)break;m<_&&(l+=t.slice(m,_)),l+=Number(i[g]),m=_+2,_++;break;case 105:if(g>=h||i[g]==null)break;m<_&&(l+=t.slice(m,_)),l+=Math.floor(Number(i[g])),m=_+2,_++;break;case 79:case 111:case 106:if(g>=h||i[g]===void 0)break;m<_&&(l+=t.slice(m,_));var O=typeof i[g];if(O==="string"){l+="'"+i[g]+"'",m=_+2,_++;break}if(O==="function"){l+=i[g].name||"<anonymous>",m=_+2,_++;break}l+=n(i[g]),m=_+2,_++;break;case 115:if(g>=h)break;m<_&&(l+=t.slice(m,_)),l+=String(i[g]),m=_+2,_++;break;case 37:m<_&&(l+=t.slice(m,_)),l+="%",m=_+2,_++,g--;break}++g}++_}return m===-1?t:(m<y&&(l+=t.slice(m)),l)}return eo}var to,Fh;function t3(){if(Fh)return to;Fh=1;const r=e3();to=s;const e=N().console||{},t={mapHttpRequest:y,mapHttpResponse:y,wrapRequestSerializer:_,wrapResponseSerializer:_,wrapErrorSerializer:_,req:y,res:y,err:g};function i(C,q){return Array.isArray(C)?C.filter(function(F){return F!=="!stdSerializers.err"}):C===!0?Object.keys(q):!1}function s(C){C=C||{},C.browser=C.browser||{};const q=C.browser.transmit;if(q&&typeof q.send!="function")throw Error("pino: transmit option must have a send function");const B=C.browser.write||e;C.browser.write&&(C.browser.asObject=!0);const F=C.serializers||{},H=i(C.browser.serialize,F);let S=C.browser.serialize;Array.isArray(C.browser.serialize)&&C.browser.serialize.indexOf("!stdSerializers.err")>-1&&(S=!1);const f=["error","fatal","warn","info","debug","trace"];typeof B=="function"&&(B.error=B.fatal=B.warn=B.info=B.debug=B.trace=B),C.enabled===!1&&(C.level="silent");const b=C.level||"info",w=Object.create(B);w.log||(w.log=O),Object.defineProperty(w,"levelVal",{get:v}),Object.defineProperty(w,"level",{get:I,set:P});const p={transmit:q,serialize:H,asObject:C.browser.asObject,levels:f,timestamp:m(C)};w.levels=s.levels,w.level=b,w.setMaxListeners=w.getMaxListeners=w.emit=w.addListener=w.on=w.prependListener=w.once=w.prependOnceListener=w.removeListener=w.removeAllListeners=w.listeners=w.listenerCount=w.eventNames=w.write=w.flush=O,w.serializers=F,w._serialize=H,w._stdErrSerialize=S,w.child=E,q&&(w._logEvent=l());function v(){return this.level==="silent"?1/0:this.levels.values[this.level]}function I(){return this._level}function P(d){if(d!=="silent"&&!this.levels.values[d])throw Error("unknown level "+d);this._level=d,n(p,w,"error","log"),n(p,w,"fatal","error"),n(p,w,"warn","error"),n(p,w,"info","log"),n(p,w,"debug","log"),n(p,w,"trace","log")}function E(d,$){if(!d)throw new Error("missing bindings for child Pino");$=$||{},H&&d.serializers&&($.serializers=d.serializers);const j=$.serializers;if(H&&j){var U=Object.assign({},F,j),L=C.browser.serialize===!0?Object.keys(U):H;delete d.serializers,u([d],L,U,this._stdErrSerialize)}function z(G){this._childLevel=(G._childLevel|0)+1,this.error=c(G,d,"error"),this.fatal=c(G,d,"fatal"),this.warn=c(G,d,"warn"),this.info=c(G,d,"info"),this.debug=c(G,d,"debug"),this.trace=c(G,d,"trace"),U&&(this.serializers=U,this._serialize=L),q&&(this._logEvent=l([].concat(G._logEvent.bindings,d)))}return z.prototype=this,new z(this)}return w}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:x,epochTime:D,unixTime:M,isoTime:R});function n(C,q,B,F){const H=Object.getPrototypeOf(q);q[B]=q.levelVal>q.levels.values[B]?O:H[B]?H[B]:e[B]||e[F]||O,a(C,q,B)}function a(C,q,B){!C.transmit&&q[B]===O||(q[B]=function(F){return function(){const S=C.timestamp(),f=new Array(arguments.length),b=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var w=0;w<f.length;w++)f[w]=arguments[w];if(C.serialize&&!C.asObject&&u(f,this._serialize,this.serializers,this._stdErrSerialize),C.asObject?F.call(b,o(this,B,f,S)):F.apply(b,f),C.transmit){const p=C.transmit.level||q.level,v=s.levels.values[p],I=s.levels.values[B];if(I<v)return;h(this,{ts:S,methodLevel:B,methodValue:I,transmitValue:s.levels.values[C.transmit.level||q.level],send:C.transmit.send,val:q.levelVal},f)}}}(q[B]))}function o(C,q,B,F){C._serialize&&u(B,C._serialize,C.serializers,C._stdErrSerialize);const H=B.slice();let S=H[0];const f={};F&&(f.time=F),f.level=s.levels.values[q];let b=(C._childLevel|0)+1;if(b<1&&(b=1),S!==null&&typeof S=="object"){for(;b--&&typeof H[0]=="object";)Object.assign(f,H.shift());S=H.length?r(H.shift(),H):void 0}else typeof S=="string"&&(S=r(H.shift(),H));return S!==void 0&&(f.msg=S),f}function u(C,q,B,F){for(const H in C)if(F&&C[H]instanceof Error)C[H]=s.stdSerializers.err(C[H]);else if(typeof C[H]=="object"&&!Array.isArray(C[H]))for(const S in C[H])q&&q.indexOf(S)>-1&&S in B&&(C[H][S]=B[S](C[H][S]))}function c(C,q,B){return function(){const F=new Array(1+arguments.length);F[0]=q;for(var H=1;H<F.length;H++)F[H]=arguments[H-1];return C[B].apply(this,F)}}function h(C,q,B){const F=q.send,H=q.ts,S=q.methodLevel,f=q.methodValue,b=q.val,w=C._logEvent.bindings;u(B,C._serialize||Object.keys(C.serializers),C.serializers,C._stdErrSerialize===void 0?!0:C._stdErrSerialize),C._logEvent.ts=H,C._logEvent.messages=B.filter(function(p){return w.indexOf(p)===-1}),C._logEvent.level.label=S,C._logEvent.level.value=f,F(S,C._logEvent,b),C._logEvent=l(w)}function l(C){return{ts:0,messages:[],bindings:C||[],level:{label:"",value:0}}}function g(C){const q={type:C.constructor.name,msg:C.message,stack:C.stack};for(const B in C)q[B]===void 0&&(q[B]=C[B]);return q}function m(C){return typeof C.timestamp=="function"?C.timestamp:C.timestamp===!1?x:D}function y(){return{}}function _(C){return C}function O(){}function x(){return!1}function D(){return Date.now()}function M(){return Math.round(Date.now()/1e3)}function R(){return new Date(Date.now()).toISOString()}function N(){function C(q){return typeof q<"u"&&q}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return C(self)||C(window)||C(this)||{}}}return to}var Ri=t3();const Js=Hn(Ri),r3={level:"info"},Ys="custom_context",Ec=1e3*1024;let i3=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},qh=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new i3(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;t!==null;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}},ql=class{constructor(e,t=Ec){this.level=e??"error",this.levelValue=Ri.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new qh(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===Ri.levels.values.error?console.error(e):t===Ri.levels.values.warn?console.warn(e):t===Ri.levels.values.debug?console.debug(e):t===Ri.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Sr({timestamp:new Date().toISOString(),log:e}));const t=typeof e=="string"?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new qh(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push(Sr({extraMetadata:e})),new Blob(t,{type:"application/json"})}},s3=class{constructor(e,t=Ec){this.baseChunkLogger=new ql(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=t,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}},n3=class{constructor(e,t=Ec){this.baseChunkLogger=new ql(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var a3=Object.defineProperty,o3=Object.defineProperties,c3=Object.getOwnPropertyDescriptors,Bh=Object.getOwnPropertySymbols,u3=Object.prototype.hasOwnProperty,h3=Object.prototype.propertyIsEnumerable,jh=(r,e,t)=>e in r?a3(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ln=(r,e)=>{for(var t in e||(e={}))u3.call(e,t)&&jh(r,t,e[t]);if(Bh)for(var t of Bh(e))h3.call(e,t)&&jh(r,t,e[t]);return r},Un=(r,e)=>o3(r,c3(e));function Qn(r){return Un(Ln({},r),{level:(r==null?void 0:r.level)||r3.level})}function f3(r,e=Ys){return r[e]||""}function d3(r,e,t=Ys){return r[t]=e,r}function At(r,e=Ys){let t="";return typeof r.bindings>"u"?t=f3(r,e):t=r.bindings().context||"",t}function l3(r,e,t=Ys){const i=At(r,t);return i.trim()?`${i}/${e}`:e}function Et(r,e,t=Ys){const i=l3(r,e,t),s=r.child({context:i});return d3(s,i,t)}function p3(r){var e,t;const i=new s3((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Js(Un(Ln({},r.opts),{level:"trace",browser:Un(Ln({},(t=r.opts)==null?void 0:t.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function g3(r){var e;const t=new n3((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Js(Un(Ln({},r.opts),{level:"trace"}),t),chunkLoggerController:t}}function b3(r){return typeof r.loggerOverride<"u"&&typeof r.loggerOverride!="string"?{logger:r.loggerOverride,chunkLoggerController:null}:typeof window<"u"?p3(r):g3(r)}var y3=Object.defineProperty,v3=(r,e,t)=>e in r?y3(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Lh=(r,e,t)=>v3(r,typeof e!="symbol"?e+"":e,t);let m3=class extends ci{constructor(e){super(),this.opts=e,Lh(this,"protocol","wc"),Lh(this,"version",2)}};var w3=Object.defineProperty,_3=(r,e,t)=>e in r?w3(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,E3=(r,e,t)=>_3(r,e+"",t);let $3=class extends ci{constructor(e,t){super(),this.core=e,this.logger=t,E3(this,"records",new Map)}},I3=class{constructor(e,t){this.logger=e,this.core=t}},S3=class extends ci{constructor(e,t){super(),this.relayer=e,this.logger=t}},x3=class extends ci{constructor(e){super()}},D3=class{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}},P3=class extends ci{constructor(e,t){super(),this.relayer=e,this.logger=t}},A3=class extends ci{constructor(e,t){super(),this.core=e,this.logger=t}},O3=class{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}},M3=class{constructor(e,t){this.projectId=e,this.logger=t}},C3=class{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}};var R3=Object.defineProperty,T3=(r,e,t)=>e in r?R3(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Uh=(r,e,t)=>T3(r,typeof e!="symbol"?e+"":e,t);let N3=class{constructor(e){this.opts=e,Uh(this,"protocol","wc"),Uh(this,"version",2)}},F3=class{constructor(e){this.client=e}};const q3="PARSE_ERROR",B3="INVALID_REQUEST",j3="METHOD_NOT_FOUND",L3="INVALID_PARAMS",Bl="INTERNAL_ERROR",$c="SERVER_ERROR",U3=[-32700,-32600,-32601,-32602,-32603],Cs={[q3]:{code:-32700,message:"Parse error"},[B3]:{code:-32600,message:"Invalid Request"},[j3]:{code:-32601,message:"Method not found"},[L3]:{code:-32602,message:"Invalid params"},[Bl]:{code:-32603,message:"Internal error"},[$c]:{code:-32e3,message:"Server error"}},jl=$c;function z3(r){return U3.includes(r)}function zh(r){return Object.keys(Cs).includes(r)?Cs[r]:Cs[jl]}function k3(r){const e=Object.values(Cs).find(t=>t.code===r);return e||Cs[jl]}function Ll(r,e,t){return r.message.includes("getaddrinfo ENOTFOUND")||r.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):r}var ro={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var No=function(r,e){return No=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},No(r,e)};function H3(r,e){No(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Fo=function(){return Fo=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Fo.apply(this,arguments)};function K3(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function V3(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var o=r.length-1;o>=0;o--)(a=r[o])&&(n=(s<3?a(n):s>3?a(e,t,n):a(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function W3(r,e){return function(t,i){e(t,i,r)}}function G3(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function J3(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{c(i.next(h))}catch(l){a(l)}}function u(h){try{c(i.throw(h))}catch(l){a(l)}}function c(h){h.done?n(h.value):s(h.value).then(o,u)}c((i=i.apply(r,e||[])).next())})}function Y3(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(c){return function(h){return u([c,h])}}function u(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=c[0]&2?s.return:c[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,c[1])).done)return n;switch(s=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(h){c=[6,h],s=0}finally{i=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function X3(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function Z3(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function qo(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ul(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],a;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}return n}function Q3(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Ul(arguments[e]));return r}function e6(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],a=0,o=n.length;a<o;a++,s++)i[s]=n[a];return i}function Ls(r){return this instanceof Ls?(this.v=r,this):new Ls(r)}function t6(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(g){i[g]&&(s[g]=function(m){return new Promise(function(y,_){n.push([g,m,y,_])>1||o(g,m)})})}function o(g,m){try{u(i[g](m))}catch(y){l(n[0][3],y)}}function u(g){g.value instanceof Ls?Promise.resolve(g.value.v).then(c,h):l(n[0][2],g)}function c(g){o("next",g)}function h(g){o("throw",g)}function l(g,m){g(m),n.shift(),n.length&&o(n[0][0],n[0][1])}}function r6(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(a){return(t=!t)?{value:Ls(r[s](a)),done:s==="return"}:n?n(a):a}:n}}function i6(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof qo=="function"?qo(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(a){return new Promise(function(o,u){a=r[n](a),s(o,u,a.done,a.value)})}}function s(n,a,o,u){Promise.resolve(u).then(function(c){n({value:c,done:o})},a)}}function s6(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function n6(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function a6(r){return r&&r.__esModule?r:{default:r}}function o6(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function c6(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const u6=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Fo},__asyncDelegator:r6,__asyncGenerator:t6,__asyncValues:i6,__await:Ls,__awaiter:J3,__classPrivateFieldGet:o6,__classPrivateFieldSet:c6,__createBinding:X3,__decorate:V3,__exportStar:Z3,__extends:H3,__generator:Y3,__importDefault:a6,__importStar:n6,__makeTemplateObject:s6,__metadata:G3,__param:W3,__read:Ul,__rest:K3,__spread:Q3,__spreadArrays:e6,__values:qo},Symbol.toStringTag,{value:"Module"})),h6=sd(u6);var wr={},kh;function f6(){if(kh)return wr;kh=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.isBrowserCryptoAvailable=wr.getSubtleCrypto=wr.getBrowerCrypto=void 0;function r(){return(Pt===null||Pt===void 0?void 0:Pt.crypto)||(Pt===null||Pt===void 0?void 0:Pt.msCrypto)||{}}wr.getBrowerCrypto=r;function e(){const i=r();return i.subtle||i.webkitSubtle}wr.getSubtleCrypto=e;function t(){return!!r()&&!!e()}return wr.isBrowserCryptoAvailable=t,wr}var _r={},Hh;function d6(){if(Hh)return _r;Hh=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.isBrowser=_r.isNode=_r.isReactNative=void 0;function r(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}_r.isReactNative=r;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}_r.isNode=e;function t(){return!r()&&!e()}return _r.isBrowser=t,_r}var Kh;function l6(){return Kh||(Kh=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=h6;e.__exportStar(f6(),r),e.__exportStar(d6(),r)}(ro)),ro}var p6=l6();function fr(r=3){const e=Date.now()*Math.pow(10,r),t=Math.floor(Math.random()*Math.pow(10,r));return e+t}function ri(r=6){return BigInt(fr(r))}function Br(r,e,t){return{id:t||fr(),jsonrpc:"2.0",method:r,params:e}}function ea(r,e){return{id:r,jsonrpc:"2.0",result:e}}function ta(r,e,t){return{id:r,jsonrpc:"2.0",error:g6(e)}}function g6(r,e){return typeof r>"u"?zh(Bl):(typeof r=="string"&&(r=Object.assign(Object.assign({},zh($c)),{message:r})),z3(r.code)&&(r=k3(r.code)),r)}class b6{}class y6 extends b6{constructor(){super()}}class v6 extends y6{constructor(e){super()}}const m6="^https?:",w6="^wss?:";function _6(r){const e=r.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function zl(r,e){const t=_6(r);return typeof t>"u"?!1:new RegExp(e).test(t)}function Vh(r){return zl(r,m6)}function Wh(r){return zl(r,w6)}function E6(r){return new RegExp("wss?://localhost(:d{2,5})?").test(r)}function kl(r){return typeof r=="object"&&"id"in r&&"jsonrpc"in r&&r.jsonrpc==="2.0"}function Ic(r){return kl(r)&&"method"in r}function ra(r){return kl(r)&&(dr(r)||Ht(r))}function dr(r){return"result"in r}function Ht(r){return"error"in r}let Wt=class extends v6{constructor(e){super(e),this.events=new qt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Br(e.method,e.params||[],e.id||ri().toString()),t)}async requestStrict(e,t){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{Ht(n)?s(n.error):i(n.result)});try{await this.connection.send(e,t)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),ra(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const $6=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),I6=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Gh=r=>r.split("?")[0],Jh=10,S6=$6();let x6=class{constructor(e){if(this.url=e,this.events=new qt.EventEmitter,this.registering=!1,!Wh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Sr(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Wh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const s=p6.isReactNative()?void 0:{rejectUnauthorized:!E6(e)},n=new S6(e,[],s);I6()?n.onerror=a=>{const o=a;i(this.emitError(o.error))}:n.on("error",a=>{i(this.emitError(a))}),n.onopen=()=>{this.onOpen(n),t(n)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?ni(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),n=ta(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return Ll(e,Gh(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Jh&&this.events.setMaxListeners(Jh)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Gh(this.url)}`));return this.events.emit("register_error",t),t}};var Os={exports:{}};Os.exports;var Yh;function D6(){return Yh||(Yh=1,function(r,e){var t=200,i="__lodash_hash_undefined__",s=1,n=2,a=9007199254740991,o="[object Arguments]",u="[object Array]",c="[object AsyncFunction]",h="[object Boolean]",l="[object Date]",g="[object Error]",m="[object Function]",y="[object GeneratorFunction]",_="[object Map]",O="[object Number]",x="[object Null]",D="[object Object]",M="[object Promise]",R="[object Proxy]",N="[object RegExp]",C="[object Set]",q="[object String]",B="[object Symbol]",F="[object Undefined]",H="[object WeakMap]",S="[object ArrayBuffer]",f="[object DataView]",b="[object Float32Array]",w="[object Float64Array]",p="[object Int8Array]",v="[object Int16Array]",I="[object Int32Array]",P="[object Uint8Array]",E="[object Uint8ClampedArray]",d="[object Uint16Array]",$="[object Uint32Array]",j=/[\\^$.*+?()[\]{}|]/g,U=/^\[object .+?Constructor\]$/,L=/^(?:0|[1-9]\d*)$/,z={};z[b]=z[w]=z[p]=z[v]=z[I]=z[P]=z[E]=z[d]=z[$]=!0,z[o]=z[u]=z[S]=z[h]=z[f]=z[l]=z[g]=z[m]=z[_]=z[O]=z[D]=z[N]=z[C]=z[q]=z[H]=!1;var G=typeof Pt=="object"&&Pt&&Pt.Object===Object&&Pt,X=typeof self=="object"&&self&&self.Object===Object&&self,Q=G||X||Function("return this")(),Y=e&&!e.nodeType&&e,ee=Y&&!0&&r&&!r.nodeType&&r,ut=ee&&ee.exports===Y,ne=ut&&G.process,fe=function(){try{return ne&&ne.binding&&ne.binding("util")}catch{}}(),Bt=fe&&fe.isTypedArray;function be(A,T){for(var k=-1,J=A==null?0:A.length,Se=0,Z=[];++k<J;){var Xe=A[k];T(Xe,k,A)&&(Z[Se++]=Xe)}return Z}function Pe(A,T){for(var k=-1,J=T.length,Se=A.length;++k<J;)A[Se+k]=T[k];return A}function li(A,T){for(var k=-1,J=A==null?0:A.length;++k<J;)if(T(A[k],k,A))return!0;return!1}function Ae(A,T){for(var k=-1,J=Array(A);++k<A;)J[k]=T(k);return J}function _e(A){return function(T){return A(T)}}function Ur(A,T){return A.has(T)}function ye(A,T){return A==null?void 0:A[T]}function Ee(A){var T=-1,k=Array(A.size);return A.forEach(function(J,Se){k[++T]=[Se,J]}),k}function zr(A,T){return function(k){return A(T(k))}}function $e(A){var T=-1,k=Array(A.size);return A.forEach(function(J){k[++T]=J}),k}var Ie=Array.prototype,kr=Function.prototype,pe=Object.prototype,ve=Q["__core-js_shared__"],Hr=kr.toString,se=pe.hasOwnProperty,Te=function(){var A=/[^.]+$/.exec(ve&&ve.keys&&ve.keys.IE_PROTO||"");return A?"Symbol(src)_1."+A:""}(),Xi=pe.toString,ze=RegExp("^"+Hr.call(se).replace(j,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ne=ut?Q.Buffer:void 0,Kr=Q.Symbol,Fe=Q.Uint8Array,qe=pe.propertyIsEnumerable,Qs=Ie.splice,de=Kr?Kr.toStringTag:void 0,Be=Object.getOwnPropertySymbols,en=Ne?Ne.isBuffer:void 0,ke=zr(Object.keys,Object),Oe=gi(Q,"DataView"),Dr=gi(Q,"Map"),Me=gi(Q,"Promise"),Ce=gi(Q,"Set"),pi=gi(Q,"WeakMap"),me=gi(Object,"create"),He=Vr(Oe),tn=Vr(Dr),Ke=Vr(Me),Ve=Vr(Ce),rn=Vr(pi),je=Kr?Kr.prototype:void 0,Re=je?je.valueOf:void 0;function sr(A){var T=-1,k=A==null?0:A.length;for(this.clear();++T<k;){var J=A[T];this.set(J[0],J[1])}}function We(){this.__data__=me?me(null):{},this.size=0}function Ge(A){var T=this.has(A)&&delete this.__data__[A];return this.size-=T?1:0,T}function sn(A){var T=this.__data__;if(me){var k=T[A];return k===i?void 0:k}return se.call(T,A)?T[A]:void 0}function Je(A){var T=this.__data__;return me?T[A]!==void 0:se.call(T,A)}function Ye(A,T){var k=this.__data__;return this.size+=this.has(A)?0:1,k[A]=me&&T===void 0?i:T,this}sr.prototype.clear=We,sr.prototype.delete=Ge,sr.prototype.get=sn,sr.prototype.has=Je,sr.prototype.set=Ye;function Ot(A){var T=-1,k=A==null?0:A.length;for(this.clear();++T<k;){var J=A[T];this.set(J[0],J[1])}}function Zi(){this.__data__=[],this.size=0}function Qi(A){var T=this.__data__,k=nn(T,A);if(k<0)return!1;var J=T.length-1;return k==J?T.pop():Qs.call(T,k,1),--this.size,!0}function es(A){var T=this.__data__,k=nn(T,A);return k<0?void 0:T[k][1]}function ts(A){return nn(this.__data__,A)>-1}function rs(A,T){var k=this.__data__,J=nn(k,A);return J<0?(++this.size,k.push([A,T])):k[J][1]=T,this}Ot.prototype.clear=Zi,Ot.prototype.delete=Qi,Ot.prototype.get=es,Ot.prototype.has=ts,Ot.prototype.set=rs;function Jt(A){var T=-1,k=A==null?0:A.length;for(this.clear();++T<k;){var J=A[T];this.set(J[0],J[1])}}function is(){this.size=0,this.__data__={hash:new sr,map:new(Dr||Ot),string:new sr}}function ss(A){var T=an(this,A).delete(A);return this.size-=T?1:0,T}function ns(A){return an(this,A).get(A)}function as(A){return an(this,A).has(A)}function os(A,T){var k=an(this,A),J=k.size;return k.set(A,T),this.size+=k.size==J?0:1,this}Jt.prototype.clear=is,Jt.prototype.delete=ss,Jt.prototype.get=ns,Jt.prototype.has=as,Jt.prototype.set=os;function Pr(A){var T=-1,k=A==null?0:A.length;for(this.__data__=new Jt;++T<k;)this.add(A[T])}function cs(A){return this.__data__.set(A,i),this}function us(A){return this.__data__.has(A)}Pr.prototype.add=Pr.prototype.push=cs,Pr.prototype.has=us;function jt(A){var T=this.__data__=new Ot(A);this.size=T.size}function hs(){this.__data__=new Ot,this.size=0}function fs(A){var T=this.__data__,k=T.delete(A);return this.size=T.size,k}function ds(A){return this.__data__.get(A)}function Cp(A){return this.__data__.has(A)}function Rp(A,T){var k=this.__data__;if(k instanceof Ot){var J=k.__data__;if(!Dr||J.length<t-1)return J.push([A,T]),this.size=++k.size,this;k=this.__data__=new Jt(J)}return k.set(A,T),this.size=k.size,this}jt.prototype.clear=hs,jt.prototype.delete=fs,jt.prototype.get=ds,jt.prototype.has=Cp,jt.prototype.set=Rp;function Tp(A,T){var k=on(A),J=!k&&Jp(A),Se=!k&&!J&&fa(A),Z=!k&&!J&&!Se&&Lc(A),Xe=k||J||Se||Z,it=Xe?Ae(A.length,String):[],ht=it.length;for(var Le in A)se.call(A,Le)&&!(Xe&&(Le=="length"||Se&&(Le=="offset"||Le=="parent")||Z&&(Le=="buffer"||Le=="byteLength"||Le=="byteOffset")||Hp(Le,ht)))&&it.push(Le);return it}function nn(A,T){for(var k=A.length;k--;)if(Fc(A[k][0],T))return k;return-1}function Np(A,T,k){var J=T(A);return on(A)?J:Pe(J,k(A))}function ls(A){return A==null?A===void 0?F:x:de&&de in Object(A)?zp(A):Gp(A)}function Cc(A){return ps(A)&&ls(A)==o}function Rc(A,T,k,J,Se){return A===T?!0:A==null||T==null||!ps(A)&&!ps(T)?A!==A&&T!==T:Fp(A,T,k,J,Rc,Se)}function Fp(A,T,k,J,Se,Z){var Xe=on(A),it=on(T),ht=Xe?u:Ar(A),Le=it?u:Ar(T);ht=ht==o?D:ht,Le=Le==o?D:Le;var Mt=ht==D,Yt=Le==D,yt=ht==Le;if(yt&&fa(A)){if(!fa(T))return!1;Xe=!0,Mt=!1}if(yt&&!Mt)return Z||(Z=new jt),Xe||Lc(A)?Tc(A,T,k,J,Se,Z):Lp(A,T,ht,k,J,Se,Z);if(!(k&s)){var Lt=Mt&&se.call(A,"__wrapped__"),Ut=Yt&&se.call(T,"__wrapped__");if(Lt||Ut){var Or=Lt?A.value():A,gr=Ut?T.value():T;return Z||(Z=new jt),Se(Or,gr,k,J,Z)}}return yt?(Z||(Z=new jt),Up(A,T,k,J,Se,Z)):!1}function qp(A){if(!jc(A)||Vp(A))return!1;var T=qc(A)?ze:U;return T.test(Vr(A))}function Bp(A){return ps(A)&&Bc(A.length)&&!!z[ls(A)]}function jp(A){if(!Wp(A))return ke(A);var T=[];for(var k in Object(A))se.call(A,k)&&k!="constructor"&&T.push(k);return T}function Tc(A,T,k,J,Se,Z){var Xe=k&s,it=A.length,ht=T.length;if(it!=ht&&!(Xe&&ht>it))return!1;var Le=Z.get(A);if(Le&&Z.get(T))return Le==T;var Mt=-1,Yt=!0,yt=k&n?new Pr:void 0;for(Z.set(A,T),Z.set(T,A);++Mt<it;){var Lt=A[Mt],Ut=T[Mt];if(J)var Or=Xe?J(Ut,Lt,Mt,T,A,Z):J(Lt,Ut,Mt,A,T,Z);if(Or!==void 0){if(Or)continue;Yt=!1;break}if(yt){if(!li(T,function(gr,Wr){if(!Ur(yt,Wr)&&(Lt===gr||Se(Lt,gr,k,J,Z)))return yt.push(Wr)})){Yt=!1;break}}else if(!(Lt===Ut||Se(Lt,Ut,k,J,Z))){Yt=!1;break}}return Z.delete(A),Z.delete(T),Yt}function Lp(A,T,k,J,Se,Z,Xe){switch(k){case f:if(A.byteLength!=T.byteLength||A.byteOffset!=T.byteOffset)return!1;A=A.buffer,T=T.buffer;case S:return!(A.byteLength!=T.byteLength||!Z(new Fe(A),new Fe(T)));case h:case l:case O:return Fc(+A,+T);case g:return A.name==T.name&&A.message==T.message;case N:case q:return A==T+"";case _:var it=Ee;case C:var ht=J&s;if(it||(it=$e),A.size!=T.size&&!ht)return!1;var Le=Xe.get(A);if(Le)return Le==T;J|=n,Xe.set(A,T);var Mt=Tc(it(A),it(T),J,Se,Z,Xe);return Xe.delete(A),Mt;case B:if(Re)return Re.call(A)==Re.call(T)}return!1}function Up(A,T,k,J,Se,Z){var Xe=k&s,it=Nc(A),ht=it.length,Le=Nc(T),Mt=Le.length;if(ht!=Mt&&!Xe)return!1;for(var Yt=ht;Yt--;){var yt=it[Yt];if(!(Xe?yt in T:se.call(T,yt)))return!1}var Lt=Z.get(A);if(Lt&&Z.get(T))return Lt==T;var Ut=!0;Z.set(A,T),Z.set(T,A);for(var Or=Xe;++Yt<ht;){yt=it[Yt];var gr=A[yt],Wr=T[yt];if(J)var Uc=Xe?J(Wr,gr,yt,T,A,Z):J(gr,Wr,yt,A,T,Z);if(!(Uc===void 0?gr===Wr||Se(gr,Wr,k,J,Z):Uc)){Ut=!1;break}Or||(Or=yt=="constructor")}if(Ut&&!Or){var cn=A.constructor,un=T.constructor;cn!=un&&"constructor"in A&&"constructor"in T&&!(typeof cn=="function"&&cn instanceof cn&&typeof un=="function"&&un instanceof un)&&(Ut=!1)}return Z.delete(A),Z.delete(T),Ut}function Nc(A){return Np(A,Zp,kp)}function an(A,T){var k=A.__data__;return Kp(T)?k[typeof T=="string"?"string":"hash"]:k.map}function gi(A,T){var k=ye(A,T);return qp(k)?k:void 0}function zp(A){var T=se.call(A,de),k=A[de];try{A[de]=void 0;var J=!0}catch{}var Se=Xi.call(A);return J&&(T?A[de]=k:delete A[de]),Se}var kp=Be?function(A){return A==null?[]:(A=Object(A),be(Be(A),function(T){return qe.call(A,T)}))}:Qp,Ar=ls;(Oe&&Ar(new Oe(new ArrayBuffer(1)))!=f||Dr&&Ar(new Dr)!=_||Me&&Ar(Me.resolve())!=M||Ce&&Ar(new Ce)!=C||pi&&Ar(new pi)!=H)&&(Ar=function(A){var T=ls(A),k=T==D?A.constructor:void 0,J=k?Vr(k):"";if(J)switch(J){case He:return f;case tn:return _;case Ke:return M;case Ve:return C;case rn:return H}return T});function Hp(A,T){return T=T??a,!!T&&(typeof A=="number"||L.test(A))&&A>-1&&A%1==0&&A<T}function Kp(A){var T=typeof A;return T=="string"||T=="number"||T=="symbol"||T=="boolean"?A!=="__proto__":A===null}function Vp(A){return!!Te&&Te in A}function Wp(A){var T=A&&A.constructor,k=typeof T=="function"&&T.prototype||pe;return A===k}function Gp(A){return Xi.call(A)}function Vr(A){if(A!=null){try{return Hr.call(A)}catch{}try{return A+""}catch{}}return""}function Fc(A,T){return A===T||A!==A&&T!==T}var Jp=Cc(function(){return arguments}())?Cc:function(A){return ps(A)&&se.call(A,"callee")&&!qe.call(A,"callee")},on=Array.isArray;function Yp(A){return A!=null&&Bc(A.length)&&!qc(A)}var fa=en||e0;function Xp(A,T){return Rc(A,T)}function qc(A){if(!jc(A))return!1;var T=ls(A);return T==m||T==y||T==c||T==R}function Bc(A){return typeof A=="number"&&A>-1&&A%1==0&&A<=a}function jc(A){var T=typeof A;return A!=null&&(T=="object"||T=="function")}function ps(A){return A!=null&&typeof A=="object"}var Lc=Bt?_e(Bt):Bp;function Zp(A){return Yp(A)?Tp(A):jp(A)}function Qp(){return[]}function e0(){return!1}r.exports=Xp}(Os,Os.exports)),Os.exports}var P6=D6();const A6=Hn(P6),Hl="wc",Kl=2,Bo="core",pr=`${Hl}@2:${Bo}:`,O6={logger:"error"},M6={database:":memory:"},C6="crypto",Xh="client_ed25519_seed",R6=V.ONE_DAY,T6="keychain",N6="0.3",F6="messages",q6="0.3",Zh=V.SIX_HOURS,B6="publisher",Vl="irn",j6="error",Wl="wss://relay.walletconnect.org",L6="relayer",ot={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},U6="_subscription",zt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},z6=.1,jo="2.19.0",De={link_mode:"link_mode",relay:"relay"},k6="0.3",H6="WALLETCONNECT_CLIENT_ID",Qh="WALLETCONNECT_LINK_MODE_APPS",Rt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},K6="subscription",V6="0.3",W6=V.FIVE_SECONDS*1e3,G6="pairing",J6="0.3",$s={wc_pairingDelete:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:V.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:V.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:V.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:V.ONE_DAY,prompt:!1,tag:0},res:{ttl:V.ONE_DAY,prompt:!1,tag:0}}},ei={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Zt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Y6="history",X6="0.3",Z6="expirer",kt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Q6="0.3",e8="verify-api",t8="https://verify.walletconnect.com",Gl="https://verify.walletconnect.org",Rs=Gl,r8=`${Rs}/v3`,i8=[t8,Gl],s8="echo",n8="https://echo.walletconnect.com",hr={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Er={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Qt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Yr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Xr={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Is={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},a8=.1,o8="event-client",c8=86400,u8="https://pulse.walletconnect.org/batch";function h8(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+" is ambiguous");t[a]=s}var o=r.length,u=r.charAt(0),c=Math.log(o)/Math.log(256),h=Math.log(256)/Math.log(o);function l(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var _=0,O=0,x=0,D=y.length;x!==D&&y[x]===0;)x++,_++;for(var M=(D-x)*h+1>>>0,R=new Uint8Array(M);x!==D;){for(var N=y[x],C=0,q=M-1;(N!==0||C<O)&&q!==-1;q--,C++)N+=256*R[q]>>>0,R[q]=N%o>>>0,N=N/o>>>0;if(N!==0)throw new Error("Non-zero carry");O=C,x++}for(var B=M-O;B!==M&&R[B]===0;)B++;for(var F=u.repeat(_);B<M;++B)F+=r.charAt(R[B]);return F}function g(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var _=0;if(y[_]!==" "){for(var O=0,x=0;y[_]===u;)O++,_++;for(var D=(y.length-_)*c+1>>>0,M=new Uint8Array(D);y[_];){var R=t[y.charCodeAt(_)];if(R===255)return;for(var N=0,C=D-1;(R!==0||N<x)&&C!==-1;C--,N++)R+=o*M[C]>>>0,M[C]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");x=N,_++}if(y[_]!==" "){for(var q=D-x;q!==D&&M[q]===0;)q++;for(var B=new Uint8Array(O+(D-q)),F=O;q!==D;)B[F++]=M[q++];return B}}}function m(y){var _=g(y);if(_)return _;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:g,decode:m}}var f8=h8,d8=f8;const Jl=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},l8=r=>new TextEncoder().encode(r),p8=r=>new TextDecoder().decode(r);let g8=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},b8=class{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Yl(this,e)}},y8=class{constructor(e){this.decoders=e}or(e){return Yl(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Yl=(r,e)=>new y8({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let v8=class{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new g8(e,t,i),this.decoder=new b8(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const ia=({name:r,prefix:e,encode:t,decode:i})=>new v8(r,e,t,i),Xs=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=d8(t,e);return ia({prefix:r,name:e,encode:i,decode:n=>Jl(s(n))})},m8=(r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;const a=new Uint8Array(n*t/8|0);let o=0,u=0,c=0;for(let h=0;h<n;++h){const l=s[r[h]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);u=u<<t|l,o+=t,o>=8&&(o-=8,a[c++]=255&u>>o)}if(o>=t||255&u<<8-o)throw new SyntaxError("Unexpected end of data");return a},w8=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",a=0,o=0;for(let u=0;u<r.length;++u)for(o=o<<8|r[u],a+=8;a>t;)a-=t,n+=e[s&o>>a];if(a&&(n+=e[s&o<<t-a]),i)for(;n.length*t&7;)n+="=";return n},bt=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>ia({prefix:e,name:r,encode(s){return w8(s,i,t)},decode(s){return m8(s,i,t,r)}}),_8=ia({prefix:"\0",name:"identity",encode:r=>p8(r),decode:r=>l8(r)});var E8=Object.freeze({__proto__:null,identity:_8});const $8=bt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var I8=Object.freeze({__proto__:null,base2:$8});const S8=bt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var x8=Object.freeze({__proto__:null,base8:S8});const D8=Xs({prefix:"9",name:"base10",alphabet:"0123456789"});var P8=Object.freeze({__proto__:null,base10:D8});const A8=bt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),O8=bt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var M8=Object.freeze({__proto__:null,base16:A8,base16upper:O8});const C8=bt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),R8=bt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),T8=bt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),N8=bt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),F8=bt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),q8=bt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),B8=bt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),j8=bt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),L8=bt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var U8=Object.freeze({__proto__:null,base32:C8,base32upper:R8,base32pad:T8,base32padupper:N8,base32hex:F8,base32hexupper:q8,base32hexpad:B8,base32hexpadupper:j8,base32z:L8});const z8=Xs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),k8=Xs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var H8=Object.freeze({__proto__:null,base36:z8,base36upper:k8});const K8=Xs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),V8=Xs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var W8=Object.freeze({__proto__:null,base58btc:K8,base58flickr:V8});const G8=bt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),J8=bt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Y8=bt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),X8=bt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Z8=Object.freeze({__proto__:null,base64:G8,base64pad:J8,base64url:Y8,base64urlpad:X8});const Xl=Array.from(""),Q8=Xl.reduce((r,e,t)=>(r[t]=e,r),[]),e4=Xl.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function t4(r){return r.reduce((e,t)=>(e+=Q8[t],e),"")}function r4(r){const e=[];for(const t of r){const i=e4[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const i4=ia({prefix:"",name:"base256emoji",encode:t4,decode:r4});var s4=Object.freeze({__proto__:null,base256emoji:i4}),n4=Zl,ef=128,a4=-128,o4=Math.pow(2,31);function Zl(r,e,t){e=e||[],t=t||0;for(var i=t;r>=o4;)e[t++]=r&255|ef,r/=128;for(;r&a4;)e[t++]=r&255|ef,r>>>=7;return e[t]=r|0,Zl.bytes=t-i+1,e}var c4=Lo,u4=128,tf=127;function Lo(r,i){var t=0,i=i||0,s=0,n=i,a,o=r.length;do{if(n>=o)throw Lo.bytes=0,new RangeError("Could not decode varint");a=r[n++],t+=s<28?(a&tf)<<s:(a&tf)*Math.pow(2,s),s+=7}while(a>=u4);return Lo.bytes=n-i,t}var h4=Math.pow(2,7),f4=Math.pow(2,14),d4=Math.pow(2,21),l4=Math.pow(2,28),p4=Math.pow(2,35),g4=Math.pow(2,42),b4=Math.pow(2,49),y4=Math.pow(2,56),v4=Math.pow(2,63),m4=function(r){return r<h4?1:r<f4?2:r<d4?3:r<l4?4:r<p4?5:r<g4?6:r<b4?7:r<y4?8:r<v4?9:10},w4={encode:n4,decode:c4,encodingLength:m4},Ql=w4;const rf=(r,e,t=0)=>(Ql.encode(r,e,t),e),sf=r=>Ql.encodingLength(r),Uo=(r,e)=>{const t=e.byteLength,i=sf(r),s=i+sf(t),n=new Uint8Array(s+t);return rf(r,n,0),rf(t,n,i),n.set(e,s),new _4(r,t,e,n)};let _4=class{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}};const ep=({name:r,code:e,encode:t})=>new E4(r,e,t);let E4=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Uo(this.code,t):t.then(i=>Uo(this.code,i))}else throw Error("Unknown type, must be binary type")}};const tp=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),$4=ep({name:"sha2-256",code:18,encode:tp("SHA-256")}),I4=ep({name:"sha2-512",code:19,encode:tp("SHA-512")});var S4=Object.freeze({__proto__:null,sha256:$4,sha512:I4});const rp=0,x4="identity",ip=Jl,D4=r=>Uo(rp,ip(r)),P4={code:rp,name:x4,encode:ip,digest:D4};var A4=Object.freeze({__proto__:null,identity:P4});new TextEncoder,new TextDecoder;const nf={...E8,...I8,...x8,...P8,...M8,...U8,...H8,...W8,...Z8,...s4};({...S4,...A4});function O4(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function sp(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const af=sp("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),io=sp("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=O4(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),M4={utf8:af,"utf-8":af,hex:nf.base16,latin1:io,ascii:io,binary:io,...nf};function C4(r,e="utf8"){const t=M4[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}var R4=Object.defineProperty,T4=(r,e,t)=>e in r?R4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,or=(r,e,t)=>T4(r,typeof e!="symbol"?e+"":e,t);let N4=class{constructor(e,t){this.core=e,this.logger=t,or(this,"keychain",new Map),or(this,"name",T6),or(this,"version",N6),or(this,"initialized",!1),or(this,"storagePrefix",pr),or(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),or(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),or(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),or(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),or(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=Et(t,this.name)}get context(){return At(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,nl(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?al(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var F4=Object.defineProperty,q4=(r,e,t)=>e in r?F4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,dt=(r,e,t)=>q4(r,typeof e!="symbol"?e+"":e,t);let B4=class{constructor(e,t,i){this.core=e,this.logger=t,dt(this,"name",C6),dt(this,"keychain"),dt(this,"randomSessionIdentifier",Ro()),dt(this,"initialized",!1),dt(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),dt(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),dt(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=Iu(s);return Wd(n.publicKey)}),dt(this,"generateKeyPair",()=>{this.isInitialized();const s=E2();return this.setPrivateKey(s.publicKey,s.privateKey)}),dt(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),a=Iu(n),o=this.randomSessionIdentifier;return await iy(o,s,R6,a)}),dt(this,"generateSharedKey",(s,n,a)=>{this.isInitialized();const o=this.getPrivateKey(s),u=$2(o,n);return this.setSymKey(u,a)}),dt(this,"setSymKey",async(s,n)=>{this.isInitialized();const a=n||On(s);return await this.keychain.set(a,s),a}),dt(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),dt(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),dt(this,"encode",async(s,n,a)=>{this.isInitialized();const o=Cl(a),u=Sr(n);if(_h(o))return x2(u,a==null?void 0:a.encoding);if(wh(o)){const g=o.senderPublicKey,m=o.receiverPublicKey;s=await this.generateSharedKey(g,m)}const c=this.getSymKey(s),{type:h,senderPublicKey:l}=o;return I2({type:h,symKey:c,message:u,senderPublicKey:l,encoding:a==null?void 0:a.encoding})}),dt(this,"decode",async(s,n,a)=>{this.isInitialized();const o=P2(n,a);if(_h(o)){const u=D2(n,a==null?void 0:a.encoding);return ni(u)}if(wh(o)){const u=o.receiverPublicKey,c=o.senderPublicKey;s=await this.generateSharedKey(u,c)}try{const u=this.getSymKey(s),c=S2({symKey:u,encoded:n,encoding:a==null?void 0:a.encoding});return ni(c)}catch(u){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(u)}}),dt(this,"getPayloadType",(s,n=qr)=>{const a=Bs({encoded:s,encoding:n});return oi(a.type)}),dt(this,"getPayloadSenderPublicKey",(s,n=qr)=>{const a=Bs({encoded:s,encoding:n});return a.senderPublicKey?_t(a.senderPublicKey,mt):void 0}),this.core=e,this.logger=Et(t,this.name),this.keychain=i||new N4(this.core,this.logger)}get context(){return At(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Xh)}catch{e=Ro(),await this.keychain.set(Xh,e)}return C4(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var j4=Object.defineProperty,L4=(r,e,t)=>e in r?j4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,cr=(r,e,t)=>L4(r,typeof e!="symbol"?e+"":e,t);let U4=class extends I3{constructor(e,t){super(e,t),this.logger=e,this.core=t,cr(this,"messages",new Map),cr(this,"name",F6),cr(this,"version",q6),cr(this,"initialized",!1),cr(this,"storagePrefix",pr),cr(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),cr(this,"set",async(i,s)=>{this.isInitialized();const n=$r(s);let a=this.messages.get(i);return typeof a>"u"&&(a={}),typeof a[n]<"u"||(a[n]=s,this.messages.set(i,a),await this.persist()),n}),cr(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),cr(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),a=$r(s);return typeof n[a]<"u"}),cr(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()}),this.logger=Et(e,this.name),this.core=t}get context(){return At(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,nl(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?al(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var z4=Object.defineProperty,k4=Object.defineProperties,H4=Object.getOwnPropertyDescriptors,of=Object.getOwnPropertySymbols,K4=Object.prototype.hasOwnProperty,V4=Object.prototype.propertyIsEnumerable,zo=(r,e,t)=>e in r?z4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,wn=(r,e)=>{for(var t in e||(e={}))K4.call(e,t)&&zo(r,t,e[t]);if(of)for(var t of of(e))V4.call(e,t)&&zo(r,t,e[t]);return r},so=(r,e)=>k4(r,H4(e)),er=(r,e,t)=>zo(r,typeof e!="symbol"?e+"":e,t);let W4=class extends S3{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,er(this,"events",new qt.EventEmitter),er(this,"name",B6),er(this,"queue",new Map),er(this,"publishTimeout",V.toMiliseconds(V.ONE_MINUTE)),er(this,"initialPublishTimeout",V.toMiliseconds(V.ONE_SECOND*15)),er(this,"needsTransportRestart",!1),er(this,"publish",async(i,s,n)=>{var a;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const o=(n==null?void 0:n.ttl)||Zh,u=Bn(n),c=(n==null?void 0:n.prompt)||!1,h=(n==null?void 0:n.tag)||0,l=(n==null?void 0:n.id)||ri().toString(),g={topic:i,message:s,opts:{ttl:o,relay:u,prompt:c,tag:h,id:l,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}},m=`Failed to publish payload, please try again. id:${l} tag:${h}`;try{const y=new Promise(async _=>{const O=({id:D})=>{g.opts.id===D&&(this.removeRequestFromQueue(D),this.relayer.events.removeListener(ot.publish,O),_(g))};this.relayer.events.on(ot.publish,O);const x=Fr(new Promise((D,M)=>{this.rpcPublish({topic:i,message:s,ttl:o,prompt:c,tag:h,id:l,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}).then(D).catch(R=>{this.logger.warn(R,R==null?void 0:R.message),M(R)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${h}`);try{await x,this.events.removeListener(ot.publish,O)}catch(D){this.queue.set(l,so(wn({},g),{attempt:1})),this.logger.warn(D,D==null?void 0:D.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:i,message:s,opts:n}}),await Fr(y,this.publishTimeout,m)}catch(y){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(y),(a=n==null?void 0:n.internal)!=null&&a.throwOnFailedPublish)throw y}finally{this.queue.delete(l)}}),er(this,"on",(i,s)=>{this.events.on(i,s)}),er(this,"once",(i,s)=>{this.events.once(i,s)}),er(this,"off",(i,s)=>{this.events.off(i,s)}),er(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=Et(t,this.name),this.registerEventListeners()}get context(){return At(this.logger)}async rpcPublish(e){var t,i,s,n;const{topic:a,message:o,ttl:u=Zh,prompt:c,tag:h,id:l,attestation:g,tvf:m}=e,y={method:Ps(Bn().protocol).publish,params:wn({topic:a,message:o,ttl:u,prompt:c,tag:h,attestation:g},m),id:l};wt((t=y.params)==null?void 0:t.prompt)&&((i=y.params)==null||delete i.prompt),wt((s=y.params)==null?void 0:s.tag)&&((n=y.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:y});const _=await this.relayer.request(y);return this.relayer.events.emit(ot.publish,e),this.logger.debug("Successfully Published Payload"),_}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{const i=e.attempt+1;this.queue.set(t,so(wn({},e),{attempt:i}));const{topic:s,message:n,opts:a,attestation:o}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),await this.rpcPublish(so(wn({},e),{topic:s,message:n,ttl:a.ttl,prompt:a.prompt,tag:a.tag,id:a.id,attestation:o,tvf:a.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ji.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ot.connection_stalled);return}this.checkQueue()}),this.relayer.on(ot.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}};var G4=Object.defineProperty,J4=(r,e,t)=>e in r?G4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,wi=(r,e,t)=>J4(r,typeof e!="symbol"?e+"":e,t);let Y4=class{constructor(){wi(this,"map",new Map),wi(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),wi(this,"get",e=>this.map.get(e)||[]),wi(this,"exists",(e,t)=>this.get(e).includes(t)),wi(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(n=>n!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),wi(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}};var X4=Object.defineProperty,Z4=Object.defineProperties,Q4=Object.getOwnPropertyDescriptors,cf=Object.getOwnPropertySymbols,e5=Object.prototype.hasOwnProperty,t5=Object.prototype.propertyIsEnumerable,ko=(r,e,t)=>e in r?X4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ss=(r,e)=>{for(var t in e||(e={}))e5.call(e,t)&&ko(r,t,e[t]);if(cf)for(var t of cf(e))t5.call(e,t)&&ko(r,t,e[t]);return r},no=(r,e)=>Z4(r,Q4(e)),le=(r,e,t)=>ko(r,typeof e!="symbol"?e+"":e,t);let r5=class extends P3{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,le(this,"subscriptions",new Map),le(this,"topicMap",new Y4),le(this,"events",new qt.EventEmitter),le(this,"name",K6),le(this,"version",V6),le(this,"pending",new Map),le(this,"cached",[]),le(this,"initialized",!1),le(this,"pendingSubscriptionWatchLabel","pending_sub_watch_label"),le(this,"pollingInterval",20),le(this,"storagePrefix",pr),le(this,"subscribeTimeout",V.toMiliseconds(V.ONE_MINUTE)),le(this,"initialSubscribeTimeout",V.toMiliseconds(V.ONE_SECOND*15)),le(this,"clientId"),le(this,"batchSubscribeTopicsLimit",500),le(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),le(this,"subscribe",async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const n=Bn(s),a={topic:i,relay:n,transportType:s==null?void 0:s.transportType};this.pending.set(i,a);const o=await this.rpcSubscribe(i,n,s);return typeof o=="string"&&(this.onSubscribe(o,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),o}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),le(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),le(this,"isSubscribed",async i=>{if(this.topics.includes(i))return!0;const s=`${this.pendingSubscriptionWatchLabel}_${i}`;return await new Promise((n,a)=>{const o=new V.Watch;o.start(s);const u=setInterval(()=>{(!this.pending.has(i)&&this.topics.includes(i)||this.cached.some(c=>c.topic===i))&&(clearInterval(u),o.stop(s),n(!0)),o.elapsed(s)>=W6&&(clearInterval(u),o.stop(s),a(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)}),le(this,"on",(i,s)=>{this.events.on(i,s)}),le(this,"once",(i,s)=>{this.events.once(i,s)}),le(this,"off",(i,s)=>{this.events.off(i,s)}),le(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),le(this,"start",async()=>{await this.onConnect()}),le(this,"stop",async()=>{await this.onDisconnect()}),le(this,"restart",async()=>{await this.restore(),await this.onRestart()}),le(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),le(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Ji.pulse,async()=>{await this.checkPending()}),this.events.on(Rt.created,async i=>{const s=Rt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(Rt.deleted,async i=>{const s=Rt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=Et(t,this.name),this.clientId=""}get context(){return At(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=Bn(i);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const n=he("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,i){var s;(!i||(i==null?void 0:i.transportType)===De.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const n={method:Ps(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const a=(s=i==null?void 0:i.internal)==null?void 0:s.throwOnFailedPublish;try{const o=await this.getSubscriptionId(e);if((i==null?void 0:i.transportType)===De.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(h=>this.logger.warn(h))},V.toMiliseconds(V.ONE_SECOND)),o;const u=new Promise(async h=>{const l=g=>{g.topic===e&&(this.events.removeListener(Rt.created,l),h(g.id))};this.events.on(Rt.created,l);try{const g=await Fr(new Promise((m,y)=>{this.relayer.request(n).catch(_=>{this.logger.warn(_,_==null?void 0:_.message),y(_)}).then(m)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Rt.created,l),h(g)}catch{}}),c=await Fr(u,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!c&&a)throw new Error(`Subscribing to ${e} failed, please try again`);return c?o:null}catch(o){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ot.connection_stalled),a)throw o}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,i={method:Ps(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Fr(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(ot.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,i={method:Ps(t.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Fr(new Promise((n,a)=>{this.relayer.request(i).catch(o=>{this.logger.warn(o),a(o)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(ot.connection_stalled)}return s}rpcUnsubscribe(e,t,i){const s={method:Ps(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,no(Ss({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Ss({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,Ss({},t)),this.topicMap.set(t.topic,e),this.events.emit(Rt.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Rt.deleted,no(Ss({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Rt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Rt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>no(Ss({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await Fv(V.toMiliseconds(V.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return $r(e+await this.getClientId())}};var i5=Object.defineProperty,uf=Object.getOwnPropertySymbols,s5=Object.prototype.hasOwnProperty,n5=Object.prototype.propertyIsEnumerable,Ho=(r,e,t)=>e in r?i5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,hf=(r,e)=>{for(var t in e||(e={}))s5.call(e,t)&&Ho(r,t,e[t]);if(uf)for(var t of uf(e))n5.call(e,t)&&Ho(r,t,e[t]);return r},oe=(r,e,t)=>Ho(r,typeof e!="symbol"?e+"":e,t);let a5=class extends x3{constructor(e){super(e),oe(this,"protocol","wc"),oe(this,"version",2),oe(this,"core"),oe(this,"logger"),oe(this,"events",new qt.EventEmitter),oe(this,"provider"),oe(this,"messages"),oe(this,"subscriber"),oe(this,"publisher"),oe(this,"name",L6),oe(this,"transportExplicitlyClosed",!1),oe(this,"initialized",!1),oe(this,"connectionAttemptInProgress",!1),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"packageName"),oe(this,"bundleId"),oe(this,"hasExperiencedNetworkDisruption",!1),oe(this,"pingTimeout"),oe(this,"heartBeatTimeout",V.toMiliseconds(V.THIRTY_SECONDS+V.FIVE_SECONDS)),oe(this,"reconnectTimeout"),oe(this,"connectPromise"),oe(this,"reconnectInProgress",!1),oe(this,"requestsInFlight",[]),oe(this,"connectTimeout",V.toMiliseconds(V.ONE_SECOND*15)),oe(this,"request",async t=>{var i,s;this.logger.debug("Publishing Request Payload");const n=t.id||ri().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:(i=t.params)==null?void 0:i.topic},"relayer.request - publishing...");const a=`${n}:${((s=t.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const o=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(u=>u!==a),o}catch(a){throw this.logger.debug(`Failed to Publish Request: ${n}`),a}}),oe(this,"resetPingTimeout",()=>{if(Fn())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,i,s;this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(t=this.provider)==null?void 0:t.connection)==null?void 0:i.socket)==null||s.terminate()},this.heartBeatTimeout)}catch(t){this.logger.warn(t,t==null?void 0:t.message)}}),oe(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),oe(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(ot.connect)}),oe(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),oe(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(ot.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),oe(this,"registerProviderListeners",()=>{this.provider.on(zt.payload,this.onPayloadHandler),this.provider.on(zt.connect,this.onConnectHandler),this.provider.on(zt.disconnect,this.onDisconnectHandler),this.provider.on(zt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Et(e.logger,this.name):Js(Qn({level:e.logger||j6})),this.messages=new U4(this.logger,e.core),this.subscriber=new r5(this,this.logger),this.publisher=new W4(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Wl,this.projectId=e.projectId,_v()?this.packageName=Wu():Ev()&&(this.bundleId=Wu()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e==null?void 0:e.message)}}get context(){return At(this.logger)}get connected(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:De.relay})}async subscribe(e,t){var i,s,n;this.isInitialized(),(!(t!=null&&t.transportType)||(t==null?void 0:t.transportType)==="relay")&&await this.toEstablishConnection();const a=typeof((i=t==null?void 0:t.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=t==null?void 0:t.internal)==null?void 0:s.throwOnFailedPublish;let o=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",u;const c=h=>{h.topic===e&&(this.subscriber.off(Rt.created,c),u())};return await Promise.all([new Promise(h=>{u=h,this.subscriber.on(Rt.created,c)}),new Promise(async(h,l)=>{o=await this.subscriber.subscribe(e,hf({internal:{throwOnFailedPublish:a}},t)).catch(g=>{a&&l(g)})||o,h()})]),o}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Fr(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,i)=>{await this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Ah())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const t=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const i of t)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:i}=e;if(!t.sessionExists){const s=tt(V.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(ot.message,e),await this.recordMessageEvent(e)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(zt.disconnect,n),await Fr(new Promise((a,o)=>{this.provider.connect().then(a).catch(o)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>{s(a)}).finally(()=>{this.provider.off(zt.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(a,o)=>{const u=()=>{o(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(zt.disconnect,u),await this.subscriber.start().then(a).catch(o).finally(()=>{this.provider.off(zt.disconnect,u)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(i=>setTimeout(i,V.toMiliseconds(t*1))),t++}}startPingTimeout(){var e,t,i,s,n;if(Fn())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a==null?void 0:a.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Wt(new x6(xv({sdkVersion:jo,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.warn(`Ignoring message for non-subscribed topic ${t}`),!0;const s=this.messages.has(t,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ic(e)){if(!e.method.endsWith(U6))return;const t=e.params,{topic:i,message:s,publishedAt:n,attestation:a}=t.data,o={topic:i,message:s,publishedAt:n,transportType:De.relay,attestation:a};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(hf({type:"event",event:t.id},o)),this.events.emit(t.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}else ra(e)&&this.events.emit(ot.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(ot.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=ea(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(zt.payload,this.onPayloadHandler),this.provider.off(zt.connect,this.onConnectHandler),this.provider.off(zt.disconnect,this.onDisconnectHandler),this.provider.off(zt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Ah();gw(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(i=>this.logger.error(i,i==null?void 0:i.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(ot.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},V.toMiliseconds(z6)))))}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&await this.connect()}};var o5=Object.defineProperty,ff=Object.getOwnPropertySymbols,c5=Object.prototype.hasOwnProperty,u5=Object.prototype.propertyIsEnumerable,Ko=(r,e,t)=>e in r?o5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,df=(r,e)=>{for(var t in e||(e={}))c5.call(e,t)&&Ko(r,t,e[t]);if(ff)for(var t of ff(e))u5.call(e,t)&&Ko(r,t,e[t]);return r},It=(r,e,t)=>Ko(r,typeof e!="symbol"?e+"":e,t);let hi=class extends D3{constructor(e,t,i,s=pr,n=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,It(this,"map",new Map),It(this,"version",k6),It(this,"cached",[]),It(this,"initialized",!1),It(this,"getKey"),It(this,"storagePrefix",pr),It(this,"recentlyDeleted",[]),It(this,"recentlyDeletedLimit",200),It(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!wt(a)?this.map.set(this.getKey(a),a):V2(a)?this.map.set(a.id,a):W2(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)}),It(this,"set",async(a,o)=>{this.isInitialized(),this.map.has(a)?await this.update(a,o):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:o}),this.map.set(a,o),await this.persist())}),It(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),It(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(o=>Object.keys(a).every(u=>A6(o[u],a[u]))):this.values)),It(this,"update",async(a,o)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:o});const u=df(df({},this.getData(a)),o);this.map.set(a,u),await this.persist()}),It(this,"delete",async(a,o)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:o}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())}),this.logger=Et(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return At(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=W("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var h5=Object.defineProperty,f5=(r,e,t)=>e in r?h5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,re=(r,e,t)=>f5(r,typeof e!="symbol"?e+"":e,t);let d5=class{constructor(e,t){this.core=e,this.logger=t,re(this,"name",G6),re(this,"version",J6),re(this,"events",new sc),re(this,"pairings"),re(this,"initialized",!1),re(this,"storagePrefix",pr),re(this,"ignoredPayloadTypes",[Ir]),re(this,"registeredMethods",[]),re(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),re(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),re(this,"create",async i=>{this.isInitialized();const s=Ro(),n=await this.core.crypto.setSymKey(s),a=tt(V.FIVE_MINUTES),o={protocol:Vl},u={topic:n,expiry:a,relay:o,active:!1,methods:i==null?void 0:i.methods},c=$h({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:o,expiryTimestamp:a,methods:i==null?void 0:i.methods});return this.events.emit(ei.create,u),this.core.expirer.set(n,a),await this.pairings.set(n,u),await this.core.relayer.subscribe(n,{transportType:i==null?void 0:i.transportType}),{topic:n,uri:c}}),re(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i==null?void 0:i.uri,trace:[hr.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:a,relay:o,expiryTimestamp:u,methods:c}=Eh(i.uri);s.props.properties.topic=n,s.addTrace(hr.pairing_uri_validation_success),s.addTrace(hr.pairing_uri_not_expired);let h;if(this.pairings.keys.includes(n)){if(h=this.pairings.get(n),s.addTrace(hr.existing_pairing),h.active)throw s.setError(Er.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(hr.pairing_not_expired)}const l=u||tt(V.FIVE_MINUTES),g={topic:n,relay:o,expiry:l,active:!1,methods:c};this.core.expirer.set(n,l),await this.pairings.set(n,g),s.addTrace(hr.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(ei.create,g),s.addTrace(hr.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(a,n),s.addTrace(hr.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(Er.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:o})}catch(m){throw s.setError(Er.subscribe_pairing_topic_failure),m}return s.addTrace(hr.subscribe_pairing_topic_success),g}),re(this,"activate",async({topic:i})=>{this.isInitialized();const s=tt(V.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),re(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:a,resolve:o,reject:u}=Zr();this.events.once(ue("pairing_ping",n),({error:c})=>{c?u(c):o()}),await a()}}),re(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),re(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),re(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),re(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",he("USER_DISCONNECTED")),await this.deletePairing(s))}),re(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:a,methods:o}=i,u=this.core.crypto.keychain.get(s);return $h({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:u,relay:n,expiryTimestamp:a,methods:o})}),re(this,"sendRequest",async(i,s,n)=>{const a=Br(s,n),o=await this.core.crypto.encode(i,a),u=$s[s].req;return this.core.history.set(i,a),this.core.relayer.publish(i,o,u),a.id}),re(this,"sendResult",async(i,s,n)=>{const a=ea(i,n),o=await this.core.crypto.encode(s,a),u=(await this.core.history.get(s,i)).request.method,c=$s[u].res;await this.core.relayer.publish(s,o,c),await this.core.history.resolve(a)}),re(this,"sendError",async(i,s,n)=>{const a=ta(i,n),o=await this.core.crypto.encode(s,a),u=(await this.core.history.get(s,i)).request.method,c=$s[u]?$s[u].res:$s.unregistered_method.res;await this.core.relayer.publish(s,o,c),await this.core.history.resolve(a)}),re(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,he("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),re(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>Nr(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),re(this,"onRelayEventRequest",i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return this.onPairingPingRequest(s,n);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,n);default:return this.onUnknownRpcMethodRequest(s,n)}}),re(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,a=(await this.core.history.get(s,n.id)).request.method;switch(a){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(a)}}),re(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(ei.ping,{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),re(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{dr(s)?this.events.emit(ue("pairing_ping",n),{}):Ht(s)&&this.events.emit(ue("pairing_ping",n),{error:s.error})},500)}),re(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(ei.delete,{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),re(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:a}=s;try{if(this.registeredMethods.includes(a))return;const o=he("WC_METHOD_UNSUPPORTED",a);await this.sendError(n,i,o),this.logger.error(o)}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),re(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(he("WC_METHOD_UNSUPPORTED",i))}),re(this,"isValidPair",(i,s)=>{var n;if(!Dt(i)){const{message:o}=W("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(Er.malformed_pairing_uri),new Error(o)}if(!K2(i.uri)){const{message:o}=W("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(Er.malformed_pairing_uri),new Error(o)}const a=Eh(i==null?void 0:i.uri);if(!((n=a==null?void 0:a.relay)!=null&&n.protocol)){const{message:o}=W("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(Er.malformed_pairing_uri),new Error(o)}if(!(a!=null&&a.symKey)){const{message:o}=W("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(Er.malformed_pairing_uri),new Error(o)}if(a!=null&&a.expiryTimestamp&&V.toMiliseconds(a==null?void 0:a.expiryTimestamp)<Date.now()){s.setError(Er.pairing_expired);const{message:o}=W("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(o)}}),re(this,"isValidPing",async i=>{if(!Dt(i)){const{message:n}=W("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),re(this,"isValidDisconnect",async i=>{if(!Dt(i)){const{message:n}=W("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),re(this,"isValidPairingTopic",async i=>{if(!Ze(i,!1)){const{message:s}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Nr(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=W("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=Et(t,this.name),this.pairings=new hi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return At(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ot.message,async e=>{const{topic:t,message:i,transportType:s}=e;if(!this.pairings.keys.includes(t)||s===De.link_mode||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(t,i);try{Ic(n)?(this.core.history.set(t,n),this.onRelayEventRequest({topic:t,payload:n})):ra(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id))}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(kt.expired,async e=>{const{topic:t}=cl(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(ei.expire,{topic:t}))})}};var l5=Object.defineProperty,p5=(r,e,t)=>e in r?l5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lt=(r,e,t)=>p5(r,typeof e!="symbol"?e+"":e,t);let g5=class extends $3{constructor(e,t){super(e,t),this.core=e,this.logger=t,lt(this,"records",new Map),lt(this,"events",new qt.EventEmitter),lt(this,"name",Y6),lt(this,"version",X6),lt(this,"cached",[]),lt(this,"initialized",!1),lt(this,"storagePrefix",pr),lt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),lt(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const a={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:tt(V.THIRTY_DAYS)};this.records.set(a.id,a),this.persist(),this.events.emit(Zt.created,a)}),lt(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=Ht(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(Zt.updated,s))}),lt(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),lt(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(Zt.deleted,n)}}),this.persist()}),lt(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),lt(this,"on",(i,s)=>{this.events.on(i,s)}),lt(this,"once",(i,s)=>{this.events.once(i,s)}),lt(this,"off",(i,s)=>{this.events.off(i,s)}),lt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Et(t,this.name)}get context(){return At(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:Br(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Zt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Zt.created,e=>{const t=Zt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Zt.updated,e=>{const t=Zt.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Zt.deleted,e=>{const t=Zt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(Ji.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{V.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(Zt.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var b5=Object.defineProperty,y5=(r,e,t)=>e in r?b5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vt=(r,e,t)=>y5(r,typeof e!="symbol"?e+"":e,t);let v5=class extends A3{constructor(e,t){super(e,t),this.core=e,this.logger=t,vt(this,"expirations",new Map),vt(this,"events",new qt.EventEmitter),vt(this,"name",Z6),vt(this,"version",Q6),vt(this,"cached",[]),vt(this,"initialized",!1),vt(this,"storagePrefix",pr),vt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),vt(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),vt(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),a={target:n,expiry:s};this.expirations.set(n,a),this.checkExpiry(n,a),this.events.emit(kt.created,{target:n,expiration:a})}),vt(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),vt(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(kt.deleted,{target:s,expiration:n})}}),vt(this,"on",(i,s)=>{this.events.on(i,s)}),vt(this,"once",(i,s)=>{this.events.once(i,s)}),vt(this,"off",(i,s)=>{this.events.off(i,s)}),vt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Et(t,this.name)}get context(){return At(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Dv(e);if(typeof e=="number")return Pv(e);const{message:t}=W("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(kt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;V.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(kt.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Ji.pulse,()=>this.checkExpirations()),this.events.on(kt.created,e=>{const t=kt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(kt.expired,e=>{const t=kt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(kt.deleted,e=>{const t=kt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}};var m5=Object.defineProperty,w5=(r,e,t)=>e in r?m5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,et=(r,e,t)=>w5(r,typeof e!="symbol"?e+"":e,t);let _5=class extends O3{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,et(this,"name",e8),et(this,"abortController"),et(this,"isDevEnv"),et(this,"verifyUrlV3",r8),et(this,"storagePrefix",pr),et(this,"version",Kl),et(this,"publicKey"),et(this,"fetchPromise"),et(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&V.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),et(this,"register",async s=>{if(!ks()||this.isDevEnv)return;const n=window.location.origin,{id:a,decryptedId:o}=s,u=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${a}&decryptedId=${o}`;try{const c=ii.getDocument(),h=this.startAbortTimer(V.ONE_SECOND*5),l=await new Promise((g,m)=>{const y=()=>{window.removeEventListener("message",O),c.body.removeChild(_),m("attestation aborted")};this.abortController.signal.addEventListener("abort",y);const _=c.createElement("iframe");_.src=u,_.style.display="none",_.addEventListener("error",y,{signal:this.abortController.signal});const O=x=>{if(x.data&&typeof x.data=="string")try{const D=JSON.parse(x.data);if(D.type==="verify_attestation"){if(xo(D.attestation).payload.id!==a)return;clearInterval(h),c.body.removeChild(_),this.abortController.signal.removeEventListener("abort",y),window.removeEventListener("message",O),g(D.attestation===null?"":D.attestation)}}catch(D){this.logger.warn(D)}};c.body.appendChild(_),window.addEventListener("message",O,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",l),l}catch(c){this.logger.warn(c)}return""}),et(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:a,encryptedId:o}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(xo(n).payload.id!==o)return;const c=await this.isValidJwtAttestation(n);if(c){if(!c.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return c}}if(!a)return;const u=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(a,u)}),et(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const a=this.startAbortTimer(V.ONE_SECOND*5),o=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(a),o.status===200?await o.json():void 0}),et(this,"getVerifyUrl",s=>{let n=s||Rs;return i8.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Rs}`),n=Rs),n}),et(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(V.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),et(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),et(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),et(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(o){this.logger.error(o),this.logger.warn("error validating attestation")}const a=await this.fetchAndPersistPublicKey();try{if(a)return this.validateAttestation(s,a)}catch(o){this.logger.error(o),this.logger.warn("error validating attestation")}}),et(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),et(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const a=await this.fetchPublicKey();a&&(await this.persistPublicKey(a),n(a))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),et(this,"validateAttestation",(s,n)=>{const a=C2(s,n.publicKey),o={hasExpired:V.toMiliseconds(a.exp)<Date.now(),payload:a};if(o.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:o.payload.origin,isScam:o.payload.isScam,isVerified:o.payload.isVerified}}),this.logger=Et(t,this.name),this.abortController=new AbortController,this.isDevEnv=lc(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return At(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),V.toMiliseconds(e))}};var E5=Object.defineProperty,$5=(r,e,t)=>e in r?E5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lf=(r,e,t)=>$5(r,typeof e!="symbol"?e+"":e,t);let I5=class extends M3{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,lf(this,"context",s8),lf(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:a,enableEncrypted:o=!1}=i,u=`${n8}/${this.projectId}/clients`;await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:a,token:n,always_raw:o})})}),this.logger=Et(t,this.context)}};var S5=Object.defineProperty,pf=Object.getOwnPropertySymbols,x5=Object.prototype.hasOwnProperty,D5=Object.prototype.propertyIsEnumerable,Vo=(r,e,t)=>e in r?S5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xs=(r,e)=>{for(var t in e||(e={}))x5.call(e,t)&&Vo(r,t,e[t]);if(pf)for(var t of pf(e))D5.call(e,t)&&Vo(r,t,e[t]);return r},st=(r,e,t)=>Vo(r,typeof e!="symbol"?e+"":e,t);let P5=class extends C3{constructor(e,t,i=!0){super(e,t,i),this.core=e,this.logger=t,st(this,"context",o8),st(this,"storagePrefix",pr),st(this,"storageVersion",a8),st(this,"events",new Map),st(this,"shouldPersist",!1),st(this,"init",async()=>{if(!lc())try{const s={eventId:Ju(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:sl(this.core.relayer.protocol,this.core.relayer.version,jo)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),st(this,"createEvent",s=>{const{event:n="ERROR",type:a="",properties:{topic:o,trace:u}}=s,c=Ju(),h=this.core.projectId||"",l=Date.now(),g=xs({eventId:c,timestamp:l,props:{event:n,type:a,properties:{topic:o,trace:u}},bundleId:h,domain:this.getAppDomain()},this.setMethods(c));return this.telemetryEnabled&&(this.events.set(c,g),this.shouldPersist=!0),g}),st(this,"getEvent",s=>{const{eventId:n,topic:a}=s;if(n)return this.events.get(n);const o=Array.from(this.events.values()).find(u=>u.props.properties.topic===a);if(o)return xs(xs({},o),this.setMethods(o.eventId))}),st(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),st(this,"setEventListeners",()=>{this.core.heartbeat.on(Ji.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{V.fromMiliseconds(Date.now())-V.fromMiliseconds(s.timestamp)>c8&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),st(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),st(this,"addTrace",(s,n)=>{const a=this.events.get(s);a&&(a.props.properties.trace.push(n),this.events.set(s,a),this.shouldPersist=!0)}),st(this,"setError",(s,n)=>{const a=this.events.get(s);a&&(a.props.type=n,a.timestamp=Date.now(),this.events.set(s,a),this.shouldPersist=!0)}),st(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),st(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,xs(xs({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),st(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,a]of this.events)a.props.type&&s.push(a);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),st(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${u8}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${jo}${n}`,{method:"POST",body:JSON.stringify(s)})}),st(this,"getAppDomain",()=>il().url),this.logger=Et(t,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}};var A5=Object.defineProperty,gf=Object.getOwnPropertySymbols,O5=Object.prototype.hasOwnProperty,M5=Object.prototype.propertyIsEnumerable,Wo=(r,e,t)=>e in r?A5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,bf=(r,e)=>{for(var t in e||(e={}))O5.call(e,t)&&Wo(r,t,e[t]);if(gf)for(var t of gf(e))M5.call(e,t)&&Wo(r,t,e[t]);return r},we=(r,e,t)=>Wo(r,typeof e!="symbol"?e+"":e,t);let C5=class np extends m3{constructor(e){var t;super(e),we(this,"protocol",Hl),we(this,"version",Kl),we(this,"name",Bo),we(this,"relayUrl"),we(this,"projectId"),we(this,"customStoragePrefix"),we(this,"events",new qt.EventEmitter),we(this,"logger"),we(this,"heartbeat"),we(this,"relayer"),we(this,"crypto"),we(this,"storage"),we(this,"history"),we(this,"expirer"),we(this,"pairing"),we(this,"verify"),we(this,"echoClient"),we(this,"linkModeSupportedApps"),we(this,"eventClient"),we(this,"initialized",!1),we(this,"logChunkController"),we(this,"on",(a,o)=>this.events.on(a,o)),we(this,"once",(a,o)=>this.events.once(a,o)),we(this,"off",(a,o)=>this.events.off(a,o)),we(this,"removeListener",(a,o)=>this.events.removeListener(a,o)),we(this,"dispatchEnvelope",({topic:a,message:o,sessionExists:u})=>{if(!a||!o)return;const c={topic:a,message:o,publishedAt:Date.now(),transportType:De.link_mode};this.relayer.onLinkMessageEvent(c,{sessionExists:u})}),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Wl,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=Qn({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:O6.logger,name:Bo}),{logger:s,chunkLoggerController:n}=b3({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=n,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,o;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((o=this.logChunkController)==null||o.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Et(s,this.name),this.heartbeat=new mw,this.crypto=new B4(this,this.logger,e==null?void 0:e.keychain),this.history=new g5(this,this.logger),this.expirer=new v5(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Qw(bf(bf({},M6),e==null?void 0:e.storageOptions)),this.relayer=new a5({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new d5(this,this.logger),this.verify=new _5(this,this.logger,this.storage),this.echoClient=new I5(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new P5(this,this.logger,e==null?void 0:e.telemetryEnabled)}static async init(e){const t=new np(e);await t.initialize();const i=await t.crypto.getClientId();return await t.storage.setItem(H6,i),t}get context(){return At(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Qh,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Qh)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}};const R5=C5,ap="wc",op=2,cp="client",Sc=`${ap}@${op}:${cp}:`,ao={name:cp,logger:"error"},yf="WALLETCONNECT_DEEPLINK_CHOICE",T5="proposal",vf="Proposal expired",N5="session",_i=V.SEVEN_DAYS,F5="engine",nt={wc_sessionPropose:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1104},res:{ttl:V.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1106},res:{ttl:V.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1112},res:{ttl:V.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1114},res:{ttl:V.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:V.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:V.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1119}}},oo={min:V.FIVE_MINUTES,max:V.SEVEN_DAYS},ur={idle:"IDLE",active:"ACTIVE"},mf={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},q5="request",B5=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],j5="wc",L5="auth",U5="authKeys",z5="pairingTopics",k5="requests",sa=`${j5}@${1.5}:${L5}:`,Rn=`${sa}:PUB_KEY`;var H5=Object.defineProperty,K5=Object.defineProperties,V5=Object.getOwnPropertyDescriptors,wf=Object.getOwnPropertySymbols,W5=Object.prototype.hasOwnProperty,G5=Object.prototype.propertyIsEnumerable,Go=(r,e,t)=>e in r?H5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ue=(r,e)=>{for(var t in e||(e={}))W5.call(e,t)&&Go(r,t,e[t]);if(wf)for(var t of wf(e))G5.call(e,t)&&Go(r,t,e[t]);return r},St=(r,e)=>K5(r,V5(e)),K=(r,e,t)=>Go(r,typeof e!="symbol"?e+"":e,t);let J5=class extends F3{constructor(e){super(e),K(this,"name",F5),K(this,"events",new sc),K(this,"initialized",!1),K(this,"requestQueue",{state:ur.idle,queue:[]}),K(this,"sessionRequestQueue",{state:ur.idle,queue:[]}),K(this,"requestQueueDelay",V.ONE_SECOND),K(this,"expectedPairingMethodMap",new Map),K(this,"recentlyDeletedMap",new Map),K(this,"recentlyDeletedLimit",200),K(this,"relayMessageCache",[]),K(this,"pendingSessions",new Map),K(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(nt)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},V.toMiliseconds(this.requestQueueDelay)))}),K(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=St(Ue({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:a,sessionProperties:o,relays:u}=i;let c=s,h,l=!1;try{if(c){const N=this.client.core.pairing.pairings.get(c);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),l=N.active}}catch(N){throw this.client.logger.error(`connect() -> pairing.get(${c}) failed`),N}if(!c||!l){const{topic:N,uri:C}=await this.client.core.pairing.create();c=N,h=C}if(!c){const{message:N}=W("NO_MATCHING_KEY",`connect() pairing topic: ${c}`);throw new Error(N)}const g=await this.client.core.crypto.generateKeyPair(),m=nt.wc_sessionPropose.req.ttl||V.FIVE_MINUTES,y=tt(m),_=St(Ue({requiredNamespaces:n,optionalNamespaces:a,relays:u??[{protocol:Vl}],proposer:{publicKey:g,metadata:this.client.metadata},expiryTimestamp:y,pairingTopic:c},o&&{sessionProperties:o}),{id:fr()}),O=ue("session_connect",_.id),{reject:x,resolve:D,done:M}=Zr(m,vf),R=({id:N})=>{N===_.id&&(this.client.events.off("proposal_expire",R),this.pendingSessions.delete(_.id),this.events.emit(O,{error:{message:vf,code:0}}))};return this.client.events.on("proposal_expire",R),this.events.once(O,({error:N,session:C})=>{this.client.events.off("proposal_expire",R),N?x(N):C&&D(C)}),await this.sendRequest({topic:c,method:"wc_sessionPropose",params:_,throwOnFailedPublish:!0,clientRpcId:_.id}),await this.setProposal(_.id,_),{uri:h,approval:M}}),K(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(i){throw this.client.logger.error("pair() failed"),i}}),K(this,"approve",async t=>{var i,s,n;const a=this.client.core.eventClient.createEvent({properties:{topic:(i=t==null?void 0:t.id)==null?void 0:i.toString(),trace:[Qt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(B){throw a.setError(Yr.no_internet_connection),B}try{await this.isValidProposalId(t==null?void 0:t.id)}catch(B){throw this.client.logger.error(`approve() -> proposal.get(${t==null?void 0:t.id}) failed`),a.setError(Yr.proposal_not_found),B}try{await this.isValidApprove(t)}catch(B){throw this.client.logger.error("approve() -> isValidApprove() failed"),a.setError(Yr.session_approve_namespace_validation_failure),B}const{id:o,relayProtocol:u,namespaces:c,sessionProperties:h,sessionConfig:l}=t,g=this.client.proposal.get(o);this.client.core.eventClient.deleteEvent({eventId:a.eventId});const{pairingTopic:m,proposer:y,requiredNamespaces:_,optionalNamespaces:O}=g;let x=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:m});x||(x=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:Qt.session_approve_started,properties:{topic:m,trace:[Qt.session_approve_started,Qt.session_namespaces_validation_success]}}));const D=await this.client.core.crypto.generateKeyPair(),M=y.publicKey,R=await this.client.core.crypto.generateSharedKey(D,M),N=Ue(Ue({relay:{protocol:u??"irn"},namespaces:c,controller:{publicKey:D,metadata:this.client.metadata},expiry:tt(_i)},h&&{sessionProperties:h}),l&&{sessionConfig:l}),C=De.relay;x.addTrace(Qt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(R,{transportType:C})}catch(B){throw x.setError(Yr.subscribe_session_topic_failure),B}x.addTrace(Qt.subscribe_session_topic_success);const q=St(Ue({},N),{topic:R,requiredNamespaces:_,optionalNamespaces:O,pairingTopic:m,acknowledged:!1,self:N.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:D,transportType:De.relay});await this.client.session.set(R,q),x.addTrace(Qt.store_session);try{x.addTrace(Qt.publishing_session_settle),await this.sendRequest({topic:R,method:"wc_sessionSettle",params:N,throwOnFailedPublish:!0}).catch(B=>{throw x==null||x.setError(Yr.session_settle_publish_failure),B}),x.addTrace(Qt.session_settle_publish_success),x.addTrace(Qt.publishing_session_approve),await this.sendResult({id:o,topic:m,result:{relay:{protocol:u??"irn"},responderPublicKey:D},throwOnFailedPublish:!0}).catch(B=>{throw x==null||x.setError(Yr.session_approve_publish_failure),B}),x.addTrace(Qt.session_approve_publish_success)}catch(B){throw this.client.logger.error(B),this.client.session.delete(R,he("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(R),B}return this.client.core.eventClient.deleteEvent({eventId:x.eventId}),await this.client.core.pairing.updateMetadata({topic:m,metadata:y.metadata}),await this.client.proposal.delete(o,he("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}),await this.setExpiry(R,tt(_i)),{topic:R,acknowledged:()=>Promise.resolve(this.client.session.get(R))}}),K(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}const{id:i,reason:s}=t;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),a}n&&(await this.sendError({id:i,topic:n,error:s,rpcOpts:nt.wc_sessionPropose.reject}),await this.client.proposal.delete(i,he("USER_DISCONNECTED")))}),K(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}const{topic:i,namespaces:s}=t,{done:n,resolve:a,reject:o}=Zr(),u=fr(),c=ri().toString(),h=this.client.session.get(i).namespaces;return this.events.once(ue("session_update",u),({error:l})=>{l?o(l):a()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:u,relayRpcId:c}).catch(l=>{this.client.logger.error(l),this.client.session.update(i,{namespaces:h}),o(l)}),{acknowledged:n}}),K(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(u){throw this.client.logger.error("extend() -> isValidExtend() failed"),u}const{topic:i}=t,s=fr(),{done:n,resolve:a,reject:o}=Zr();return this.events.once(ue("session_extend",s),({error:u})=>{u?o(u):a()}),await this.setExpiry(i,tt(_i)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(u=>{o(u)}),{acknowledged:n}}),K(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(x){throw this.client.logger.error("request() -> isValidRequest() failed"),x}const{chainId:i,request:s,topic:n,expiry:a=nt.wc_sessionRequest.req.ttl}=t,o=this.client.session.get(n);(o==null?void 0:o.transportType)===De.relay&&await this.confirmOnlineStateOrThrow();const u=fr(),c=ri().toString(),{done:h,resolve:l,reject:g}=Zr(a,"Request expired. Please try again.");this.events.once(ue("session_request",u),({error:x,result:D})=>{x?g(x):l(D)});const m="wc_sessionRequest",y=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);if(y)return await this.sendRequest({clientRpcId:u,relayRpcId:c,topic:n,method:m,params:{request:St(Ue({},s),{expiryTimestamp:tt(a)}),chainId:i},expiry:a,throwOnFailedPublish:!0,appLink:y}).catch(x=>g(x)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:u}),await h();const _={request:St(Ue({},s),{expiryTimestamp:tt(a)}),chainId:i},O=this.shouldSetTVF(m,_);return await Promise.all([new Promise(async x=>{await this.sendRequest(Ue({clientRpcId:u,relayRpcId:c,topic:n,method:m,params:_,expiry:a,throwOnFailedPublish:!0},O&&{tvf:this.getTVFParams(u,_)})).catch(D=>g(D)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:u}),x()}),new Promise(async x=>{var D;if(!((D=o.sessionConfig)!=null&&D.disableDeepLink)){const M=await Cv(this.client.core.storage,yf);await Av({id:u,topic:n,wcDeepLink:M})}x()}),h()]).then(x=>x[2])}),K(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:i,response:s}=t,{id:n}=s,a=this.client.session.get(i);a.transportType===De.relay&&await this.confirmOnlineStateOrThrow();const o=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);dr(s)?await this.sendResult({id:n,topic:i,result:s.result,throwOnFailedPublish:!0,appLink:o}):Ht(s)&&await this.sendError({id:n,topic:i,error:s.error,appLink:o}),this.cleanupAfterResponse(t)}),K(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=t;if(this.client.session.keys.includes(i)){const s=fr(),n=ri().toString(),{done:a,resolve:o,reject:u}=Zr();this.events.once(ue("session_ping",s),({error:c})=>{c?u(c):o()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),a()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),K(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);const{topic:i,event:s,chainId:n}=t,a=ri().toString(),o=fr();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:a,clientRpcId:o})}),K(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);const{topic:i}=t;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:he("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=W("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),K(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(i=>k2(i,t)))),K(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),K(this,"authenticate",async(t,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(t);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),a=n?De.link_mode:De.relay;a===De.relay&&await this.confirmOnlineStateOrThrow();const{chains:o,statement:u="",uri:c,domain:h,nonce:l,type:g,exp:m,nbf:y,methods:_=[],expiry:O}=t,x=[...t.resources||[]],{topic:D,uri:M}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:a});this.client.logger.info({message:"Generated new pairing",pairing:{topic:D,uri:M}});const R=await this.client.core.crypto.generateKeyPair(),N=On(R);if(await Promise.all([this.client.auth.authKeys.set(Rn,{responseTopic:N,publicKey:R}),this.client.auth.pairingTopics.set(N,{topic:N,pairingTopic:D})]),await this.client.core.relayer.subscribe(N,{transportType:a}),this.client.logger.info(`sending request to new pairing topic: ${D}`),_.length>0){const{namespace:E}=Ui(o[0]);let d=Em(E,"request",_);An(x)&&(d=Im(d,x.pop())),x.push(d)}const C=O&&O>nt.wc_sessionAuthenticate.req.ttl?O:nt.wc_sessionAuthenticate.req.ttl,q={authPayload:{type:g??"caip122",chains:o,statement:u,aud:c,domain:h,version:"1",nonce:l,iat:new Date().toISOString(),exp:m,nbf:y,resources:x},requester:{publicKey:R,metadata:this.client.metadata},expiryTimestamp:tt(C)},B={eip155:{chains:o,methods:[...new Set(["personal_sign",..._])],events:["chainChanged","accountsChanged"]}},F={requiredNamespaces:{},optionalNamespaces:B,relays:[{protocol:"irn"}],pairingTopic:D,proposer:{publicKey:R,metadata:this.client.metadata},expiryTimestamp:tt(nt.wc_sessionPropose.req.ttl),id:fr()},{done:H,resolve:S,reject:f}=Zr(C,"Request expired"),b=fr(),w=ue("session_connect",F.id),p=ue("session_request",b),v=async({error:E,session:d})=>{this.events.off(p,I),E?f(E):d&&S({session:d})},I=async E=>{var d,$,j;if(await this.deletePendingAuthRequest(b,{message:"fulfilled",code:0}),E.error){const Y=he("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return E.error.code===Y.code?void 0:(this.events.off(w,v),f(E.error.message))}await this.deleteProposal(F.id),this.events.off(w,v);const{cacaos:U,responder:L}=E.result,z=[],G=[];for(const Y of U){await ih({cacao:Y,projectId:this.client.core.projectId})||(this.client.logger.error(Y,"Signature verification failed"),f(he("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:ee}=Y,ut=An(ee.resources),ne=[Do(ee.iss)],fe=qn(ee.iss);if(ut){const Bt=sh(ut),be=nh(ut);z.push(...Bt),ne.push(...be)}for(const Bt of ne)G.push(`${Bt}:${fe}`)}const X=await this.client.core.crypto.generateSharedKey(R,L.publicKey);let Q;z.length>0&&(Q={topic:X,acknowledged:!0,self:{publicKey:R,metadata:this.client.metadata},peer:L,controller:L.publicKey,expiry:tt(_i),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:D,namespaces:Ih([...new Set(z)],[...new Set(G)]),transportType:a},await this.client.core.relayer.subscribe(X,{transportType:a}),await this.client.session.set(X,Q),D&&await this.client.core.pairing.updateMetadata({topic:D,metadata:L.metadata}),Q=this.client.session.get(X)),(d=this.client.metadata.redirect)!=null&&d.linkMode&&($=L.metadata.redirect)!=null&&$.linkMode&&(j=L.metadata.redirect)!=null&&j.universal&&i&&(this.client.core.addLinkModeSupportedApp(L.metadata.redirect.universal),this.client.session.update(X,{transportType:De.link_mode})),S({auths:U,session:Q})};this.events.once(w,v),this.events.once(p,I);let P;try{if(n){const E=Br("wc_sessionAuthenticate",q,b);this.client.core.history.set(D,E);const d=await this.client.core.crypto.encode("",E,{type:Ws,encoding:_s});P=yn(i,D,d)}else await Promise.all([this.sendRequest({topic:D,method:"wc_sessionAuthenticate",params:q,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:b}),this.sendRequest({topic:D,method:"wc_sessionPropose",params:F,expiry:nt.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:F.id})])}catch(E){throw this.events.off(w,v),this.events.off(p,I),E}return await this.setProposal(F.id,F),await this.setAuthRequest(b,{request:St(Ue({},q),{verifyContext:{}}),pairingTopic:D,transportType:a}),{uri:P??M,response:H}}),K(this,"approveSessionAuthenticate",async t=>{const{id:i,auths:s}=t,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Xr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(O){throw n.setError(Is.no_internet_connection),O}const a=this.getPendingAuthRequest(i);if(!a)throw n.setError(Is.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const o=a.transportType||De.relay;o===De.relay&&await this.confirmOnlineStateOrThrow();const u=a.requester.publicKey,c=await this.client.core.crypto.generateKeyPair(),h=On(u),l={type:Ir,receiverPublicKey:u,senderPublicKey:c},g=[],m=[];for(const O of s){if(!await ih({cacao:O,projectId:this.client.core.projectId})){n.setError(Is.invalid_cacao);const N=he("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:h,error:N,encodeOpts:l}),new Error(N.message)}n.addTrace(Xr.cacaos_verified);const{p:x}=O,D=An(x.resources),M=[Do(x.iss)],R=qn(x.iss);if(D){const N=sh(D),C=nh(D);g.push(...N),M.push(...C)}for(const N of M)m.push(`${N}:${R}`)}const y=await this.client.core.crypto.generateSharedKey(c,u);n.addTrace(Xr.create_authenticated_session_topic);let _;if((g==null?void 0:g.length)>0){_={topic:y,acknowledged:!0,self:{publicKey:c,metadata:this.client.metadata},peer:{publicKey:u,metadata:a.requester.metadata},controller:u,expiry:tt(_i),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:a.pairingTopic,namespaces:Ih([...new Set(g)],[...new Set(m)]),transportType:o},n.addTrace(Xr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(y,{transportType:o})}catch(O){throw n.setError(Is.subscribe_authenticated_session_topic_failure),O}n.addTrace(Xr.subscribe_authenticated_session_topic_success),await this.client.session.set(y,_),n.addTrace(Xr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:a.pairingTopic,metadata:a.requester.metadata})}n.addTrace(Xr.publishing_authenticated_session_approve);try{await this.sendResult({topic:h,id:i,result:{cacaos:s,responder:{publicKey:c,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(a.requester.metadata,o)})}catch(O){throw n.setError(Is.authenticated_session_approve_publish_failure),O}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:a.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:_}}),K(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();const{id:i,reason:s}=t,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===De.relay&&await this.confirmOnlineStateOrThrow();const a=n.requester.publicKey,o=await this.client.core.crypto.generateKeyPair(),u=On(a),c={type:Ir,receiverPublicKey:a,senderPublicKey:o};await this.sendError({id:i,topic:u,error:s,encodeOpts:c,rpcOpts:nt.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.client.proposal.delete(i,he("USER_DISCONNECTED"))}),K(this,"formatAuthMessage",t=>{this.isInitialized();const{request:i,iss:s}=t;return yl(i,s)}),K(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),K(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{const i=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var a,o;return((a=n.peerMetadata)==null?void 0:a.url)&&((o=n.peerMetadata)==null?void 0:o.url)===t.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),K(this,"deleteSession",async t=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:a=!0,id:o=0}=t,{self:u}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,he("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(u.publicKey)&&await this.client.core.crypto.deleteKeyPair(u.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(yf).catch(c=>this.client.logger.warn(c)),this.getPendingSessionRequests().forEach(c=>{c.topic===s&&this.deletePendingSessionRequest(c.id,he("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=ur.idle),a&&this.client.events.emit("session_delete",{id:o,topic:s})}),K(this,"deleteProposal",async(t,i)=>{if(i)try{const s=this.client.proposal.get(t),n=this.client.core.eventClient.getEvent({topic:s.pairingTopic});n==null||n.setError(Yr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,he("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),K(this,"deletePendingSessionRequest",async(t,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),s&&(this.sessionRequestQueue.state=ur.idle,this.client.events.emit("session_request_expire",{id:t}))}),K(this,"deletePendingAuthRequest",async(t,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)])}),K(this,"setExpiry",async(t,i)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,i),await this.client.session.update(t,{expiry:i}))}),K(this,"setProposal",async(t,i)=>{this.client.core.expirer.set(t,tt(nt.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,i)}),K(this,"setAuthRequest",async(t,i)=>{const{request:s,pairingTopic:n,transportType:a=De.relay}=i;this.client.core.expirer.set(t,s.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:t,pairingTopic:n,verifyContext:s.verifyContext,transportType:a})}),K(this,"setPendingSessionRequest",async t=>{const{id:i,topic:s,params:n,verifyContext:a}=t,o=n.request.expiryTimestamp||tt(nt.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,o),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:a})}),K(this,"sendRequest",async t=>{const{topic:i,method:s,params:n,expiry:a,relayRpcId:o,clientRpcId:u,throwOnFailedPublish:c,appLink:h,tvf:l}=t,g=Br(s,n,u);let m;const y=!!h;try{const x=y?_s:qr;m=await this.client.core.crypto.encode(i,g,{encoding:x})}catch(x){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),x}let _;if(B5.includes(s)){const x=$r(JSON.stringify(g)),D=$r(m);_=await this.client.core.verify.register({id:D,decryptedId:x})}const O=nt[s].req;if(O.attestation=_,a&&(O.ttl=a),o&&(O.id=o),this.client.core.history.set(i,g),y){const x=yn(h,i,m);await global.Linking.openURL(x,this.client.name)}else{const x=nt[s].req;a&&(x.ttl=a),o&&(x.id=o),x.tvf=St(Ue({},l),{correlationId:g.id}),c?(x.internal=St(Ue({},x.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,m,x)):this.client.core.relayer.publish(i,m,x).catch(D=>this.client.logger.error(D))}return g.id}),K(this,"sendResult",async t=>{const{id:i,topic:s,result:n,throwOnFailedPublish:a,encodeOpts:o,appLink:u}=t,c=ea(i,n);let h;const l=u&&typeof(global==null?void 0:global.Linking)<"u";try{const y=l?_s:qr;h=await this.client.core.crypto.encode(s,c,St(Ue({},o||{}),{encoding:y}))}catch(y){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),y}let g,m;try{g=await this.client.core.history.get(s,i);const y=g.request;try{this.shouldSetTVF(y.method,y.params)&&(m=this.getTVFParams(i,y.params,n))}catch(_){this.client.logger.warn("sendResult() -> getTVFParams() failed",_)}}catch(y){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),y}if(l){const y=yn(u,s,h);await global.Linking.openURL(y,this.client.name)}else{const y=g.request.method,_=nt[y].res;_.tvf=St(Ue({},m),{correlationId:i}),a?(_.internal=St(Ue({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,h,_)):this.client.core.relayer.publish(s,h,_).catch(O=>this.client.logger.error(O))}await this.client.core.history.resolve(c)}),K(this,"sendError",async t=>{const{id:i,topic:s,error:n,encodeOpts:a,rpcOpts:o,appLink:u}=t,c=ta(i,n);let h;const l=u&&typeof(global==null?void 0:global.Linking)<"u";try{const m=l?_s:qr;h=await this.client.core.crypto.encode(s,c,St(Ue({},a||{}),{encoding:m}))}catch(m){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),m}let g;try{g=await this.client.core.history.get(s,i)}catch(m){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),m}if(l){const m=yn(u,s,h);await global.Linking.openURL(m,this.client.name)}else{const m=g.request.method,y=o||nt[m].res;this.client.core.relayer.publish(s,h,y)}await this.client.core.history.resolve(c)}),K(this,"cleanup",async()=>{const t=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;Nr(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Nr(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),K(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),K(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===ur.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ur.active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=ur.idle}),K(this,"processRequest",async t=>{const{topic:i,payload:s,attestation:n,transportType:a,encryptedId:o}=t,u=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:u}))switch(u){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:o});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:o,transportType:a});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:o,transportType:a});default:return this.client.logger.info(`Unsupported request method ${u}`)}}),K(this,"onRelayEventResponse",async t=>{const{topic:i,payload:s,transportType:n}=t,a=(await this.client.core.history.get(i,s.id)).request.method;switch(a){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${a}`)}}),K(this,"onRelayEventUnknownPayload",t=>{const{topic:i}=t,{message:s}=W("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),K(this,"shouldIgnorePairingRequest",t=>{const{topic:i,requestMethod:s}=t,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),K(this,"onSessionProposeRequest",async t=>{const{topic:i,payload:s,attestation:n,encryptedId:a}=t,{params:o,id:u}=s;try{const c=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),c==null||c.setError(Er.proposal_listener_not_found)),this.isValidConnect(Ue({},s.params));const h=o.expiryTimestamp||tt(nt.wc_sessionPropose.req.ttl),l=Ue({id:u,pairingTopic:i,expiryTimestamp:h},o);await this.setProposal(u,l);const g=await this.getVerifyContext({attestationId:n,hash:$r(JSON.stringify(s)),encryptedId:a,metadata:l.proposer.metadata});c==null||c.addTrace(hr.emit_session_proposal),this.client.events.emit("session_proposal",{id:u,params:l,verifyContext:g})}catch(c){await this.sendError({id:u,topic:i,error:c,rpcOpts:nt.wc_sessionPropose.autoReject}),this.client.logger.error(c)}}),K(this,"onSessionProposeResponse",async(t,i,s)=>{const{id:n}=i;if(dr(i)){const{result:a}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:a});const o=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:o});const u=o.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:u});const c=a.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:c});const h=await this.client.core.crypto.generateSharedKey(u,c);this.pendingSessions.set(n,{sessionTopic:h,pairingTopic:t,proposalId:n,publicKey:u});const l=await this.client.core.relayer.subscribe(h,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:t})}else if(Ht(i)){await this.client.proposal.delete(n,he("USER_DISCONNECTED"));const a=ue("session_connect",n);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners, 954`);this.events.emit(a,{error:i.error})}}),K(this,"onSessionSettleRequest",async(t,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:a,controller:o,expiry:u,namespaces:c,sessionProperties:h,sessionConfig:l}=i.params,g=[...this.pendingSessions.values()].find(_=>_.sessionTopic===t);if(!g)return this.client.logger.error(`Pending session not found for topic ${t}`);const m=this.client.proposal.get(g.proposalId),y=St(Ue(Ue({topic:t,relay:a,expiry:u,namespaces:c,acknowledged:!0,pairingTopic:g.pairingTopic,requiredNamespaces:m.requiredNamespaces,optionalNamespaces:m.optionalNamespaces,controller:o.publicKey,self:{publicKey:g.publicKey,metadata:this.client.metadata},peer:{publicKey:o.publicKey,metadata:o.metadata}},h&&{sessionProperties:h}),l&&{sessionConfig:l}),{transportType:De.relay});await this.client.session.set(y.topic,y),await this.setExpiry(y.topic,y.expiry),await this.client.core.pairing.updateMetadata({topic:g.pairingTopic,metadata:y.peer.metadata}),this.client.events.emit("session_connect",{session:y}),this.events.emit(ue("session_connect",g.proposalId),{session:y}),this.pendingSessions.delete(g.proposalId),this.deleteProposal(g.proposalId,!1),this.cleanupDuplicatePairings(y),await this.sendResult({id:i.id,topic:t,result:!0,throwOnFailedPublish:!0})}catch(a){await this.sendError({id:s,topic:t,error:a}),this.client.logger.error(a)}}),K(this,"onSessionSettleResponse",async(t,i)=>{const{id:s}=i;dr(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(ue("session_approve",s),{})):Ht(i)&&(await this.client.session.delete(t,he("USER_DISCONNECTED")),this.events.emit(ue("session_approve",s),{error:i.error}))}),K(this,"onSessionUpdateRequest",async(t,i)=>{const{params:s,id:n}=i;try{const a=`${t}_session_update`,o=Es.get(a);if(o&&this.isRequestOutOfSync(o,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:t,error:he("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(Ue({topic:t},s));try{Es.set(a,n),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:t,result:!0,throwOnFailedPublish:!0})}catch(u){throw Es.delete(a),u}this.client.events.emit("session_update",{id:n,topic:t,params:s})}catch(a){await this.sendError({id:n,topic:t,error:a}),this.client.logger.error(a)}}),K(this,"isRequestOutOfSync",(t,i)=>i.toString().slice(0,-3)<t.toString().slice(0,-3)),K(this,"onSessionUpdateResponse",(t,i)=>{const{id:s}=i,n=ue("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);dr(i)?this.events.emit(ue("session_update",s),{}):Ht(i)&&this.events.emit(ue("session_update",s),{error:i.error})}),K(this,"onSessionExtendRequest",async(t,i)=>{const{id:s}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,tt(_i)),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),K(this,"onSessionExtendResponse",(t,i)=>{const{id:s}=i,n=ue("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);dr(i)?this.events.emit(ue("session_extend",s),{}):Ht(i)&&this.events.emit(ue("session_extend",s),{error:i.error})}),K(this,"onSessionPingRequest",async(t,i)=>{const{id:s}=i;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),K(this,"onSessionPingResponse",(t,i)=>{const{id:s}=i,n=ue("session_ping",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);setTimeout(()=>{dr(i)?this.events.emit(ue("session_ping",s),{}):Ht(i)&&this.events.emit(ue("session_ping",s),{error:i.error})},500)}),K(this,"onSessionDeleteRequest",async(t,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(ot.publish,async()=>{n(await this.deleteSession({topic:t,id:s}))})}),this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:he("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),K(this,"onSessionRequest",async t=>{var i,s,n;const{topic:a,payload:o,attestation:u,encryptedId:c,transportType:h}=t,{id:l,params:g}=o;try{await this.isValidRequest(Ue({topic:a},g));const m=this.client.session.get(a),y=await this.getVerifyContext({attestationId:u,hash:$r(JSON.stringify(Br("wc_sessionRequest",g,l))),encryptedId:c,metadata:m.peer.metadata,transportType:h}),_={id:l,topic:a,params:g,verifyContext:y};await this.setPendingSessionRequest(_),h===De.link_mode&&(i=m.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=m.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(_):(this.addSessionRequestToSessionRequestQueue(_),this.processSessionRequestQueue())}catch(m){await this.sendError({id:l,topic:a,error:m}),this.client.logger.error(m)}}),K(this,"onSessionRequestResponse",(t,i)=>{const{id:s}=i,n=ue("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);dr(i)?this.events.emit(ue("session_request",s),{result:i.result}):Ht(i)&&this.events.emit(ue("session_request",s),{error:i.error})}),K(this,"onSessionEventRequest",async(t,i)=>{const{id:s,params:n}=i;try{const a=`${t}_session_event_${n.event.name}`,o=Es.get(a);if(o&&this.isRequestOutOfSync(o,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(Ue({topic:t},n)),this.client.events.emit("session_event",{id:s,topic:t,params:n}),Es.set(a,s)}catch(a){await this.sendError({id:s,topic:t,error:a}),this.client.logger.error(a)}}),K(this,"onSessionAuthenticateResponse",(t,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:i}),dr(i)?this.events.emit(ue("session_request",s),{result:i.result}):Ht(i)&&this.events.emit(ue("session_request",s),{error:i.error})}),K(this,"onSessionAuthenticateRequest",async t=>{var i;const{topic:s,payload:n,attestation:a,encryptedId:o,transportType:u}=t;try{const{requester:c,authPayload:h,expiryTimestamp:l}=n.params,g=await this.getVerifyContext({attestationId:a,hash:$r(JSON.stringify(n)),encryptedId:o,metadata:c.metadata,transportType:u}),m={requester:c,pairingTopic:s,id:n.id,authPayload:h,verifyContext:g,expiryTimestamp:l};await this.setAuthRequest(n.id,{request:m,pairingTopic:s,transportType:u}),u===De.link_mode&&(i=c.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(c.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:g})}catch(c){this.client.logger.error(c);const h=n.params.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),g=this.getAppLinkIfEnabled(n.params.requester.metadata,u),m={type:Ir,receiverPublicKey:h,senderPublicKey:l};await this.sendError({id:n.id,topic:s,error:c,encodeOpts:m,rpcOpts:nt.wc_sessionAuthenticate.autoReject,appLink:g})}}),K(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),K(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ur.idle,this.processSessionRequestQueue()},V.toMiliseconds(this.requestQueueDelay))}),K(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===t&&n.request.method==="wc_sessionRequest").forEach(n=>{const a=n.request.id,o=ue("session_request",a);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners`);this.events.emit(ue("session_request",n.request.id),{error:i})})}),K(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===ur.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ur.active,this.emitSessionRequest(t)}catch(i){this.client.logger.error(i)}}),K(this,"emitSessionRequest",t=>{this.client.events.emit("session_request",t)}),K(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);i&&this.onSessionProposeRequest({topic:t.topic,payload:Br("wc_sessionPropose",{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties},i.id)})}),K(this,"isValidConnect",async t=>{if(!Dt(t)){const{message:u}=W("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(u)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:a,relays:o}=t;if(wt(i)||await this.isValidPairingTopic(i),!tw(o)){const{message:u}=W("MISSING_OR_INVALID",`connect() relays: ${o}`);throw new Error(u)}!wt(s)&&js(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!wt(n)&&js(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),wt(a)||this.validateSessionProps(a,"sessionProperties")}),K(this,"validateNamespaces",(t,i)=>{const s=ew(t,"connect()",i);if(s)throw new Error(s.message)}),K(this,"isValidApprove",async t=>{if(!Dt(t))throw new Error(W("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:a}=t;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const o=this.client.proposal.get(i),u=Ya(s,"approve()");if(u)throw new Error(u.message);const c=Dh(o.requiredNamespaces,s,"approve()");if(c)throw new Error(c.message);if(!Ze(n,!0)){const{message:h}=W("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(h)}wt(a)||this.validateSessionProps(a,"sessionProperties")}),K(this,"isValidReject",async t=>{if(!Dt(t)){const{message:n}=W("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}const{id:i,reason:s}=t;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!iw(s)){const{message:n}=W("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),K(this,"isValidSessionSettleRequest",t=>{if(!Dt(t)){const{message:c}=W("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(c)}const{relay:i,controller:s,namespaces:n,expiry:a}=t;if(!Tl(i)){const{message:c}=W("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(c)}const o=G2(s,"onSessionSettleRequest()");if(o)throw new Error(o.message);const u=Ya(n,"onSessionSettleRequest()");if(u)throw new Error(u.message);if(Nr(a)){const{message:c}=W("EXPIRED","onSessionSettleRequest()");throw new Error(c)}}),K(this,"isValidUpdate",async t=>{if(!Dt(t)){const{message:u}=W("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(u)}const{topic:i,namespaces:s}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),a=Ya(s,"update()");if(a)throw new Error(a.message);const o=Dh(n.requiredNamespaces,s,"update()");if(o)throw new Error(o.message)}),K(this,"isValidExtend",async t=>{if(!Dt(t)){const{message:s}=W("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:i}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),K(this,"isValidRequest",async t=>{if(!Dt(t)){const{message:u}=W("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(u)}const{topic:i,request:s,chainId:n,expiry:a}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!xh(o,n)){const{message:u}=W("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(u)}if(!sw(s)){const{message:u}=W("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(u)}if(!ow(o,n,s.method)){const{message:u}=W("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(u)}if(a&&!fw(a,oo)){const{message:u}=W("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${oo.min} and ${oo.max}`);throw new Error(u)}}),K(this,"isValidRespond",async t=>{var i;if(!Dt(t)){const{message:a}=W("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(a)}const{topic:s,response:n}=t;try{await this.isValidSessionTopic(s)}catch(a){throw(i=t==null?void 0:t.response)!=null&&i.id&&this.cleanupAfterResponse(t),a}if(!nw(n)){const{message:a}=W("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(a)}}),K(this,"isValidPing",async t=>{if(!Dt(t)){const{message:s}=W("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),K(this,"isValidEmit",async t=>{if(!Dt(t)){const{message:o}=W("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(o)}const{topic:i,event:s,chainId:n}=t;await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!xh(a,n)){const{message:o}=W("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(o)}if(!aw(s)){const{message:o}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}if(!cw(a,n,s.name)){const{message:o}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}}),K(this,"isValidDisconnect",async t=>{if(!Dt(t)){const{message:s}=W("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),K(this,"isValidAuthenticate",t=>{const{chains:i,uri:s,domain:n,nonce:a}=t;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!Ze(s,!1))throw new Error("uri is required parameter");if(!Ze(n,!1))throw new Error("domain is required parameter");if(!Ze(a,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(u=>Ui(u).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:o}=Ui(i[0]);if(o!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),K(this,"getVerifyContext",async t=>{const{attestationId:i,hash:s,encryptedId:n,metadata:a,transportType:o}=t,u={verified:{verifyUrl:a.verifyUrl||Rs,validation:"UNKNOWN",origin:a.url||""}};try{if(o===De.link_mode){const h=this.getAppLinkIfEnabled(a,o);return u.verified.validation=h&&new URL(h).origin===new URL(a.url).origin?"VALID":"INVALID",u}const c=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:a.verifyUrl});c&&(u.verified.origin=c.origin,u.verified.isScam=c.isScam,u.verified.validation=c.origin===new URL(a.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.warn(c)}return this.client.logger.debug(`Verify context: ${JSON.stringify(u)}`),u}),K(this,"validateSessionProps",(t,i)=>{Object.values(t).forEach(s=>{if(!Ze(s,!1)){const{message:n}=W("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(n)}})}),K(this,"getPendingAuthRequest",t=>{const i=this.client.auth.requests.get(t);return typeof i=="object"?i:void 0}),K(this,"addToRecentlyDeleted",(t,i)=>{if(this.recentlyDeletedMap.set(t,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const a of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(a)}}}),K(this,"checkRecentlyDeleted",t=>{const i=this.recentlyDeletedMap.get(t);if(i){const{message:s}=W("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${t}`);throw new Error(s)}}),K(this,"isLinkModeEnabled",(t,i)=>{var s,n,a,o,u,c,h,l,g;return!t||i!==De.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((o=(a=this.client.metadata)==null?void 0:a.redirect)==null?void 0:o.universal)!==void 0&&((c=(u=this.client.metadata)==null?void 0:u.redirect)==null?void 0:c.universal)!==""&&((h=t==null?void 0:t.redirect)==null?void 0:h.universal)!==void 0&&((l=t==null?void 0:t.redirect)==null?void 0:l.universal)!==""&&((g=t==null?void 0:t.redirect)==null?void 0:g.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),K(this,"getAppLinkIfEnabled",(t,i)=>{var s;return this.isLinkModeEnabled(t,i)?(s=t==null?void 0:t.redirect)==null?void 0:s.universal:void 0}),K(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const i=Gu(t,"topic")||"",s=decodeURIComponent(Gu(t,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:De.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),K(this,"registerLinkModeListeners",async()=>{var t;if(lc()||Lr()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),K(this,"shouldSetTVF",(t,i)=>{if(!i||t!=="wc_sessionRequest")return!1;const{request:s}=i;return Object.keys(mf).includes(s.method)}),K(this,"getTVFParams",(t,i,s)=>{var n,a;try{const o=i.request.method,u=this.extractTxHashesFromResult(o,s);return St(Ue({correlationId:t,rpcMethods:[o],chainId:i.chainId},this.isValidContractData(i.request.params)&&{contractAddresses:[(a=(n=i.request.params)==null?void 0:n[0])==null?void 0:a.to]}),{txHashes:u})}catch(o){this.client.logger.warn("Error getting TVF params",o)}return{}}),K(this,"isValidContractData",t=>{var i;if(!t)return!1;try{const s=(t==null?void 0:t.data)||((i=t==null?void 0:t[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),K(this,"extractTxHashesFromResult",(t,i)=>{try{const s=mf[t];if(typeof i=="string")return[i];const n=i[s.key];if(lr(n))return n;if(typeof n=="string")return[n]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ot.message,e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):this.onRelayMessage(e)})}async onRelayMessage(e){const{topic:t,message:i,attestation:s,transportType:n}=e,{publicKey:a}=this.client.auth.authKeys.keys.includes(Rn)?this.client.auth.authKeys.get(Rn):{publicKey:void 0},o=await this.client.core.crypto.decode(t,i,{receiverPublicKey:a,encoding:n===De.link_mode?_s:qr});try{Ic(o)?(this.client.core.history.set(t,o),this.onRelayEventRequest({topic:t,payload:o,attestation:s,transportType:n,encryptedId:$r(i)})):ra(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:t,payload:o,transportType:n}),this.client.core.history.delete(t,o.id)):this.onRelayEventUnknownPayload({topic:t,payload:o,transportType:n})}catch(u){this.client.logger.error(u)}}registerExpirerEvents(){this.client.core.expirer.on(kt.expired,async e=>{const{topic:t,id:i}=cl(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,W("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,W("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(ei.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(ei.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Ze(e,!1)){const{message:t}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Nr(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=W("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Ze(e,!1)){const{message:t}=W("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Nr(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=W("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=W("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ze(e,!1)){const{message:t}=W("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=W("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!rw(e)){const{message:t}=W("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Nr(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=W("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}},Y5=class extends hi{constructor(e,t){super(e,t,T5,Sc),this.core=e,this.logger=t}},X5=class extends hi{constructor(e,t){super(e,t,N5,Sc),this.core=e,this.logger=t}},Z5=class extends hi{constructor(e,t){super(e,t,q5,Sc,i=>i.id),this.core=e,this.logger=t}},Q5=class extends hi{constructor(e,t){super(e,t,U5,sa,()=>Rn),this.core=e,this.logger=t}},e9=class extends hi{constructor(e,t){super(e,t,z5,sa),this.core=e,this.logger=t}},t9=class extends hi{constructor(e,t){super(e,t,k5,sa,i=>i.id),this.core=e,this.logger=t}};var r9=Object.defineProperty,i9=(r,e,t)=>e in r?r9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,co=(r,e,t)=>i9(r,typeof e!="symbol"?e+"":e,t);let s9=class{constructor(e,t){this.core=e,this.logger=t,co(this,"authKeys"),co(this,"pairingTopics"),co(this,"requests"),this.authKeys=new Q5(this.core,this.logger),this.pairingTopics=new e9(this.core,this.logger),this.requests=new t9(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}};var n9=Object.defineProperty,a9=(r,e,t)=>e in r?n9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ie=(r,e,t)=>a9(r,typeof e!="symbol"?e+"":e,t);let o9=class up extends N3{constructor(e){super(e),ie(this,"protocol",ap),ie(this,"version",op),ie(this,"name",ao.name),ie(this,"metadata"),ie(this,"core"),ie(this,"logger"),ie(this,"events",new qt.EventEmitter),ie(this,"engine"),ie(this,"session"),ie(this,"proposal"),ie(this,"pendingRequest"),ie(this,"auth"),ie(this,"signConfig"),ie(this,"on",(i,s)=>this.events.on(i,s)),ie(this,"once",(i,s)=>this.events.once(i,s)),ie(this,"off",(i,s)=>this.events.off(i,s)),ie(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),ie(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),ie(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),ie(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=(e==null?void 0:e.name)||ao.name,this.metadata=(e==null?void 0:e.metadata)||il(),this.signConfig=e==null?void 0:e.signConfig;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Js(Qn({level:(e==null?void 0:e.logger)||ao.logger}));this.core=(e==null?void 0:e.core)||new R5(e),this.logger=Et(t,this.name),this.session=new X5(this.core,this.logger),this.proposal=new Y5(this.core,this.logger),this.pendingRequest=new Z5(this.core,this.logger),this.engine=new J5(this),this.auth=new s9(this.core,this.logger)}static async init(e){const t=new up(e);return await t.initialize(),t}get context(){return At(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},V.toMiliseconds(V.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var _n={exports:{}},_f;function c9(){return _f||(_f=1,function(r,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Pt<"u"&&Pt,i=function(){function n(){this.fetch=!1,this.DOMException=t.DOMException}return n.prototype=t,new n}();(function(n){(function(a){var o=typeof n<"u"&&n||typeof self<"u"&&self||typeof Pt<"u"&&Pt||{},u={searchParams:"URLSearchParams"in o,iterable:"Symbol"in o&&"iterator"in Symbol,blob:"FileReader"in o&&"Blob"in o&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in o,arrayBuffer:"ArrayBuffer"in o};function c(p){return p&&DataView.prototype.isPrototypeOf(p)}if(u.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(p){return p&&h.indexOf(Object.prototype.toString.call(p))>-1};function g(p){if(typeof p!="string"&&(p=String(p)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(p)||p==="")throw new TypeError('Invalid character in header field name: "'+p+'"');return p.toLowerCase()}function m(p){return typeof p!="string"&&(p=String(p)),p}function y(p){var v={next:function(){var I=p.shift();return{done:I===void 0,value:I}}};return u.iterable&&(v[Symbol.iterator]=function(){return v}),v}function _(p){this.map={},p instanceof _?p.forEach(function(v,I){this.append(I,v)},this):Array.isArray(p)?p.forEach(function(v){if(v.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+v.length);this.append(v[0],v[1])},this):p&&Object.getOwnPropertyNames(p).forEach(function(v){this.append(v,p[v])},this)}_.prototype.append=function(p,v){p=g(p),v=m(v);var I=this.map[p];this.map[p]=I?I+", "+v:v},_.prototype.delete=function(p){delete this.map[g(p)]},_.prototype.get=function(p){return p=g(p),this.has(p)?this.map[p]:null},_.prototype.has=function(p){return this.map.hasOwnProperty(g(p))},_.prototype.set=function(p,v){this.map[g(p)]=m(v)},_.prototype.forEach=function(p,v){for(var I in this.map)this.map.hasOwnProperty(I)&&p.call(v,this.map[I],I,this)},_.prototype.keys=function(){var p=[];return this.forEach(function(v,I){p.push(I)}),y(p)},_.prototype.values=function(){var p=[];return this.forEach(function(v){p.push(v)}),y(p)},_.prototype.entries=function(){var p=[];return this.forEach(function(v,I){p.push([I,v])}),y(p)},u.iterable&&(_.prototype[Symbol.iterator]=_.prototype.entries);function O(p){if(!p._noBody){if(p.bodyUsed)return Promise.reject(new TypeError("Already read"));p.bodyUsed=!0}}function x(p){return new Promise(function(v,I){p.onload=function(){v(p.result)},p.onerror=function(){I(p.error)}})}function D(p){var v=new FileReader,I=x(v);return v.readAsArrayBuffer(p),I}function M(p){var v=new FileReader,I=x(v),P=/charset=([A-Za-z0-9_-]+)/.exec(p.type),E=P?P[1]:"utf-8";return v.readAsText(p,E),I}function R(p){for(var v=new Uint8Array(p),I=new Array(v.length),P=0;P<v.length;P++)I[P]=String.fromCharCode(v[P]);return I.join("")}function N(p){if(p.slice)return p.slice(0);var v=new Uint8Array(p.byteLength);return v.set(new Uint8Array(p)),v.buffer}function C(){return this.bodyUsed=!1,this._initBody=function(p){this.bodyUsed=this.bodyUsed,this._bodyInit=p,p?typeof p=="string"?this._bodyText=p:u.blob&&Blob.prototype.isPrototypeOf(p)?this._bodyBlob=p:u.formData&&FormData.prototype.isPrototypeOf(p)?this._bodyFormData=p:u.searchParams&&URLSearchParams.prototype.isPrototypeOf(p)?this._bodyText=p.toString():u.arrayBuffer&&u.blob&&c(p)?(this._bodyArrayBuffer=N(p.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(p)||l(p))?this._bodyArrayBuffer=N(p):this._bodyText=p=Object.prototype.toString.call(p):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof p=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):u.searchParams&&URLSearchParams.prototype.isPrototypeOf(p)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u.blob&&(this.blob=function(){var p=O(this);if(p)return p;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var p=O(this);return p||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(u.blob)return this.blob().then(D);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var p=O(this);if(p)return p;if(this._bodyBlob)return M(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(R(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},u.formData&&(this.formData=function(){return this.text().then(H)}),this.json=function(){return this.text().then(JSON.parse)},this}var q=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function B(p){var v=p.toUpperCase();return q.indexOf(v)>-1?v:p}function F(p,v){if(!(this instanceof F))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');v=v||{};var I=v.body;if(p instanceof F){if(p.bodyUsed)throw new TypeError("Already read");this.url=p.url,this.credentials=p.credentials,v.headers||(this.headers=new _(p.headers)),this.method=p.method,this.mode=p.mode,this.signal=p.signal,!I&&p._bodyInit!=null&&(I=p._bodyInit,p.bodyUsed=!0)}else this.url=String(p);if(this.credentials=v.credentials||this.credentials||"same-origin",(v.headers||!this.headers)&&(this.headers=new _(v.headers)),this.method=B(v.method||this.method||"GET"),this.mode=v.mode||this.mode||null,this.signal=v.signal||this.signal||function(){if("AbortController"in o){var d=new AbortController;return d.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&I)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(I),(this.method==="GET"||this.method==="HEAD")&&(v.cache==="no-store"||v.cache==="no-cache")){var P=/([?&])_=[^&]*/;if(P.test(this.url))this.url=this.url.replace(P,"$1_="+new Date().getTime());else{var E=/\?/;this.url+=(E.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}F.prototype.clone=function(){return new F(this,{body:this._bodyInit})};function H(p){var v=new FormData;return p.trim().split("&").forEach(function(I){if(I){var P=I.split("="),E=P.shift().replace(/\+/g," "),d=P.join("=").replace(/\+/g," ");v.append(decodeURIComponent(E),decodeURIComponent(d))}}),v}function S(p){var v=new _,I=p.replace(/\r?\n[\t ]+/g," ");return I.split("\r").map(function(P){return P.indexOf(`
`)===0?P.substr(1,P.length):P}).forEach(function(P){var E=P.split(":"),d=E.shift().trim();if(d){var $=E.join(":").trim();try{v.append(d,$)}catch(j){console.warn("Response "+j.message)}}}),v}C.call(F.prototype);function f(p,v){if(!(this instanceof f))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(v||(v={}),this.type="default",this.status=v.status===void 0?200:v.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=v.statusText===void 0?"":""+v.statusText,this.headers=new _(v.headers),this.url=v.url||"",this._initBody(p)}C.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new _(this.headers),url:this.url})},f.error=function(){var p=new f(null,{status:200,statusText:""});return p.ok=!1,p.status=0,p.type="error",p};var b=[301,302,303,307,308];f.redirect=function(p,v){if(b.indexOf(v)===-1)throw new RangeError("Invalid status code");return new f(null,{status:v,headers:{location:p}})},a.DOMException=o.DOMException;try{new a.DOMException}catch{a.DOMException=function(v,I){this.message=v,this.name=I;var P=Error(v);this.stack=P.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function w(p,v){return new Promise(function(I,P){var E=new F(p,v);if(E.signal&&E.signal.aborted)return P(new a.DOMException("Aborted","AbortError"));var d=new XMLHttpRequest;function $(){d.abort()}d.onload=function(){var L={statusText:d.statusText,headers:S(d.getAllResponseHeaders()||"")};E.url.indexOf("file://")===0&&(d.status<200||d.status>599)?L.status=200:L.status=d.status,L.url="responseURL"in d?d.responseURL:L.headers.get("X-Request-URL");var z="response"in d?d.response:d.responseText;setTimeout(function(){I(new f(z,L))},0)},d.onerror=function(){setTimeout(function(){P(new TypeError("Network request failed"))},0)},d.ontimeout=function(){setTimeout(function(){P(new TypeError("Network request timed out"))},0)},d.onabort=function(){setTimeout(function(){P(new a.DOMException("Aborted","AbortError"))},0)};function j(L){try{return L===""&&o.location.href?o.location.href:L}catch{return L}}if(d.open(E.method,j(E.url),!0),E.credentials==="include"?d.withCredentials=!0:E.credentials==="omit"&&(d.withCredentials=!1),"responseType"in d&&(u.blob?d.responseType="blob":u.arrayBuffer&&(d.responseType="arraybuffer")),v&&typeof v.headers=="object"&&!(v.headers instanceof _||o.Headers&&v.headers instanceof o.Headers)){var U=[];Object.getOwnPropertyNames(v.headers).forEach(function(L){U.push(g(L)),d.setRequestHeader(L,m(v.headers[L]))}),E.headers.forEach(function(L,z){U.indexOf(z)===-1&&d.setRequestHeader(z,L)})}else E.headers.forEach(function(L,z){d.setRequestHeader(z,L)});E.signal&&(E.signal.addEventListener("abort",$),d.onreadystatechange=function(){d.readyState===4&&E.signal.removeEventListener("abort",$)}),d.send(typeof E._bodyInit>"u"?null:E._bodyInit)})}return w.polyfill=!0,o.fetch||(o.fetch=w,o.Headers=_,o.Request=F,o.Response=f),a.Headers=_,a.Request=F,a.Response=f,a.fetch=w,Object.defineProperty(a,"__esModule",{value:!0}),a})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=t.fetch?t:i;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,r.exports=e}(_n,_n.exports)),_n.exports}var u9=c9();const Ef=Hn(u9);var h9=Object.defineProperty,f9=Object.defineProperties,d9=Object.getOwnPropertyDescriptors,$f=Object.getOwnPropertySymbols,l9=Object.prototype.hasOwnProperty,p9=Object.prototype.propertyIsEnumerable,If=(r,e,t)=>e in r?h9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Sf=(r,e)=>{for(var t in e||(e={}))l9.call(e,t)&&If(r,t,e[t]);if($f)for(var t of $f(e))p9.call(e,t)&&If(r,t,e[t]);return r},xf=(r,e)=>f9(r,d9(e));const g9={Accept:"application/json","Content-Type":"application/json"},b9="POST",Df={headers:g9,method:b9},Pf=10;let ir=class{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new qt.EventEmitter,this.isAvailable=!1,this.registering=!1,!Vh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const t=Sr(e),i=await(await Ef(this.url,xf(Sf({},Df),{body:t}))).json();this.onPayload({data:i})}catch(t){this.onError(e.id,t)}}async register(e=this.url){if(!Vh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=Sr({id:1,jsonrpc:"2.0",method:"test",params:[]});await Ef(e,xf(Sf({},Df),{body:t}))}this.onOpen()}catch(t){const i=this.parseError(t);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?ni(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),n=ta(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return Ll(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Pf&&this.events.setMaxListeners(Pf)}};const Af="error",y9="wss://relay.walletconnect.org",v9="wc",m9="universal_provider",Of=`${v9}@2:${m9}:`,hp="https://rpc.walletconnect.org/v1/",Ti="generic",w9=`${hp}bundler`,Gt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var En=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _9(){this.__data__=[],this.size=0}var E9=_9;function $9(r,e){return r===e||r!==r&&e!==e}var na=$9,I9=na;function S9(r,e){for(var t=r.length;t--;)if(I9(r[t][0],e))return t;return-1}var aa=S9,x9=aa,D9=Array.prototype,P9=D9.splice;function A9(r){var e=this.__data__,t=x9(e,r);if(t<0)return!1;var i=e.length-1;return t==i?e.pop():P9.call(e,t,1),--this.size,!0}var O9=A9,M9=aa;function C9(r){var e=this.__data__,t=M9(e,r);return t<0?void 0:e[t][1]}var R9=C9,T9=aa;function N9(r){return T9(this.__data__,r)>-1}var F9=N9,q9=aa;function B9(r,e){var t=this.__data__,i=q9(t,r);return i<0?(++this.size,t.push([r,e])):t[i][1]=e,this}var j9=B9,L9=E9,U9=O9,z9=R9,k9=F9,H9=j9;function Ni(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}Ni.prototype.clear=L9,Ni.prototype.delete=U9,Ni.prototype.get=z9,Ni.prototype.has=k9,Ni.prototype.set=H9;var oa=Ni,K9=oa;function V9(){this.__data__=new K9,this.size=0}var W9=V9;function G9(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var J9=G9;function Y9(r){return this.__data__.get(r)}var X9=Y9;function Z9(r){return this.__data__.has(r)}var Q9=Z9,e7=typeof En=="object"&&En&&En.Object===Object&&En,fp=e7,t7=fp,r7=typeof self=="object"&&self&&self.Object===Object&&self,i7=t7||r7||Function("return this")(),Yi=i7,s7=Yi,n7=s7.Symbol,dp=n7,Mf=dp,lp=Object.prototype,a7=lp.hasOwnProperty,o7=lp.toString,Ds=Mf?Mf.toStringTag:void 0;function c7(r){var e=a7.call(r,Ds),t=r[Ds];try{r[Ds]=void 0;var i=!0}catch{}var s=o7.call(r);return i&&(e?r[Ds]=t:delete r[Ds]),s}var u7=c7,h7=Object.prototype,f7=h7.toString;function d7(r){return f7.call(r)}var l7=d7,Cf=dp,p7=u7,g7=l7,b7="[object Null]",y7="[object Undefined]",Rf=Cf?Cf.toStringTag:void 0;function v7(r){return r==null?r===void 0?y7:b7:Rf&&Rf in Object(r)?p7(r):g7(r)}var ca=v7;function m7(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var fi=m7,w7=ca,_7=fi,E7="[object AsyncFunction]",$7="[object Function]",I7="[object GeneratorFunction]",S7="[object Proxy]";function x7(r){if(!_7(r))return!1;var e=w7(r);return e==$7||e==I7||e==E7||e==S7}var xc=x7,D7=Yi,P7=D7["__core-js_shared__"],A7=P7,uo=A7,Tf=function(){var r=/[^.]+$/.exec(uo&&uo.keys&&uo.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function O7(r){return!!Tf&&Tf in r}var M7=O7,C7=Function.prototype,R7=C7.toString;function T7(r){if(r!=null){try{return R7.call(r)}catch{}try{return r+""}catch{}}return""}var N7=T7,F7=xc,q7=M7,B7=fi,j7=N7,L7=/[\\^$.*+?()[\]{}|]/g,U7=/^\[object .+?Constructor\]$/,z7=Function.prototype,k7=Object.prototype,H7=z7.toString,K7=k7.hasOwnProperty,V7=RegExp("^"+H7.call(K7).replace(L7,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function W7(r){if(!B7(r)||q7(r))return!1;var e=F7(r)?V7:U7;return e.test(j7(r))}var G7=W7;function J7(r,e){return r==null?void 0:r[e]}var Y7=J7,X7=G7,Z7=Y7;function Q7(r,e){var t=Z7(r,e);return X7(t)?t:void 0}var Dc=Q7,e_=Dc,t_=Yi,r_=e_(t_,"Map"),pp=r_,i_=Dc,s_=i_(Object,"create"),ua=s_,Nf=ua;function n_(){this.__data__=Nf?Nf(null):{},this.size=0}var a_=n_;function o_(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var c_=o_,u_=ua,h_="__lodash_hash_undefined__",f_=Object.prototype,d_=f_.hasOwnProperty;function l_(r){var e=this.__data__;if(u_){var t=e[r];return t===h_?void 0:t}return d_.call(e,r)?e[r]:void 0}var p_=l_,g_=ua,b_=Object.prototype,y_=b_.hasOwnProperty;function v_(r){var e=this.__data__;return g_?e[r]!==void 0:y_.call(e,r)}var m_=v_,w_=ua,__="__lodash_hash_undefined__";function E_(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=w_&&e===void 0?__:e,this}var $_=E_,I_=a_,S_=c_,x_=p_,D_=m_,P_=$_;function Fi(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}Fi.prototype.clear=I_,Fi.prototype.delete=S_,Fi.prototype.get=x_,Fi.prototype.has=D_,Fi.prototype.set=P_;var A_=Fi,Ff=A_,O_=oa,M_=pp;function C_(){this.size=0,this.__data__={hash:new Ff,map:new(M_||O_),string:new Ff}}var R_=C_;function T_(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var N_=T_,F_=N_;function q_(r,e){var t=r.__data__;return F_(e)?t[typeof e=="string"?"string":"hash"]:t.map}var ha=q_,B_=ha;function j_(r){var e=B_(this,r).delete(r);return this.size-=e?1:0,e}var L_=j_,U_=ha;function z_(r){return U_(this,r).get(r)}var k_=z_,H_=ha;function K_(r){return H_(this,r).has(r)}var V_=K_,W_=ha;function G_(r,e){var t=W_(this,r),i=t.size;return t.set(r,e),this.size+=t.size==i?0:1,this}var J_=G_,Y_=R_,X_=L_,Z_=k_,Q_=V_,eE=J_;function qi(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}qi.prototype.clear=Y_,qi.prototype.delete=X_,qi.prototype.get=Z_,qi.prototype.has=Q_,qi.prototype.set=eE;var tE=qi,rE=oa,iE=pp,sE=tE,nE=200;function aE(r,e){var t=this.__data__;if(t instanceof rE){var i=t.__data__;if(!iE||i.length<nE-1)return i.push([r,e]),this.size=++t.size,this;t=this.__data__=new sE(i)}return t.set(r,e),this.size=t.size,this}var oE=aE,cE=oa,uE=W9,hE=J9,fE=X9,dE=Q9,lE=oE;function Bi(r){var e=this.__data__=new cE(r);this.size=e.size}Bi.prototype.clear=uE,Bi.prototype.delete=hE,Bi.prototype.get=fE,Bi.prototype.has=dE,Bi.prototype.set=lE;var pE=Bi,gE=Dc,bE=function(){try{var r=gE(Object,"defineProperty");return r({},"",{}),r}catch{}}(),gp=bE,qf=gp;function yE(r,e,t){e=="__proto__"&&qf?qf(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var Pc=yE,vE=Pc,mE=na;function wE(r,e,t){(t!==void 0&&!mE(r[e],t)||t===void 0&&!(e in r))&&vE(r,e,t)}var bp=wE;function _E(r){return function(e,t,i){for(var s=-1,n=Object(e),a=i(e),o=a.length;o--;){var u=a[r?o:++s];if(t(n[u],u,n)===!1)break}return e}}var EE=_E,$E=EE,IE=$E(),SE=IE,Jo={exports:{}};(function(r,e){var t=Yi,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,n=s&&s.exports===i,a=n?t.Buffer:void 0,o=a?a.allocUnsafe:void 0;function u(c,h){if(h)return c.slice();var l=c.length,g=o?o(l):new c.constructor(l);return c.copy(g),g}r.exports=u})(Jo,Jo.exports);var xE=Yi,DE=xE.Uint8Array,PE=DE,Bf=PE;function AE(r){var e=new r.constructor(r.byteLength);return new Bf(e).set(new Bf(r)),e}var OE=AE,ME=OE;function CE(r,e){var t=e?ME(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var RE=CE;function TE(r,e){var t=-1,i=r.length;for(e||(e=Array(i));++t<i;)e[t]=r[t];return e}var NE=TE,FE=fi,jf=Object.create,qE=function(){function r(){}return function(e){if(!FE(e))return{};if(jf)return jf(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),BE=qE;function jE(r,e){return function(t){return r(e(t))}}var LE=jE,UE=LE,zE=UE(Object.getPrototypeOf,Object),yp=zE,kE=Object.prototype;function HE(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||kE;return r===t}var vp=HE,KE=BE,VE=yp,WE=vp;function GE(r){return typeof r.constructor=="function"&&!WE(r)?KE(VE(r)):{}}var JE=GE;function YE(r){return r!=null&&typeof r=="object"}var Zs=YE,XE=ca,ZE=Zs,QE="[object Arguments]";function e$(r){return ZE(r)&&XE(r)==QE}var t$=e$,Lf=t$,r$=Zs,mp=Object.prototype,i$=mp.hasOwnProperty,s$=mp.propertyIsEnumerable,n$=Lf(function(){return arguments}())?Lf:function(r){return r$(r)&&i$.call(r,"callee")&&!s$.call(r,"callee")},wp=n$,a$=Array.isArray,_p=a$,o$=9007199254740991;function c$(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=o$}var Ep=c$,u$=xc,h$=Ep;function f$(r){return r!=null&&h$(r.length)&&!u$(r)}var Ac=f$,d$=Ac,l$=Zs;function p$(r){return l$(r)&&d$(r)}var g$=p$,zn={exports:{}};function b$(){return!1}var y$=b$;(function(r,e){var t=Yi,i=y$,s=e&&!e.nodeType&&e,n=s&&!0&&r&&!r.nodeType&&r,a=n&&n.exports===s,o=a?t.Buffer:void 0,u=o?o.isBuffer:void 0,c=u||i;r.exports=c})(zn,zn.exports);var v$=ca,m$=yp,w$=Zs,_$="[object Object]",E$=Function.prototype,$$=Object.prototype,$p=E$.toString,I$=$$.hasOwnProperty,S$=$p.call(Object);function x$(r){if(!w$(r)||v$(r)!=_$)return!1;var e=m$(r);if(e===null)return!0;var t=I$.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&$p.call(t)==S$}var D$=x$,P$=ca,A$=Ep,O$=Zs,M$="[object Arguments]",C$="[object Array]",R$="[object Boolean]",T$="[object Date]",N$="[object Error]",F$="[object Function]",q$="[object Map]",B$="[object Number]",j$="[object Object]",L$="[object RegExp]",U$="[object Set]",z$="[object String]",k$="[object WeakMap]",H$="[object ArrayBuffer]",K$="[object DataView]",V$="[object Float32Array]",W$="[object Float64Array]",G$="[object Int8Array]",J$="[object Int16Array]",Y$="[object Int32Array]",X$="[object Uint8Array]",Z$="[object Uint8ClampedArray]",Q$="[object Uint16Array]",eI="[object Uint32Array]",xe={};xe[V$]=xe[W$]=xe[G$]=xe[J$]=xe[Y$]=xe[X$]=xe[Z$]=xe[Q$]=xe[eI]=!0,xe[M$]=xe[C$]=xe[H$]=xe[R$]=xe[K$]=xe[T$]=xe[N$]=xe[F$]=xe[q$]=xe[B$]=xe[j$]=xe[L$]=xe[U$]=xe[z$]=xe[k$]=!1;function tI(r){return O$(r)&&A$(r.length)&&!!xe[P$(r)]}var rI=tI;function iI(r){return function(e){return r(e)}}var sI=iI,Yo={exports:{}};(function(r,e){var t=fp,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,n=s&&s.exports===i,a=n&&t.process,o=function(){try{var u=s&&s.require&&s.require("util").types;return u||a&&a.binding&&a.binding("util")}catch{}}();r.exports=o})(Yo,Yo.exports);var nI=rI,aI=sI,Uf=Yo.exports,zf=Uf&&Uf.isTypedArray,oI=zf?aI(zf):nI,Ip=oI;function cI(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var Sp=cI,uI=Pc,hI=na,fI=Object.prototype,dI=fI.hasOwnProperty;function lI(r,e,t){var i=r[e];(!(dI.call(r,e)&&hI(i,t))||t===void 0&&!(e in r))&&uI(r,e,t)}var pI=lI,gI=pI,bI=Pc;function yI(r,e,t,i){var s=!t;t||(t={});for(var n=-1,a=e.length;++n<a;){var o=e[n],u=i?i(t[o],r[o],o,t,r):void 0;u===void 0&&(u=r[o]),s?bI(t,o,u):gI(t,o,u)}return t}var vI=yI;function mI(r,e){for(var t=-1,i=Array(r);++t<r;)i[t]=e(t);return i}var wI=mI,_I=9007199254740991,EI=/^(?:0|[1-9]\d*)$/;function $I(r,e){var t=typeof r;return e=e??_I,!!e&&(t=="number"||t!="symbol"&&EI.test(r))&&r>-1&&r%1==0&&r<e}var xp=$I,II=wI,SI=wp,xI=_p,DI=zn.exports,PI=xp,AI=Ip,OI=Object.prototype,MI=OI.hasOwnProperty;function CI(r,e){var t=xI(r),i=!t&&SI(r),s=!t&&!i&&DI(r),n=!t&&!i&&!s&&AI(r),a=t||i||s||n,o=a?II(r.length,String):[],u=o.length;for(var c in r)(e||MI.call(r,c))&&!(a&&(c=="length"||s&&(c=="offset"||c=="parent")||n&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||PI(c,u)))&&o.push(c);return o}var RI=CI;function TI(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var NI=TI,FI=fi,qI=vp,BI=NI,jI=Object.prototype,LI=jI.hasOwnProperty;function UI(r){if(!FI(r))return BI(r);var e=qI(r),t=[];for(var i in r)i=="constructor"&&(e||!LI.call(r,i))||t.push(i);return t}var zI=UI,kI=RI,HI=zI,KI=Ac;function VI(r){return KI(r)?kI(r,!0):HI(r)}var Dp=VI,WI=vI,GI=Dp;function JI(r){return WI(r,GI(r))}var YI=JI,kf=bp,XI=Jo.exports,ZI=RE,QI=NE,eS=JE,Hf=wp,Kf=_p,tS=g$,rS=zn.exports,iS=xc,sS=fi,nS=D$,aS=Ip,Vf=Sp,oS=YI;function cS(r,e,t,i,s,n,a){var o=Vf(r,t),u=Vf(e,t),c=a.get(u);if(c){kf(r,t,c);return}var h=n?n(o,u,t+"",r,e,a):void 0,l=h===void 0;if(l){var g=Kf(u),m=!g&&rS(u),y=!g&&!m&&aS(u);h=u,g||m||y?Kf(o)?h=o:tS(o)?h=QI(o):m?(l=!1,h=XI(u,!0)):y?(l=!1,h=ZI(u,!0)):h=[]:nS(u)||Hf(u)?(h=o,Hf(o)?h=oS(o):(!sS(o)||iS(o))&&(h=eS(u))):l=!1}l&&(a.set(u,h),s(h,u,i,n,a),a.delete(u)),kf(r,t,h)}var uS=cS,hS=pE,fS=bp,dS=SE,lS=uS,pS=fi,gS=Dp,bS=Sp;function Pp(r,e,t,i,s){r!==e&&dS(e,function(n,a){if(s||(s=new hS),pS(n))lS(r,e,a,t,Pp,i,s);else{var o=i?i(bS(r,a),n,a+"",r,e,s):void 0;o===void 0&&(o=n),fS(r,a,o)}},gS)}var yS=Pp;function vS(r){return r}var Ap=vS;function mS(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var wS=mS,_S=wS,Wf=Math.max;function ES(r,e,t){return e=Wf(e===void 0?r.length-1:e,0),function(){for(var i=arguments,s=-1,n=Wf(i.length-e,0),a=Array(n);++s<n;)a[s]=i[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=i[s];return o[e]=t(a),_S(r,this,o)}}var $S=ES;function IS(r){return function(){return r}}var SS=IS,xS=SS,Gf=gp,DS=Ap,PS=Gf?function(r,e){return Gf(r,"toString",{configurable:!0,enumerable:!1,value:xS(e),writable:!0})}:DS,AS=PS,OS=800,MS=16,CS=Date.now;function RS(r){var e=0,t=0;return function(){var i=CS(),s=MS-(i-t);if(t=i,s>0){if(++e>=OS)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var TS=RS,NS=AS,FS=TS,qS=FS(NS),BS=qS,jS=Ap,LS=$S,US=BS;function zS(r,e){return US(LS(r,e,jS),r+"")}var kS=zS,HS=na,KS=Ac,VS=xp,WS=fi;function GS(r,e,t){if(!WS(t))return!1;var i=typeof e;return(i=="number"?KS(t)&&VS(e,t.length):i=="string"&&e in t)?HS(t[e],r):!1}var JS=GS,YS=kS,XS=JS;function ZS(r){return YS(function(e,t){var i=-1,s=t.length,n=s>1?t[s-1]:void 0,a=s>2?t[2]:void 0;for(n=r.length>3&&typeof n=="function"?(s--,n):void 0,a&&XS(t[0],t[1],a)&&(n=s<3?void 0:n,s=1),e=Object(e);++i<s;){var o=t[i];o&&r(e,o,i,n)}return e})}var QS=ZS,ex=yS,tx=QS,rx=tx(function(r,e,t){ex(r,e,t)}),ix=rx,sx=Object.defineProperty,nx=Object.defineProperties,ax=Object.getOwnPropertyDescriptors,Jf=Object.getOwnPropertySymbols,ox=Object.prototype.hasOwnProperty,cx=Object.prototype.propertyIsEnumerable,Yf=(r,e,t)=>e in r?sx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$n=(r,e)=>{for(var t in e||(e={}))ox.call(e,t)&&Yf(r,t,e[t]);if(Jf)for(var t of Jf(e))cx.call(e,t)&&Yf(r,t,e[t]);return r},ux=(r,e)=>nx(r,ax(e));function Ft(r,e,t){var i;const s=Ui(r);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${hp}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function di(r){return r.includes(":")?r.split(":")[1]:r}function Op(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function hx(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const i=[];return t.forEach(s=>{const n=e.namespaces[s].accounts;i.push(...n)}),i}function ho(r={},e={}){const t=Xf(r),i=Xf(e);return ix(t,i)}function Xf(r){var e,t,i,s;const n={};if(!js(r))return n;for(const[a,o]of Object.entries(r)){const u=wc(a)?[a]:o.chains,c=o.methods||[],h=o.events||[],l=o.rpcMap||{},g=As(a);n[g]=ux($n($n({},n[g]),o),{chains:Pn(u,(e=n[g])==null?void 0:e.chains),methods:Pn(c,(t=n[g])==null?void 0:t.methods),events:Pn(h,(i=n[g])==null?void 0:i.events),rpcMap:$n($n({},l),(s=n[g])==null?void 0:s.rpcMap)})}return n}function fx(r){return r.includes(":")?r.split(":")[2]:r}function Zf(r){const e={};for(const[t,i]of Object.entries(r)){const s=i.methods||[],n=i.events||[],a=i.accounts||[],o=wc(t)?[t]:i.chains?i.chains:Op(i.accounts);e[t]={chains:o,methods:s,events:n,accounts:a}}return e}function fo(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}const Mp={},ce=r=>Mp[r],lo=(r,e)=>{Mp[r]=e};var dx=Object.defineProperty,lx=(r,e,t)=>e in r?dx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ei=(r,e,t)=>lx(r,typeof e!="symbol"?e+"":e,t);class px{constructor(e){Ei(this,"name","polkadot"),Ei(this,"client"),Ei(this,"httpProviders"),Ei(this,"events"),Ei(this,"namespace"),Ei(this,"chainId"),this.namespace=e.namespace,this.events=ce("events"),this.client=ce("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Gt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=di(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ft(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Wt(new ir(i,ce("disableProviderPing")))}}var gx=Object.defineProperty,bx=Object.defineProperties,yx=Object.getOwnPropertyDescriptors,Qf=Object.getOwnPropertySymbols,vx=Object.prototype.hasOwnProperty,mx=Object.prototype.propertyIsEnumerable,Xo=(r,e,t)=>e in r?gx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ed=(r,e)=>{for(var t in e||(e={}))vx.call(e,t)&&Xo(r,t,e[t]);if(Qf)for(var t of Qf(e))mx.call(e,t)&&Xo(r,t,e[t]);return r},td=(r,e)=>bx(r,yx(e)),$i=(r,e,t)=>Xo(r,typeof e!="symbol"?e+"":e,t);class wx{constructor(e){$i(this,"name","eip155"),$i(this,"client"),$i(this,"chainId"),$i(this,"namespace"),$i(this,"httpProviders"),$i(this,"events"),this.namespace=e.namespace,this.events=ce("events"),this.client=ce("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(Gt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||Ft(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Wt(new ir(i,ce("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(di(t));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,i;let s=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,i,s;const n=(i=(t=e.request)==null?void 0:t.params)==null?void 0:i[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const a=this.client.session.get(e.topic),o=((s=a==null?void 0:a.sessionProperties)==null?void 0:s.capabilities)||{};if(o!=null&&o[n])return o==null?void 0:o[n];const u=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:td(ed({},a.sessionProperties||{}),{capabilities:td(ed({},o||{}),{[n]:u})})})}catch(c){console.warn("Failed to update session with capabilities",c)}return u}async getCallStatus(e){var t,i;const s=this.client.session.get(e.topic),n=(t=s.sessionProperties)==null?void 0:t.bundler_name;if(n){const o=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(o,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,o)}}const a=(i=s.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(o){console.warn("Failed to fetch call status from custom bundler",o,a)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Br("eth_getUserOperationReceipt",[(i=t.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${w9}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var _x=Object.defineProperty,Ex=(r,e,t)=>e in r?_x(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ii=(r,e,t)=>Ex(r,typeof e!="symbol"?e+"":e,t);class $x{constructor(e){Ii(this,"name","solana"),Ii(this,"client"),Ii(this,"httpProviders"),Ii(this,"events"),Ii(this,"namespace"),Ii(this,"chainId"),this.namespace=e.namespace,this.events=ce("events"),this.client=ce("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Gt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=di(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ft(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Wt(new ir(i,ce("disableProviderPing")))}}var Ix=Object.defineProperty,Sx=(r,e,t)=>e in r?Ix(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Si=(r,e,t)=>Sx(r,typeof e!="symbol"?e+"":e,t);class xx{constructor(e){Si(this,"name","cosmos"),Si(this,"client"),Si(this,"httpProviders"),Si(this,"events"),Si(this,"namespace"),Si(this,"chainId"),this.namespace=e.namespace,this.events=ce("events"),this.client=ce("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Gt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=di(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ft(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Wt(new ir(i,ce("disableProviderPing")))}}var Dx=Object.defineProperty,Px=(r,e,t)=>e in r?Dx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xi=(r,e,t)=>Px(r,typeof e!="symbol"?e+"":e,t);class Ax{constructor(e){xi(this,"name","algorand"),xi(this,"client"),xi(this,"httpProviders"),xi(this,"events"),xi(this,"namespace"),xi(this,"chainId"),this.namespace=e.namespace,this.events=ce("events"),this.client=ce("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||Ft(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(Gt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ft(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new Wt(new ir(i,ce("disableProviderPing")))}}var Ox=Object.defineProperty,Mx=(r,e,t)=>e in r?Ox(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Di=(r,e,t)=>Mx(r,typeof e!="symbol"?e+"":e,t);class Cx{constructor(e){Di(this,"name","cip34"),Di(this,"client"),Di(this,"httpProviders"),Di(this,"events"),Di(this,"namespace"),Di(this,"chainId"),this.namespace=e.namespace,this.events=ce("events"),this.client=ce("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Gt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=di(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Wt(new ir(i,ce("disableProviderPing")))}}var Rx=Object.defineProperty,Tx=(r,e,t)=>e in r?Rx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Pi=(r,e,t)=>Tx(r,typeof e!="symbol"?e+"":e,t);class Nx{constructor(e){Pi(this,"name","elrond"),Pi(this,"client"),Pi(this,"httpProviders"),Pi(this,"events"),Pi(this,"namespace"),Pi(this,"chainId"),this.namespace=e.namespace,this.events=ce("events"),this.client=ce("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Gt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=di(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ft(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Wt(new ir(i,ce("disableProviderPing")))}}var Fx=Object.defineProperty,qx=(r,e,t)=>e in r?Fx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ai=(r,e,t)=>qx(r,typeof e!="symbol"?e+"":e,t);class Bx{constructor(e){Ai(this,"name","multiversx"),Ai(this,"client"),Ai(this,"httpProviders"),Ai(this,"events"),Ai(this,"namespace"),Ai(this,"chainId"),this.namespace=e.namespace,this.events=ce("events"),this.client=ce("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Gt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=di(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ft(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Wt(new ir(i,ce("disableProviderPing")))}}var jx=Object.defineProperty,Lx=(r,e,t)=>e in r?jx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Oi=(r,e,t)=>Lx(r,typeof e!="symbol"?e+"":e,t);class Ux{constructor(e){Oi(this,"name","near"),Oi(this,"client"),Oi(this,"httpProviders"),Oi(this,"events"),Oi(this,"namespace"),Oi(this,"chainId"),this.namespace=e.namespace,this.events=ce("events"),this.client=ce("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Gt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ft(e,this.namespace);return typeof i>"u"?void 0:new Wt(new ir(i,ce("disableProviderPing")))}}var zx=Object.defineProperty,kx=(r,e,t)=>e in r?zx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Mi=(r,e,t)=>kx(r,typeof e!="symbol"?e+"":e,t);class Hx{constructor(e){Mi(this,"name","tezos"),Mi(this,"client"),Mi(this,"httpProviders"),Mi(this,"events"),Mi(this,"namespace"),Mi(this,"chainId"),this.namespace=e.namespace,this.events=ce("events"),this.client=ce("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Gt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ft(e,this.namespace);return typeof i>"u"?void 0:new Wt(new ir(i))}}var Kx=Object.defineProperty,Vx=(r,e,t)=>e in r?Kx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ci=(r,e,t)=>Vx(r,typeof e!="symbol"?e+"":e,t);class Wx{constructor(e){Ci(this,"name",Ti),Ci(this,"client"),Ci(this,"httpProviders"),Ci(this,"events"),Ci(this,"namespace"),Ci(this,"chainId"),this.namespace=e.namespace,this.events=ce("events"),this.client=ce("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Gt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(s=>{const n=Ui(s);i[`${n.namespace}:${n.reference}`]=this.createHttpProvider(s)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ft(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Wt(new ir(i,ce("disableProviderPing")))}}var Gx=Object.defineProperty,Jx=Object.defineProperties,Yx=Object.getOwnPropertyDescriptors,rd=Object.getOwnPropertySymbols,Xx=Object.prototype.hasOwnProperty,Zx=Object.prototype.propertyIsEnumerable,Zo=(r,e,t)=>e in r?Gx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,In=(r,e)=>{for(var t in e||(e={}))Xx.call(e,t)&&Zo(r,t,e[t]);if(rd)for(var t of rd(e))Zx.call(e,t)&&Zo(r,t,e[t]);return r},po=(r,e)=>Jx(r,Yx(e)),tr=(r,e,t)=>Zo(r,typeof e!="symbol"?e+"":e,t);class Oc{constructor(e){tr(this,"client"),tr(this,"namespaces"),tr(this,"optionalNamespaces"),tr(this,"sessionProperties"),tr(this,"events",new sc),tr(this,"rpcProviders",{}),tr(this,"session"),tr(this,"providerOpts"),tr(this,"logger"),tr(this,"uri"),tr(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Js(Qn({level:(e==null?void 0:e.logger)||Af})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const t=new Oc(e);return await t.initialize(),t}async request(e,t,i){const[s,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:In({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:i})}sendAsync(e,t,i,s){const n=new Date().getTime();this.request(e,i,s).then(a=>t(null,ea(n,a))).catch(a=>t(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:he("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const a=Zf(this.session.namespaces);this.namespaces=ho(this.namespaces,a),this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await i();this.session=s;const n=Zf(s.namespaces);return this.namespaces=ho(this.namespaces,n),this.persist("namespaces",this.namespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e),n=this.getProvider(i);n.name===Ti?n.setDefaultChain(`${i}:${s}`,t):n.setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(lr(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await o9.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Af,relayUrl:this.providerOpts.relayUrl||y9,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>As(t)))];lo("client",this.client),lo("events",this.events),lo("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=hx(t,this.session),s=Op(i),n=ho(this.namespaces,this.optionalNamespaces),a=po(In({},n[t]),{accounts:i,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new wx({namespace:a});break;case"algorand":this.rpcProviders[t]=new Ax({namespace:a});break;case"solana":this.rpcProviders[t]=new $x({namespace:a});break;case"cosmos":this.rpcProviders[t]=new xx({namespace:a});break;case"polkadot":this.rpcProviders[t]=new px({namespace:a});break;case"cip34":this.rpcProviders[t]=new Cx({namespace:a});break;case"elrond":this.rpcProviders[t]=new Nx({namespace:a});break;case"multiversx":this.rpcProviders[t]=new Bx({namespace:a});break;case"near":this.rpcProviders[t]=new Ux({namespace:a});break;case"tezos":this.rpcProviders[t]=new Hx({namespace:a});break;default:this.rpcProviders[Ti]?this.rpcProviders[Ti].updateNamespace(a):this.rpcProviders[Ti]=new Wx({namespace:a})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:i}=t;if(i.name==="accountsChanged"){const s=i.data;s&&lr(s)&&this.events.emit("accountsChanged",s.map(fx))}else if(i.name==="chainChanged"){const s=t.chainId,n=t.event.data,a=As(s),o=fo(s)!==fo(n)?`${a}:${fo(n)}`:s;this.onChainChanged(o)}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i;const{namespaces:s}=t,n=(i=this.client)==null?void 0:i.session.get(e);this.session=po(In({},n),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",po(In({},he("USER_DISCONNECTED")),{data:e.topic}))}),this.on(Gt.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Ti]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:i,sessionProperties:s}=e;t&&Object.keys(t).length&&(this.namespaces=t),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=s,this.persist("namespaces",t),this.persist("optionalNamespaces",i)}validateChain(e){const[t,i]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(a=>As(a)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const s=As(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){if(!this.namespaces)return;const[i,s]=this.validateChain(e);s&&(t||this.getProvider(i).setDefaultChain(s),this.namespaces[i]?this.namespaces[i].defaultChain=s:this.namespaces[`${i}:${s}`]?this.namespaces[`${i}:${s}`].defaultChain=s:this.namespaces[`${i}:${s}`]={defaultChain:s},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",s))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${Of}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${Of}/${e}`)}}const Qx=Oc,eD="wc",tD="ethereum_provider",rD=`${eD}@2:${tD}:`,iD="https://rpc.walletconnect.org/v1/",Qo=["eth_sendTransaction","personal_sign"],sD=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],ec=["chainChanged","accountsChanged"],nD=["chainChanged","accountsChanged","message","disconnect","connect"];var aD=Object.defineProperty,oD=Object.defineProperties,cD=Object.getOwnPropertyDescriptors,id=Object.getOwnPropertySymbols,uD=Object.prototype.hasOwnProperty,hD=Object.prototype.propertyIsEnumerable,tc=(r,e,t)=>e in r?aD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ji=(r,e)=>{for(var t in e||(e={}))uD.call(e,t)&&tc(r,t,e[t]);if(id)for(var t of id(e))hD.call(e,t)&&tc(r,t,e[t]);return r},go=(r,e)=>oD(r,cD(e)),Ct=(r,e,t)=>tc(r,typeof e!="symbol"?e+"":e,t);function kn(r){return Number(r[0].split(":")[1])}function Sn(r){return`0x${r.toString(16)}`}function fD(r){const{chains:e,optionalChains:t,methods:i,optionalMethods:s,events:n,optionalEvents:a,rpcMap:o}=r;if(!lr(e))throw new Error("Invalid chains");const u={chains:e,methods:i||Qo,events:n||ec,rpcMap:ji({},e.length?{[kn(e)]:o[kn(e)]}:{})},c=n==null?void 0:n.filter(m=>!ec.includes(m)),h=i==null?void 0:i.filter(m=>!Qo.includes(m));if(!t&&!a&&!s&&!(c!=null&&c.length)&&!(h!=null&&h.length))return{required:e.length?u:void 0};const l=(c==null?void 0:c.length)&&(h==null?void 0:h.length)||!t,g={chains:[...new Set(l?u.chains.concat(t||[]):t)],methods:[...new Set(u.methods.concat(s!=null&&s.length?s:sD))],events:[...new Set(u.events.concat(a!=null&&a.length?a:nD))],rpcMap:o};return{required:e.length?u:void 0,optional:t.length?g:void 0}}class Mc{constructor(){Ct(this,"events",new qt.EventEmitter),Ct(this,"namespace","eip155"),Ct(this,"accounts",[]),Ct(this,"signer"),Ct(this,"chainId",1),Ct(this,"modal"),Ct(this,"rpc"),Ct(this,"STORAGE_KEY",rD),Ct(this,"on",(e,t)=>(this.events.on(e,t),this)),Ct(this,"once",(e,t)=>(this.events.once(e,t),this)),Ct(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),Ct(this,"off",(e,t)=>(this.events.off(e,t),this)),Ct(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const t=new Mc;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,i){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:t,optional:i}=fD(this.rpc);try{const s=await new Promise(async(a,o)=>{var u;this.rpc.showQrModal&&((u=this.modal)==null||u.subscribeModal(c=>{!c.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),o(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(go(ji({namespaces:ji({},t&&{[this.namespace]:t})},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:e==null?void 0:e.pairingTopic})).then(c=>{a(c)}).catch(c=>{o(new Error(c.message))})});if(!s)return;const n=Vu(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:n),this.setAccounts(n),this.events.emit("connect",{chainId:Sn(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async authenticate(e,t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const i=await new Promise(async(n,a)=>{var o;this.rpc.showQrModal&&((o=this.modal)==null||o.subscribeModal(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(go(ji({},e),{chains:this.rpc.chains}),t).then(u=>{n(u)}).catch(u=>{a(new Error(u.message))})}),s=i.session;if(s){const n=Vu(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:n),this.setAccounts(n),this.events.emit("connect",{chainId:Sn(this.chainId)})}return i}catch(i){throw this.signer.logger.error(i),i}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:i}=t;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",Sn(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",go(ji({},he("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var t,i;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(i=this.modal)==null||i.openModal({uri:e})),this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",Sn(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,i,s]=e.split(":");return{chainId:`${t}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,i;const s=(t=e==null?void 0:e.chains)!=null?t:[],n=(i=e==null?void 0:e.optionalChains)!=null?i:[],a=s.concat(n);if(!a.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const o=s.length?(e==null?void 0:e.methods)||Qo:[],u=s.length?(e==null?void 0:e.events)||ec:[],c=(e==null?void 0:e.optionalMethods)||[],h=(e==null?void 0:e.optionalEvents)||[],l=(e==null?void 0:e.rpcMap)||this.buildRpcMap(a,e.projectId),g=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:s==null?void 0:s.map(m=>this.formatChainId(m)),optionalChains:n.map(m=>this.formatChainId(m)),methods:o,events:u,optionalMethods:c,optionalEvents:h,rpcMap:l,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:g,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,t)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?kn(this.rpc.chains):kn(this.rpc.optionalChains),this.signer=await Qx.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const{WalletConnectModal:i}=await nd(()=>import("./index-DzABqRQN.js").then(s=>s.i),__vite__mapDeps([2,0,1]));t=i}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(ji({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:i,rpcMap:s}=e;t&&lr(t)&&(this.rpc.chains=t.map(n=>this.formatChainId(n)),t.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)})),i&&lr(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i==null?void 0:i.map(n=>this.formatChainId(n)),i.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)}))}getRpcUrl(e,t){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${iD}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(t=>this.signer.logger.warn(t))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const PP=Mc;export{PP as EthereumProvider,nD as OPTIONAL_EVENTS,sD as OPTIONAL_METHODS,ec as REQUIRED_EVENTS,Qo as REQUIRED_METHODS,Mc as default};
